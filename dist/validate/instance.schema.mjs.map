{"version":3,"sources":["../../src/api/types/wa.types.ts","../../src/validate/instance.schema.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-namespace */\nimport { JsonValue } from '@prisma/client/runtime/library';\nimport { AuthenticationState, WAConnectionState } from 'baileys';\n\nexport enum Events {\n  APPLICATION_STARTUP = 'application.startup',\n  INSTANCE_CREATE = 'instance.create',\n  INSTANCE_DELETE = 'instance.delete',\n  QRCODE_UPDATED = 'qrcode.updated',\n  CONNECTION_UPDATE = 'connection.update',\n  STATUS_INSTANCE = 'status.instance',\n  MESSAGES_SET = 'messages.set',\n  MESSAGES_UPSERT = 'messages.upsert',\n  MESSAGES_EDITED = 'messages.edited',\n  MESSAGES_UPDATE = 'messages.update',\n  MESSAGES_DELETE = 'messages.delete',\n  SEND_MESSAGE = 'send.message',\n  SEND_MESSAGE_UPDATE = 'send.message.update',\n  CONTACTS_SET = 'contacts.set',\n  CONTACTS_UPSERT = 'contacts.upsert',\n  CONTACTS_UPDATE = 'contacts.update',\n  PRESENCE_UPDATE = 'presence.update',\n  CHATS_SET = 'chats.set',\n  CHATS_UPDATE = 'chats.update',\n  CHATS_UPSERT = 'chats.upsert',\n  CHATS_DELETE = 'chats.delete',\n  GROUPS_UPSERT = 'groups.upsert',\n  GROUPS_UPDATE = 'groups.update',\n  GROUP_PARTICIPANTS_UPDATE = 'group-participants.update',\n  CALL = 'call',\n  TYPEBOT_START = 'typebot.start',\n  TYPEBOT_CHANGE_STATUS = 'typebot.change-status',\n  LABELS_EDIT = 'labels.edit',\n  LABELS_ASSOCIATION = 'labels.association',\n  CREDS_UPDATE = 'creds.update',\n  MESSAGING_HISTORY_SET = 'messaging-history.set',\n  REMOVE_INSTANCE = 'remove.instance',\n  LOGOUT_INSTANCE = 'logout.instance',\n}\n\nexport declare namespace wa {\n  export type QrCode = {\n    count?: number;\n    pairingCode?: string;\n    base64?: string;\n    code?: string;\n  };\n\n  export type Instance = {\n    id?: string;\n    qrcode?: QrCode;\n    pairingCode?: string;\n    authState?: { state: AuthenticationState; saveCreds: () => void };\n    name?: string;\n    ownerJid?: string;\n    wuid?: string;\n    profileName?: string;\n    profilePictureUrl?: string;\n    token?: string;\n    number?: string;\n    integration?: string;\n    businessId?: string;\n  };\n\n  export type LocalChatwoot = {\n    enabled?: boolean;\n    accountId?: string;\n    token?: string;\n    url?: string;\n    nameInbox?: string;\n    signMsg?: boolean;\n    signDelimiter?: string;\n    number?: string;\n    reopenConversation?: boolean;\n    conversationPending?: boolean;\n    mergeBrazilContacts?: boolean;\n    importContacts?: boolean;\n    importMessages?: boolean;\n    daysLimitImportMessages?: number;\n  };\n\n  export type LocalSettings = {\n    rejectCall?: boolean;\n    msgCall?: string;\n    groupsIgnore?: boolean;\n    alwaysOnline?: boolean;\n    readMessages?: boolean;\n    readStatus?: boolean;\n    syncFullHistory?: boolean;\n    wavoipToken?: string;\n  };\n\n  export type LocalEvent = {\n    enabled?: boolean;\n    events?: JsonValue;\n  };\n\n  export type LocalWebHook = LocalEvent & {\n    url?: string;\n    headers?: JsonValue;\n    webhookByEvents?: boolean;\n    webhookBase64?: boolean;\n  };\n\n  export type LocalPusher = LocalEvent & {\n    appId?: string;\n    key?: string;\n    secret?: string;\n    cluster?: string;\n    useTLS?: boolean;\n  };\n\n  type Session = {\n    remoteJid?: string;\n    sessionId?: string;\n    createdAt?: number;\n  };\n\n  export type LocalProxy = {\n    enabled?: boolean;\n    host?: string;\n    port?: string;\n    protocol?: string;\n    username?: string;\n    password?: string;\n  };\n\n  export type StateConnection = {\n    instance?: string;\n    state?: WAConnectionState | 'refused';\n    statusReason?: number;\n  };\n\n  export type StatusMessage = 'ERROR' | 'PENDING' | 'SERVER_ACK' | 'DELIVERY_ACK' | 'READ' | 'DELETED' | 'PLAYED';\n}\n\nexport const TypeMediaMessage = [\n  'imageMessage',\n  'documentMessage',\n  'audioMessage',\n  'videoMessage',\n  'stickerMessage',\n  'ptvMessage',\n];\n\nexport const MessageSubtype = [\n  'ephemeralMessage',\n  'documentWithCaptionMessage',\n  'viewOnceMessage',\n  'viewOnceMessageV2',\n];\n\nexport const Integration = {\n  WHATSAPP_BUSINESS: 'WHATSAPP-BUSINESS',\n  WHATSAPP_BAILEYS: 'WHATSAPP-BAILEYS',\n  EVOLUTION: 'EVOLUTION',\n};\n","import { Integration } from '@api/types/wa.types';\nimport { JSONSchema7 } from 'json-schema';\nimport { v4 } from 'uuid';\n\nconst isNotEmpty = (...propertyNames: string[]): JSONSchema7 => {\n  const properties = {};\n  propertyNames.forEach(\n    (property) =>\n      (properties[property] = {\n        minLength: 1,\n        description: `The \"${property}\" cannot be empty`,\n      }),\n  );\n  return {\n    if: {\n      propertyNames: {\n        enum: [...propertyNames],\n      },\n    },\n    then: { properties },\n  };\n};\n\nexport const instanceSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    // Instance\n    instanceName: { type: 'string' },\n    token: { type: 'string' },\n    number: { type: 'string', pattern: '^\\\\d+[\\\\.@\\\\w-]+' },\n    businessId: { type: 'string' },\n    qrcode: { type: 'boolean' },\n    Integration: {\n      type: 'string',\n      enum: Object.values(Integration),\n    },\n    // Settings\n    rejectCall: { type: 'boolean' },\n    msgCall: { type: 'string' },\n    groupsIgnore: { type: 'boolean' },\n    alwaysOnline: { type: 'boolean' },\n    readMessages: { type: 'boolean' },\n    readStatus: { type: 'boolean' },\n    syncFullHistory: { type: 'boolean' },\n    wavoipToken: { type: 'string' },\n    // Proxy\n    proxyHost: { type: 'string' },\n    proxyPort: { type: 'string' },\n    proxyProtocol: { type: 'string' },\n    proxyUsername: { type: 'string' },\n    proxyPassword: { type: 'string' },\n    // Webhook\n    webhookUrl: { type: 'string' },\n    webhookByEvents: { type: 'boolean' },\n    webhookBase64: { type: 'boolean' },\n    webhookEvents: {\n      type: 'array',\n      minItems: 0,\n      items: {\n        type: 'string',\n        enum: [\n          'APPLICATION_STARTUP',\n          'QRCODE_UPDATED',\n          'MESSAGES_SET',\n          'MESSAGES_UPSERT',\n          'MESSAGES_EDITED',\n          'MESSAGES_UPDATE',\n          'MESSAGES_DELETE',\n          'SEND_MESSAGE',\n          'SEND_MESSAGE_UPDATE',\n          'CONTACTS_SET',\n          'CONTACTS_UPSERT',\n          'CONTACTS_UPDATE',\n          'PRESENCE_UPDATE',\n          'CHATS_SET',\n          'CHATS_UPSERT',\n          'CHATS_UPDATE',\n          'CHATS_DELETE',\n          'GROUPS_UPSERT',\n          'GROUP_UPDATE',\n          'GROUP_PARTICIPANTS_UPDATE',\n          'CONNECTION_UPDATE',\n          'LABELS_EDIT',\n          'LABELS_ASSOCIATION',\n          'CALL',\n          'TYPEBOT_START',\n          'TYPEBOT_CHANGE_STATUS',\n        ],\n      },\n    },\n    // RabbitMQ\n    rabbitmqEnabled: { type: 'boolean' },\n    rabbitmqEvents: {\n      type: 'array',\n      minItems: 0,\n      items: {\n        type: 'string',\n        enum: [\n          'APPLICATION_STARTUP',\n          'QRCODE_UPDATED',\n          'MESSAGES_SET',\n          'MESSAGES_UPSERT',\n          'MESSAGES_EDITED',\n          'MESSAGES_UPDATE',\n          'MESSAGES_DELETE',\n          'SEND_MESSAGE',\n          'SEND_MESSAGE_UPDATE',\n          'CONTACTS_SET',\n          'CONTACTS_UPSERT',\n          'CONTACTS_UPDATE',\n          'PRESENCE_UPDATE',\n          'CHATS_SET',\n          'CHATS_UPSERT',\n          'CHATS_UPDATE',\n          'CHATS_DELETE',\n          'GROUPS_UPSERT',\n          'GROUP_UPDATE',\n          'GROUP_PARTICIPANTS_UPDATE',\n          'CONNECTION_UPDATE',\n          'LABELS_EDIT',\n          'LABELS_ASSOCIATION',\n          'CALL',\n          'TYPEBOT_START',\n          'TYPEBOT_CHANGE_STATUS',\n        ],\n      },\n    },\n    // NATS\n    natsEnabled: { type: 'boolean' },\n    natsEvents: {\n      type: 'array',\n      minItems: 0,\n      items: {\n        type: 'string',\n        enum: [\n          'APPLICATION_STARTUP',\n          'QRCODE_UPDATED',\n          'MESSAGES_SET',\n          'MESSAGES_UPSERT',\n          'MESSAGES_EDITED',\n          'MESSAGES_UPDATE',\n          'MESSAGES_DELETE',\n          'SEND_MESSAGE',\n          'SEND_MESSAGE_UPDATE',\n          'CONTACTS_SET',\n          'CONTACTS_UPSERT',\n          'CONTACTS_UPDATE',\n          'PRESENCE_UPDATE',\n          'CHATS_SET',\n          'CHATS_UPSERT',\n          'CHATS_UPDATE',\n          'CHATS_DELETE',\n          'GROUPS_UPSERT',\n          'GROUP_UPDATE',\n          'GROUP_PARTICIPANTS_UPDATE',\n          'CONNECTION_UPDATE',\n          'LABELS_EDIT',\n          'LABELS_ASSOCIATION',\n          'CALL',\n          'TYPEBOT_START',\n          'TYPEBOT_CHANGE_STATUS',\n        ],\n      },\n    },\n    // SQS\n    sqsEnabled: { type: 'boolean' },\n    sqsEvents: {\n      type: 'array',\n      minItems: 0,\n      items: {\n        type: 'string',\n        enum: [\n          'APPLICATION_STARTUP',\n          'QRCODE_UPDATED',\n          'MESSAGES_SET',\n          'MESSAGES_UPSERT',\n          'MESSAGES_EDITED',\n          'MESSAGES_UPDATE',\n          'MESSAGES_DELETE',\n          'SEND_MESSAGE',\n          'SEND_MESSAGE_UPDATE',\n          'CONTACTS_SET',\n          'CONTACTS_UPSERT',\n          'CONTACTS_UPDATE',\n          'PRESENCE_UPDATE',\n          'CHATS_SET',\n          'CHATS_UPSERT',\n          'CHATS_UPDATE',\n          'CHATS_DELETE',\n          'GROUPS_UPSERT',\n          'GROUP_UPDATE',\n          'GROUP_PARTICIPANTS_UPDATE',\n          'CONNECTION_UPDATE',\n          'LABELS_EDIT',\n          'LABELS_ASSOCIATION',\n          'CALL',\n          'TYPEBOT_START',\n          'TYPEBOT_CHANGE_STATUS',\n        ],\n      },\n    },\n    // Chatwoot\n    chatwootAccountId: { type: 'string' },\n    chatwootToken: { type: 'string' },\n    chatwootUrl: { type: 'string' },\n    chatwootSignMsg: { type: 'boolean' },\n    chatwootReopenConversation: { type: 'boolean' },\n    chatwootConversationPending: { type: 'boolean' },\n    chatwootImportContacts: { type: 'boolean' },\n    chatwootNameInbox: { type: 'string' },\n    chatwootMergeBrazilContacts: { type: 'boolean' },\n    chatwootImportMessages: { type: 'boolean' },\n    chatwootDaysLimitImportMessages: { type: 'number' },\n  },\n  ...isNotEmpty('instanceName'),\n};\n\nexport const presenceOnlySchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    presence: {\n      type: 'string',\n      enum: ['unavailable', 'available', 'composing', 'recording', 'paused'],\n    },\n  },\n  required: ['presence'],\n};\n"],"mappings":"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","names":["Integration","WHATSAPP_BUSINESS","WHATSAPP_BAILEYS","EVOLUTION","v4","isNotEmpty","__name","propertyNames","properties","forEach","property","minLength","description","if","enum","then","instanceSchema","$id","v4","type","instanceName","token","number","pattern","businessId","qrcode","Integration","Object","values","rejectCall","msgCall","groupsIgnore","alwaysOnline","readMessages","readStatus","syncFullHistory","wavoipToken","proxyHost","proxyPort","proxyProtocol","proxyUsername","proxyPassword","webhookUrl","webhookByEvents","webhookBase64","webhookEvents","minItems","items","rabbitmqEnabled","rabbitmqEvents","natsEnabled","natsEvents","sqsEnabled","sqsEvents","chatwootAccountId","chatwootToken","chatwootUrl","chatwootSignMsg","chatwootReopenConversation","chatwootConversationPending","chatwootImportContacts","chatwootNameInbox","chatwootMergeBrazilContacts","chatwootImportMessages","chatwootDaysLimitImportMessages","presenceOnlySchema","presence","required"]}