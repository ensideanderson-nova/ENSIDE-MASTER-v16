var T=Object.defineProperty;var f=(r,t)=>T(r,"name",{value:t,configurable:!0});function h(r){return r.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}f(h,"normalizeString");function w(r,t){let n=t.split(" ").reduce((s,u)=>{let[g,...d]=u.split(":"),l=d.join(":");return s[g]||(s[g]=[]),s[g].push(l),s},{}),a=h(r);return Object.entries(n).every(([s,u])=>u.some(g=>g.split(",").every(l=>{let i=h(l);switch(s.toLowerCase()){case"contains":return a.includes(i);case"notcontains":return!a.includes(i);case"startswith":return a.startsWith(i);case"endswith":return a.endsWith(i);case"exact":return a===i;default:return!1}})))}f(w,"advancedOperatorsSearch");var v=f(async(r,t,n)=>{let a=await r.findFirst({where:{enabled:!0,triggerType:{in:["all","none"]},instanceId:n}});if(a)return a;let s=await r.findMany({where:{enabled:!0,triggerType:"advanced",instanceId:n}});for(let e of s)if(w(t,e.triggerValue))return e;let u=await r.findFirst({where:{enabled:!0,triggerType:"keyword",triggerOperator:"equals",triggerValue:t,instanceId:n}});if(u)return u;let g=await r.findMany({where:{enabled:!0,triggerType:"keyword",triggerOperator:"regex",instanceId:n}}),d=null;for(let e of g)if(new RegExp(e.triggerValue).test(t)){d=e;break}if(d)return d;let l=await r.findMany({where:{enabled:!0,triggerType:"keyword",triggerOperator:"startsWith",instanceId:n}}),i=null;for(let e of l)if(t.startsWith(e.triggerValue)){i=e;break}if(i)return i;let p=await r.findMany({where:{enabled:!0,triggerType:"keyword",triggerOperator:"endsWith",instanceId:n}}),o=null;for(let e of p)if(t.endsWith(e.triggerValue)){o=e;break}if(o)return o;let y=await r.findMany({where:{enabled:!0,triggerType:"keyword",triggerOperator:"contains",instanceId:n}}),c=null;for(let e of y)if(t.includes(e.triggerValue)){c=e;break}return c||null},"findBotByTrigger");export{v as findBotByTrigger};
//# sourceMappingURL=findBotByTrigger.mjs.map