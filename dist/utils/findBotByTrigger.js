var o=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames;var x=Object.prototype.hasOwnProperty;var f=(e,r)=>o(e,"name",{value:r,configurable:!0});var b=(e,r)=>{for(var t in r)o(e,t,{get:r[t],enumerable:!0})},k=(e,r,t,a)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of V(r))!x.call(e,n)&&n!==t&&o(e,n,{get:()=>r[n],enumerable:!(a=W(r,n))||a.enumerable});return e};var v=e=>k(o({},"__esModule",{value:!0}),e);var m={};b(m,{findBotByTrigger:()=>O});module.exports=v(m);function w(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}f(w,"normalizeString");function p(e,r){let t=r.split(" ").reduce((n,u)=>{let[g,...d]=u.split(":"),l=d.join(":");return n[g]||(n[g]=[]),n[g].push(l),n},{}),a=w(e);return Object.entries(t).every(([n,u])=>u.some(g=>g.split(",").every(l=>{let s=w(l);switch(n.toLowerCase()){case"contains":return a.includes(s);case"notcontains":return!a.includes(s);case"startswith":return a.startsWith(s);case"endswith":return a.endsWith(s);case"exact":return a===s;default:return!1}})))}f(p,"advancedOperatorsSearch");var O=f(async(e,r,t)=>{let a=await e.findFirst({where:{enabled:!0,triggerType:{in:["all","none"]},instanceId:t}});if(a)return a;let n=await e.findMany({where:{enabled:!0,triggerType:"advanced",instanceId:t}});for(let i of n)if(p(r,i.triggerValue))return i;let u=await e.findFirst({where:{enabled:!0,triggerType:"keyword",triggerOperator:"equals",triggerValue:r,instanceId:t}});if(u)return u;let g=await e.findMany({where:{enabled:!0,triggerType:"keyword",triggerOperator:"regex",instanceId:t}}),d=null;for(let i of g)if(new RegExp(i.triggerValue).test(r)){d=i;break}if(d)return d;let l=await e.findMany({where:{enabled:!0,triggerType:"keyword",triggerOperator:"startsWith",instanceId:t}}),s=null;for(let i of l)if(r.startsWith(i.triggerValue)){s=i;break}if(s)return s;let y=await e.findMany({where:{enabled:!0,triggerType:"keyword",triggerOperator:"endsWith",instanceId:t}}),c=null;for(let i of y)if(r.endsWith(i.triggerValue)){c=i;break}if(c)return c;let T=await e.findMany({where:{enabled:!0,triggerType:"keyword",triggerOperator:"contains",instanceId:t}}),h=null;for(let i of T)if(r.includes(i.triggerValue)){h=i;break}return h||null},"findBotByTrigger");0&&(module.exports={findBotByTrigger});
//# sourceMappingURL=findBotByTrigger.js.map