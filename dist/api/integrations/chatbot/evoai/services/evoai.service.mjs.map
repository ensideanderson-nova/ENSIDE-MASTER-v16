{"version":3,"sources":["../../../../../../src/api/types/wa.types.ts","../../../../../../src/api/integrations/chatbot/evoai/services/evoai.service.ts","../../../../../../src/config/logger.config.ts","../../../../../../src/config/env.config.ts","../../../../../../src/api/integrations/chatbot/base-chatbot.service.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-namespace */\nimport { JsonValue } from '@prisma/client/runtime/library';\nimport { AuthenticationState, WAConnectionState } from 'baileys';\n\nexport enum Events {\n  APPLICATION_STARTUP = 'application.startup',\n  INSTANCE_CREATE = 'instance.create',\n  INSTANCE_DELETE = 'instance.delete',\n  QRCODE_UPDATED = 'qrcode.updated',\n  CONNECTION_UPDATE = 'connection.update',\n  STATUS_INSTANCE = 'status.instance',\n  MESSAGES_SET = 'messages.set',\n  MESSAGES_UPSERT = 'messages.upsert',\n  MESSAGES_EDITED = 'messages.edited',\n  MESSAGES_UPDATE = 'messages.update',\n  MESSAGES_DELETE = 'messages.delete',\n  SEND_MESSAGE = 'send.message',\n  SEND_MESSAGE_UPDATE = 'send.message.update',\n  CONTACTS_SET = 'contacts.set',\n  CONTACTS_UPSERT = 'contacts.upsert',\n  CONTACTS_UPDATE = 'contacts.update',\n  PRESENCE_UPDATE = 'presence.update',\n  CHATS_SET = 'chats.set',\n  CHATS_UPDATE = 'chats.update',\n  CHATS_UPSERT = 'chats.upsert',\n  CHATS_DELETE = 'chats.delete',\n  GROUPS_UPSERT = 'groups.upsert',\n  GROUPS_UPDATE = 'groups.update',\n  GROUP_PARTICIPANTS_UPDATE = 'group-participants.update',\n  CALL = 'call',\n  TYPEBOT_START = 'typebot.start',\n  TYPEBOT_CHANGE_STATUS = 'typebot.change-status',\n  LABELS_EDIT = 'labels.edit',\n  LABELS_ASSOCIATION = 'labels.association',\n  CREDS_UPDATE = 'creds.update',\n  MESSAGING_HISTORY_SET = 'messaging-history.set',\n  REMOVE_INSTANCE = 'remove.instance',\n  LOGOUT_INSTANCE = 'logout.instance',\n}\n\nexport declare namespace wa {\n  export type QrCode = {\n    count?: number;\n    pairingCode?: string;\n    base64?: string;\n    code?: string;\n  };\n\n  export type Instance = {\n    id?: string;\n    qrcode?: QrCode;\n    pairingCode?: string;\n    authState?: { state: AuthenticationState; saveCreds: () => void };\n    name?: string;\n    ownerJid?: string;\n    wuid?: string;\n    profileName?: string;\n    profilePictureUrl?: string;\n    token?: string;\n    number?: string;\n    integration?: string;\n    businessId?: string;\n  };\n\n  export type LocalChatwoot = {\n    enabled?: boolean;\n    accountId?: string;\n    token?: string;\n    url?: string;\n    nameInbox?: string;\n    signMsg?: boolean;\n    signDelimiter?: string;\n    number?: string;\n    reopenConversation?: boolean;\n    conversationPending?: boolean;\n    mergeBrazilContacts?: boolean;\n    importContacts?: boolean;\n    importMessages?: boolean;\n    daysLimitImportMessages?: number;\n  };\n\n  export type LocalSettings = {\n    rejectCall?: boolean;\n    msgCall?: string;\n    groupsIgnore?: boolean;\n    alwaysOnline?: boolean;\n    readMessages?: boolean;\n    readStatus?: boolean;\n    syncFullHistory?: boolean;\n    wavoipToken?: string;\n  };\n\n  export type LocalEvent = {\n    enabled?: boolean;\n    events?: JsonValue;\n  };\n\n  export type LocalWebHook = LocalEvent & {\n    url?: string;\n    headers?: JsonValue;\n    webhookByEvents?: boolean;\n    webhookBase64?: boolean;\n  };\n\n  export type LocalPusher = LocalEvent & {\n    appId?: string;\n    key?: string;\n    secret?: string;\n    cluster?: string;\n    useTLS?: boolean;\n  };\n\n  type Session = {\n    remoteJid?: string;\n    sessionId?: string;\n    createdAt?: number;\n  };\n\n  export type LocalProxy = {\n    enabled?: boolean;\n    host?: string;\n    port?: string;\n    protocol?: string;\n    username?: string;\n    password?: string;\n  };\n\n  export type StateConnection = {\n    instance?: string;\n    state?: WAConnectionState | 'refused';\n    statusReason?: number;\n  };\n\n  export type StatusMessage = 'ERROR' | 'PENDING' | 'SERVER_ACK' | 'DELIVERY_ACK' | 'READ' | 'DELETED' | 'PLAYED';\n}\n\nexport const TypeMediaMessage = [\n  'imageMessage',\n  'documentMessage',\n  'audioMessage',\n  'videoMessage',\n  'stickerMessage',\n  'ptvMessage',\n];\n\nexport const MessageSubtype = [\n  'ephemeralMessage',\n  'documentWithCaptionMessage',\n  'viewOnceMessage',\n  'viewOnceMessageV2',\n];\n\nexport const Integration = {\n  WHATSAPP_BUSINESS: 'WHATSAPP-BUSINESS',\n  WHATSAPP_BAILEYS: 'WHATSAPP-BAILEYS',\n  EVOLUTION: 'EVOLUTION',\n};\n","import { PrismaRepository } from '@api/repository/repository.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { Integration } from '@api/types/wa.types';\nimport { ConfigService, HttpServer } from '@config/env.config';\nimport { Evoai, EvoaiSetting, IntegrationSession } from '@prisma/client';\nimport axios from 'axios';\nimport { downloadMediaMessage } from 'baileys';\nimport { isURL } from 'class-validator';\nimport { v4 as uuidv4 } from 'uuid';\n\nimport { BaseChatbotService } from '../../base-chatbot.service';\nimport { OpenaiService } from '../../openai/services/openai.service';\n\nexport class EvoaiService extends BaseChatbotService<Evoai, EvoaiSetting> {\n  private openaiService: OpenaiService;\n\n  constructor(\n    waMonitor: WAMonitoringService,\n    prismaRepository: PrismaRepository,\n    configService: ConfigService,\n    openaiService: OpenaiService,\n  ) {\n    super(waMonitor, prismaRepository, 'EvoaiService', configService);\n    this.openaiService = openaiService;\n  }\n\n  /**\n   * Return the bot type for EvoAI\n   */\n  protected getBotType(): string {\n    return 'evoai';\n  }\n\n  /**\n   * Implement the abstract method to send message to EvoAI API\n   * Handles audio transcription, image processing, and complex JSON-RPC payload\n   */\n  protected async sendMessageToBot(\n    instance: any,\n    session: IntegrationSession,\n    settings: EvoaiSetting,\n    evoai: Evoai,\n    remoteJid: string,\n    pushName: string,\n    content: string,\n    msg?: any,\n  ): Promise<void> {\n    try {\n      this.logger.debug(`[EvoAI] Sending message to bot with content: ${content}`);\n\n      let processedContent = content;\n\n      // Handle audio messages - transcribe using OpenAI Whisper\n      if (this.isAudioMessage(content) && msg) {\n        try {\n          this.logger.debug(`[EvoAI] Downloading audio for Whisper transcription`);\n          const transcription = await this.openaiService.speechToText(msg, instance);\n          if (transcription) {\n            processedContent = `[audio] ${transcription}`;\n          }\n        } catch (err) {\n          this.logger.error(`[EvoAI] Failed to transcribe audio: ${err}`);\n        }\n      }\n\n      const endpoint: string = evoai.agentUrl;\n\n      if (!endpoint) {\n        this.logger.error('No EvoAI endpoint defined');\n        return;\n      }\n\n      const callId = `req-${uuidv4().substring(0, 8)}`;\n      const messageId = remoteJid.split('@')[0] || uuidv4(); // Use phone number as messageId\n\n      // Prepare message parts\n      const parts = [\n        {\n          type: 'text',\n          text: processedContent,\n        },\n      ];\n\n      // Handle image message if present\n      if (this.isImageMessage(content) && msg) {\n        const media = content.split('|');\n        parts[0].text = media[2] || content;\n\n        try {\n          if (msg.message.mediaUrl || msg.message.base64) {\n            let mediaBase64 = msg.message.base64 || null;\n\n            if (msg.message.mediaUrl && isURL(msg.message.mediaUrl)) {\n              const result = await axios.get(msg.message.mediaUrl, { responseType: 'arraybuffer' });\n              mediaBase64 = Buffer.from(result.data).toString('base64');\n            }\n\n            if (mediaBase64) {\n              parts.push({\n                type: 'file',\n                file: {\n                  name: msg.key.id + '.jpeg',\n                  mimeType: 'image/jpeg',\n                  bytes: mediaBase64,\n                },\n              } as any);\n            }\n          } else {\n            // Download the image\n            const mediaBuffer = await downloadMediaMessage(msg, 'buffer', {});\n            const fileContent = Buffer.from(mediaBuffer).toString('base64');\n            const fileName = media[2] || `${msg.key?.id || 'image'}.jpg`;\n\n            parts.push({\n              type: 'file',\n              file: {\n                name: fileName,\n                mimeType: 'image/jpeg',\n                bytes: fileContent,\n              },\n            } as any);\n          }\n        } catch (fileErr) {\n          this.logger.error(`[EvoAI] Failed to process image: ${fileErr}`);\n        }\n      }\n\n      const payload = {\n        jsonrpc: '2.0',\n        id: callId,\n        method: 'message/send',\n        params: {\n          contextId: session.sessionId,\n          message: {\n            role: 'user',\n            parts,\n            messageId: messageId,\n            metadata: {\n              messageKey: msg?.key,\n            },\n          },\n          metadata: {\n            remoteJid: remoteJid,\n            pushName: pushName,\n            fromMe: msg?.key?.fromMe,\n            instanceName: instance.instanceName,\n            serverUrl: this.configService.get<HttpServer>('SERVER').URL,\n            apiKey: instance.token,\n          },\n        },\n      };\n\n      this.logger.debug(`[EvoAI] Sending request to: ${endpoint}`);\n      // Redact base64 file bytes from payload log\n      const redactedPayload = JSON.parse(JSON.stringify(payload));\n      if (redactedPayload?.params?.message?.parts) {\n        redactedPayload.params.message.parts = redactedPayload.params.message.parts.map((part) => {\n          if (part.type === 'file' && part.file && part.file.bytes) {\n            return { ...part, file: { ...part.file, bytes: '[base64 omitted]' } };\n          }\n          return part;\n        });\n      }\n      this.logger.debug(`[EvoAI] Payload: ${JSON.stringify(redactedPayload)}`);\n\n      if (instance.integration === Integration.WHATSAPP_BAILEYS) {\n        await instance.client.presenceSubscribe(remoteJid);\n        await instance.client.sendPresenceUpdate('composing', remoteJid);\n      }\n\n      const response = await axios.post(endpoint, payload, {\n        headers: {\n          'x-api-key': evoai.apiKey,\n          'Content-Type': 'application/json',\n        },\n      });\n\n      this.logger.debug(`[EvoAI] Response: ${JSON.stringify(response.data)}`);\n\n      if (instance.integration === Integration.WHATSAPP_BAILEYS)\n        await instance.client.sendPresenceUpdate('paused', remoteJid);\n\n      let message = undefined;\n      const result = response?.data?.result;\n\n      // Extract message from artifacts array\n      if (result?.artifacts && Array.isArray(result.artifacts) && result.artifacts.length > 0) {\n        const artifact = result.artifacts[0];\n        if (artifact?.parts && Array.isArray(artifact.parts)) {\n          const textPart = artifact.parts.find((p) => p.type === 'text' && p.text);\n          if (textPart) message = textPart.text;\n        }\n      }\n\n      this.logger.debug(`[EvoAI] Extracted message to send: ${message}`);\n\n      if (message) {\n        await this.sendMessageWhatsApp(instance, remoteJid, message, settings, true);\n      }\n    } catch (error) {\n      this.logger.error(\n        `[EvoAI] Error sending message: ${error?.response?.data ? JSON.stringify(error.response.data) : error}`,\n      );\n      return;\n    }\n  }\n}\n","import dayjs from 'dayjs';\nimport fs from 'fs';\n\nimport { configService, Log } from './env.config';\nconst packageJson = JSON.parse(fs.readFileSync('./package.json', 'utf8'));\n\nconst formatDateLog = (timestamp: number) =>\n  dayjs(timestamp)\n    .toDate()\n    .toString()\n    .replace(/\\sGMT.+/, '');\n\nenum Color {\n  LOG = '\\x1b[32m',\n  INFO = '\\x1b[34m',\n  WARN = '\\x1b[33m',\n  ERROR = '\\x1b[31m',\n  DEBUG = '\\x1b[36m',\n  VERBOSE = '\\x1b[37m',\n  DARK = '\\x1b[30m',\n}\n\nenum Command {\n  RESET = '\\x1b[0m',\n  BRIGHT = '\\x1b[1m',\n  UNDERSCORE = '\\x1b[4m',\n}\n\nenum Level {\n  LOG = Color.LOG + '%s' + Command.RESET,\n  DARK = Color.DARK + '%s' + Command.RESET,\n  INFO = Color.INFO + '%s' + Command.RESET,\n  WARN = Color.WARN + '%s' + Command.RESET,\n  ERROR = Color.ERROR + '%s' + Command.RESET,\n  DEBUG = Color.DEBUG + '%s' + Command.RESET,\n  VERBOSE = Color.VERBOSE + '%s' + Command.RESET,\n}\n\nenum Type {\n  LOG = 'LOG',\n  WARN = 'WARN',\n  INFO = 'INFO',\n  DARK = 'DARK',\n  ERROR = 'ERROR',\n  DEBUG = 'DEBUG',\n  VERBOSE = 'VERBOSE',\n}\n\nenum Background {\n  LOG = '\\x1b[42m',\n  INFO = '\\x1b[44m',\n  WARN = '\\x1b[43m',\n  DARK = '\\x1b[40m',\n  ERROR = '\\x1b[41m',\n  DEBUG = '\\x1b[46m',\n  VERBOSE = '\\x1b[47m',\n}\n\nexport class Logger {\n  private readonly configService = configService;\n  private context: string;\n\n  constructor(context = 'Logger') {\n    this.context = context;\n  }\n\n  private instance = null;\n\n  public setContext(value: string) {\n    this.context = value;\n  }\n\n  public setInstance(value: string) {\n    this.instance = value;\n  }\n\n  private console(value: any, type: Type) {\n    const types: Type[] = [];\n\n    this.configService.get<Log>('LOG').LEVEL.forEach((level) => types.push(Type[level]));\n\n    const typeValue = typeof value;\n    if (types.includes(type)) {\n      if (configService.get<Log>('LOG').COLOR) {\n        console.log(\n          /*Command.UNDERSCORE +*/ Command.BRIGHT + Level[type],\n          '[Evolution API]',\n          Command.BRIGHT + Color[type],\n          this.instance ? `[${this.instance}]` : '',\n          Command.BRIGHT + Color[type],\n          `v${packageJson.version}`,\n          Command.BRIGHT + Color[type],\n          process.pid.toString(),\n          Command.RESET,\n          Command.BRIGHT + Color[type],\n          '-',\n          Command.BRIGHT + Color.VERBOSE,\n          `${formatDateLog(Date.now())}  `,\n          Command.RESET,\n          Color[type] + Background[type] + Command.BRIGHT,\n          `${type} ` + Command.RESET,\n          Color.WARN + Command.BRIGHT,\n          `[${this.context}]` + Command.RESET,\n          Color[type] + Command.BRIGHT,\n          `[${typeValue}]` + Command.RESET,\n          Color[type],\n          typeValue !== 'object' ? value : '',\n          Command.RESET,\n        );\n        typeValue === 'object' ? console.log(/*Level.DARK,*/ value, '\\n') : '';\n      } else {\n        console.log(\n          '[Evolution API]',\n          this.instance ? `[${this.instance}]` : '',\n          process.pid.toString(),\n          '-',\n          `${formatDateLog(Date.now())}  `,\n          `${type} `,\n          `[${this.context}]`,\n          `[${typeValue}]`,\n          value,\n        );\n      }\n    }\n  }\n\n  public log(value: any) {\n    this.console(value, Type.LOG);\n  }\n\n  public info(value: any) {\n    this.console(value, Type.INFO);\n  }\n\n  public warn(value: any) {\n    this.console(value, Type.WARN);\n  }\n\n  public error(value: any) {\n    this.console(value, Type.ERROR);\n  }\n\n  public verbose(value: any) {\n    this.console(value, Type.VERBOSE);\n  }\n\n  public debug(value: any) {\n    this.console(value, Type.DEBUG);\n  }\n\n  public dark(value: any) {\n    this.console(value, Type.DARK);\n  }\n}\n","import { isBooleanString } from 'class-validator';\nimport dotenv from 'dotenv';\n\ndotenv.config();\n\nexport type HttpServer = {\n  NAME: string;\n  TYPE: 'http' | 'https';\n  PORT: number;\n  URL: string;\n  DISABLE_DOCS: boolean;\n  DISABLE_MANAGER: boolean;\n};\n\nexport type HttpMethods = 'POST' | 'GET' | 'PUT' | 'DELETE';\nexport type Cors = {\n  ORIGIN: string[];\n  METHODS: HttpMethods[];\n  CREDENTIALS: boolean;\n};\n\nexport type LogBaileys = 'fatal' | 'error' | 'warn' | 'info' | 'debug' | 'trace';\n\nexport type LogLevel = 'ERROR' | 'WARN' | 'DEBUG' | 'INFO' | 'LOG' | 'VERBOSE' | 'DARK' | 'WEBHOOKS' | 'WEBSOCKET';\n\nexport type Log = {\n  LEVEL: LogLevel[];\n  COLOR: boolean;\n  BAILEYS: LogBaileys;\n};\n\nexport type ProviderSession = {\n  ENABLED: boolean;\n  HOST: string;\n  PORT: string;\n  PREFIX: string;\n};\n\nexport type SaveData = {\n  INSTANCE: boolean;\n  HISTORIC: boolean;\n  NEW_MESSAGE: boolean;\n  MESSAGE_UPDATE: boolean;\n  CONTACTS: boolean;\n  CHATS: boolean;\n  LABELS: boolean;\n  IS_ON_WHATSAPP: boolean;\n  IS_ON_WHATSAPP_DAYS: number;\n};\n\nexport type DBConnection = {\n  URI: string;\n  CLIENT_NAME: string;\n};\nexport type Database = {\n  CONNECTION: DBConnection;\n  PROVIDER: string;\n  SAVE_DATA: SaveData;\n  DELETE_DATA: DeleteData;\n};\n\nexport type DeleteData = {\n  LOGICAL_MESSAGE_DELETE: boolean;\n};\nexport type EventsRabbitmq = {\n  APPLICATION_STARTUP: boolean;\n  INSTANCE_CREATE: boolean;\n  INSTANCE_DELETE: boolean;\n  QRCODE_UPDATED: boolean;\n  MESSAGES_SET: boolean;\n  MESSAGES_UPSERT: boolean;\n  MESSAGES_EDITED: boolean;\n  MESSAGES_UPDATE: boolean;\n  MESSAGES_DELETE: boolean;\n  SEND_MESSAGE: boolean;\n  SEND_MESSAGE_UPDATE: boolean;\n  CONTACTS_SET: boolean;\n  CONTACTS_UPDATE: boolean;\n  CONTACTS_UPSERT: boolean;\n  PRESENCE_UPDATE: boolean;\n  CHATS_SET: boolean;\n  CHATS_UPDATE: boolean;\n  CHATS_DELETE: boolean;\n  CHATS_UPSERT: boolean;\n  CONNECTION_UPDATE: boolean;\n  LABELS_EDIT: boolean;\n  LABELS_ASSOCIATION: boolean;\n  GROUPS_UPSERT: boolean;\n  GROUP_UPDATE: boolean;\n  GROUP_PARTICIPANTS_UPDATE: boolean;\n  CALL: boolean;\n  TYPEBOT_START: boolean;\n  TYPEBOT_CHANGE_STATUS: boolean;\n};\n\nexport type Rabbitmq = {\n  ENABLED: boolean;\n  URI: string;\n  FRAME_MAX: number;\n  EXCHANGE_NAME: string;\n  GLOBAL_ENABLED: boolean;\n  EVENTS: EventsRabbitmq;\n  PREFIX_KEY?: string;\n};\n\nexport type Nats = {\n  ENABLED: boolean;\n  URI: string;\n  EXCHANGE_NAME: string;\n  GLOBAL_ENABLED: boolean;\n  EVENTS: EventsRabbitmq;\n  PREFIX_KEY?: string;\n};\n\nexport type Sqs = {\n  ENABLED: boolean;\n  GLOBAL_ENABLED: boolean;\n  GLOBAL_FORCE_SINGLE_QUEUE: boolean;\n  GLOBAL_PREFIX_NAME: string;\n  ACCESS_KEY_ID: string;\n  SECRET_ACCESS_KEY: string;\n  ACCOUNT_ID: string;\n  REGION: string;\n  MAX_PAYLOAD_SIZE: number;\n  EVENTS: {\n    APPLICATION_STARTUP: boolean;\n    CALL: boolean;\n    CHATS_DELETE: boolean;\n    CHATS_SET: boolean;\n    CHATS_UPDATE: boolean;\n    CHATS_UPSERT: boolean;\n    CONNECTION_UPDATE: boolean;\n    CONTACTS_SET: boolean;\n    CONTACTS_UPDATE: boolean;\n    CONTACTS_UPSERT: boolean;\n    GROUP_PARTICIPANTS_UPDATE: boolean;\n    GROUPS_UPDATE: boolean;\n    GROUPS_UPSERT: boolean;\n    LABELS_ASSOCIATION: boolean;\n    LABELS_EDIT: boolean;\n    LOGOUT_INSTANCE: boolean;\n    MESSAGES_DELETE: boolean;\n    MESSAGES_EDITED: boolean;\n    MESSAGES_SET: boolean;\n    MESSAGES_UPDATE: boolean;\n    MESSAGES_UPSERT: boolean;\n    PRESENCE_UPDATE: boolean;\n    QRCODE_UPDATED: boolean;\n    REMOVE_INSTANCE: boolean;\n    SEND_MESSAGE: boolean;\n    TYPEBOT_CHANGE_STATUS: boolean;\n    TYPEBOT_START: boolean;\n  };\n};\n\nexport type Kafka = {\n  ENABLED: boolean;\n  CLIENT_ID: string;\n  BROKERS: string[];\n  CONNECTION_TIMEOUT: number;\n  REQUEST_TIMEOUT: number;\n  GLOBAL_ENABLED: boolean;\n  CONSUMER_GROUP_ID: string;\n  TOPIC_PREFIX: string;\n  NUM_PARTITIONS: number;\n  REPLICATION_FACTOR: number;\n  AUTO_CREATE_TOPICS: boolean;\n  EVENTS: EventsRabbitmq;\n  SASL?: {\n    ENABLED: boolean;\n    MECHANISM: string;\n    USERNAME: string;\n    PASSWORD: string;\n  };\n  SSL?: {\n    ENABLED: boolean;\n    REJECT_UNAUTHORIZED: boolean;\n    CA?: string;\n    KEY?: string;\n    CERT?: string;\n  };\n};\n\nexport type Websocket = {\n  ENABLED: boolean;\n  GLOBAL_EVENTS: boolean;\n  ALLOWED_HOSTS?: string;\n};\n\nexport type WaBusiness = {\n  TOKEN_WEBHOOK: string;\n  URL: string;\n  VERSION: string;\n  LANGUAGE: string;\n};\n\nexport type EventsWebhook = {\n  APPLICATION_STARTUP: boolean;\n  INSTANCE_CREATE: boolean;\n  INSTANCE_DELETE: boolean;\n  QRCODE_UPDATED: boolean;\n  MESSAGES_SET: boolean;\n  MESSAGES_UPSERT: boolean;\n  MESSAGES_EDITED: boolean;\n  MESSAGES_UPDATE: boolean;\n  MESSAGES_DELETE: boolean;\n  SEND_MESSAGE: boolean;\n  SEND_MESSAGE_UPDATE: boolean;\n  CONTACTS_SET: boolean;\n  CONTACTS_UPDATE: boolean;\n  CONTACTS_UPSERT: boolean;\n  PRESENCE_UPDATE: boolean;\n  CHATS_SET: boolean;\n  CHATS_UPDATE: boolean;\n  CHATS_DELETE: boolean;\n  CHATS_UPSERT: boolean;\n  CONNECTION_UPDATE: boolean;\n  LABELS_EDIT: boolean;\n  LABELS_ASSOCIATION: boolean;\n  GROUPS_UPSERT: boolean;\n  GROUP_UPDATE: boolean;\n  GROUP_PARTICIPANTS_UPDATE: boolean;\n  CALL: boolean;\n  TYPEBOT_START: boolean;\n  TYPEBOT_CHANGE_STATUS: boolean;\n  ERRORS: boolean;\n  ERRORS_WEBHOOK: string;\n};\n\nexport type EventsPusher = {\n  APPLICATION_STARTUP: boolean;\n  INSTANCE_CREATE: boolean;\n  INSTANCE_DELETE: boolean;\n  QRCODE_UPDATED: boolean;\n  MESSAGES_SET: boolean;\n  MESSAGES_UPSERT: boolean;\n  MESSAGES_EDITED: boolean;\n  MESSAGES_UPDATE: boolean;\n  MESSAGES_DELETE: boolean;\n  SEND_MESSAGE: boolean;\n  SEND_MESSAGE_UPDATE: boolean;\n  CONTACTS_SET: boolean;\n  CONTACTS_UPDATE: boolean;\n  CONTACTS_UPSERT: boolean;\n  PRESENCE_UPDATE: boolean;\n  CHATS_SET: boolean;\n  CHATS_UPDATE: boolean;\n  CHATS_DELETE: boolean;\n  CHATS_UPSERT: boolean;\n  CONNECTION_UPDATE: boolean;\n  LABELS_EDIT: boolean;\n  LABELS_ASSOCIATION: boolean;\n  GROUPS_UPSERT: boolean;\n  GROUP_UPDATE: boolean;\n  GROUP_PARTICIPANTS_UPDATE: boolean;\n  CALL: boolean;\n  TYPEBOT_START: boolean;\n  TYPEBOT_CHANGE_STATUS: boolean;\n};\n\nexport type ApiKey = { KEY: string };\n\nexport type Auth = {\n  API_KEY: ApiKey;\n  EXPOSE_IN_FETCH_INSTANCES: boolean;\n};\n\nexport type DelInstance = number | boolean;\n\nexport type Language = string | 'en';\n\nexport type GlobalWebhook = {\n  URL: string;\n  ENABLED: boolean;\n  WEBHOOK_BY_EVENTS: boolean;\n};\n\nexport type GlobalPusher = {\n  ENABLED: boolean;\n  APP_ID: string;\n  KEY: string;\n  SECRET: string;\n  CLUSTER: string;\n  USE_TLS: boolean;\n};\n\nexport type CacheConfRedis = {\n  ENABLED: boolean;\n  URI: string;\n  PREFIX_KEY: string;\n  TTL: number;\n  SAVE_INSTANCES: boolean;\n};\nexport type CacheConfLocal = {\n  ENABLED: boolean;\n  TTL: number;\n};\nexport type SslConf = { PRIVKEY: string; FULLCHAIN: string };\nexport type Webhook = {\n  GLOBAL?: GlobalWebhook;\n  EVENTS: EventsWebhook;\n  REQUEST?: {\n    TIMEOUT_MS?: number;\n  };\n  RETRY?: {\n    MAX_ATTEMPTS?: number;\n    INITIAL_DELAY_SECONDS?: number;\n    USE_EXPONENTIAL_BACKOFF?: boolean;\n    MAX_DELAY_SECONDS?: number;\n    JITTER_FACTOR?: number;\n    NON_RETRYABLE_STATUS_CODES?: number[];\n  };\n};\nexport type Pusher = { ENABLED: boolean; GLOBAL?: GlobalPusher; EVENTS: EventsPusher };\nexport type ConfigSessionPhone = { CLIENT: string; NAME: string };\nexport type QrCode = { LIMIT: number; COLOR: string };\nexport type Typebot = { ENABLED: boolean; API_VERSION: string; SEND_MEDIA_BASE64: boolean };\nexport type Chatwoot = {\n  ENABLED: boolean;\n  MESSAGE_DELETE: boolean;\n  MESSAGE_READ: boolean;\n  BOT_CONTACT: boolean;\n  IMPORT: {\n    DATABASE: {\n      CONNECTION: {\n        URI: string;\n      };\n    };\n    PLACEHOLDER_MEDIA_MESSAGE: boolean;\n  };\n};\nexport type Openai = { ENABLED: boolean; API_KEY_GLOBAL?: string };\nexport type Dify = { ENABLED: boolean };\nexport type N8n = { ENABLED: boolean };\nexport type Evoai = { ENABLED: boolean };\nexport type Flowise = { ENABLED: boolean };\n\nexport type S3 = {\n  ACCESS_KEY: string;\n  SECRET_KEY: string;\n  ENDPOINT: string;\n  BUCKET_NAME: string;\n  ENABLE: boolean;\n  PORT?: number;\n  USE_SSL?: boolean;\n  REGION?: string;\n  SKIP_POLICY?: boolean;\n  SAVE_VIDEO?: boolean;\n};\n\nexport type CacheConf = { REDIS: CacheConfRedis; LOCAL: CacheConfLocal };\nexport type Metrics = {\n  ENABLED: boolean;\n  AUTH_REQUIRED: boolean;\n  USER?: string;\n  PASSWORD?: string;\n  ALLOWED_IPS?: string;\n};\n\nexport type Telemetry = {\n  ENABLED: boolean;\n  URL?: string;\n};\n\nexport type Proxy = {\n  HOST?: string;\n  PORT?: string;\n  PROTOCOL?: string;\n  USERNAME?: string;\n  PASSWORD?: string;\n};\n\nexport type AudioConverter = {\n  API_URL?: string;\n  API_KEY?: string;\n};\n\nexport type Facebook = {\n  APP_ID?: string;\n  CONFIG_ID?: string;\n  USER_TOKEN?: string;\n};\n\nexport type Sentry = {\n  DSN?: string;\n};\n\nexport type EventEmitter = {\n  MAX_LISTENERS: number;\n};\n\nexport type Production = boolean;\n\nexport interface Env {\n  SERVER: HttpServer;\n  CORS: Cors;\n  SSL_CONF: SslConf;\n  PROVIDER: ProviderSession;\n  DATABASE: Database;\n  RABBITMQ: Rabbitmq;\n  NATS: Nats;\n  SQS: Sqs;\n  KAFKA: Kafka;\n  WEBSOCKET: Websocket;\n  WA_BUSINESS: WaBusiness;\n  LOG: Log;\n  DEL_INSTANCE: DelInstance;\n  DEL_TEMP_INSTANCES: boolean;\n  LANGUAGE: Language;\n  WEBHOOK: Webhook;\n  PUSHER: Pusher;\n  CONFIG_SESSION_PHONE: ConfigSessionPhone;\n  QRCODE: QrCode;\n  TYPEBOT: Typebot;\n  CHATWOOT: Chatwoot;\n  OPENAI: Openai;\n  DIFY: Dify;\n  N8N: N8n;\n  EVOAI: Evoai;\n  FLOWISE: Flowise;\n  CACHE: CacheConf;\n  S3?: S3;\n  AUTHENTICATION: Auth;\n  METRICS: Metrics;\n  TELEMETRY: Telemetry;\n  PROXY: Proxy;\n  AUDIO_CONVERTER: AudioConverter;\n  FACEBOOK: Facebook;\n  SENTRY: Sentry;\n  EVENT_EMITTER: EventEmitter;\n  PRODUCTION?: Production;\n}\n\nexport type Key = keyof Env;\n\nexport class ConfigService {\n  constructor() {\n    this.loadEnv();\n  }\n\n  private env: Env;\n\n  public get<T = any>(key: Key) {\n    return this.env[key] as T;\n  }\n\n  private loadEnv() {\n    this.env = this.envProcess();\n    this.env.PRODUCTION = process.env?.NODE_ENV === 'PROD';\n    if (process.env?.DOCKER_ENV === 'true') {\n      this.env.SERVER.TYPE = process.env.SERVER_TYPE as 'http' | 'http';\n      this.env.SERVER.PORT = Number.parseInt(process.env.SERVER_PORT) || 8080;\n    }\n  }\n\n  private envProcess(): Env {\n    return {\n      SERVER: {\n        NAME: process.env?.SERVER_NAME || 'evolution',\n        TYPE: (process.env.SERVER_TYPE as 'http' | 'https') || 'http',\n        PORT: Number.parseInt(process.env.SERVER_PORT) || 8080,\n        URL: process.env.SERVER_URL,\n        DISABLE_DOCS: process.env?.SERVER_DISABLE_DOCS === 'true',\n        DISABLE_MANAGER: process.env?.SERVER_DISABLE_MANAGER === 'true',\n      },\n      CORS: {\n        ORIGIN: process.env.CORS_ORIGIN?.split(',') || ['*'],\n        METHODS:\n          (process.env.CORS_METHODS?.split(',') as HttpMethods[]) ||\n          (['POST', 'GET', 'PUT', 'DELETE'] as HttpMethods[]),\n        CREDENTIALS: process.env?.CORS_CREDENTIALS === 'true',\n      },\n      SSL_CONF: {\n        PRIVKEY: process.env?.SSL_CONF_PRIVKEY || '',\n        FULLCHAIN: process.env?.SSL_CONF_FULLCHAIN || '',\n      },\n      PROVIDER: {\n        ENABLED: process.env?.PROVIDER_ENABLED === 'true',\n        HOST: process.env.PROVIDER_HOST,\n        PORT: process.env?.PROVIDER_PORT || '5656',\n        PREFIX: process.env?.PROVIDER_PREFIX || 'evolution',\n      },\n      DATABASE: {\n        CONNECTION: {\n          URI: process.env.DATABASE_CONNECTION_URI || '',\n          CLIENT_NAME: process.env.DATABASE_CONNECTION_CLIENT_NAME || 'evolution',\n        },\n        PROVIDER: process.env.DATABASE_PROVIDER || 'postgresql',\n        SAVE_DATA: {\n          INSTANCE: process.env?.DATABASE_SAVE_DATA_INSTANCE === 'true',\n          NEW_MESSAGE: process.env?.DATABASE_SAVE_DATA_NEW_MESSAGE === 'true',\n          MESSAGE_UPDATE: process.env?.DATABASE_SAVE_MESSAGE_UPDATE === 'true',\n          CONTACTS: process.env?.DATABASE_SAVE_DATA_CONTACTS === 'true',\n          CHATS: process.env?.DATABASE_SAVE_DATA_CHATS === 'true',\n          HISTORIC: process.env?.DATABASE_SAVE_DATA_HISTORIC === 'true',\n          LABELS: process.env?.DATABASE_SAVE_DATA_LABELS === 'true',\n          IS_ON_WHATSAPP: process.env?.DATABASE_SAVE_IS_ON_WHATSAPP === 'true',\n          IS_ON_WHATSAPP_DAYS: Number.parseInt(process.env?.DATABASE_SAVE_IS_ON_WHATSAPP_DAYS ?? '7'),\n        },\n        DELETE_DATA: {\n          LOGICAL_MESSAGE_DELETE: process.env?.DATABASE_DELETE_MESSAGE === 'true',\n        },\n      },\n      RABBITMQ: {\n        ENABLED: process.env?.RABBITMQ_ENABLED === 'true',\n        GLOBAL_ENABLED: process.env?.RABBITMQ_GLOBAL_ENABLED === 'true',\n        PREFIX_KEY: process.env?.RABBITMQ_PREFIX_KEY,\n        EXCHANGE_NAME: process.env?.RABBITMQ_EXCHANGE_NAME || 'evolution_exchange',\n        URI: process.env.RABBITMQ_URI || '',\n        FRAME_MAX: Number.parseInt(process.env.RABBITMQ_FRAME_MAX) || 8192,\n        EVENTS: {\n          APPLICATION_STARTUP: process.env?.RABBITMQ_EVENTS_APPLICATION_STARTUP === 'true',\n          INSTANCE_CREATE: process.env?.RABBITMQ_EVENTS_INSTANCE_CREATE === 'true',\n          INSTANCE_DELETE: process.env?.RABBITMQ_EVENTS_INSTANCE_DELETE === 'true',\n          QRCODE_UPDATED: process.env?.RABBITMQ_EVENTS_QRCODE_UPDATED === 'true',\n          MESSAGES_SET: process.env?.RABBITMQ_EVENTS_MESSAGES_SET === 'true',\n          MESSAGES_UPSERT: process.env?.RABBITMQ_EVENTS_MESSAGES_UPSERT === 'true',\n          MESSAGES_EDITED: process.env?.RABBITMQ_EVENTS_MESSAGES_EDITED === 'true',\n          MESSAGES_UPDATE: process.env?.RABBITMQ_EVENTS_MESSAGES_UPDATE === 'true',\n          MESSAGES_DELETE: process.env?.RABBITMQ_EVENTS_MESSAGES_DELETE === 'true',\n          SEND_MESSAGE: process.env?.RABBITMQ_EVENTS_SEND_MESSAGE === 'true',\n          SEND_MESSAGE_UPDATE: process.env?.RABBITMQ_EVENTS_SEND_MESSAGE_UPDATE === 'true',\n          CONTACTS_SET: process.env?.RABBITMQ_EVENTS_CONTACTS_SET === 'true',\n          CONTACTS_UPDATE: process.env?.RABBITMQ_EVENTS_CONTACTS_UPDATE === 'true',\n          CONTACTS_UPSERT: process.env?.RABBITMQ_EVENTS_CONTACTS_UPSERT === 'true',\n          PRESENCE_UPDATE: process.env?.RABBITMQ_EVENTS_PRESENCE_UPDATE === 'true',\n          CHATS_SET: process.env?.RABBITMQ_EVENTS_CHATS_SET === 'true',\n          CHATS_UPDATE: process.env?.RABBITMQ_EVENTS_CHATS_UPDATE === 'true',\n          CHATS_UPSERT: process.env?.RABBITMQ_EVENTS_CHATS_UPSERT === 'true',\n          CHATS_DELETE: process.env?.RABBITMQ_EVENTS_CHATS_DELETE === 'true',\n          CONNECTION_UPDATE: process.env?.RABBITMQ_EVENTS_CONNECTION_UPDATE === 'true',\n          LABELS_EDIT: process.env?.RABBITMQ_EVENTS_LABELS_EDIT === 'true',\n          LABELS_ASSOCIATION: process.env?.RABBITMQ_EVENTS_LABELS_ASSOCIATION === 'true',\n          GROUPS_UPSERT: process.env?.RABBITMQ_EVENTS_GROUPS_UPSERT === 'true',\n          GROUP_UPDATE: process.env?.RABBITMQ_EVENTS_GROUPS_UPDATE === 'true',\n          GROUP_PARTICIPANTS_UPDATE: process.env?.RABBITMQ_EVENTS_GROUP_PARTICIPANTS_UPDATE === 'true',\n          CALL: process.env?.RABBITMQ_EVENTS_CALL === 'true',\n          TYPEBOT_START: process.env?.RABBITMQ_EVENTS_TYPEBOT_START === 'true',\n          TYPEBOT_CHANGE_STATUS: process.env?.RABBITMQ_EVENTS_TYPEBOT_CHANGE_STATUS === 'true',\n        },\n      },\n      NATS: {\n        ENABLED: process.env?.NATS_ENABLED === 'true',\n        GLOBAL_ENABLED: process.env?.NATS_GLOBAL_ENABLED === 'true',\n        PREFIX_KEY: process.env?.NATS_PREFIX_KEY,\n        EXCHANGE_NAME: process.env?.NATS_EXCHANGE_NAME || 'evolution_exchange',\n        URI: process.env.NATS_URI || '',\n        EVENTS: {\n          APPLICATION_STARTUP: process.env?.NATS_EVENTS_APPLICATION_STARTUP === 'true',\n          INSTANCE_CREATE: process.env?.NATS_EVENTS_INSTANCE_CREATE === 'true',\n          INSTANCE_DELETE: process.env?.NATS_EVENTS_INSTANCE_DELETE === 'true',\n          QRCODE_UPDATED: process.env?.NATS_EVENTS_QRCODE_UPDATED === 'true',\n          MESSAGES_SET: process.env?.NATS_EVENTS_MESSAGES_SET === 'true',\n          MESSAGES_UPSERT: process.env?.NATS_EVENTS_MESSAGES_UPSERT === 'true',\n          MESSAGES_EDITED: process.env?.NATS_EVENTS_MESSAGES_EDITED === 'true',\n          MESSAGES_UPDATE: process.env?.NATS_EVENTS_MESSAGES_UPDATE === 'true',\n          MESSAGES_DELETE: process.env?.NATS_EVENTS_MESSAGES_DELETE === 'true',\n          SEND_MESSAGE: process.env?.NATS_EVENTS_SEND_MESSAGE === 'true',\n          SEND_MESSAGE_UPDATE: process.env?.NATS_EVENTS_SEND_MESSAGE_UPDATE === 'true',\n          CONTACTS_SET: process.env?.NATS_EVENTS_CONTACTS_SET === 'true',\n          CONTACTS_UPDATE: process.env?.NATS_EVENTS_CONTACTS_UPDATE === 'true',\n          CONTACTS_UPSERT: process.env?.NATS_EVENTS_CONTACTS_UPSERT === 'true',\n          PRESENCE_UPDATE: process.env?.NATS_EVENTS_PRESENCE_UPDATE === 'true',\n          CHATS_SET: process.env?.NATS_EVENTS_CHATS_SET === 'true',\n          CHATS_UPDATE: process.env?.NATS_EVENTS_CHATS_UPDATE === 'true',\n          CHATS_UPSERT: process.env?.NATS_EVENTS_CHATS_UPSERT === 'true',\n          CHATS_DELETE: process.env?.NATS_EVENTS_CHATS_DELETE === 'true',\n          CONNECTION_UPDATE: process.env?.NATS_EVENTS_CONNECTION_UPDATE === 'true',\n          LABELS_EDIT: process.env?.NATS_EVENTS_LABELS_EDIT === 'true',\n          LABELS_ASSOCIATION: process.env?.NATS_EVENTS_LABELS_ASSOCIATION === 'true',\n          GROUPS_UPSERT: process.env?.NATS_EVENTS_GROUPS_UPSERT === 'true',\n          GROUP_UPDATE: process.env?.NATS_EVENTS_GROUPS_UPDATE === 'true',\n          GROUP_PARTICIPANTS_UPDATE: process.env?.NATS_EVENTS_GROUP_PARTICIPANTS_UPDATE === 'true',\n          CALL: process.env?.NATS_EVENTS_CALL === 'true',\n          TYPEBOT_START: process.env?.NATS_EVENTS_TYPEBOT_START === 'true',\n          TYPEBOT_CHANGE_STATUS: process.env?.NATS_EVENTS_TYPEBOT_CHANGE_STATUS === 'true',\n        },\n      },\n      SQS: {\n        ENABLED: process.env?.SQS_ENABLED === 'true',\n        GLOBAL_ENABLED: process.env?.SQS_GLOBAL_ENABLED === 'true',\n        GLOBAL_FORCE_SINGLE_QUEUE: process.env?.SQS_GLOBAL_FORCE_SINGLE_QUEUE === 'true',\n        GLOBAL_PREFIX_NAME: process.env?.SQS_GLOBAL_PREFIX_NAME || 'global',\n        ACCESS_KEY_ID: process.env.SQS_ACCESS_KEY_ID || '',\n        SECRET_ACCESS_KEY: process.env.SQS_SECRET_ACCESS_KEY || '',\n        ACCOUNT_ID: process.env.SQS_ACCOUNT_ID || '',\n        REGION: process.env.SQS_REGION || '',\n        MAX_PAYLOAD_SIZE: Number.parseInt(process.env.SQS_MAX_PAYLOAD_SIZE ?? '1048576'),\n        EVENTS: {\n          APPLICATION_STARTUP: process.env?.SQS_GLOBAL_APPLICATION_STARTUP === 'true',\n          CALL: process.env?.SQS_GLOBAL_CALL === 'true',\n          CHATS_DELETE: process.env?.SQS_GLOBAL_CHATS_DELETE === 'true',\n          CHATS_SET: process.env?.SQS_GLOBAL_CHATS_SET === 'true',\n          CHATS_UPDATE: process.env?.SQS_GLOBAL_CHATS_UPDATE === 'true',\n          CHATS_UPSERT: process.env?.SQS_GLOBAL_CHATS_UPSERT === 'true',\n          CONNECTION_UPDATE: process.env?.SQS_GLOBAL_CONNECTION_UPDATE === 'true',\n          CONTACTS_SET: process.env?.SQS_GLOBAL_CONTACTS_SET === 'true',\n          CONTACTS_UPDATE: process.env?.SQS_GLOBAL_CONTACTS_UPDATE === 'true',\n          CONTACTS_UPSERT: process.env?.SQS_GLOBAL_CONTACTS_UPSERT === 'true',\n          GROUP_PARTICIPANTS_UPDATE: process.env?.SQS_GLOBAL_GROUP_PARTICIPANTS_UPDATE === 'true',\n          GROUPS_UPDATE: process.env?.SQS_GLOBAL_GROUPS_UPDATE === 'true',\n          GROUPS_UPSERT: process.env?.SQS_GLOBAL_GROUPS_UPSERT === 'true',\n          LABELS_ASSOCIATION: process.env?.SQS_GLOBAL_LABELS_ASSOCIATION === 'true',\n          LABELS_EDIT: process.env?.SQS_GLOBAL_LABELS_EDIT === 'true',\n          LOGOUT_INSTANCE: process.env?.SQS_GLOBAL_LOGOUT_INSTANCE === 'true',\n          MESSAGES_DELETE: process.env?.SQS_GLOBAL_MESSAGES_DELETE === 'true',\n          MESSAGES_EDITED: process.env?.SQS_GLOBAL_MESSAGES_EDITED === 'true',\n          MESSAGES_SET: process.env?.SQS_GLOBAL_MESSAGES_SET === 'true',\n          MESSAGES_UPDATE: process.env?.SQS_GLOBAL_MESSAGES_UPDATE === 'true',\n          MESSAGES_UPSERT: process.env?.SQS_GLOBAL_MESSAGES_UPSERT === 'true',\n          PRESENCE_UPDATE: process.env?.SQS_GLOBAL_PRESENCE_UPDATE === 'true',\n          QRCODE_UPDATED: process.env?.SQS_GLOBAL_QRCODE_UPDATED === 'true',\n          REMOVE_INSTANCE: process.env?.SQS_GLOBAL_REMOVE_INSTANCE === 'true',\n          SEND_MESSAGE: process.env?.SQS_GLOBAL_SEND_MESSAGE === 'true',\n          TYPEBOT_CHANGE_STATUS: process.env?.SQS_GLOBAL_TYPEBOT_CHANGE_STATUS === 'true',\n          TYPEBOT_START: process.env?.SQS_GLOBAL_TYPEBOT_START === 'true',\n        },\n      },\n      KAFKA: {\n        ENABLED: process.env?.KAFKA_ENABLED === 'true',\n        CLIENT_ID: process.env?.KAFKA_CLIENT_ID || 'evolution-api',\n        BROKERS: process.env?.KAFKA_BROKERS?.split(',') || ['localhost:9092'],\n        CONNECTION_TIMEOUT: Number.parseInt(process.env?.KAFKA_CONNECTION_TIMEOUT || '3000'),\n        REQUEST_TIMEOUT: Number.parseInt(process.env?.KAFKA_REQUEST_TIMEOUT || '30000'),\n        GLOBAL_ENABLED: process.env?.KAFKA_GLOBAL_ENABLED === 'true',\n        CONSUMER_GROUP_ID: process.env?.KAFKA_CONSUMER_GROUP_ID || 'evolution-api-consumers',\n        TOPIC_PREFIX: process.env?.KAFKA_TOPIC_PREFIX || 'evolution',\n        NUM_PARTITIONS: Number.parseInt(process.env?.KAFKA_NUM_PARTITIONS || '1'),\n        REPLICATION_FACTOR: Number.parseInt(process.env?.KAFKA_REPLICATION_FACTOR || '1'),\n        AUTO_CREATE_TOPICS: process.env?.KAFKA_AUTO_CREATE_TOPICS === 'true',\n        EVENTS: {\n          APPLICATION_STARTUP: process.env?.KAFKA_EVENTS_APPLICATION_STARTUP === 'true',\n          INSTANCE_CREATE: process.env?.KAFKA_EVENTS_INSTANCE_CREATE === 'true',\n          INSTANCE_DELETE: process.env?.KAFKA_EVENTS_INSTANCE_DELETE === 'true',\n          QRCODE_UPDATED: process.env?.KAFKA_EVENTS_QRCODE_UPDATED === 'true',\n          MESSAGES_SET: process.env?.KAFKA_EVENTS_MESSAGES_SET === 'true',\n          MESSAGES_UPSERT: process.env?.KAFKA_EVENTS_MESSAGES_UPSERT === 'true',\n          MESSAGES_EDITED: process.env?.KAFKA_EVENTS_MESSAGES_EDITED === 'true',\n          MESSAGES_UPDATE: process.env?.KAFKA_EVENTS_MESSAGES_UPDATE === 'true',\n          MESSAGES_DELETE: process.env?.KAFKA_EVENTS_MESSAGES_DELETE === 'true',\n          SEND_MESSAGE: process.env?.KAFKA_EVENTS_SEND_MESSAGE === 'true',\n          SEND_MESSAGE_UPDATE: process.env?.KAFKA_EVENTS_SEND_MESSAGE_UPDATE === 'true',\n          CONTACTS_SET: process.env?.KAFKA_EVENTS_CONTACTS_SET === 'true',\n          CONTACTS_UPSERT: process.env?.KAFKA_EVENTS_CONTACTS_UPSERT === 'true',\n          CONTACTS_UPDATE: process.env?.KAFKA_EVENTS_CONTACTS_UPDATE === 'true',\n          PRESENCE_UPDATE: process.env?.KAFKA_EVENTS_PRESENCE_UPDATE === 'true',\n          CHATS_SET: process.env?.KAFKA_EVENTS_CHATS_SET === 'true',\n          CHATS_UPSERT: process.env?.KAFKA_EVENTS_CHATS_UPSERT === 'true',\n          CHATS_UPDATE: process.env?.KAFKA_EVENTS_CHATS_UPDATE === 'true',\n          CHATS_DELETE: process.env?.KAFKA_EVENTS_CHATS_DELETE === 'true',\n          CONNECTION_UPDATE: process.env?.KAFKA_EVENTS_CONNECTION_UPDATE === 'true',\n          LABELS_EDIT: process.env?.KAFKA_EVENTS_LABELS_EDIT === 'true',\n          LABELS_ASSOCIATION: process.env?.KAFKA_EVENTS_LABELS_ASSOCIATION === 'true',\n          GROUPS_UPSERT: process.env?.KAFKA_EVENTS_GROUPS_UPSERT === 'true',\n          GROUP_UPDATE: process.env?.KAFKA_EVENTS_GROUPS_UPDATE === 'true',\n          GROUP_PARTICIPANTS_UPDATE: process.env?.KAFKA_EVENTS_GROUP_PARTICIPANTS_UPDATE === 'true',\n          CALL: process.env?.KAFKA_EVENTS_CALL === 'true',\n          TYPEBOT_START: process.env?.KAFKA_EVENTS_TYPEBOT_START === 'true',\n          TYPEBOT_CHANGE_STATUS: process.env?.KAFKA_EVENTS_TYPEBOT_CHANGE_STATUS === 'true',\n        },\n        SASL:\n          process.env?.KAFKA_SASL_ENABLED === 'true'\n            ? {\n                ENABLED: true,\n                MECHANISM: process.env?.KAFKA_SASL_MECHANISM || 'plain',\n                USERNAME: process.env?.KAFKA_SASL_USERNAME || '',\n                PASSWORD: process.env?.KAFKA_SASL_PASSWORD || '',\n              }\n            : undefined,\n        SSL:\n          process.env?.KAFKA_SSL_ENABLED === 'true'\n            ? {\n                ENABLED: true,\n                REJECT_UNAUTHORIZED: process.env?.KAFKA_SSL_REJECT_UNAUTHORIZED !== 'false',\n                CA: process.env?.KAFKA_SSL_CA,\n                KEY: process.env?.KAFKA_SSL_KEY,\n                CERT: process.env?.KAFKA_SSL_CERT,\n              }\n            : undefined,\n      },\n      WEBSOCKET: {\n        ENABLED: process.env?.WEBSOCKET_ENABLED === 'true',\n        GLOBAL_EVENTS: process.env?.WEBSOCKET_GLOBAL_EVENTS === 'true',\n        ALLOWED_HOSTS: process.env?.WEBSOCKET_ALLOWED_HOSTS,\n      },\n      PUSHER: {\n        ENABLED: process.env?.PUSHER_ENABLED === 'true',\n        GLOBAL: {\n          ENABLED: process.env?.PUSHER_GLOBAL_ENABLED === 'true',\n          APP_ID: process.env?.PUSHER_GLOBAL_APP_ID || '',\n          KEY: process.env?.PUSHER_GLOBAL_KEY || '',\n          SECRET: process.env?.PUSHER_GLOBAL_SECRET || '',\n          CLUSTER: process.env?.PUSHER_GLOBAL_CLUSTER || '',\n          USE_TLS: process.env?.PUSHER_GLOBAL_USE_TLS === 'true',\n        },\n        EVENTS: {\n          APPLICATION_STARTUP: process.env?.PUSHER_EVENTS_APPLICATION_STARTUP === 'true',\n          INSTANCE_CREATE: process.env?.PUSHER_EVENTS_INSTANCE_CREATE === 'true',\n          INSTANCE_DELETE: process.env?.PUSHER_EVENTS_INSTANCE_DELETE === 'true',\n          QRCODE_UPDATED: process.env?.PUSHER_EVENTS_QRCODE_UPDATED === 'true',\n          MESSAGES_SET: process.env?.PUSHER_EVENTS_MESSAGES_SET === 'true',\n          MESSAGES_UPSERT: process.env?.PUSHER_EVENTS_MESSAGES_UPSERT === 'true',\n          MESSAGES_EDITED: process.env?.PUSHER_EVENTS_MESSAGES_EDITED === 'true',\n          MESSAGES_UPDATE: process.env?.PUSHER_EVENTS_MESSAGES_UPDATE === 'true',\n          MESSAGES_DELETE: process.env?.PUSHER_EVENTS_MESSAGES_DELETE === 'true',\n          SEND_MESSAGE: process.env?.PUSHER_EVENTS_SEND_MESSAGE === 'true',\n          SEND_MESSAGE_UPDATE: process.env?.PUSHER_EVENTS_SEND_MESSAGE_UPDATE === 'true',\n          CONTACTS_SET: process.env?.PUSHER_EVENTS_CONTACTS_SET === 'true',\n          CONTACTS_UPDATE: process.env?.PUSHER_EVENTS_CONTACTS_UPDATE === 'true',\n          CONTACTS_UPSERT: process.env?.PUSHER_EVENTS_CONTACTS_UPSERT === 'true',\n          PRESENCE_UPDATE: process.env?.PUSHER_EVENTS_PRESENCE_UPDATE === 'true',\n          CHATS_SET: process.env?.PUSHER_EVENTS_CHATS_SET === 'true',\n          CHATS_UPDATE: process.env?.PUSHER_EVENTS_CHATS_UPDATE === 'true',\n          CHATS_UPSERT: process.env?.PUSHER_EVENTS_CHATS_UPSERT === 'true',\n          CHATS_DELETE: process.env?.PUSHER_EVENTS_CHATS_DELETE === 'true',\n          CONNECTION_UPDATE: process.env?.PUSHER_EVENTS_CONNECTION_UPDATE === 'true',\n          LABELS_EDIT: process.env?.PUSHER_EVENTS_LABELS_EDIT === 'true',\n          LABELS_ASSOCIATION: process.env?.PUSHER_EVENTS_LABELS_ASSOCIATION === 'true',\n          GROUPS_UPSERT: process.env?.PUSHER_EVENTS_GROUPS_UPSERT === 'true',\n          GROUP_UPDATE: process.env?.PUSHER_EVENTS_GROUPS_UPDATE === 'true',\n          GROUP_PARTICIPANTS_UPDATE: process.env?.PUSHER_EVENTS_GROUP_PARTICIPANTS_UPDATE === 'true',\n          CALL: process.env?.PUSHER_EVENTS_CALL === 'true',\n          TYPEBOT_START: process.env?.PUSHER_EVENTS_TYPEBOT_START === 'true',\n          TYPEBOT_CHANGE_STATUS: process.env?.PUSHER_EVENTS_TYPEBOT_CHANGE_STATUS === 'true',\n        },\n      },\n      WA_BUSINESS: {\n        TOKEN_WEBHOOK: process.env.WA_BUSINESS_TOKEN_WEBHOOK || 'evolution',\n        URL: process.env.WA_BUSINESS_URL || 'https://graph.facebook.com',\n        VERSION: process.env.WA_BUSINESS_VERSION || 'v18.0',\n        LANGUAGE: process.env.WA_BUSINESS_LANGUAGE || 'en',\n      },\n      LOG: {\n        LEVEL:\n          (process.env?.LOG_LEVEL?.split(',') as LogLevel[]) ||\n          (['ERROR', 'WARN', 'DEBUG', 'INFO', 'LOG', 'VERBOSE', 'DARK', 'WEBHOOKS', 'WEBSOCKET'] as LogLevel[]),\n        COLOR: process.env?.LOG_COLOR === 'true',\n        BAILEYS: (process.env?.LOG_BAILEYS as LogBaileys) || 'error',\n      },\n      DEL_INSTANCE: isBooleanString(process.env?.DEL_INSTANCE)\n        ? process.env.DEL_INSTANCE === 'true'\n        : Number.parseInt(process.env.DEL_INSTANCE) || false,\n      DEL_TEMP_INSTANCES: isBooleanString(process.env?.DEL_TEMP_INSTANCES)\n        ? process.env.DEL_TEMP_INSTANCES === 'true'\n        : true,\n      LANGUAGE: process.env?.LANGUAGE || 'en',\n      WEBHOOK: {\n        GLOBAL: {\n          URL: process.env?.WEBHOOK_GLOBAL_URL || '',\n          ENABLED: process.env?.WEBHOOK_GLOBAL_ENABLED === 'true',\n          WEBHOOK_BY_EVENTS: process.env?.WEBHOOK_GLOBAL_WEBHOOK_BY_EVENTS === 'true',\n        },\n        EVENTS: {\n          APPLICATION_STARTUP: process.env?.WEBHOOK_EVENTS_APPLICATION_STARTUP === 'true',\n          INSTANCE_CREATE: process.env?.WEBHOOK_EVENTS_INSTANCE_CREATE === 'true',\n          INSTANCE_DELETE: process.env?.WEBHOOK_EVENTS_INSTANCE_DELETE === 'true',\n          QRCODE_UPDATED: process.env?.WEBHOOK_EVENTS_QRCODE_UPDATED === 'true',\n          MESSAGES_SET: process.env?.WEBHOOK_EVENTS_MESSAGES_SET === 'true',\n          MESSAGES_UPSERT: process.env?.WEBHOOK_EVENTS_MESSAGES_UPSERT === 'true',\n          MESSAGES_EDITED: process.env?.WEBHOOK_EVENTS_MESSAGES_EDITED === 'true',\n          MESSAGES_UPDATE: process.env?.WEBHOOK_EVENTS_MESSAGES_UPDATE === 'true',\n          MESSAGES_DELETE: process.env?.WEBHOOK_EVENTS_MESSAGES_DELETE === 'true',\n          SEND_MESSAGE: process.env?.WEBHOOK_EVENTS_SEND_MESSAGE === 'true',\n          SEND_MESSAGE_UPDATE: process.env?.WEBHOOK_EVENTS_SEND_MESSAGE_UPDATE === 'true',\n          CONTACTS_SET: process.env?.WEBHOOK_EVENTS_CONTACTS_SET === 'true',\n          CONTACTS_UPDATE: process.env?.WEBHOOK_EVENTS_CONTACTS_UPDATE === 'true',\n          CONTACTS_UPSERT: process.env?.WEBHOOK_EVENTS_CONTACTS_UPSERT === 'true',\n          PRESENCE_UPDATE: process.env?.WEBHOOK_EVENTS_PRESENCE_UPDATE === 'true',\n          CHATS_SET: process.env?.WEBHOOK_EVENTS_CHATS_SET === 'true',\n          CHATS_UPDATE: process.env?.WEBHOOK_EVENTS_CHATS_UPDATE === 'true',\n          CHATS_UPSERT: process.env?.WEBHOOK_EVENTS_CHATS_UPSERT === 'true',\n          CHATS_DELETE: process.env?.WEBHOOK_EVENTS_CHATS_DELETE === 'true',\n          CONNECTION_UPDATE: process.env?.WEBHOOK_EVENTS_CONNECTION_UPDATE === 'true',\n          LABELS_EDIT: process.env?.WEBHOOK_EVENTS_LABELS_EDIT === 'true',\n          LABELS_ASSOCIATION: process.env?.WEBHOOK_EVENTS_LABELS_ASSOCIATION === 'true',\n          GROUPS_UPSERT: process.env?.WEBHOOK_EVENTS_GROUPS_UPSERT === 'true',\n          GROUP_UPDATE: process.env?.WEBHOOK_EVENTS_GROUPS_UPDATE === 'true',\n          GROUP_PARTICIPANTS_UPDATE: process.env?.WEBHOOK_EVENTS_GROUP_PARTICIPANTS_UPDATE === 'true',\n          CALL: process.env?.WEBHOOK_EVENTS_CALL === 'true',\n          TYPEBOT_START: process.env?.WEBHOOK_EVENTS_TYPEBOT_START === 'true',\n          TYPEBOT_CHANGE_STATUS: process.env?.WEBHOOK_EVENTS_TYPEBOT_CHANGE_STATUS === 'true',\n          ERRORS: process.env?.WEBHOOK_EVENTS_ERRORS === 'true',\n          ERRORS_WEBHOOK: process.env?.WEBHOOK_EVENTS_ERRORS_WEBHOOK || '',\n        },\n        REQUEST: {\n          TIMEOUT_MS: Number.parseInt(process.env?.WEBHOOK_REQUEST_TIMEOUT_MS) || 30000,\n        },\n        RETRY: {\n          MAX_ATTEMPTS: Number.parseInt(process.env?.WEBHOOK_RETRY_MAX_ATTEMPTS) || 10,\n          INITIAL_DELAY_SECONDS: Number.parseInt(process.env?.WEBHOOK_RETRY_INITIAL_DELAY_SECONDS) || 5,\n          USE_EXPONENTIAL_BACKOFF: process.env?.WEBHOOK_RETRY_USE_EXPONENTIAL_BACKOFF !== 'false',\n          MAX_DELAY_SECONDS: Number.parseInt(process.env?.WEBHOOK_RETRY_MAX_DELAY_SECONDS) || 300,\n          JITTER_FACTOR: Number.parseFloat(process.env?.WEBHOOK_RETRY_JITTER_FACTOR) || 0.2,\n          NON_RETRYABLE_STATUS_CODES: process.env?.WEBHOOK_RETRY_NON_RETRYABLE_STATUS_CODES?.split(',').map(Number) || [\n            400, 401, 403, 404, 422,\n          ],\n        },\n      },\n      CONFIG_SESSION_PHONE: {\n        CLIENT: process.env?.CONFIG_SESSION_PHONE_CLIENT || 'Evolution API',\n        NAME: process.env?.CONFIG_SESSION_PHONE_NAME || 'Chrome',\n      },\n      QRCODE: {\n        LIMIT: Number.parseInt(process.env.QRCODE_LIMIT) || 30,\n        COLOR: process.env.QRCODE_COLOR || '#198754',\n      },\n      TYPEBOT: {\n        ENABLED: process.env?.TYPEBOT_ENABLED === 'true',\n        API_VERSION: process.env?.TYPEBOT_API_VERSION || 'old',\n        SEND_MEDIA_BASE64: process.env?.TYPEBOT_SEND_MEDIA_BASE64 === 'true',\n      },\n      CHATWOOT: {\n        ENABLED: process.env?.CHATWOOT_ENABLED === 'true',\n        MESSAGE_DELETE: process.env.CHATWOOT_MESSAGE_DELETE === 'true',\n        MESSAGE_READ: process.env.CHATWOOT_MESSAGE_READ === 'true',\n        BOT_CONTACT: !process.env.CHATWOOT_BOT_CONTACT || process.env.CHATWOOT_BOT_CONTACT === 'true',\n        IMPORT: {\n          DATABASE: {\n            CONNECTION: {\n              URI: process.env.CHATWOOT_IMPORT_DATABASE_CONNECTION_URI || '',\n            },\n          },\n          PLACEHOLDER_MEDIA_MESSAGE: process.env?.CHATWOOT_IMPORT_PLACEHOLDER_MEDIA_MESSAGE === 'true',\n        },\n      },\n      OPENAI: {\n        ENABLED: process.env?.OPENAI_ENABLED === 'true',\n        API_KEY_GLOBAL: process.env?.OPENAI_API_KEY_GLOBAL || null,\n      },\n      DIFY: {\n        ENABLED: process.env?.DIFY_ENABLED === 'true',\n      },\n      N8N: {\n        ENABLED: process.env?.N8N_ENABLED === 'true',\n      },\n      EVOAI: {\n        ENABLED: process.env?.EVOAI_ENABLED === 'true',\n      },\n      FLOWISE: {\n        ENABLED: process.env?.FLOWISE_ENABLED === 'true',\n      },\n      CACHE: {\n        REDIS: {\n          ENABLED: process.env?.CACHE_REDIS_ENABLED === 'true',\n          URI: process.env?.CACHE_REDIS_URI || '',\n          PREFIX_KEY: process.env?.CACHE_REDIS_PREFIX_KEY || 'evolution-cache',\n          TTL: Number.parseInt(process.env?.CACHE_REDIS_TTL) || 604800,\n          SAVE_INSTANCES: process.env?.CACHE_REDIS_SAVE_INSTANCES === 'true',\n        },\n        LOCAL: {\n          ENABLED: process.env?.CACHE_LOCAL_ENABLED === 'true',\n          TTL: Number.parseInt(process.env?.CACHE_REDIS_TTL) || 86400,\n        },\n      },\n      S3: {\n        ACCESS_KEY: process.env?.S3_ACCESS_KEY,\n        SECRET_KEY: process.env?.S3_SECRET_KEY,\n        ENDPOINT: process.env?.S3_ENDPOINT,\n        BUCKET_NAME: process.env?.S3_BUCKET,\n        ENABLE: process.env?.S3_ENABLED === 'true',\n        PORT: Number.parseInt(process.env?.S3_PORT || '9000'),\n        USE_SSL: process.env?.S3_USE_SSL === 'true',\n        REGION: process.env?.S3_REGION,\n        SKIP_POLICY: process.env?.S3_SKIP_POLICY === 'true',\n        SAVE_VIDEO: process.env?.S3_SAVE_VIDEO === 'true',\n      },\n      AUTHENTICATION: {\n        API_KEY: {\n          KEY: process.env.AUTHENTICATION_API_KEY || 'BQYHJGJHJ',\n        },\n        EXPOSE_IN_FETCH_INSTANCES: process.env?.AUTHENTICATION_EXPOSE_IN_FETCH_INSTANCES === 'true',\n      },\n      METRICS: {\n        ENABLED: process.env?.PROMETHEUS_METRICS === 'true',\n        AUTH_REQUIRED: process.env?.METRICS_AUTH_REQUIRED === 'true',\n        USER: process.env?.METRICS_USER,\n        PASSWORD: process.env?.METRICS_PASSWORD,\n        ALLOWED_IPS: process.env?.METRICS_ALLOWED_IPS,\n      },\n      TELEMETRY: {\n        ENABLED: process.env?.TELEMETRY_ENABLED === undefined || process.env?.TELEMETRY_ENABLED === 'true',\n        URL: process.env?.TELEMETRY_URL,\n      },\n      PROXY: {\n        HOST: process.env?.PROXY_HOST,\n        PORT: process.env?.PROXY_PORT,\n        PROTOCOL: process.env?.PROXY_PROTOCOL,\n        USERNAME: process.env?.PROXY_USERNAME,\n        PASSWORD: process.env?.PROXY_PASSWORD,\n      },\n      AUDIO_CONVERTER: {\n        API_URL: process.env?.API_AUDIO_CONVERTER,\n        API_KEY: process.env?.API_AUDIO_CONVERTER_KEY,\n      },\n      FACEBOOK: {\n        APP_ID: process.env?.FACEBOOK_APP_ID,\n        CONFIG_ID: process.env?.FACEBOOK_CONFIG_ID,\n        USER_TOKEN: process.env?.FACEBOOK_USER_TOKEN,\n      },\n      SENTRY: {\n        DSN: process.env?.SENTRY_DSN,\n      },\n      EVENT_EMITTER: {\n        MAX_LISTENERS: Number.parseInt(process.env?.EVENT_EMITTER_MAX_LISTENERS) || 50,\n      },\n    };\n  }\n}\n\nexport const configService = new ConfigService();\n","import { InstanceDto } from '@api/dto/instance.dto';\nimport { PrismaRepository } from '@api/repository/repository.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { Integration } from '@api/types/wa.types';\nimport { ConfigService } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\nimport { IntegrationSession } from '@prisma/client';\n\n/**\n * Base class for all chatbot service implementations\n * Contains common methods shared across different chatbot integrations\n */\nexport abstract class BaseChatbotService<BotType = any, SettingsType = any> {\n  protected readonly logger: Logger;\n  protected readonly waMonitor: WAMonitoringService;\n  protected readonly prismaRepository: PrismaRepository;\n  protected readonly configService?: ConfigService;\n\n  constructor(\n    waMonitor: WAMonitoringService,\n    prismaRepository: PrismaRepository,\n    loggerName: string,\n    configService?: ConfigService,\n  ) {\n    this.waMonitor = waMonitor;\n    this.prismaRepository = prismaRepository;\n    this.logger = new Logger(loggerName);\n    this.configService = configService;\n  }\n\n  /**\n   * Check if a message contains an image\n   */\n  protected isImageMessage(content: string): boolean {\n    return content.includes('imageMessage');\n  }\n\n  /**\n   * Check if a message contains audio\n   */\n  protected isAudioMessage(content: string): boolean {\n    return content.includes('audioMessage');\n  }\n\n  /**\n   * Check if a string is valid JSON\n   */\n  protected isJSON(str: string): boolean {\n    try {\n      JSON.parse(str);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Determine the media type from a URL based on its extension\n   */\n  protected getMediaType(url: string): string | null {\n    const extension = url.split('.').pop()?.toLowerCase();\n    const imageExtensions = ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp'];\n    const audioExtensions = ['mp3', 'wav', 'aac', 'ogg'];\n    const videoExtensions = ['mp4', 'avi', 'mkv', 'mov'];\n    const documentExtensions = ['pdf', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx', 'txt'];\n\n    if (imageExtensions.includes(extension || '')) return 'image';\n    if (audioExtensions.includes(extension || '')) return 'audio';\n    if (videoExtensions.includes(extension || '')) return 'video';\n    if (documentExtensions.includes(extension || '')) return 'document';\n    return null;\n  }\n\n  /**\n   * Create a new chatbot session\n   */\n  public async createNewSession(instance: InstanceDto | any, data: any, type: string) {\n    try {\n      // Extract pushName safely - if data.pushName is an object with a pushName property, use that\n      const pushNameValue =\n        typeof data.pushName === 'object' && data.pushName?.pushName\n          ? data.pushName.pushName\n          : typeof data.pushName === 'string'\n            ? data.pushName\n            : null;\n\n      // Extract remoteJid safely\n      const remoteJidValue =\n        typeof data.remoteJid === 'object' && data.remoteJid?.remoteJid ? data.remoteJid.remoteJid : data.remoteJid;\n\n      const session = await this.prismaRepository.integrationSession.create({\n        data: {\n          remoteJid: remoteJidValue,\n          pushName: pushNameValue,\n          sessionId: remoteJidValue,\n          status: 'opened',\n          awaitUser: false,\n          botId: data.botId,\n          instanceId: instance.instanceId,\n          type: type,\n        },\n      });\n\n      return { session };\n    } catch (error) {\n      this.logger.error(error);\n      return;\n    }\n  }\n\n  /**\n   * Standard implementation for processing incoming messages\n   * This handles the common workflow across all chatbot types:\n   * 1. Check for existing session or create new one\n   * 2. Handle message based on session state\n   */\n  public async process(\n    instance: any,\n    remoteJid: string,\n    bot: BotType,\n    session: IntegrationSession,\n    settings: SettingsType,\n    content: string,\n    pushName?: string,\n    msg?: any,\n  ): Promise<void> {\n    try {\n      // For new sessions or sessions awaiting initialization\n      if (!session) {\n        await this.initNewSession(instance, remoteJid, bot, settings, session, content, pushName, msg);\n        return;\n      }\n\n      // If session is paused, ignore the message\n      if (session.status === 'paused') {\n        return;\n      }\n\n      // For existing sessions, keywords might indicate the conversation should end\n      const keywordFinish = (settings as any)?.keywordFinish || '';\n      const normalizedContent = content.toLowerCase().trim();\n      if (keywordFinish.length > 0 && normalizedContent === keywordFinish.toLowerCase()) {\n        // Update session to closed and return\n        await this.prismaRepository.integrationSession.update({\n          where: {\n            id: session.id,\n          },\n          data: {\n            status: 'closed',\n          },\n        });\n        return;\n      }\n\n      // Forward the message to the chatbot API\n      await this.sendMessageToBot(instance, session, settings, bot, remoteJid, pushName || '', content, msg);\n\n      // Update session to indicate we're waiting for user response\n      await this.prismaRepository.integrationSession.update({\n        where: {\n          id: session.id,\n        },\n        data: {\n          status: 'opened',\n          awaitUser: true,\n        },\n      });\n    } catch (error) {\n      this.logger.error(`Error in process: ${error}`);\n      return;\n    }\n  }\n\n  /**\n   * Standard implementation for sending messages to WhatsApp\n   * This handles common patterns like markdown links and formatting\n   */\n  protected async sendMessageWhatsApp(\n    instance: any,\n    remoteJid: string,\n    message: string,\n    settings: SettingsType,\n    linkPreview: boolean = true,\n  ): Promise<void> {\n    if (!message) return;\n\n    const linkRegex = /!?\\[(.*?)\\]\\((.*?)\\)/g;\n    let textBuffer = '';\n    let lastIndex = 0;\n    let match: RegExpExecArray | null;\n\n    const splitMessages = (settings as any)?.splitMessages ?? false;\n\n    while ((match = linkRegex.exec(message)) !== null) {\n      const [fullMatch, altText, url] = match;\n      const mediaType = this.getMediaType(url);\n      const beforeText = message.slice(lastIndex, match.index);\n\n      if (beforeText) {\n        textBuffer += beforeText;\n      }\n\n      if (mediaType) {\n        // Send accumulated text before sending media\n        if (textBuffer.trim()) {\n          await this.sendFormattedText(instance, remoteJid, textBuffer.trim(), settings, splitMessages, linkPreview);\n          textBuffer = '';\n        }\n\n        // Handle sending the media\n        try {\n          if (mediaType === 'audio') {\n            await instance.audioWhatsapp({\n              number: remoteJid.includes('@lid') ? remoteJid : remoteJid.split('@')[0],\n              delay: (settings as any)?.delayMessage || 1000,\n              audio: url,\n              caption: altText,\n            });\n          } else {\n            await instance.mediaMessage(\n              {\n                number: remoteJid.includes('@lid') ? remoteJid : remoteJid.split('@')[0],\n                delay: (settings as any)?.delayMessage || 1000,\n                mediatype: mediaType,\n                media: url,\n                caption: altText,\n                fileName: mediaType === 'document' ? altText || 'document' : undefined,\n              },\n              null,\n              false,\n            );\n          }\n        } catch (error) {\n          this.logger.error(`Error sending media: ${error}`);\n          // If media fails, at least send the alt text and URL\n          textBuffer += `${altText}: ${url}`;\n        }\n      } else {\n        // It's a regular link, keep it in the text\n        textBuffer += fullMatch;\n      }\n\n      lastIndex = linkRegex.lastIndex;\n    }\n\n    // Add any remaining text after the last match\n    if (lastIndex < message.length) {\n      const remainingText = message.slice(lastIndex);\n      if (remainingText.trim()) {\n        textBuffer += remainingText;\n      }\n    }\n\n    // Send any remaining text\n    if (textBuffer.trim()) {\n      await this.sendFormattedText(instance, remoteJid, textBuffer.trim(), settings, splitMessages, linkPreview);\n    }\n  }\n\n  /**\n   * Split message by double line breaks and return array of message parts\n   */\n  private splitMessageByDoubleLineBreaks(message: string): string[] {\n    return message.split('\\n\\n').filter((part) => part.trim().length > 0);\n  }\n\n  /**\n   * Send a single message with proper typing indicators and delays\n   */\n  private async sendSingleMessage(\n    instance: any,\n    remoteJid: string,\n    message: string,\n    settings: any,\n    linkPreview: boolean = true,\n  ): Promise<void> {\n    const timePerChar = settings?.timePerChar ?? 0;\n    const minDelay = 1000;\n    const maxDelay = 20000;\n    const delay = Math.min(Math.max(message.length * timePerChar, minDelay), maxDelay);\n\n    this.logger.debug(`[BaseChatbot] Sending single message with linkPreview: ${linkPreview}`);\n\n    if (instance.integration === Integration.WHATSAPP_BAILEYS) {\n      await instance.client.presenceSubscribe(remoteJid);\n      await instance.client.sendPresenceUpdate('composing', remoteJid);\n    }\n\n    await new Promise<void>((resolve) => {\n      setTimeout(async () => {\n        await instance.textMessage(\n          {\n            number: remoteJid.includes('@lid') ? remoteJid : remoteJid.split('@')[0],\n            delay: settings?.delayMessage || 1000,\n            text: message,\n            linkPreview,\n          },\n          false,\n        );\n        resolve();\n      }, delay);\n    });\n\n    if (instance.integration === Integration.WHATSAPP_BAILEYS) {\n      await instance.client.sendPresenceUpdate('paused', remoteJid);\n    }\n  }\n\n  /**\n   * Helper method to send formatted text with proper typing indicators and delays\n   */\n  private async sendFormattedText(\n    instance: any,\n    remoteJid: string,\n    text: string,\n    settings: any,\n    splitMessages: boolean,\n    linkPreview: boolean = true,\n  ): Promise<void> {\n    if (splitMessages) {\n      const messageParts = this.splitMessageByDoubleLineBreaks(text);\n\n      this.logger.debug(`[BaseChatbot] Splitting message into ${messageParts.length} parts`);\n\n      for (let index = 0; index < messageParts.length; index++) {\n        const message = messageParts[index];\n\n        this.logger.debug(`[BaseChatbot] Sending message part ${index + 1}/${messageParts.length}`);\n        await this.sendSingleMessage(instance, remoteJid, message, settings, linkPreview);\n      }\n\n      this.logger.debug(`[BaseChatbot] All message parts sent successfully`);\n    } else {\n      this.logger.debug(`[BaseChatbot] Sending single message`);\n      await this.sendSingleMessage(instance, remoteJid, text, settings, linkPreview);\n    }\n  }\n\n  /**\n   * Standard implementation for initializing a new session\n   * This method should be overridden if a subclass needs specific initialization\n   */\n  protected async initNewSession(\n    instance: any,\n    remoteJid: string,\n    bot: BotType,\n    settings: SettingsType,\n    session: IntegrationSession,\n    content: string,\n    pushName?: string | any,\n    msg?: any,\n  ): Promise<void> {\n    // Create a session if none exists\n    if (!session) {\n      // Extract pushName properly - if it's an object with pushName property, use that\n      const pushNameValue =\n        typeof pushName === 'object' && pushName?.pushName\n          ? pushName.pushName\n          : typeof pushName === 'string'\n            ? pushName\n            : null;\n\n      const sessionResult = await this.createNewSession(\n        {\n          instanceName: instance.instanceName,\n          instanceId: instance.instanceId,\n        },\n        {\n          remoteJid,\n          pushName: pushNameValue,\n          botId: (bot as any).id,\n        },\n        this.getBotType(),\n      );\n\n      if (!sessionResult || !sessionResult.session) {\n        this.logger.error('Failed to create new session');\n        return;\n      }\n\n      session = sessionResult.session;\n    }\n\n    // Update session status to opened\n    await this.prismaRepository.integrationSession.update({\n      where: {\n        id: session.id,\n      },\n      data: {\n        status: 'opened',\n        awaitUser: false,\n      },\n    });\n\n    // Forward the message to the chatbot\n    await this.sendMessageToBot(instance, session, settings, bot, remoteJid, pushName || '', content, msg);\n  }\n\n  /**\n   * Get the bot type identifier (e.g., 'dify', 'n8n', 'evoai')\n   * This should match the type field used in the IntegrationSession\n   */\n  protected abstract getBotType(): string;\n\n  /**\n   * Send a message to the chatbot API\n   * This is specific to each chatbot integration\n   */\n  protected abstract sendMessageToBot(\n    instance: any,\n    session: IntegrationSession,\n    settings: SettingsType,\n    bot: BotType,\n    remoteJid: string,\n    pushName: string,\n    content: string,\n    msg?: any,\n  ): Promise<void>;\n}\n"],"mappings":"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","names":["Integration","WHATSAPP_BUSINESS","WHATSAPP_BAILEYS","EVOLUTION","axios","downloadMediaMessage","isURL","v4","uuidv4","dayjs","fs","isBooleanString","dotenv","dotenv","config","ConfigService","env","loadEnv","get","key","envProcess","PRODUCTION","process","NODE_ENV","DOCKER_ENV","SERVER","TYPE","SERVER_TYPE","PORT","Number","parseInt","SERVER_PORT","NAME","SERVER_NAME","URL","SERVER_URL","DISABLE_DOCS","SERVER_DISABLE_DOCS","DISABLE_MANAGER","SERVER_DISABLE_MANAGER","CORS","ORIGIN","CORS_ORIGIN","split","METHODS","CORS_METHODS","CREDENTIALS","CORS_CREDENTIALS","SSL_CONF","PRIVKEY","SSL_CONF_PRIVKEY","FULLCHAIN","SSL_CONF_FULLCHAIN","PROVIDER","ENABLED","PROVIDER_ENABLED","HOST","PROVIDER_HOST","PROVIDER_PORT","PREFIX","PROVIDER_PREFIX","DATABASE","CONNECTION","URI","DATABASE_CONNECTION_URI","CLIENT_NAME","DATABASE_CONNECTION_CLIENT_NAME","DATABASE_PROVIDER","SAVE_DATA","INSTANCE","DATABASE_SAVE_DATA_INSTANCE","NEW_MESSAGE","DATABASE_SAVE_DATA_NEW_MESSAGE","MESSAGE_UPDATE","DATABASE_SAVE_MESSAGE_UPDATE","CONTACTS","DATABASE_SAVE_DATA_CONTACTS","CHATS","DATABASE_SAVE_DATA_CHATS","HISTORIC","DATABASE_SAVE_DATA_HISTORIC","LABELS","DATABASE_SAVE_DATA_LABELS","IS_ON_WHATSAPP","DATABASE_SAVE_IS_ON_WHATSAPP","IS_ON_WHATSAPP_DAYS","DATABASE_SAVE_IS_ON_WHATSAPP_DAYS","DELETE_DATA","LOGICAL_MESSAGE_DELETE","DATABASE_DELETE_MESSAGE","RABBITMQ","RABBITMQ_ENABLED","GLOBAL_ENABLED","RABBITMQ_GLOBAL_ENABLED","PREFIX_KEY","RABBITMQ_PREFIX_KEY","EXCHANGE_NAME","RABBITMQ_EXCHANGE_NAME","RABBITMQ_URI","FRAME_MAX","RABBITMQ_FRAME_MAX","EVENTS","APPLICATION_STARTUP","RABBITMQ_EVENTS_APPLICATION_STARTUP","INSTANCE_CREATE","RABBITMQ_EVENTS_INSTANCE_CREATE","INSTANCE_DELETE","RABBITMQ_EVENTS_INSTANCE_DELETE","QRCODE_UPDATED","RABBITMQ_EVENTS_QRCODE_UPDATED","MESSAGES_SET","RABBITMQ_EVENTS_MESSAGES_SET","MESSAGES_UPSERT","RABBITMQ_EVENTS_MESSAGES_UPSERT","MESSAGES_EDITED","RABBITMQ_EVENTS_MESSAGES_EDITED","MESSAGES_UPDATE","RABBITMQ_EVENTS_MESSAGES_UPDATE","MESSAGES_DELETE","RABBITMQ_EVENTS_MESSAGES_DELETE","SEND_MESSAGE","RABBITMQ_EVENTS_SEND_MESSAGE","SEND_MESSAGE_UPDATE","RABBITMQ_EVENTS_SEND_MESSAGE_UPDATE","CONTACTS_SET","RABBITMQ_EVENTS_CONTACTS_SET","CONTACTS_UPDATE","RABBITMQ_EVENTS_CONTACTS_UPDATE","CONTACTS_UPSERT","RABBITMQ_EVENTS_CONTACTS_UPSERT","PRESENCE_UPDATE","RABBITMQ_EVENTS_PRESENCE_UPDATE","CHATS_SET","RABBITMQ_EVENTS_CHATS_SET","CHATS_UPDATE","RABBITMQ_EVENTS_CHATS_UPDATE","CHATS_UPSERT","RABBITMQ_EVENTS_CHATS_UPSERT","CHATS_DELETE","RABBITMQ_EVENTS_CHATS_DELETE","CONNECTION_UPDATE","RABBITMQ_EVENTS_CONNECTION_UPDATE","LABELS_EDIT","RABBITMQ_EVENTS_LABELS_EDIT","LABELS_ASSOCIATION","RABBITMQ_EVENTS_LABELS_ASSOCIATION","GROUPS_UPSERT","RABBITMQ_EVENTS_GROUPS_UPSERT","GROUP_UPDATE","RABBITMQ_EVENTS_GROUPS_UPDATE","GROUP_PARTICIPANTS_UPDATE","RABBITMQ_EVENTS_GROUP_PARTICIPANTS_UPDATE","CALL","RABBITMQ_EVENTS_CALL","TYPEBOT_START","RABBITMQ_EVENTS_TYPEBOT_START","TYPEBOT_CHANGE_STATUS","RABBITMQ_EVENTS_TYPEBOT_CHANGE_STATUS","NATS","NATS_ENABLED","NATS_GLOBAL_ENABLED","NATS_PREFIX_KEY","NATS_EXCHANGE_NAME","NATS_URI","NATS_EVENTS_APPLICATION_STARTUP","NATS_EVENTS_INSTANCE_CREATE","NATS_EVENTS_INSTANCE_DELETE","NATS_EVENTS_QRCODE_UPDATED","NATS_EVENTS_MESSAGES_SET","NATS_EVENTS_MESSAGES_UPSERT","NATS_EVENTS_MESSAGES_EDITED","NATS_EVENTS_MESSAGES_UPDATE","NATS_EVENTS_MESSAGES_DELETE","NATS_EVENTS_SEND_MESSAGE","NATS_EVENTS_SEND_MESSAGE_UPDATE","NATS_EVENTS_CONTACTS_SET","NATS_EVENTS_CONTACTS_UPDATE","NATS_EVENTS_CONTACTS_UPSERT","NATS_EVENTS_PRESENCE_UPDATE","NATS_EVENTS_CHATS_SET","NATS_EVENTS_CHATS_UPDATE","NATS_EVENTS_CHATS_UPSERT","NATS_EVENTS_CHATS_DELETE","NATS_EVENTS_CONNECTION_UPDATE","NATS_EVENTS_LABELS_EDIT","NATS_EVENTS_LABELS_ASSOCIATION","NATS_EVENTS_GROUPS_UPSERT","NATS_EVENTS_GROUPS_UPDATE","NATS_EVENTS_GROUP_PARTICIPANTS_UPDATE","NATS_EVENTS_CALL","NATS_EVENTS_TYPEBOT_START","NATS_EVENTS_TYPEBOT_CHANGE_STATUS","SQS","SQS_ENABLED","SQS_GLOBAL_ENABLED","GLOBAL_FORCE_SINGLE_QUEUE","SQS_GLOBAL_FORCE_SINGLE_QUEUE","GLOBAL_PREFIX_NAME","SQS_GLOBAL_PREFIX_NAME","ACCESS_KEY_ID","SQS_ACCESS_KEY_ID","SECRET_ACCESS_KEY","SQS_SECRET_ACCESS_KEY","ACCOUNT_ID","SQS_ACCOUNT_ID","REGION","SQS_REGION","MAX_PAYLOAD_SIZE","SQS_MAX_PAYLOAD_SIZE","SQS_GLOBAL_APPLICATION_STARTUP","SQS_GLOBAL_CALL","SQS_GLOBAL_CHATS_DELETE","SQS_GLOBAL_CHATS_SET","SQS_GLOBAL_CHATS_UPDATE","SQS_GLOBAL_CHATS_UPSERT","SQS_GLOBAL_CONNECTION_UPDATE","SQS_GLOBAL_CONTACTS_SET","SQS_GLOBAL_CONTACTS_UPDATE","SQS_GLOBAL_CONTACTS_UPSERT","SQS_GLOBAL_GROUP_PARTICIPANTS_UPDATE","GROUPS_UPDATE","SQS_GLOBAL_GROUPS_UPDATE","SQS_GLOBAL_GROUPS_UPSERT","SQS_GLOBAL_LABELS_ASSOCIATION","SQS_GLOBAL_LABELS_EDIT","LOGOUT_INSTANCE","SQS_GLOBAL_LOGOUT_INSTANCE","SQS_GLOBAL_MESSAGES_DELETE","SQS_GLOBAL_MESSAGES_EDITED","SQS_GLOBAL_MESSAGES_SET","SQS_GLOBAL_MESSAGES_UPDATE","SQS_GLOBAL_MESSAGES_UPSERT","SQS_GLOBAL_PRESENCE_UPDATE","SQS_GLOBAL_QRCODE_UPDATED","REMOVE_INSTANCE","SQS_GLOBAL_REMOVE_INSTANCE","SQS_GLOBAL_SEND_MESSAGE","SQS_GLOBAL_TYPEBOT_CHANGE_STATUS","SQS_GLOBAL_TYPEBOT_START","KAFKA","KAFKA_ENABLED","CLIENT_ID","KAFKA_CLIENT_ID","BROKERS","KAFKA_BROKERS","CONNECTION_TIMEOUT","KAFKA_CONNECTION_TIMEOUT","REQUEST_TIMEOUT","KAFKA_REQUEST_TIMEOUT","KAFKA_GLOBAL_ENABLED","CONSUMER_GROUP_ID","KAFKA_CONSUMER_GROUP_ID","TOPIC_PREFIX","KAFKA_TOPIC_PREFIX","NUM_PARTITIONS","KAFKA_NUM_PARTITIONS","REPLICATION_FACTOR","KAFKA_REPLICATION_FACTOR","AUTO_CREATE_TOPICS","KAFKA_AUTO_CREATE_TOPICS","KAFKA_EVENTS_APPLICATION_STARTUP","KAFKA_EVENTS_INSTANCE_CREATE","KAFKA_EVENTS_INSTANCE_DELETE","KAFKA_EVENTS_QRCODE_UPDATED","KAFKA_EVENTS_MESSAGES_SET","KAFKA_EVENTS_MESSAGES_UPSERT","KAFKA_EVENTS_MESSAGES_EDITED","KAFKA_EVENTS_MESSAGES_UPDATE","KAFKA_EVENTS_MESSAGES_DELETE","KAFKA_EVENTS_SEND_MESSAGE","KAFKA_EVENTS_SEND_MESSAGE_UPDATE","KAFKA_EVENTS_CONTACTS_SET","KAFKA_EVENTS_CONTACTS_UPSERT","KAFKA_EVENTS_CONTACTS_UPDATE","KAFKA_EVENTS_PRESENCE_UPDATE","KAFKA_EVENTS_CHATS_SET","KAFKA_EVENTS_CHATS_UPSERT","KAFKA_EVENTS_CHATS_UPDATE","KAFKA_EVENTS_CHATS_DELETE","KAFKA_EVENTS_CONNECTION_UPDATE","KAFKA_EVENTS_LABELS_EDIT","KAFKA_EVENTS_LABELS_ASSOCIATION","KAFKA_EVENTS_GROUPS_UPSERT","KAFKA_EVENTS_GROUPS_UPDATE","KAFKA_EVENTS_GROUP_PARTICIPANTS_UPDATE","KAFKA_EVENTS_CALL","KAFKA_EVENTS_TYPEBOT_START","KAFKA_EVENTS_TYPEBOT_CHANGE_STATUS","SASL","KAFKA_SASL_ENABLED","MECHANISM","KAFKA_SASL_MECHANISM","USERNAME","KAFKA_SASL_USERNAME","PASSWORD","KAFKA_SASL_PASSWORD","undefined","SSL","KAFKA_SSL_ENABLED","REJECT_UNAUTHORIZED","KAFKA_SSL_REJECT_UNAUTHORIZED","CA","KAFKA_SSL_CA","KEY","KAFKA_SSL_KEY","CERT","KAFKA_SSL_CERT","WEBSOCKET","WEBSOCKET_ENABLED","GLOBAL_EVENTS","WEBSOCKET_GLOBAL_EVENTS","ALLOWED_HOSTS","WEBSOCKET_ALLOWED_HOSTS","PUSHER","PUSHER_ENABLED","GLOBAL","PUSHER_GLOBAL_ENABLED","APP_ID","PUSHER_GLOBAL_APP_ID","PUSHER_GLOBAL_KEY","SECRET","PUSHER_GLOBAL_SECRET","CLUSTER","PUSHER_GLOBAL_CLUSTER","USE_TLS","PUSHER_GLOBAL_USE_TLS","PUSHER_EVENTS_APPLICATION_STARTUP","PUSHER_EVENTS_INSTANCE_CREATE","PUSHER_EVENTS_INSTANCE_DELETE","PUSHER_EVENTS_QRCODE_UPDATED","PUSHER_EVENTS_MESSAGES_SET","PUSHER_EVENTS_MESSAGES_UPSERT","PUSHER_EVENTS_MESSAGES_EDITED","PUSHER_EVENTS_MESSAGES_UPDATE","PUSHER_EVENTS_MESSAGES_DELETE","PUSHER_EVENTS_SEND_MESSAGE","PUSHER_EVENTS_SEND_MESSAGE_UPDATE","PUSHER_EVENTS_CONTACTS_SET","PUSHER_EVENTS_CONTACTS_UPDATE","PUSHER_EVENTS_CONTACTS_UPSERT","PUSHER_EVENTS_PRESENCE_UPDATE","PUSHER_EVENTS_CHATS_SET","PUSHER_EVENTS_CHATS_UPDATE","PUSHER_EVENTS_CHATS_UPSERT","PUSHER_EVENTS_CHATS_DELETE","PUSHER_EVENTS_CONNECTION_UPDATE","PUSHER_EVENTS_LABELS_EDIT","PUSHER_EVENTS_LABELS_ASSOCIATION","PUSHER_EVENTS_GROUPS_UPSERT","PUSHER_EVENTS_GROUPS_UPDATE","PUSHER_EVENTS_GROUP_PARTICIPANTS_UPDATE","PUSHER_EVENTS_CALL","PUSHER_EVENTS_TYPEBOT_START","PUSHER_EVENTS_TYPEBOT_CHANGE_STATUS","WA_BUSINESS","TOKEN_WEBHOOK","WA_BUSINESS_TOKEN_WEBHOOK","WA_BUSINESS_URL","VERSION","WA_BUSINESS_VERSION","LANGUAGE","WA_BUSINESS_LANGUAGE","LOG","LEVEL","LOG_LEVEL","COLOR","LOG_COLOR","BAILEYS","LOG_BAILEYS","DEL_INSTANCE","isBooleanString","DEL_TEMP_INSTANCES","WEBHOOK","WEBHOOK_GLOBAL_URL","WEBHOOK_GLOBAL_ENABLED","WEBHOOK_BY_EVENTS","WEBHOOK_GLOBAL_WEBHOOK_BY_EVENTS","WEBHOOK_EVENTS_APPLICATION_STARTUP","WEBHOOK_EVENTS_INSTANCE_CREATE","WEBHOOK_EVENTS_INSTANCE_DELETE","WEBHOOK_EVENTS_QRCODE_UPDATED","WEBHOOK_EVENTS_MESSAGES_SET","WEBHOOK_EVENTS_MESSAGES_UPSERT","WEBHOOK_EVENTS_MESSAGES_EDITED","WEBHOOK_EVENTS_MESSAGES_UPDATE","WEBHOOK_EVENTS_MESSAGES_DELETE","WEBHOOK_EVENTS_SEND_MESSAGE","WEBHOOK_EVENTS_SEND_MESSAGE_UPDATE","WEBHOOK_EVENTS_CONTACTS_SET","WEBHOOK_EVENTS_CONTACTS_UPDATE","WEBHOOK_EVENTS_CONTACTS_UPSERT","WEBHOOK_EVENTS_PRESENCE_UPDATE","WEBHOOK_EVENTS_CHATS_SET","WEBHOOK_EVENTS_CHATS_UPDATE","WEBHOOK_EVENTS_CHATS_UPSERT","WEBHOOK_EVENTS_CHATS_DELETE","WEBHOOK_EVENTS_CONNECTION_UPDATE","WEBHOOK_EVENTS_LABELS_EDIT","WEBHOOK_EVENTS_LABELS_ASSOCIATION","WEBHOOK_EVENTS_GROUPS_UPSERT","WEBHOOK_EVENTS_GROUPS_UPDATE","WEBHOOK_EVENTS_GROUP_PARTICIPANTS_UPDATE","WEBHOOK_EVENTS_CALL","WEBHOOK_EVENTS_TYPEBOT_START","WEBHOOK_EVENTS_TYPEBOT_CHANGE_STATUS","ERRORS","WEBHOOK_EVENTS_ERRORS","ERRORS_WEBHOOK","WEBHOOK_EVENTS_ERRORS_WEBHOOK","REQUEST","TIMEOUT_MS","WEBHOOK_REQUEST_TIMEOUT_MS","RETRY","MAX_ATTEMPTS","WEBHOOK_RETRY_MAX_ATTEMPTS","INITIAL_DELAY_SECONDS","WEBHOOK_RETRY_INITIAL_DELAY_SECONDS","USE_EXPONENTIAL_BACKOFF","WEBHOOK_RETRY_USE_EXPONENTIAL_BACKOFF","MAX_DELAY_SECONDS","WEBHOOK_RETRY_MAX_DELAY_SECONDS","JITTER_FACTOR","parseFloat","WEBHOOK_RETRY_JITTER_FACTOR","NON_RETRYABLE_STATUS_CODES","WEBHOOK_RETRY_NON_RETRYABLE_STATUS_CODES","map","CONFIG_SESSION_PHONE","CLIENT","CONFIG_SESSION_PHONE_CLIENT","CONFIG_SESSION_PHONE_NAME","QRCODE","LIMIT","QRCODE_LIMIT","QRCODE_COLOR","TYPEBOT","TYPEBOT_ENABLED","API_VERSION","TYPEBOT_API_VERSION","SEND_MEDIA_BASE64","TYPEBOT_SEND_MEDIA_BASE64","CHATWOOT","CHATWOOT_ENABLED","MESSAGE_DELETE","CHATWOOT_MESSAGE_DELETE","MESSAGE_READ","CHATWOOT_MESSAGE_READ","BOT_CONTACT","CHATWOOT_BOT_CONTACT","IMPORT","CHATWOOT_IMPORT_DATABASE_CONNECTION_URI","PLACEHOLDER_MEDIA_MESSAGE","CHATWOOT_IMPORT_PLACEHOLDER_MEDIA_MESSAGE","OPENAI","OPENAI_ENABLED","API_KEY_GLOBAL","OPENAI_API_KEY_GLOBAL","DIFY","DIFY_ENABLED","N8N","N8N_ENABLED","EVOAI","EVOAI_ENABLED","FLOWISE","FLOWISE_ENABLED","CACHE","REDIS","CACHE_REDIS_ENABLED","CACHE_REDIS_URI","CACHE_REDIS_PREFIX_KEY","TTL","CACHE_REDIS_TTL","SAVE_INSTANCES","CACHE_REDIS_SAVE_INSTANCES","LOCAL","CACHE_LOCAL_ENABLED","S3","ACCESS_KEY","S3_ACCESS_KEY","SECRET_KEY","S3_SECRET_KEY","ENDPOINT","S3_ENDPOINT","BUCKET_NAME","S3_BUCKET","ENABLE","S3_ENABLED","S3_PORT","USE_SSL","S3_USE_SSL","S3_REGION","SKIP_POLICY","S3_SKIP_POLICY","SAVE_VIDEO","S3_SAVE_VIDEO","AUTHENTICATION","API_KEY","AUTHENTICATION_API_KEY","EXPOSE_IN_FETCH_INSTANCES","AUTHENTICATION_EXPOSE_IN_FETCH_INSTANCES","METRICS","PROMETHEUS_METRICS","AUTH_REQUIRED","METRICS_AUTH_REQUIRED","USER","METRICS_USER","METRICS_PASSWORD","ALLOWED_IPS","METRICS_ALLOWED_IPS","TELEMETRY","TELEMETRY_ENABLED","TELEMETRY_URL","PROXY","PROXY_HOST","PROXY_PORT","PROTOCOL","PROXY_PROTOCOL","PROXY_USERNAME","PROXY_PASSWORD","AUDIO_CONVERTER","API_URL","API_AUDIO_CONVERTER","API_AUDIO_CONVERTER_KEY","FACEBOOK","FACEBOOK_APP_ID","CONFIG_ID","FACEBOOK_CONFIG_ID","USER_TOKEN","FACEBOOK_USER_TOKEN","SENTRY","DSN","SENTRY_DSN","EVENT_EMITTER","MAX_LISTENERS","EVENT_EMITTER_MAX_LISTENERS","_ConfigService","configService","packageJson","JSON","parse","fs","readFileSync","formatDateLog","__name","timestamp","dayjs","toDate","toString","replace","Color","Level","Type","Background","Logger","context","configService","instance","setContext","value","setInstance","console","type","types","get","LEVEL","forEach","level","push","typeValue","includes","COLOR","log","Command","Color","packageJson","version","process","pid","toString","formatDateLog","Date","now","info","warn","error","verbose","debug","dark","_Logger","BaseChatbotService","waMonitor","prismaRepository","loggerName","configService","logger","Logger","isImageMessage","content","includes","isAudioMessage","isJSON","str","JSON","parse","getMediaType","url","extension","split","pop","toLowerCase","imageExtensions","audioExtensions","videoExtensions","documentExtensions","createNewSession","instance","data","type","pushNameValue","pushName","remoteJidValue","remoteJid","session","integrationSession","create","sessionId","status","awaitUser","botId","instanceId","error","process","bot","settings","msg","initNewSession","keywordFinish","normalizedContent","trim","length","update","where","id","sendMessageToBot","sendMessageWhatsApp","message","linkPreview","linkRegex","textBuffer","lastIndex","match","splitMessages","exec","fullMatch","altText","mediaType","beforeText","slice","index","sendFormattedText","audioWhatsapp","number","delay","delayMessage","audio","caption","mediaMessage","mediatype","media","fileName","undefined","remainingText","splitMessageByDoubleLineBreaks","filter","part","sendSingleMessage","timePerChar","Math","min","max","minDelay","maxDelay","debug","integration","Integration","WHATSAPP_BAILEYS","client","presenceSubscribe","sendPresenceUpdate","Promise","resolve","setTimeout","textMessage","text","messageParts","sessionResult","instanceName","getBotType","_BaseChatbotService","EvoaiService","BaseChatbotService","waMonitor","prismaRepository","configService","openaiService","getBotType","sendMessageToBot","instance","session","settings","evoai","remoteJid","pushName","content","msg","logger","debug","processedContent","isAudioMessage","transcription","speechToText","err","error","endpoint","agentUrl","callId","uuidv4","substring","messageId","split","parts","type","text","isImageMessage","media","message","mediaUrl","base64","mediaBase64","isURL","result","axios","get","responseType","Buffer","from","data","toString","push","file","name","key","id","mimeType","bytes","mediaBuffer","downloadMediaMessage","fileContent","fileName","fileErr","payload","jsonrpc","method","params","contextId","sessionId","role","metadata","messageKey","fromMe","instanceName","serverUrl","URL","apiKey","token","redactedPayload","JSON","parse","stringify","map","part","integration","Integration","WHATSAPP_BAILEYS","client","presenceSubscribe","sendPresenceUpdate","response","post","headers","artifacts","Array","isArray","length","artifact","textPart","find","p","sendMessageWhatsApp","_EvoaiService"]}