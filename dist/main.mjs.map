{"version":3,"sources":["../src/config/env.config.ts","../src/utils/instrumentSentry.ts","../src/config/logger.config.ts","../src/api/provider/sessions.ts","../src/api/repository/repository.service.ts","../src/cache/localcache.ts","../src/cache/rediscache.client.ts","../src/cache/rediscache.ts","../src/cache/cacheengine.ts","../src/config/event.config.ts","../src/api/controllers/business.controller.ts","../src/api/controllers/call.controller.ts","../src/api/controllers/chat.controller.ts","../src/api/controllers/group.controller.ts","../src/api/types/wa.types.ts","../src/exceptions/400.exception.ts","../src/exceptions/401.exception.ts","../src/exceptions/403.exception.ts","../src/exceptions/404.exception.ts","../src/exceptions/500.exception.ts","../src/exceptions/index.ts","../src/api/controllers/instance.controller.ts","../src/api/controllers/label.controller.ts","../src/utils/makeProxyAgent.ts","../src/api/controllers/proxy.controller.ts","../src/api/controllers/sendMessage.controller.ts","../src/api/controllers/settings.controller.ts","../src/api/controllers/template.controller.ts","../src/api/integrations/storage/s3/libs/minio.server.ts","../src/api/integrations/chatbot/chatwoot/libs/postgres.client.ts","../src/api/integrations/chatbot/chatwoot/utils/chatwoot-import-helper.ts","../src/utils/i18n.ts","../src/utils/sendTelemetry.ts","../src/api/integrations/chatbot/chatwoot/services/chatwoot.service.ts","../src/api/integrations/chatbot/base-chatbot.service.ts","../src/api/integrations/chatbot/dify/services/dify.service.ts","../src/api/integrations/chatbot/openai/services/openai.service.ts","../src/utils/getConversationMessage.ts","../src/api/integrations/chatbot/typebot/services/typebot.service.ts","../src/utils/createJid.ts","../src/api/services/channel.service.ts","../src/api/integrations/channel/evolution/evolution.channel.service.ts","../src/utils/renderStatus.ts","../src/api/integrations/channel/meta/whatsapp.business.service.ts","../src/api/dto/chat.dto.ts","../src/api/services/cache.service.ts","../src/utils/fetchLatestWaWebVersion.ts","../src/utils/onWhatsappCache.ts","../src/config/path.config.ts","../src/utils/use-multi-file-auth-state-prisma.ts","../src/utils/use-multi-file-auth-state-provider-files.ts","../src/utils/use-multi-file-auth-state-redis-db.ts","../src/api/integrations/channel/whatsapp/baileysMessage.processor.ts","../src/api/integrations/channel/whatsapp/voiceCalls/useVoiceCallsBaileys.ts","../src/api/integrations/channel/whatsapp/whatsapp.baileys.service.ts","../src/api/integrations/channel/channel.controller.ts","../src/api/integrations/channel/evolution/evolution.controller.ts","../src/api/integrations/channel/meta/meta.controller.ts","../src/api/integrations/channel/whatsapp/baileys.controller.ts","../src/utils/advancedOperatorsSearch.ts","../src/utils/findBotByTrigger.ts","../src/api/integrations/chatbot/chatbot.controller.ts","../src/api/integrations/chatbot/chatwoot/controllers/chatwoot.controller.ts","../src/api/integrations/chatbot/base-chatbot.controller.ts","../src/api/integrations/chatbot/dify/controllers/dify.controller.ts","../src/api/integrations/chatbot/evoai/controllers/evoai.controller.ts","../src/api/integrations/chatbot/evoai/services/evoai.service.ts","../src/api/integrations/chatbot/evolutionBot/controllers/evolutionBot.controller.ts","../src/api/integrations/chatbot/evolutionBot/services/evolutionBot.service.ts","../src/api/integrations/chatbot/flowise/controllers/flowise.controller.ts","../src/api/integrations/chatbot/flowise/services/flowise.service.ts","../src/api/integrations/chatbot/n8n/controllers/n8n.controller.ts","../src/api/integrations/chatbot/n8n/services/n8n.service.ts","../src/api/integrations/chatbot/openai/controllers/openai.controller.ts","../src/api/integrations/chatbot/typebot/controllers/typebot.controller.ts","../src/api/integrations/event/event.controller.ts","../src/api/integrations/event/kafka/kafka.controller.ts","../src/api/integrations/event/nats/nats.controller.ts","../src/api/integrations/event/pusher/pusher.controller.ts","../src/api/integrations/event/rabbitmq/rabbitmq.controller.ts","../src/api/integrations/event/sqs/sqs.controller.ts","../src/api/integrations/event/webhook/webhook.controller.ts","../src/api/integrations/event/websocket/websocket.controller.ts","../src/api/integrations/event/event.manager.ts","../src/api/integrations/storage/s3/controllers/s3.controller.ts","../src/api/integrations/storage/s3/services/s3.service.ts","../src/api/services/monitor.service.ts","../src/api/services/proxy.service.ts","../src/api/services/settings.service.ts","../src/api/services/template.service.ts","../src/api/server.module.ts","../src/api/guards/auth.guard.ts","../src/api/guards/instance.guard.ts","../src/api/guards/telemetry.guard.ts","../src/api/abstract/abstract.router.ts","../src/api/integrations/channel/evolution/evolution.router.ts","../src/api/integrations/channel/meta/meta.router.ts","../src/api/integrations/chatbot/chatwoot/dto/chatwoot.dto.ts","../src/api/integrations/event/event.dto.ts","../src/api/integrations/integration.dto.ts","../src/api/dto/instance.dto.ts","../src/validate/instance.schema.ts","../src/api/integrations/channel/whatsapp/baileys.router.ts","../src/api/integrations/channel/channel.router.ts","../src/validate/business.schema.ts","../src/validate/chat.schema.ts","../src/validate/group.schema.ts","../src/validate/label.schema.ts","../src/validate/message.schema.ts","../src/validate/proxy.schema.ts","../src/validate/settings.schema.ts","../src/validate/template.schema.ts","../src/validate/templateDelete.schema.ts","../src/validate/templateEdit.schema.ts","../src/api/integrations/chatbot/chatwoot/validate/chatwoot.schema.ts","../src/api/integrations/chatbot/dify/validate/dify.schema.ts","../src/api/integrations/chatbot/evoai/validate/evoai.schema.ts","../src/api/integrations/chatbot/evolutionBot/validate/evolutionBot.schema.ts","../src/api/integrations/chatbot/flowise/validate/flowise.schema.ts","../src/api/integrations/chatbot/n8n/validate/n8n.schema.ts","../src/api/integrations/chatbot/openai/validate/openai.schema.ts","../src/api/integrations/chatbot/typebot/validate/typebot.schema.ts","../src/api/integrations/chatbot/chatbot.schema.ts","../src/api/integrations/event/pusher/pusher.schema.ts","../src/api/integrations/event/webhook/webhook.schema.ts","../src/api/integrations/event/event.schema.ts","../src/validate/validate.schema.ts","../src/api/integrations/chatbot/chatwoot/routes/chatwoot.router.ts","../src/api/dto/chatbot.dto.ts","../src/api/integrations/chatbot/base-chatbot.dto.ts","../src/api/integrations/chatbot/dify/dto/dify.dto.ts","../src/api/integrations/chatbot/dify/routes/dify.router.ts","../src/api/integrations/chatbot/openai/dto/openai.dto.ts","../src/api/integrations/chatbot/openai/routes/openai.router.ts","../src/api/integrations/chatbot/typebot/dto/typebot.dto.ts","../src/api/integrations/chatbot/typebot/routes/typebot.router.ts","../src/api/integrations/chatbot/evoai/dto/evoai.dto.ts","../src/api/integrations/chatbot/evoai/routes/evoai.router.ts","../src/api/integrations/chatbot/evolutionBot/dto/evolutionBot.dto.ts","../src/api/integrations/chatbot/evolutionBot/routes/evolutionBot.router.ts","../src/api/integrations/chatbot/flowise/dto/flowise.dto.ts","../src/api/integrations/chatbot/flowise/routes/flowise.router.ts","../src/api/integrations/chatbot/n8n/dto/n8n.dto.ts","../src/api/integrations/chatbot/n8n/routes/n8n.router.ts","../src/api/integrations/chatbot/chatbot.router.ts","../src/api/integrations/event/kafka/kafka.router.ts","../src/api/integrations/event/nats/nats.router.ts","../src/api/integrations/event/pusher/pusher.router.ts","../src/api/integrations/event/rabbitmq/rabbitmq.router.ts","../src/api/integrations/event/sqs/sqs.router.ts","../src/api/integrations/event/webhook/webhook.router.ts","../src/api/integrations/event/websocket/websocket.router.ts","../src/api/integrations/event/event.router.ts","../src/api/integrations/storage/s3/dto/media.dto.ts","../src/api/integrations/storage/s3/validate/s3.schema.ts","../src/api/integrations/storage/s3/routes/s3.router.ts","../src/api/integrations/storage/storage.router.ts","../src/utils/errorResponse.ts","../src/api/routes/business.router.ts","../src/api/dto/call.dto.ts","../src/api/routes/call.router.ts","../src/api/routes/chat.router.ts","../src/api/dto/group.dto.ts","../src/api/routes/group.router.ts","../src/api/routes/instance.router.ts","../src/api/dto/label.dto.ts","../src/api/routes/label.router.ts","../src/api/dto/proxy.dto.ts","../src/api/routes/proxy.router.ts","../src/api/dto/sendMessage.dto.ts","../src/api/routes/sendMessage.router.ts","../src/api/dto/settings.dto.ts","../src/api/routes/settings.router.ts","../src/api/dto/template.dto.ts","../src/api/routes/template.router.ts","../src/api/routes/view.router.ts","../src/api/routes/index.router.ts","../src/config/error.config.ts","../src/utils/server-up.ts","../src/main.ts"],"sourcesContent":["import { isBooleanString } from 'class-validator';\nimport dotenv from 'dotenv';\n\ndotenv.config();\n\nexport type HttpServer = {\n  NAME: string;\n  TYPE: 'http' | 'https';\n  PORT: number;\n  URL: string;\n  DISABLE_DOCS: boolean;\n  DISABLE_MANAGER: boolean;\n};\n\nexport type HttpMethods = 'POST' | 'GET' | 'PUT' | 'DELETE';\nexport type Cors = {\n  ORIGIN: string[];\n  METHODS: HttpMethods[];\n  CREDENTIALS: boolean;\n};\n\nexport type LogBaileys = 'fatal' | 'error' | 'warn' | 'info' | 'debug' | 'trace';\n\nexport type LogLevel = 'ERROR' | 'WARN' | 'DEBUG' | 'INFO' | 'LOG' | 'VERBOSE' | 'DARK' | 'WEBHOOKS' | 'WEBSOCKET';\n\nexport type Log = {\n  LEVEL: LogLevel[];\n  COLOR: boolean;\n  BAILEYS: LogBaileys;\n};\n\nexport type ProviderSession = {\n  ENABLED: boolean;\n  HOST: string;\n  PORT: string;\n  PREFIX: string;\n};\n\nexport type SaveData = {\n  INSTANCE: boolean;\n  HISTORIC: boolean;\n  NEW_MESSAGE: boolean;\n  MESSAGE_UPDATE: boolean;\n  CONTACTS: boolean;\n  CHATS: boolean;\n  LABELS: boolean;\n  IS_ON_WHATSAPP: boolean;\n  IS_ON_WHATSAPP_DAYS: number;\n};\n\nexport type DBConnection = {\n  URI: string;\n  CLIENT_NAME: string;\n};\nexport type Database = {\n  CONNECTION: DBConnection;\n  PROVIDER: string;\n  SAVE_DATA: SaveData;\n  DELETE_DATA: DeleteData;\n};\n\nexport type DeleteData = {\n  LOGICAL_MESSAGE_DELETE: boolean;\n};\nexport type EventsRabbitmq = {\n  APPLICATION_STARTUP: boolean;\n  INSTANCE_CREATE: boolean;\n  INSTANCE_DELETE: boolean;\n  QRCODE_UPDATED: boolean;\n  MESSAGES_SET: boolean;\n  MESSAGES_UPSERT: boolean;\n  MESSAGES_EDITED: boolean;\n  MESSAGES_UPDATE: boolean;\n  MESSAGES_DELETE: boolean;\n  SEND_MESSAGE: boolean;\n  SEND_MESSAGE_UPDATE: boolean;\n  CONTACTS_SET: boolean;\n  CONTACTS_UPDATE: boolean;\n  CONTACTS_UPSERT: boolean;\n  PRESENCE_UPDATE: boolean;\n  CHATS_SET: boolean;\n  CHATS_UPDATE: boolean;\n  CHATS_DELETE: boolean;\n  CHATS_UPSERT: boolean;\n  CONNECTION_UPDATE: boolean;\n  LABELS_EDIT: boolean;\n  LABELS_ASSOCIATION: boolean;\n  GROUPS_UPSERT: boolean;\n  GROUP_UPDATE: boolean;\n  GROUP_PARTICIPANTS_UPDATE: boolean;\n  CALL: boolean;\n  TYPEBOT_START: boolean;\n  TYPEBOT_CHANGE_STATUS: boolean;\n};\n\nexport type Rabbitmq = {\n  ENABLED: boolean;\n  URI: string;\n  FRAME_MAX: number;\n  EXCHANGE_NAME: string;\n  GLOBAL_ENABLED: boolean;\n  EVENTS: EventsRabbitmq;\n  PREFIX_KEY?: string;\n};\n\nexport type Nats = {\n  ENABLED: boolean;\n  URI: string;\n  EXCHANGE_NAME: string;\n  GLOBAL_ENABLED: boolean;\n  EVENTS: EventsRabbitmq;\n  PREFIX_KEY?: string;\n};\n\nexport type Sqs = {\n  ENABLED: boolean;\n  GLOBAL_ENABLED: boolean;\n  GLOBAL_FORCE_SINGLE_QUEUE: boolean;\n  GLOBAL_PREFIX_NAME: string;\n  ACCESS_KEY_ID: string;\n  SECRET_ACCESS_KEY: string;\n  ACCOUNT_ID: string;\n  REGION: string;\n  MAX_PAYLOAD_SIZE: number;\n  EVENTS: {\n    APPLICATION_STARTUP: boolean;\n    CALL: boolean;\n    CHATS_DELETE: boolean;\n    CHATS_SET: boolean;\n    CHATS_UPDATE: boolean;\n    CHATS_UPSERT: boolean;\n    CONNECTION_UPDATE: boolean;\n    CONTACTS_SET: boolean;\n    CONTACTS_UPDATE: boolean;\n    CONTACTS_UPSERT: boolean;\n    GROUP_PARTICIPANTS_UPDATE: boolean;\n    GROUPS_UPDATE: boolean;\n    GROUPS_UPSERT: boolean;\n    LABELS_ASSOCIATION: boolean;\n    LABELS_EDIT: boolean;\n    LOGOUT_INSTANCE: boolean;\n    MESSAGES_DELETE: boolean;\n    MESSAGES_EDITED: boolean;\n    MESSAGES_SET: boolean;\n    MESSAGES_UPDATE: boolean;\n    MESSAGES_UPSERT: boolean;\n    PRESENCE_UPDATE: boolean;\n    QRCODE_UPDATED: boolean;\n    REMOVE_INSTANCE: boolean;\n    SEND_MESSAGE: boolean;\n    TYPEBOT_CHANGE_STATUS: boolean;\n    TYPEBOT_START: boolean;\n  };\n};\n\nexport type Kafka = {\n  ENABLED: boolean;\n  CLIENT_ID: string;\n  BROKERS: string[];\n  CONNECTION_TIMEOUT: number;\n  REQUEST_TIMEOUT: number;\n  GLOBAL_ENABLED: boolean;\n  CONSUMER_GROUP_ID: string;\n  TOPIC_PREFIX: string;\n  NUM_PARTITIONS: number;\n  REPLICATION_FACTOR: number;\n  AUTO_CREATE_TOPICS: boolean;\n  EVENTS: EventsRabbitmq;\n  SASL?: {\n    ENABLED: boolean;\n    MECHANISM: string;\n    USERNAME: string;\n    PASSWORD: string;\n  };\n  SSL?: {\n    ENABLED: boolean;\n    REJECT_UNAUTHORIZED: boolean;\n    CA?: string;\n    KEY?: string;\n    CERT?: string;\n  };\n};\n\nexport type Websocket = {\n  ENABLED: boolean;\n  GLOBAL_EVENTS: boolean;\n  ALLOWED_HOSTS?: string;\n};\n\nexport type WaBusiness = {\n  TOKEN_WEBHOOK: string;\n  URL: string;\n  VERSION: string;\n  LANGUAGE: string;\n};\n\nexport type EventsWebhook = {\n  APPLICATION_STARTUP: boolean;\n  INSTANCE_CREATE: boolean;\n  INSTANCE_DELETE: boolean;\n  QRCODE_UPDATED: boolean;\n  MESSAGES_SET: boolean;\n  MESSAGES_UPSERT: boolean;\n  MESSAGES_EDITED: boolean;\n  MESSAGES_UPDATE: boolean;\n  MESSAGES_DELETE: boolean;\n  SEND_MESSAGE: boolean;\n  SEND_MESSAGE_UPDATE: boolean;\n  CONTACTS_SET: boolean;\n  CONTACTS_UPDATE: boolean;\n  CONTACTS_UPSERT: boolean;\n  PRESENCE_UPDATE: boolean;\n  CHATS_SET: boolean;\n  CHATS_UPDATE: boolean;\n  CHATS_DELETE: boolean;\n  CHATS_UPSERT: boolean;\n  CONNECTION_UPDATE: boolean;\n  LABELS_EDIT: boolean;\n  LABELS_ASSOCIATION: boolean;\n  GROUPS_UPSERT: boolean;\n  GROUP_UPDATE: boolean;\n  GROUP_PARTICIPANTS_UPDATE: boolean;\n  CALL: boolean;\n  TYPEBOT_START: boolean;\n  TYPEBOT_CHANGE_STATUS: boolean;\n  ERRORS: boolean;\n  ERRORS_WEBHOOK: string;\n};\n\nexport type EventsPusher = {\n  APPLICATION_STARTUP: boolean;\n  INSTANCE_CREATE: boolean;\n  INSTANCE_DELETE: boolean;\n  QRCODE_UPDATED: boolean;\n  MESSAGES_SET: boolean;\n  MESSAGES_UPSERT: boolean;\n  MESSAGES_EDITED: boolean;\n  MESSAGES_UPDATE: boolean;\n  MESSAGES_DELETE: boolean;\n  SEND_MESSAGE: boolean;\n  SEND_MESSAGE_UPDATE: boolean;\n  CONTACTS_SET: boolean;\n  CONTACTS_UPDATE: boolean;\n  CONTACTS_UPSERT: boolean;\n  PRESENCE_UPDATE: boolean;\n  CHATS_SET: boolean;\n  CHATS_UPDATE: boolean;\n  CHATS_DELETE: boolean;\n  CHATS_UPSERT: boolean;\n  CONNECTION_UPDATE: boolean;\n  LABELS_EDIT: boolean;\n  LABELS_ASSOCIATION: boolean;\n  GROUPS_UPSERT: boolean;\n  GROUP_UPDATE: boolean;\n  GROUP_PARTICIPANTS_UPDATE: boolean;\n  CALL: boolean;\n  TYPEBOT_START: boolean;\n  TYPEBOT_CHANGE_STATUS: boolean;\n};\n\nexport type ApiKey = { KEY: string };\n\nexport type Auth = {\n  API_KEY: ApiKey;\n  EXPOSE_IN_FETCH_INSTANCES: boolean;\n};\n\nexport type DelInstance = number | boolean;\n\nexport type Language = string | 'en';\n\nexport type GlobalWebhook = {\n  URL: string;\n  ENABLED: boolean;\n  WEBHOOK_BY_EVENTS: boolean;\n};\n\nexport type GlobalPusher = {\n  ENABLED: boolean;\n  APP_ID: string;\n  KEY: string;\n  SECRET: string;\n  CLUSTER: string;\n  USE_TLS: boolean;\n};\n\nexport type CacheConfRedis = {\n  ENABLED: boolean;\n  URI: string;\n  PREFIX_KEY: string;\n  TTL: number;\n  SAVE_INSTANCES: boolean;\n};\nexport type CacheConfLocal = {\n  ENABLED: boolean;\n  TTL: number;\n};\nexport type SslConf = { PRIVKEY: string; FULLCHAIN: string };\nexport type Webhook = {\n  GLOBAL?: GlobalWebhook;\n  EVENTS: EventsWebhook;\n  REQUEST?: {\n    TIMEOUT_MS?: number;\n  };\n  RETRY?: {\n    MAX_ATTEMPTS?: number;\n    INITIAL_DELAY_SECONDS?: number;\n    USE_EXPONENTIAL_BACKOFF?: boolean;\n    MAX_DELAY_SECONDS?: number;\n    JITTER_FACTOR?: number;\n    NON_RETRYABLE_STATUS_CODES?: number[];\n  };\n};\nexport type Pusher = { ENABLED: boolean; GLOBAL?: GlobalPusher; EVENTS: EventsPusher };\nexport type ConfigSessionPhone = { CLIENT: string; NAME: string };\nexport type QrCode = { LIMIT: number; COLOR: string };\nexport type Typebot = { ENABLED: boolean; API_VERSION: string; SEND_MEDIA_BASE64: boolean };\nexport type Chatwoot = {\n  ENABLED: boolean;\n  MESSAGE_DELETE: boolean;\n  MESSAGE_READ: boolean;\n  BOT_CONTACT: boolean;\n  IMPORT: {\n    DATABASE: {\n      CONNECTION: {\n        URI: string;\n      };\n    };\n    PLACEHOLDER_MEDIA_MESSAGE: boolean;\n  };\n};\nexport type Openai = { ENABLED: boolean; API_KEY_GLOBAL?: string };\nexport type Dify = { ENABLED: boolean };\nexport type N8n = { ENABLED: boolean };\nexport type Evoai = { ENABLED: boolean };\nexport type Flowise = { ENABLED: boolean };\n\nexport type S3 = {\n  ACCESS_KEY: string;\n  SECRET_KEY: string;\n  ENDPOINT: string;\n  BUCKET_NAME: string;\n  ENABLE: boolean;\n  PORT?: number;\n  USE_SSL?: boolean;\n  REGION?: string;\n  SKIP_POLICY?: boolean;\n  SAVE_VIDEO?: boolean;\n};\n\nexport type CacheConf = { REDIS: CacheConfRedis; LOCAL: CacheConfLocal };\nexport type Metrics = {\n  ENABLED: boolean;\n  AUTH_REQUIRED: boolean;\n  USER?: string;\n  PASSWORD?: string;\n  ALLOWED_IPS?: string;\n};\n\nexport type Telemetry = {\n  ENABLED: boolean;\n  URL?: string;\n};\n\nexport type Proxy = {\n  HOST?: string;\n  PORT?: string;\n  PROTOCOL?: string;\n  USERNAME?: string;\n  PASSWORD?: string;\n};\n\nexport type AudioConverter = {\n  API_URL?: string;\n  API_KEY?: string;\n};\n\nexport type Facebook = {\n  APP_ID?: string;\n  CONFIG_ID?: string;\n  USER_TOKEN?: string;\n};\n\nexport type Sentry = {\n  DSN?: string;\n};\n\nexport type EventEmitter = {\n  MAX_LISTENERS: number;\n};\n\nexport type Production = boolean;\n\nexport interface Env {\n  SERVER: HttpServer;\n  CORS: Cors;\n  SSL_CONF: SslConf;\n  PROVIDER: ProviderSession;\n  DATABASE: Database;\n  RABBITMQ: Rabbitmq;\n  NATS: Nats;\n  SQS: Sqs;\n  KAFKA: Kafka;\n  WEBSOCKET: Websocket;\n  WA_BUSINESS: WaBusiness;\n  LOG: Log;\n  DEL_INSTANCE: DelInstance;\n  DEL_TEMP_INSTANCES: boolean;\n  LANGUAGE: Language;\n  WEBHOOK: Webhook;\n  PUSHER: Pusher;\n  CONFIG_SESSION_PHONE: ConfigSessionPhone;\n  QRCODE: QrCode;\n  TYPEBOT: Typebot;\n  CHATWOOT: Chatwoot;\n  OPENAI: Openai;\n  DIFY: Dify;\n  N8N: N8n;\n  EVOAI: Evoai;\n  FLOWISE: Flowise;\n  CACHE: CacheConf;\n  S3?: S3;\n  AUTHENTICATION: Auth;\n  METRICS: Metrics;\n  TELEMETRY: Telemetry;\n  PROXY: Proxy;\n  AUDIO_CONVERTER: AudioConverter;\n  FACEBOOK: Facebook;\n  SENTRY: Sentry;\n  EVENT_EMITTER: EventEmitter;\n  PRODUCTION?: Production;\n}\n\nexport type Key = keyof Env;\n\nexport class ConfigService {\n  constructor() {\n    this.loadEnv();\n  }\n\n  private env: Env;\n\n  public get<T = any>(key: Key) {\n    return this.env[key] as T;\n  }\n\n  private loadEnv() {\n    this.env = this.envProcess();\n    this.env.PRODUCTION = process.env?.NODE_ENV === 'PROD';\n    if (process.env?.DOCKER_ENV === 'true') {\n      this.env.SERVER.TYPE = process.env.SERVER_TYPE as 'http' | 'http';\n      this.env.SERVER.PORT = Number.parseInt(process.env.SERVER_PORT) || 8080;\n    }\n  }\n\n  private envProcess(): Env {\n    return {\n      SERVER: {\n        NAME: process.env?.SERVER_NAME || 'evolution',\n        TYPE: (process.env.SERVER_TYPE as 'http' | 'https') || 'http',\n        PORT: Number.parseInt(process.env.SERVER_PORT) || 8080,\n        URL: process.env.SERVER_URL,\n        DISABLE_DOCS: process.env?.SERVER_DISABLE_DOCS === 'true',\n        DISABLE_MANAGER: process.env?.SERVER_DISABLE_MANAGER === 'true',\n      },\n      CORS: {\n        ORIGIN: process.env.CORS_ORIGIN?.split(',') || ['*'],\n        METHODS:\n          (process.env.CORS_METHODS?.split(',') as HttpMethods[]) ||\n          (['POST', 'GET', 'PUT', 'DELETE'] as HttpMethods[]),\n        CREDENTIALS: process.env?.CORS_CREDENTIALS === 'true',\n      },\n      SSL_CONF: {\n        PRIVKEY: process.env?.SSL_CONF_PRIVKEY || '',\n        FULLCHAIN: process.env?.SSL_CONF_FULLCHAIN || '',\n      },\n      PROVIDER: {\n        ENABLED: process.env?.PROVIDER_ENABLED === 'true',\n        HOST: process.env.PROVIDER_HOST,\n        PORT: process.env?.PROVIDER_PORT || '5656',\n        PREFIX: process.env?.PROVIDER_PREFIX || 'evolution',\n      },\n      DATABASE: {\n        CONNECTION: {\n          URI: process.env.DATABASE_CONNECTION_URI || '',\n          CLIENT_NAME: process.env.DATABASE_CONNECTION_CLIENT_NAME || 'evolution',\n        },\n        PROVIDER: process.env.DATABASE_PROVIDER || 'postgresql',\n        SAVE_DATA: {\n          INSTANCE: process.env?.DATABASE_SAVE_DATA_INSTANCE === 'true',\n          NEW_MESSAGE: process.env?.DATABASE_SAVE_DATA_NEW_MESSAGE === 'true',\n          MESSAGE_UPDATE: process.env?.DATABASE_SAVE_MESSAGE_UPDATE === 'true',\n          CONTACTS: process.env?.DATABASE_SAVE_DATA_CONTACTS === 'true',\n          CHATS: process.env?.DATABASE_SAVE_DATA_CHATS === 'true',\n          HISTORIC: process.env?.DATABASE_SAVE_DATA_HISTORIC === 'true',\n          LABELS: process.env?.DATABASE_SAVE_DATA_LABELS === 'true',\n          IS_ON_WHATSAPP: process.env?.DATABASE_SAVE_IS_ON_WHATSAPP === 'true',\n          IS_ON_WHATSAPP_DAYS: Number.parseInt(process.env?.DATABASE_SAVE_IS_ON_WHATSAPP_DAYS ?? '7'),\n        },\n        DELETE_DATA: {\n          LOGICAL_MESSAGE_DELETE: process.env?.DATABASE_DELETE_MESSAGE === 'true',\n        },\n      },\n      RABBITMQ: {\n        ENABLED: process.env?.RABBITMQ_ENABLED === 'true',\n        GLOBAL_ENABLED: process.env?.RABBITMQ_GLOBAL_ENABLED === 'true',\n        PREFIX_KEY: process.env?.RABBITMQ_PREFIX_KEY,\n        EXCHANGE_NAME: process.env?.RABBITMQ_EXCHANGE_NAME || 'evolution_exchange',\n        URI: process.env.RABBITMQ_URI || '',\n        FRAME_MAX: Number.parseInt(process.env.RABBITMQ_FRAME_MAX) || 8192,\n        EVENTS: {\n          APPLICATION_STARTUP: process.env?.RABBITMQ_EVENTS_APPLICATION_STARTUP === 'true',\n          INSTANCE_CREATE: process.env?.RABBITMQ_EVENTS_INSTANCE_CREATE === 'true',\n          INSTANCE_DELETE: process.env?.RABBITMQ_EVENTS_INSTANCE_DELETE === 'true',\n          QRCODE_UPDATED: process.env?.RABBITMQ_EVENTS_QRCODE_UPDATED === 'true',\n          MESSAGES_SET: process.env?.RABBITMQ_EVENTS_MESSAGES_SET === 'true',\n          MESSAGES_UPSERT: process.env?.RABBITMQ_EVENTS_MESSAGES_UPSERT === 'true',\n          MESSAGES_EDITED: process.env?.RABBITMQ_EVENTS_MESSAGES_EDITED === 'true',\n          MESSAGES_UPDATE: process.env?.RABBITMQ_EVENTS_MESSAGES_UPDATE === 'true',\n          MESSAGES_DELETE: process.env?.RABBITMQ_EVENTS_MESSAGES_DELETE === 'true',\n          SEND_MESSAGE: process.env?.RABBITMQ_EVENTS_SEND_MESSAGE === 'true',\n          SEND_MESSAGE_UPDATE: process.env?.RABBITMQ_EVENTS_SEND_MESSAGE_UPDATE === 'true',\n          CONTACTS_SET: process.env?.RABBITMQ_EVENTS_CONTACTS_SET === 'true',\n          CONTACTS_UPDATE: process.env?.RABBITMQ_EVENTS_CONTACTS_UPDATE === 'true',\n          CONTACTS_UPSERT: process.env?.RABBITMQ_EVENTS_CONTACTS_UPSERT === 'true',\n          PRESENCE_UPDATE: process.env?.RABBITMQ_EVENTS_PRESENCE_UPDATE === 'true',\n          CHATS_SET: process.env?.RABBITMQ_EVENTS_CHATS_SET === 'true',\n          CHATS_UPDATE: process.env?.RABBITMQ_EVENTS_CHATS_UPDATE === 'true',\n          CHATS_UPSERT: process.env?.RABBITMQ_EVENTS_CHATS_UPSERT === 'true',\n          CHATS_DELETE: process.env?.RABBITMQ_EVENTS_CHATS_DELETE === 'true',\n          CONNECTION_UPDATE: process.env?.RABBITMQ_EVENTS_CONNECTION_UPDATE === 'true',\n          LABELS_EDIT: process.env?.RABBITMQ_EVENTS_LABELS_EDIT === 'true',\n          LABELS_ASSOCIATION: process.env?.RABBITMQ_EVENTS_LABELS_ASSOCIATION === 'true',\n          GROUPS_UPSERT: process.env?.RABBITMQ_EVENTS_GROUPS_UPSERT === 'true',\n          GROUP_UPDATE: process.env?.RABBITMQ_EVENTS_GROUPS_UPDATE === 'true',\n          GROUP_PARTICIPANTS_UPDATE: process.env?.RABBITMQ_EVENTS_GROUP_PARTICIPANTS_UPDATE === 'true',\n          CALL: process.env?.RABBITMQ_EVENTS_CALL === 'true',\n          TYPEBOT_START: process.env?.RABBITMQ_EVENTS_TYPEBOT_START === 'true',\n          TYPEBOT_CHANGE_STATUS: process.env?.RABBITMQ_EVENTS_TYPEBOT_CHANGE_STATUS === 'true',\n        },\n      },\n      NATS: {\n        ENABLED: process.env?.NATS_ENABLED === 'true',\n        GLOBAL_ENABLED: process.env?.NATS_GLOBAL_ENABLED === 'true',\n        PREFIX_KEY: process.env?.NATS_PREFIX_KEY,\n        EXCHANGE_NAME: process.env?.NATS_EXCHANGE_NAME || 'evolution_exchange',\n        URI: process.env.NATS_URI || '',\n        EVENTS: {\n          APPLICATION_STARTUP: process.env?.NATS_EVENTS_APPLICATION_STARTUP === 'true',\n          INSTANCE_CREATE: process.env?.NATS_EVENTS_INSTANCE_CREATE === 'true',\n          INSTANCE_DELETE: process.env?.NATS_EVENTS_INSTANCE_DELETE === 'true',\n          QRCODE_UPDATED: process.env?.NATS_EVENTS_QRCODE_UPDATED === 'true',\n          MESSAGES_SET: process.env?.NATS_EVENTS_MESSAGES_SET === 'true',\n          MESSAGES_UPSERT: process.env?.NATS_EVENTS_MESSAGES_UPSERT === 'true',\n          MESSAGES_EDITED: process.env?.NATS_EVENTS_MESSAGES_EDITED === 'true',\n          MESSAGES_UPDATE: process.env?.NATS_EVENTS_MESSAGES_UPDATE === 'true',\n          MESSAGES_DELETE: process.env?.NATS_EVENTS_MESSAGES_DELETE === 'true',\n          SEND_MESSAGE: process.env?.NATS_EVENTS_SEND_MESSAGE === 'true',\n          SEND_MESSAGE_UPDATE: process.env?.NATS_EVENTS_SEND_MESSAGE_UPDATE === 'true',\n          CONTACTS_SET: process.env?.NATS_EVENTS_CONTACTS_SET === 'true',\n          CONTACTS_UPDATE: process.env?.NATS_EVENTS_CONTACTS_UPDATE === 'true',\n          CONTACTS_UPSERT: process.env?.NATS_EVENTS_CONTACTS_UPSERT === 'true',\n          PRESENCE_UPDATE: process.env?.NATS_EVENTS_PRESENCE_UPDATE === 'true',\n          CHATS_SET: process.env?.NATS_EVENTS_CHATS_SET === 'true',\n          CHATS_UPDATE: process.env?.NATS_EVENTS_CHATS_UPDATE === 'true',\n          CHATS_UPSERT: process.env?.NATS_EVENTS_CHATS_UPSERT === 'true',\n          CHATS_DELETE: process.env?.NATS_EVENTS_CHATS_DELETE === 'true',\n          CONNECTION_UPDATE: process.env?.NATS_EVENTS_CONNECTION_UPDATE === 'true',\n          LABELS_EDIT: process.env?.NATS_EVENTS_LABELS_EDIT === 'true',\n          LABELS_ASSOCIATION: process.env?.NATS_EVENTS_LABELS_ASSOCIATION === 'true',\n          GROUPS_UPSERT: process.env?.NATS_EVENTS_GROUPS_UPSERT === 'true',\n          GROUP_UPDATE: process.env?.NATS_EVENTS_GROUPS_UPDATE === 'true',\n          GROUP_PARTICIPANTS_UPDATE: process.env?.NATS_EVENTS_GROUP_PARTICIPANTS_UPDATE === 'true',\n          CALL: process.env?.NATS_EVENTS_CALL === 'true',\n          TYPEBOT_START: process.env?.NATS_EVENTS_TYPEBOT_START === 'true',\n          TYPEBOT_CHANGE_STATUS: process.env?.NATS_EVENTS_TYPEBOT_CHANGE_STATUS === 'true',\n        },\n      },\n      SQS: {\n        ENABLED: process.env?.SQS_ENABLED === 'true',\n        GLOBAL_ENABLED: process.env?.SQS_GLOBAL_ENABLED === 'true',\n        GLOBAL_FORCE_SINGLE_QUEUE: process.env?.SQS_GLOBAL_FORCE_SINGLE_QUEUE === 'true',\n        GLOBAL_PREFIX_NAME: process.env?.SQS_GLOBAL_PREFIX_NAME || 'global',\n        ACCESS_KEY_ID: process.env.SQS_ACCESS_KEY_ID || '',\n        SECRET_ACCESS_KEY: process.env.SQS_SECRET_ACCESS_KEY || '',\n        ACCOUNT_ID: process.env.SQS_ACCOUNT_ID || '',\n        REGION: process.env.SQS_REGION || '',\n        MAX_PAYLOAD_SIZE: Number.parseInt(process.env.SQS_MAX_PAYLOAD_SIZE ?? '1048576'),\n        EVENTS: {\n          APPLICATION_STARTUP: process.env?.SQS_GLOBAL_APPLICATION_STARTUP === 'true',\n          CALL: process.env?.SQS_GLOBAL_CALL === 'true',\n          CHATS_DELETE: process.env?.SQS_GLOBAL_CHATS_DELETE === 'true',\n          CHATS_SET: process.env?.SQS_GLOBAL_CHATS_SET === 'true',\n          CHATS_UPDATE: process.env?.SQS_GLOBAL_CHATS_UPDATE === 'true',\n          CHATS_UPSERT: process.env?.SQS_GLOBAL_CHATS_UPSERT === 'true',\n          CONNECTION_UPDATE: process.env?.SQS_GLOBAL_CONNECTION_UPDATE === 'true',\n          CONTACTS_SET: process.env?.SQS_GLOBAL_CONTACTS_SET === 'true',\n          CONTACTS_UPDATE: process.env?.SQS_GLOBAL_CONTACTS_UPDATE === 'true',\n          CONTACTS_UPSERT: process.env?.SQS_GLOBAL_CONTACTS_UPSERT === 'true',\n          GROUP_PARTICIPANTS_UPDATE: process.env?.SQS_GLOBAL_GROUP_PARTICIPANTS_UPDATE === 'true',\n          GROUPS_UPDATE: process.env?.SQS_GLOBAL_GROUPS_UPDATE === 'true',\n          GROUPS_UPSERT: process.env?.SQS_GLOBAL_GROUPS_UPSERT === 'true',\n          LABELS_ASSOCIATION: process.env?.SQS_GLOBAL_LABELS_ASSOCIATION === 'true',\n          LABELS_EDIT: process.env?.SQS_GLOBAL_LABELS_EDIT === 'true',\n          LOGOUT_INSTANCE: process.env?.SQS_GLOBAL_LOGOUT_INSTANCE === 'true',\n          MESSAGES_DELETE: process.env?.SQS_GLOBAL_MESSAGES_DELETE === 'true',\n          MESSAGES_EDITED: process.env?.SQS_GLOBAL_MESSAGES_EDITED === 'true',\n          MESSAGES_SET: process.env?.SQS_GLOBAL_MESSAGES_SET === 'true',\n          MESSAGES_UPDATE: process.env?.SQS_GLOBAL_MESSAGES_UPDATE === 'true',\n          MESSAGES_UPSERT: process.env?.SQS_GLOBAL_MESSAGES_UPSERT === 'true',\n          PRESENCE_UPDATE: process.env?.SQS_GLOBAL_PRESENCE_UPDATE === 'true',\n          QRCODE_UPDATED: process.env?.SQS_GLOBAL_QRCODE_UPDATED === 'true',\n          REMOVE_INSTANCE: process.env?.SQS_GLOBAL_REMOVE_INSTANCE === 'true',\n          SEND_MESSAGE: process.env?.SQS_GLOBAL_SEND_MESSAGE === 'true',\n          TYPEBOT_CHANGE_STATUS: process.env?.SQS_GLOBAL_TYPEBOT_CHANGE_STATUS === 'true',\n          TYPEBOT_START: process.env?.SQS_GLOBAL_TYPEBOT_START === 'true',\n        },\n      },\n      KAFKA: {\n        ENABLED: process.env?.KAFKA_ENABLED === 'true',\n        CLIENT_ID: process.env?.KAFKA_CLIENT_ID || 'evolution-api',\n        BROKERS: process.env?.KAFKA_BROKERS?.split(',') || ['localhost:9092'],\n        CONNECTION_TIMEOUT: Number.parseInt(process.env?.KAFKA_CONNECTION_TIMEOUT || '3000'),\n        REQUEST_TIMEOUT: Number.parseInt(process.env?.KAFKA_REQUEST_TIMEOUT || '30000'),\n        GLOBAL_ENABLED: process.env?.KAFKA_GLOBAL_ENABLED === 'true',\n        CONSUMER_GROUP_ID: process.env?.KAFKA_CONSUMER_GROUP_ID || 'evolution-api-consumers',\n        TOPIC_PREFIX: process.env?.KAFKA_TOPIC_PREFIX || 'evolution',\n        NUM_PARTITIONS: Number.parseInt(process.env?.KAFKA_NUM_PARTITIONS || '1'),\n        REPLICATION_FACTOR: Number.parseInt(process.env?.KAFKA_REPLICATION_FACTOR || '1'),\n        AUTO_CREATE_TOPICS: process.env?.KAFKA_AUTO_CREATE_TOPICS === 'true',\n        EVENTS: {\n          APPLICATION_STARTUP: process.env?.KAFKA_EVENTS_APPLICATION_STARTUP === 'true',\n          INSTANCE_CREATE: process.env?.KAFKA_EVENTS_INSTANCE_CREATE === 'true',\n          INSTANCE_DELETE: process.env?.KAFKA_EVENTS_INSTANCE_DELETE === 'true',\n          QRCODE_UPDATED: process.env?.KAFKA_EVENTS_QRCODE_UPDATED === 'true',\n          MESSAGES_SET: process.env?.KAFKA_EVENTS_MESSAGES_SET === 'true',\n          MESSAGES_UPSERT: process.env?.KAFKA_EVENTS_MESSAGES_UPSERT === 'true',\n          MESSAGES_EDITED: process.env?.KAFKA_EVENTS_MESSAGES_EDITED === 'true',\n          MESSAGES_UPDATE: process.env?.KAFKA_EVENTS_MESSAGES_UPDATE === 'true',\n          MESSAGES_DELETE: process.env?.KAFKA_EVENTS_MESSAGES_DELETE === 'true',\n          SEND_MESSAGE: process.env?.KAFKA_EVENTS_SEND_MESSAGE === 'true',\n          SEND_MESSAGE_UPDATE: process.env?.KAFKA_EVENTS_SEND_MESSAGE_UPDATE === 'true',\n          CONTACTS_SET: process.env?.KAFKA_EVENTS_CONTACTS_SET === 'true',\n          CONTACTS_UPSERT: process.env?.KAFKA_EVENTS_CONTACTS_UPSERT === 'true',\n          CONTACTS_UPDATE: process.env?.KAFKA_EVENTS_CONTACTS_UPDATE === 'true',\n          PRESENCE_UPDATE: process.env?.KAFKA_EVENTS_PRESENCE_UPDATE === 'true',\n          CHATS_SET: process.env?.KAFKA_EVENTS_CHATS_SET === 'true',\n          CHATS_UPSERT: process.env?.KAFKA_EVENTS_CHATS_UPSERT === 'true',\n          CHATS_UPDATE: process.env?.KAFKA_EVENTS_CHATS_UPDATE === 'true',\n          CHATS_DELETE: process.env?.KAFKA_EVENTS_CHATS_DELETE === 'true',\n          CONNECTION_UPDATE: process.env?.KAFKA_EVENTS_CONNECTION_UPDATE === 'true',\n          LABELS_EDIT: process.env?.KAFKA_EVENTS_LABELS_EDIT === 'true',\n          LABELS_ASSOCIATION: process.env?.KAFKA_EVENTS_LABELS_ASSOCIATION === 'true',\n          GROUPS_UPSERT: process.env?.KAFKA_EVENTS_GROUPS_UPSERT === 'true',\n          GROUP_UPDATE: process.env?.KAFKA_EVENTS_GROUPS_UPDATE === 'true',\n          GROUP_PARTICIPANTS_UPDATE: process.env?.KAFKA_EVENTS_GROUP_PARTICIPANTS_UPDATE === 'true',\n          CALL: process.env?.KAFKA_EVENTS_CALL === 'true',\n          TYPEBOT_START: process.env?.KAFKA_EVENTS_TYPEBOT_START === 'true',\n          TYPEBOT_CHANGE_STATUS: process.env?.KAFKA_EVENTS_TYPEBOT_CHANGE_STATUS === 'true',\n        },\n        SASL:\n          process.env?.KAFKA_SASL_ENABLED === 'true'\n            ? {\n                ENABLED: true,\n                MECHANISM: process.env?.KAFKA_SASL_MECHANISM || 'plain',\n                USERNAME: process.env?.KAFKA_SASL_USERNAME || '',\n                PASSWORD: process.env?.KAFKA_SASL_PASSWORD || '',\n              }\n            : undefined,\n        SSL:\n          process.env?.KAFKA_SSL_ENABLED === 'true'\n            ? {\n                ENABLED: true,\n                REJECT_UNAUTHORIZED: process.env?.KAFKA_SSL_REJECT_UNAUTHORIZED !== 'false',\n                CA: process.env?.KAFKA_SSL_CA,\n                KEY: process.env?.KAFKA_SSL_KEY,\n                CERT: process.env?.KAFKA_SSL_CERT,\n              }\n            : undefined,\n      },\n      WEBSOCKET: {\n        ENABLED: process.env?.WEBSOCKET_ENABLED === 'true',\n        GLOBAL_EVENTS: process.env?.WEBSOCKET_GLOBAL_EVENTS === 'true',\n        ALLOWED_HOSTS: process.env?.WEBSOCKET_ALLOWED_HOSTS,\n      },\n      PUSHER: {\n        ENABLED: process.env?.PUSHER_ENABLED === 'true',\n        GLOBAL: {\n          ENABLED: process.env?.PUSHER_GLOBAL_ENABLED === 'true',\n          APP_ID: process.env?.PUSHER_GLOBAL_APP_ID || '',\n          KEY: process.env?.PUSHER_GLOBAL_KEY || '',\n          SECRET: process.env?.PUSHER_GLOBAL_SECRET || '',\n          CLUSTER: process.env?.PUSHER_GLOBAL_CLUSTER || '',\n          USE_TLS: process.env?.PUSHER_GLOBAL_USE_TLS === 'true',\n        },\n        EVENTS: {\n          APPLICATION_STARTUP: process.env?.PUSHER_EVENTS_APPLICATION_STARTUP === 'true',\n          INSTANCE_CREATE: process.env?.PUSHER_EVENTS_INSTANCE_CREATE === 'true',\n          INSTANCE_DELETE: process.env?.PUSHER_EVENTS_INSTANCE_DELETE === 'true',\n          QRCODE_UPDATED: process.env?.PUSHER_EVENTS_QRCODE_UPDATED === 'true',\n          MESSAGES_SET: process.env?.PUSHER_EVENTS_MESSAGES_SET === 'true',\n          MESSAGES_UPSERT: process.env?.PUSHER_EVENTS_MESSAGES_UPSERT === 'true',\n          MESSAGES_EDITED: process.env?.PUSHER_EVENTS_MESSAGES_EDITED === 'true',\n          MESSAGES_UPDATE: process.env?.PUSHER_EVENTS_MESSAGES_UPDATE === 'true',\n          MESSAGES_DELETE: process.env?.PUSHER_EVENTS_MESSAGES_DELETE === 'true',\n          SEND_MESSAGE: process.env?.PUSHER_EVENTS_SEND_MESSAGE === 'true',\n          SEND_MESSAGE_UPDATE: process.env?.PUSHER_EVENTS_SEND_MESSAGE_UPDATE === 'true',\n          CONTACTS_SET: process.env?.PUSHER_EVENTS_CONTACTS_SET === 'true',\n          CONTACTS_UPDATE: process.env?.PUSHER_EVENTS_CONTACTS_UPDATE === 'true',\n          CONTACTS_UPSERT: process.env?.PUSHER_EVENTS_CONTACTS_UPSERT === 'true',\n          PRESENCE_UPDATE: process.env?.PUSHER_EVENTS_PRESENCE_UPDATE === 'true',\n          CHATS_SET: process.env?.PUSHER_EVENTS_CHATS_SET === 'true',\n          CHATS_UPDATE: process.env?.PUSHER_EVENTS_CHATS_UPDATE === 'true',\n          CHATS_UPSERT: process.env?.PUSHER_EVENTS_CHATS_UPSERT === 'true',\n          CHATS_DELETE: process.env?.PUSHER_EVENTS_CHATS_DELETE === 'true',\n          CONNECTION_UPDATE: process.env?.PUSHER_EVENTS_CONNECTION_UPDATE === 'true',\n          LABELS_EDIT: process.env?.PUSHER_EVENTS_LABELS_EDIT === 'true',\n          LABELS_ASSOCIATION: process.env?.PUSHER_EVENTS_LABELS_ASSOCIATION === 'true',\n          GROUPS_UPSERT: process.env?.PUSHER_EVENTS_GROUPS_UPSERT === 'true',\n          GROUP_UPDATE: process.env?.PUSHER_EVENTS_GROUPS_UPDATE === 'true',\n          GROUP_PARTICIPANTS_UPDATE: process.env?.PUSHER_EVENTS_GROUP_PARTICIPANTS_UPDATE === 'true',\n          CALL: process.env?.PUSHER_EVENTS_CALL === 'true',\n          TYPEBOT_START: process.env?.PUSHER_EVENTS_TYPEBOT_START === 'true',\n          TYPEBOT_CHANGE_STATUS: process.env?.PUSHER_EVENTS_TYPEBOT_CHANGE_STATUS === 'true',\n        },\n      },\n      WA_BUSINESS: {\n        TOKEN_WEBHOOK: process.env.WA_BUSINESS_TOKEN_WEBHOOK || 'evolution',\n        URL: process.env.WA_BUSINESS_URL || 'https://graph.facebook.com',\n        VERSION: process.env.WA_BUSINESS_VERSION || 'v18.0',\n        LANGUAGE: process.env.WA_BUSINESS_LANGUAGE || 'en',\n      },\n      LOG: {\n        LEVEL:\n          (process.env?.LOG_LEVEL?.split(',') as LogLevel[]) ||\n          (['ERROR', 'WARN', 'DEBUG', 'INFO', 'LOG', 'VERBOSE', 'DARK', 'WEBHOOKS', 'WEBSOCKET'] as LogLevel[]),\n        COLOR: process.env?.LOG_COLOR === 'true',\n        BAILEYS: (process.env?.LOG_BAILEYS as LogBaileys) || 'error',\n      },\n      DEL_INSTANCE: isBooleanString(process.env?.DEL_INSTANCE)\n        ? process.env.DEL_INSTANCE === 'true'\n        : Number.parseInt(process.env.DEL_INSTANCE) || false,\n      DEL_TEMP_INSTANCES: isBooleanString(process.env?.DEL_TEMP_INSTANCES)\n        ? process.env.DEL_TEMP_INSTANCES === 'true'\n        : true,\n      LANGUAGE: process.env?.LANGUAGE || 'en',\n      WEBHOOK: {\n        GLOBAL: {\n          URL: process.env?.WEBHOOK_GLOBAL_URL || '',\n          ENABLED: process.env?.WEBHOOK_GLOBAL_ENABLED === 'true',\n          WEBHOOK_BY_EVENTS: process.env?.WEBHOOK_GLOBAL_WEBHOOK_BY_EVENTS === 'true',\n        },\n        EVENTS: {\n          APPLICATION_STARTUP: process.env?.WEBHOOK_EVENTS_APPLICATION_STARTUP === 'true',\n          INSTANCE_CREATE: process.env?.WEBHOOK_EVENTS_INSTANCE_CREATE === 'true',\n          INSTANCE_DELETE: process.env?.WEBHOOK_EVENTS_INSTANCE_DELETE === 'true',\n          QRCODE_UPDATED: process.env?.WEBHOOK_EVENTS_QRCODE_UPDATED === 'true',\n          MESSAGES_SET: process.env?.WEBHOOK_EVENTS_MESSAGES_SET === 'true',\n          MESSAGES_UPSERT: process.env?.WEBHOOK_EVENTS_MESSAGES_UPSERT === 'true',\n          MESSAGES_EDITED: process.env?.WEBHOOK_EVENTS_MESSAGES_EDITED === 'true',\n          MESSAGES_UPDATE: process.env?.WEBHOOK_EVENTS_MESSAGES_UPDATE === 'true',\n          MESSAGES_DELETE: process.env?.WEBHOOK_EVENTS_MESSAGES_DELETE === 'true',\n          SEND_MESSAGE: process.env?.WEBHOOK_EVENTS_SEND_MESSAGE === 'true',\n          SEND_MESSAGE_UPDATE: process.env?.WEBHOOK_EVENTS_SEND_MESSAGE_UPDATE === 'true',\n          CONTACTS_SET: process.env?.WEBHOOK_EVENTS_CONTACTS_SET === 'true',\n          CONTACTS_UPDATE: process.env?.WEBHOOK_EVENTS_CONTACTS_UPDATE === 'true',\n          CONTACTS_UPSERT: process.env?.WEBHOOK_EVENTS_CONTACTS_UPSERT === 'true',\n          PRESENCE_UPDATE: process.env?.WEBHOOK_EVENTS_PRESENCE_UPDATE === 'true',\n          CHATS_SET: process.env?.WEBHOOK_EVENTS_CHATS_SET === 'true',\n          CHATS_UPDATE: process.env?.WEBHOOK_EVENTS_CHATS_UPDATE === 'true',\n          CHATS_UPSERT: process.env?.WEBHOOK_EVENTS_CHATS_UPSERT === 'true',\n          CHATS_DELETE: process.env?.WEBHOOK_EVENTS_CHATS_DELETE === 'true',\n          CONNECTION_UPDATE: process.env?.WEBHOOK_EVENTS_CONNECTION_UPDATE === 'true',\n          LABELS_EDIT: process.env?.WEBHOOK_EVENTS_LABELS_EDIT === 'true',\n          LABELS_ASSOCIATION: process.env?.WEBHOOK_EVENTS_LABELS_ASSOCIATION === 'true',\n          GROUPS_UPSERT: process.env?.WEBHOOK_EVENTS_GROUPS_UPSERT === 'true',\n          GROUP_UPDATE: process.env?.WEBHOOK_EVENTS_GROUPS_UPDATE === 'true',\n          GROUP_PARTICIPANTS_UPDATE: process.env?.WEBHOOK_EVENTS_GROUP_PARTICIPANTS_UPDATE === 'true',\n          CALL: process.env?.WEBHOOK_EVENTS_CALL === 'true',\n          TYPEBOT_START: process.env?.WEBHOOK_EVENTS_TYPEBOT_START === 'true',\n          TYPEBOT_CHANGE_STATUS: process.env?.WEBHOOK_EVENTS_TYPEBOT_CHANGE_STATUS === 'true',\n          ERRORS: process.env?.WEBHOOK_EVENTS_ERRORS === 'true',\n          ERRORS_WEBHOOK: process.env?.WEBHOOK_EVENTS_ERRORS_WEBHOOK || '',\n        },\n        REQUEST: {\n          TIMEOUT_MS: Number.parseInt(process.env?.WEBHOOK_REQUEST_TIMEOUT_MS) || 30000,\n        },\n        RETRY: {\n          MAX_ATTEMPTS: Number.parseInt(process.env?.WEBHOOK_RETRY_MAX_ATTEMPTS) || 10,\n          INITIAL_DELAY_SECONDS: Number.parseInt(process.env?.WEBHOOK_RETRY_INITIAL_DELAY_SECONDS) || 5,\n          USE_EXPONENTIAL_BACKOFF: process.env?.WEBHOOK_RETRY_USE_EXPONENTIAL_BACKOFF !== 'false',\n          MAX_DELAY_SECONDS: Number.parseInt(process.env?.WEBHOOK_RETRY_MAX_DELAY_SECONDS) || 300,\n          JITTER_FACTOR: Number.parseFloat(process.env?.WEBHOOK_RETRY_JITTER_FACTOR) || 0.2,\n          NON_RETRYABLE_STATUS_CODES: process.env?.WEBHOOK_RETRY_NON_RETRYABLE_STATUS_CODES?.split(',').map(Number) || [\n            400, 401, 403, 404, 422,\n          ],\n        },\n      },\n      CONFIG_SESSION_PHONE: {\n        CLIENT: process.env?.CONFIG_SESSION_PHONE_CLIENT || 'Evolution API',\n        NAME: process.env?.CONFIG_SESSION_PHONE_NAME || 'Chrome',\n      },\n      QRCODE: {\n        LIMIT: Number.parseInt(process.env.QRCODE_LIMIT) || 30,\n        COLOR: process.env.QRCODE_COLOR || '#198754',\n      },\n      TYPEBOT: {\n        ENABLED: process.env?.TYPEBOT_ENABLED === 'true',\n        API_VERSION: process.env?.TYPEBOT_API_VERSION || 'old',\n        SEND_MEDIA_BASE64: process.env?.TYPEBOT_SEND_MEDIA_BASE64 === 'true',\n      },\n      CHATWOOT: {\n        ENABLED: process.env?.CHATWOOT_ENABLED === 'true',\n        MESSAGE_DELETE: process.env.CHATWOOT_MESSAGE_DELETE === 'true',\n        MESSAGE_READ: process.env.CHATWOOT_MESSAGE_READ === 'true',\n        BOT_CONTACT: !process.env.CHATWOOT_BOT_CONTACT || process.env.CHATWOOT_BOT_CONTACT === 'true',\n        IMPORT: {\n          DATABASE: {\n            CONNECTION: {\n              URI: process.env.CHATWOOT_IMPORT_DATABASE_CONNECTION_URI || '',\n            },\n          },\n          PLACEHOLDER_MEDIA_MESSAGE: process.env?.CHATWOOT_IMPORT_PLACEHOLDER_MEDIA_MESSAGE === 'true',\n        },\n      },\n      OPENAI: {\n        ENABLED: process.env?.OPENAI_ENABLED === 'true',\n        API_KEY_GLOBAL: process.env?.OPENAI_API_KEY_GLOBAL || null,\n      },\n      DIFY: {\n        ENABLED: process.env?.DIFY_ENABLED === 'true',\n      },\n      N8N: {\n        ENABLED: process.env?.N8N_ENABLED === 'true',\n      },\n      EVOAI: {\n        ENABLED: process.env?.EVOAI_ENABLED === 'true',\n      },\n      FLOWISE: {\n        ENABLED: process.env?.FLOWISE_ENABLED === 'true',\n      },\n      CACHE: {\n        REDIS: {\n          ENABLED: process.env?.CACHE_REDIS_ENABLED === 'true',\n          URI: process.env?.CACHE_REDIS_URI || '',\n          PREFIX_KEY: process.env?.CACHE_REDIS_PREFIX_KEY || 'evolution-cache',\n          TTL: Number.parseInt(process.env?.CACHE_REDIS_TTL) || 604800,\n          SAVE_INSTANCES: process.env?.CACHE_REDIS_SAVE_INSTANCES === 'true',\n        },\n        LOCAL: {\n          ENABLED: process.env?.CACHE_LOCAL_ENABLED === 'true',\n          TTL: Number.parseInt(process.env?.CACHE_REDIS_TTL) || 86400,\n        },\n      },\n      S3: {\n        ACCESS_KEY: process.env?.S3_ACCESS_KEY,\n        SECRET_KEY: process.env?.S3_SECRET_KEY,\n        ENDPOINT: process.env?.S3_ENDPOINT,\n        BUCKET_NAME: process.env?.S3_BUCKET,\n        ENABLE: process.env?.S3_ENABLED === 'true',\n        PORT: Number.parseInt(process.env?.S3_PORT || '9000'),\n        USE_SSL: process.env?.S3_USE_SSL === 'true',\n        REGION: process.env?.S3_REGION,\n        SKIP_POLICY: process.env?.S3_SKIP_POLICY === 'true',\n        SAVE_VIDEO: process.env?.S3_SAVE_VIDEO === 'true',\n      },\n      AUTHENTICATION: {\n        API_KEY: {\n          KEY: process.env.AUTHENTICATION_API_KEY || 'BQYHJGJHJ',\n        },\n        EXPOSE_IN_FETCH_INSTANCES: process.env?.AUTHENTICATION_EXPOSE_IN_FETCH_INSTANCES === 'true',\n      },\n      METRICS: {\n        ENABLED: process.env?.PROMETHEUS_METRICS === 'true',\n        AUTH_REQUIRED: process.env?.METRICS_AUTH_REQUIRED === 'true',\n        USER: process.env?.METRICS_USER,\n        PASSWORD: process.env?.METRICS_PASSWORD,\n        ALLOWED_IPS: process.env?.METRICS_ALLOWED_IPS,\n      },\n      TELEMETRY: {\n        ENABLED: process.env?.TELEMETRY_ENABLED === undefined || process.env?.TELEMETRY_ENABLED === 'true',\n        URL: process.env?.TELEMETRY_URL,\n      },\n      PROXY: {\n        HOST: process.env?.PROXY_HOST,\n        PORT: process.env?.PROXY_PORT,\n        PROTOCOL: process.env?.PROXY_PROTOCOL,\n        USERNAME: process.env?.PROXY_USERNAME,\n        PASSWORD: process.env?.PROXY_PASSWORD,\n      },\n      AUDIO_CONVERTER: {\n        API_URL: process.env?.API_AUDIO_CONVERTER,\n        API_KEY: process.env?.API_AUDIO_CONVERTER_KEY,\n      },\n      FACEBOOK: {\n        APP_ID: process.env?.FACEBOOK_APP_ID,\n        CONFIG_ID: process.env?.FACEBOOK_CONFIG_ID,\n        USER_TOKEN: process.env?.FACEBOOK_USER_TOKEN,\n      },\n      SENTRY: {\n        DSN: process.env?.SENTRY_DSN,\n      },\n      EVENT_EMITTER: {\n        MAX_LISTENERS: Number.parseInt(process.env?.EVENT_EMITTER_MAX_LISTENERS) || 50,\n      },\n    };\n  }\n}\n\nexport const configService = new ConfigService();\n","import { configService, Sentry as SentryConfig } from '@config/env.config';\r\nimport * as Sentry from '@sentry/node';\r\n\r\nconst sentryConfig = configService.get<SentryConfig>('SENTRY');\r\n\r\nif (sentryConfig.DSN) {\r\n  Sentry.init({\r\n    dsn: sentryConfig.DSN,\r\n    environment: process.env.NODE_ENV || 'development',\r\n    tracesSampleRate: 1.0,\r\n    profilesSampleRate: 1.0,\r\n  });\r\n}\r\n","import dayjs from 'dayjs';\nimport fs from 'fs';\n\nimport { configService, Log } from './env.config';\nconst packageJson = JSON.parse(fs.readFileSync('./package.json', 'utf8'));\n\nconst formatDateLog = (timestamp: number) =>\n  dayjs(timestamp)\n    .toDate()\n    .toString()\n    .replace(/\\sGMT.+/, '');\n\nenum Color {\n  LOG = '\\x1b[32m',\n  INFO = '\\x1b[34m',\n  WARN = '\\x1b[33m',\n  ERROR = '\\x1b[31m',\n  DEBUG = '\\x1b[36m',\n  VERBOSE = '\\x1b[37m',\n  DARK = '\\x1b[30m',\n}\n\nenum Command {\n  RESET = '\\x1b[0m',\n  BRIGHT = '\\x1b[1m',\n  UNDERSCORE = '\\x1b[4m',\n}\n\nenum Level {\n  LOG = Color.LOG + '%s' + Command.RESET,\n  DARK = Color.DARK + '%s' + Command.RESET,\n  INFO = Color.INFO + '%s' + Command.RESET,\n  WARN = Color.WARN + '%s' + Command.RESET,\n  ERROR = Color.ERROR + '%s' + Command.RESET,\n  DEBUG = Color.DEBUG + '%s' + Command.RESET,\n  VERBOSE = Color.VERBOSE + '%s' + Command.RESET,\n}\n\nenum Type {\n  LOG = 'LOG',\n  WARN = 'WARN',\n  INFO = 'INFO',\n  DARK = 'DARK',\n  ERROR = 'ERROR',\n  DEBUG = 'DEBUG',\n  VERBOSE = 'VERBOSE',\n}\n\nenum Background {\n  LOG = '\\x1b[42m',\n  INFO = '\\x1b[44m',\n  WARN = '\\x1b[43m',\n  DARK = '\\x1b[40m',\n  ERROR = '\\x1b[41m',\n  DEBUG = '\\x1b[46m',\n  VERBOSE = '\\x1b[47m',\n}\n\nexport class Logger {\n  private readonly configService = configService;\n  private context: string;\n\n  constructor(context = 'Logger') {\n    this.context = context;\n  }\n\n  private instance = null;\n\n  public setContext(value: string) {\n    this.context = value;\n  }\n\n  public setInstance(value: string) {\n    this.instance = value;\n  }\n\n  private console(value: any, type: Type) {\n    const types: Type[] = [];\n\n    this.configService.get<Log>('LOG').LEVEL.forEach((level) => types.push(Type[level]));\n\n    const typeValue = typeof value;\n    if (types.includes(type)) {\n      if (configService.get<Log>('LOG').COLOR) {\n        console.log(\n          /*Command.UNDERSCORE +*/ Command.BRIGHT + Level[type],\n          '[Evolution API]',\n          Command.BRIGHT + Color[type],\n          this.instance ? `[${this.instance}]` : '',\n          Command.BRIGHT + Color[type],\n          `v${packageJson.version}`,\n          Command.BRIGHT + Color[type],\n          process.pid.toString(),\n          Command.RESET,\n          Command.BRIGHT + Color[type],\n          '-',\n          Command.BRIGHT + Color.VERBOSE,\n          `${formatDateLog(Date.now())}  `,\n          Command.RESET,\n          Color[type] + Background[type] + Command.BRIGHT,\n          `${type} ` + Command.RESET,\n          Color.WARN + Command.BRIGHT,\n          `[${this.context}]` + Command.RESET,\n          Color[type] + Command.BRIGHT,\n          `[${typeValue}]` + Command.RESET,\n          Color[type],\n          typeValue !== 'object' ? value : '',\n          Command.RESET,\n        );\n        typeValue === 'object' ? console.log(/*Level.DARK,*/ value, '\\n') : '';\n      } else {\n        console.log(\n          '[Evolution API]',\n          this.instance ? `[${this.instance}]` : '',\n          process.pid.toString(),\n          '-',\n          `${formatDateLog(Date.now())}  `,\n          `${type} `,\n          `[${this.context}]`,\n          `[${typeValue}]`,\n          value,\n        );\n      }\n    }\n  }\n\n  public log(value: any) {\n    this.console(value, Type.LOG);\n  }\n\n  public info(value: any) {\n    this.console(value, Type.INFO);\n  }\n\n  public warn(value: any) {\n    this.console(value, Type.WARN);\n  }\n\n  public error(value: any) {\n    this.console(value, Type.ERROR);\n  }\n\n  public verbose(value: any) {\n    this.console(value, Type.VERBOSE);\n  }\n\n  public debug(value: any) {\n    this.console(value, Type.DEBUG);\n  }\n\n  public dark(value: any) {\n    this.console(value, Type.DARK);\n  }\n}\n","import { Auth, ConfigService, ProviderSession } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\nimport axios from 'axios';\nimport { execFileSync } from 'child_process';\n\ntype ResponseSuccess = { status: number; data?: any };\ntype ResponseProvider = Promise<[ResponseSuccess?, Error?]>;\n\nexport class ProviderFiles {\n  constructor(private readonly configService: ConfigService) {\n    this.baseUrl = `http://${this.config.HOST}:${this.config.PORT}/session/${this.config.PREFIX}`;\n    this.globalApiToken = this.configService.get<Auth>('AUTHENTICATION').API_KEY.KEY;\n  }\n\n  private readonly logger = new Logger('ProviderFiles');\n\n  private baseUrl: string;\n  private globalApiToken: string;\n\n  private readonly config = Object.freeze(this.configService.get<ProviderSession>('PROVIDER'));\n\n  get isEnabled() {\n    return !!this.config?.ENABLED;\n  }\n\n  public async onModuleInit() {\n    if (this.config.ENABLED) {\n      const url = `http://${this.config.HOST}:${this.config.PORT}`;\n      try {\n        const response = await axios.options(url + '/ping');\n        if (response?.data != 'pong') {\n          throw new Error('Offline file provider.');\n        }\n\n        await axios.post(`${url}/session`, { group: this.config.PREFIX }, { headers: { apikey: this.globalApiToken } });\n      } catch (error) {\n        this.logger.error(['Failed to connect to the file server', error?.message, error?.stack]);\n        const pid = process.pid;\n        execFileSync('kill', ['-9', `${pid}`]);\n      }\n    }\n  }\n\n  public async onModuleDestroy() {\n    //\n  }\n\n  public async create(instance: string): ResponseProvider {\n    try {\n      const response = await axios.post(\n        `${this.baseUrl}`,\n        {\n          instance,\n        },\n        { headers: { apikey: this.globalApiToken } },\n      );\n      return [{ status: response.status, data: response?.data }];\n    } catch (error) {\n      return [\n        {\n          status: error?.response?.status,\n          data: error?.response?.data,\n        },\n        error,\n      ];\n    }\n  }\n\n  public async write(instance: string, key: string, data: any): ResponseProvider {\n    try {\n      const response = await axios.post(`${this.baseUrl}/${instance}/${key}`, data, {\n        headers: { apikey: this.globalApiToken },\n      });\n      return [{ status: response.status, data: response?.data }];\n    } catch (error) {\n      return [\n        {\n          status: error?.response?.status,\n          data: error?.response?.data,\n        },\n        error,\n      ];\n    }\n  }\n\n  public async read(instance: string, key: string): ResponseProvider {\n    try {\n      const response = await axios.get(`${this.baseUrl}/${instance}/${key}`, {\n        headers: { apikey: this.globalApiToken },\n      });\n      return [{ status: response.status, data: response?.data }];\n    } catch (error) {\n      return [\n        {\n          status: error?.response?.status,\n          data: error?.response?.data,\n        },\n        error,\n      ];\n    }\n  }\n\n  public async delete(instance: string, key: string): ResponseProvider {\n    try {\n      const response = await axios.delete(`${this.baseUrl}/${instance}/${key}`, {\n        headers: { apikey: this.globalApiToken },\n      });\n      return [{ status: response.status, data: response?.data }];\n    } catch (error) {\n      return [\n        {\n          status: error?.response?.status,\n          data: error?.response?.data,\n        },\n        error,\n      ];\n    }\n  }\n\n  public async allInstances(): ResponseProvider {\n    try {\n      const response = await axios.get(`${this.baseUrl}/list-instances`, { headers: { apikey: this.globalApiToken } });\n      return [{ status: response.status, data: response?.data as string[] }];\n    } catch (error) {\n      return [\n        {\n          status: error?.response?.status,\n          data: error?.response?.data,\n        },\n        error,\n      ];\n    }\n  }\n\n  public async removeSession(instance: string): ResponseProvider {\n    try {\n      const response = await axios.delete(`${this.baseUrl}/${instance}`, { headers: { apikey: this.globalApiToken } });\n      return [{ status: response.status, data: response?.data }];\n    } catch (error) {\n      return [\n        {\n          status: error?.response?.status,\n          data: error?.response?.data,\n        },\n        error,\n      ];\n    }\n  }\n}\n","import { ConfigService } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\nimport { PrismaClient } from '@prisma/client';\n\nexport class Query<T> {\n  where?: T;\n  sort?: 'asc' | 'desc';\n  page?: number;\n  offset?: number;\n}\n\nexport class PrismaRepository extends PrismaClient {\n  constructor(private readonly configService: ConfigService) {\n    super();\n  }\n\n  private readonly logger = new Logger('PrismaRepository');\n\n  public async onModuleInit() {\n    await this.$connect();\n    this.logger.info('Repository:Prisma - ON');\n  }\n\n  public async onModuleDestroy() {\n    await this.$disconnect();\n    this.logger.warn('Repository:Prisma - OFF');\n  }\n}\n","import { ICache } from '@api/abstract/abstract.cache';\nimport { CacheConf, CacheConfLocal, ConfigService } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\nimport { BufferJSON } from 'baileys';\nimport NodeCache from 'node-cache';\n\nexport class LocalCache implements ICache {\n  private readonly logger = new Logger('LocalCache');\n  private conf: CacheConfLocal;\n  static localCache = new NodeCache();\n\n  constructor(\n    private readonly configService: ConfigService,\n    private readonly module: string,\n  ) {\n    this.conf = this.configService.get<CacheConf>('CACHE')?.LOCAL;\n  }\n\n  async get(key: string): Promise<any> {\n    return LocalCache.localCache.get(this.buildKey(key));\n  }\n\n  async set(key: string, value: any, ttl?: number) {\n    return LocalCache.localCache.set(this.buildKey(key), value, ttl || this.conf.TTL);\n  }\n\n  async has(key: string) {\n    return LocalCache.localCache.has(this.buildKey(key));\n  }\n\n  async delete(key: string) {\n    return LocalCache.localCache.del(this.buildKey(key));\n  }\n\n  async deleteAll(appendCriteria?: string) {\n    const keys = await this.keys(appendCriteria);\n    if (!keys?.length) {\n      return 0;\n    }\n\n    return LocalCache.localCache.del(keys);\n  }\n\n  async keys(appendCriteria?: string) {\n    const filter = `${this.buildKey('')}${appendCriteria ? `${appendCriteria}:` : ''}`;\n\n    return LocalCache.localCache.keys().filter((key) => key.substring(0, filter.length) === filter);\n  }\n\n  buildKey(key: string) {\n    return `${this.module}:${key}`;\n  }\n\n  async hGet(key: string, field: string) {\n    try {\n      const data = LocalCache.localCache.get(this.buildKey(key)) as object;\n\n      if (data && field in data) {\n        return JSON.parse(data[field], BufferJSON.reviver);\n      }\n\n      return null;\n    } catch (error) {\n      this.logger.error(error);\n    }\n  }\n\n  async hSet(key: string, field: string, value: any) {\n    try {\n      const json = JSON.stringify(value, BufferJSON.replacer);\n\n      let hash = LocalCache.localCache.get(this.buildKey(key));\n\n      if (!hash) {\n        hash = {};\n      }\n\n      hash[field] = json;\n      LocalCache.localCache.set(this.buildKey(key), hash);\n    } catch (error) {\n      this.logger.error(error);\n    }\n  }\n\n  async hDelete(key: string, field: string) {\n    try {\n      const data = LocalCache.localCache.get(this.buildKey(key)) as object;\n\n      if (data && field in data) {\n        delete data[field];\n        LocalCache.localCache.set(this.buildKey(key), data);\n        return 1;\n      }\n\n      return 0;\n    } catch (error) {\n      this.logger.error(error);\n    }\n  }\n}\n","import { CacheConf, CacheConfRedis, configService } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\nimport { createClient, RedisClientType } from 'redis';\n\nclass Redis {\n  private logger = new Logger('Redis');\n  private client: RedisClientType = null;\n  private conf: CacheConfRedis;\n  private connected = false;\n\n  constructor() {\n    this.conf = configService.get<CacheConf>('CACHE')?.REDIS;\n  }\n\n  getConnection(): RedisClientType {\n    if (this.connected) {\n      return this.client;\n    } else {\n      this.client = createClient({\n        url: this.conf.URI,\n      });\n\n      this.client.on('connect', () => {\n        this.logger.verbose('redis connecting');\n      });\n\n      this.client.on('ready', () => {\n        this.logger.verbose('redis ready');\n        this.connected = true;\n      });\n\n      this.client.on('error', () => {\n        this.logger.error('redis disconnected');\n        this.connected = false;\n      });\n\n      this.client.on('end', () => {\n        this.logger.verbose('redis connection ended');\n        this.connected = false;\n      });\n\n      try {\n        this.client.connect();\n        this.connected = true;\n      } catch (e) {\n        this.connected = false;\n        this.logger.error('redis connect exception caught: ' + e);\n        return null;\n      }\n\n      return this.client;\n    }\n  }\n}\n\nexport const redisClient = new Redis();\n","import { ICache } from '@api/abstract/abstract.cache';\nimport { CacheConf, CacheConfRedis, ConfigService } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\nimport { BufferJSON } from 'baileys';\nimport { RedisClientType } from 'redis';\n\nimport { redisClient } from './rediscache.client';\n\nexport class RedisCache implements ICache {\n  private readonly logger = new Logger('RedisCache');\n  private client: RedisClientType;\n  private conf: CacheConfRedis;\n\n  constructor(\n    private readonly configService: ConfigService,\n    private readonly module: string,\n  ) {\n    this.conf = this.configService.get<CacheConf>('CACHE')?.REDIS;\n    this.client = redisClient.getConnection();\n  }\n  async get(key: string): Promise<any> {\n    try {\n      return JSON.parse(await this.client.get(this.buildKey(key)));\n    } catch (error) {\n      this.logger.error(error);\n    }\n  }\n\n  async hGet(key: string, field: string) {\n    try {\n      const data = await this.client.hGet(this.buildKey(key), field);\n\n      if (data) {\n        return JSON.parse(data, BufferJSON.reviver);\n      }\n\n      return null;\n    } catch (error) {\n      this.logger.error(error);\n    }\n  }\n\n  async set(key: string, value: any, ttl?: number) {\n    try {\n      await this.client.setEx(this.buildKey(key), ttl || this.conf?.TTL, JSON.stringify(value));\n    } catch (error) {\n      this.logger.error(error);\n    }\n  }\n\n  async hSet(key: string, field: string, value: any) {\n    try {\n      const json = JSON.stringify(value, BufferJSON.replacer);\n\n      await this.client.hSet(this.buildKey(key), field, json);\n    } catch (error) {\n      this.logger.error(error);\n    }\n  }\n\n  async has(key: string) {\n    try {\n      return (await this.client.exists(this.buildKey(key))) > 0;\n    } catch (error) {\n      this.logger.error(error);\n    }\n  }\n\n  async delete(key: string) {\n    try {\n      return await this.client.del(this.buildKey(key));\n    } catch (error) {\n      this.logger.error(error);\n    }\n  }\n\n  async hDelete(key: string, field: string) {\n    try {\n      return await this.client.hDel(this.buildKey(key), field);\n    } catch (error) {\n      this.logger.error(error);\n    }\n  }\n\n  async deleteAll(appendCriteria?: string) {\n    try {\n      const keys = await this.keys(appendCriteria);\n      if (!keys?.length) {\n        return 0;\n      }\n\n      return await this.client.del(keys);\n    } catch (error) {\n      this.logger.error(error);\n    }\n  }\n\n  async keys(appendCriteria?: string) {\n    try {\n      const match = `${this.buildKey('')}${appendCriteria ? `${appendCriteria}:` : ''}*`;\n      const keys = [];\n      for await (const key of this.client.scanIterator({\n        MATCH: match,\n        COUNT: 100,\n      })) {\n        keys.push(key);\n      }\n\n      return [...new Set(keys)];\n    } catch (error) {\n      this.logger.error(error);\n    }\n  }\n\n  buildKey(key: string) {\n    return `${this.conf?.PREFIX_KEY}:${this.module}:${key}`;\n  }\n}\n","import { ICache } from '@api/abstract/abstract.cache';\nimport { CacheConf, ConfigService } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\n\nimport { LocalCache } from './localcache';\nimport { RedisCache } from './rediscache';\n\nconst logger = new Logger('CacheEngine');\n\nexport class CacheEngine {\n  private engine: ICache;\n\n  constructor(\n    private readonly configService: ConfigService,\n    module: string,\n  ) {\n    const cacheConf = configService.get<CacheConf>('CACHE');\n\n    if (cacheConf?.REDIS?.ENABLED && cacheConf?.REDIS?.URI !== '') {\n      logger.verbose(`RedisCache initialized for ${module}`);\n      this.engine = new RedisCache(configService, module);\n    } else if (cacheConf?.LOCAL?.ENABLED) {\n      logger.verbose(`LocalCache initialized for ${module}`);\n      this.engine = new LocalCache(configService, module);\n    }\n  }\n\n  public getEngine() {\n    return this.engine;\n  }\n}\n","import { configService, EventEmitter as EventEmitterConfig } from '@config/env.config';\nimport EventEmitter2 from 'eventemitter2';\n\nconst eventEmitterConfig = configService.get<EventEmitterConfig>('EVENT_EMITTER');\n\nexport const eventEmitter = new EventEmitter2({\n  delimiter: '.',\n  newListener: false,\n  ignoreErrors: false,\n  maxListeners: eventEmitterConfig.MAX_LISTENERS,\n});\n","import { getCatalogDto, getCollectionsDto } from '@api/dto/business.dto';\nimport { InstanceDto } from '@api/dto/instance.dto';\nimport { WAMonitoringService } from '@api/services/monitor.service';\n\nexport class BusinessController {\n  constructor(private readonly waMonitor: WAMonitoringService) {}\n\n  public async fetchCatalog({ instanceName }: InstanceDto, data: getCatalogDto) {\n    return await this.waMonitor.waInstances[instanceName].fetchCatalog(instanceName, data);\n  }\n\n  public async fetchCollections({ instanceName }: InstanceDto, data: getCollectionsDto) {\n    return await this.waMonitor.waInstances[instanceName].fetchCollections(instanceName, data);\n  }\n}\n","import { OfferCallDto } from '@api/dto/call.dto';\nimport { InstanceDto } from '@api/dto/instance.dto';\nimport { WAMonitoringService } from '@api/services/monitor.service';\n\nexport class CallController {\n  constructor(private readonly waMonitor: WAMonitoringService) {}\n\n  public async offerCall({ instanceName }: InstanceDto, data: OfferCallDto) {\n    return await this.waMonitor.waInstances[instanceName].offerCall(data);\n  }\n}\n","import {\n  ArchiveChatDto,\n  BlockUserDto,\n  DeleteMessage,\n  getBase64FromMediaMessageDto,\n  MarkChatUnreadDto,\n  NumberDto,\n  PrivacySettingDto,\n  ProfileNameDto,\n  ProfilePictureDto,\n  ProfileStatusDto,\n  ReadMessageDto,\n  SendPresenceDto,\n  UpdateMessageDto,\n  WhatsAppNumberDto,\n} from '@api/dto/chat.dto';\nimport { InstanceDto } from '@api/dto/instance.dto';\nimport { Query } from '@api/repository/repository.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { Contact, Message, MessageUpdate } from '@prisma/client';\n\nexport class ChatController {\n  constructor(private readonly waMonitor: WAMonitoringService) {}\n\n  public async whatsappNumber({ instanceName }: InstanceDto, data: WhatsAppNumberDto) {\n    return await this.waMonitor.waInstances[instanceName].whatsappNumber(data);\n  }\n\n  public async readMessage({ instanceName }: InstanceDto, data: ReadMessageDto) {\n    return await this.waMonitor.waInstances[instanceName].markMessageAsRead(data);\n  }\n\n  public async archiveChat({ instanceName }: InstanceDto, data: ArchiveChatDto) {\n    return await this.waMonitor.waInstances[instanceName].archiveChat(data);\n  }\n\n  public async markChatUnread({ instanceName }: InstanceDto, data: MarkChatUnreadDto) {\n    return await this.waMonitor.waInstances[instanceName].markChatUnread(data);\n  }\n\n  public async deleteMessage({ instanceName }: InstanceDto, data: DeleteMessage) {\n    return await this.waMonitor.waInstances[instanceName].deleteMessage(data);\n  }\n\n  public async fetchProfilePicture({ instanceName }: InstanceDto, data: NumberDto) {\n    return await this.waMonitor.waInstances[instanceName].profilePicture(data.number);\n  }\n\n  public async fetchProfile({ instanceName }: InstanceDto, data: NumberDto) {\n    return await this.waMonitor.waInstances[instanceName].fetchProfile(instanceName, data.number);\n  }\n\n  public async fetchContacts({ instanceName }: InstanceDto, query: Query<Contact>) {\n    return await this.waMonitor.waInstances[instanceName].fetchContacts(query);\n  }\n\n  public async getBase64FromMediaMessage({ instanceName }: InstanceDto, data: getBase64FromMediaMessageDto) {\n    return await this.waMonitor.waInstances[instanceName].getBase64FromMediaMessage(data);\n  }\n\n  public async fetchMessages({ instanceName }: InstanceDto, query: Query<Message>) {\n    return await this.waMonitor.waInstances[instanceName].fetchMessages(query);\n  }\n\n  public async fetchStatusMessage({ instanceName }: InstanceDto, query: Query<MessageUpdate>) {\n    return await this.waMonitor.waInstances[instanceName].fetchStatusMessage(query);\n  }\n\n  public async fetchChats({ instanceName }: InstanceDto, query: Query<Contact>) {\n    return await this.waMonitor.waInstances[instanceName].fetchChats(query);\n  }\n\n  public async findChatByRemoteJid({ instanceName }: InstanceDto, remoteJid: string) {\n    return await this.waMonitor.waInstances[instanceName].findChatByRemoteJid(remoteJid);\n  }\n\n  public async sendPresence({ instanceName }: InstanceDto, data: SendPresenceDto) {\n    return await this.waMonitor.waInstances[instanceName].sendPresence(data);\n  }\n\n  public async fetchPrivacySettings({ instanceName }: InstanceDto) {\n    return await this.waMonitor.waInstances[instanceName].fetchPrivacySettings();\n  }\n\n  public async updatePrivacySettings({ instanceName }: InstanceDto, data: PrivacySettingDto) {\n    return await this.waMonitor.waInstances[instanceName].updatePrivacySettings(data);\n  }\n\n  public async fetchBusinessProfile({ instanceName }: InstanceDto, data: ProfilePictureDto) {\n    return await this.waMonitor.waInstances[instanceName].fetchBusinessProfile(data.number);\n  }\n\n  public async updateProfileName({ instanceName }: InstanceDto, data: ProfileNameDto) {\n    return await this.waMonitor.waInstances[instanceName].updateProfileName(data.name);\n  }\n\n  public async updateProfileStatus({ instanceName }: InstanceDto, data: ProfileStatusDto) {\n    return await this.waMonitor.waInstances[instanceName].updateProfileStatus(data.status);\n  }\n\n  public async updateProfilePicture({ instanceName }: InstanceDto, data: ProfilePictureDto) {\n    return await this.waMonitor.waInstances[instanceName].updateProfilePicture(data.picture);\n  }\n\n  public async removeProfilePicture({ instanceName }: InstanceDto) {\n    return await this.waMonitor.waInstances[instanceName].removeProfilePicture();\n  }\n\n  public async updateMessage({ instanceName }: InstanceDto, data: UpdateMessageDto) {\n    return await this.waMonitor.waInstances[instanceName].updateMessage(data);\n  }\n\n  public async blockUser({ instanceName }: InstanceDto, data: BlockUserDto) {\n    return await this.waMonitor.waInstances[instanceName].blockUser(data);\n  }\n}\n","import {\n  AcceptGroupInvite,\n  CreateGroupDto,\n  GetParticipant,\n  GroupDescriptionDto,\n  GroupInvite,\n  GroupJid,\n  GroupPictureDto,\n  GroupSendInvite,\n  GroupSubjectDto,\n  GroupToggleEphemeralDto,\n  GroupUpdateParticipantDto,\n  GroupUpdateSettingDto,\n} from '@api/dto/group.dto';\nimport { InstanceDto } from '@api/dto/instance.dto';\nimport { WAMonitoringService } from '@api/services/monitor.service';\n\nexport class GroupController {\n  constructor(private readonly waMonitor: WAMonitoringService) {}\n\n  public async createGroup(instance: InstanceDto, create: CreateGroupDto) {\n    return await this.waMonitor.waInstances[instance.instanceName].createGroup(create);\n  }\n\n  public async updateGroupPicture(instance: InstanceDto, update: GroupPictureDto) {\n    return await this.waMonitor.waInstances[instance.instanceName].updateGroupPicture(update);\n  }\n\n  public async updateGroupSubject(instance: InstanceDto, update: GroupSubjectDto) {\n    return await this.waMonitor.waInstances[instance.instanceName].updateGroupSubject(update);\n  }\n\n  public async updateGroupDescription(instance: InstanceDto, update: GroupDescriptionDto) {\n    return await this.waMonitor.waInstances[instance.instanceName].updateGroupDescription(update);\n  }\n\n  public async findGroupInfo(instance: InstanceDto, groupJid: GroupJid) {\n    return await this.waMonitor.waInstances[instance.instanceName].findGroup(groupJid);\n  }\n\n  public async fetchAllGroups(instance: InstanceDto, getPaticipants: GetParticipant) {\n    return await this.waMonitor.waInstances[instance.instanceName].fetchAllGroups(getPaticipants);\n  }\n\n  public async inviteCode(instance: InstanceDto, groupJid: GroupJid) {\n    return await this.waMonitor.waInstances[instance.instanceName].inviteCode(groupJid);\n  }\n\n  public async inviteInfo(instance: InstanceDto, inviteCode: GroupInvite) {\n    return await this.waMonitor.waInstances[instance.instanceName].inviteInfo(inviteCode);\n  }\n\n  public async sendInvite(instance: InstanceDto, data: GroupSendInvite) {\n    return await this.waMonitor.waInstances[instance.instanceName].sendInvite(data);\n  }\n\n  public async acceptInviteCode(instance: InstanceDto, inviteCode: AcceptGroupInvite) {\n    return await this.waMonitor.waInstances[instance.instanceName].acceptInviteCode(inviteCode);\n  }\n\n  public async revokeInviteCode(instance: InstanceDto, groupJid: GroupJid) {\n    return await this.waMonitor.waInstances[instance.instanceName].revokeInviteCode(groupJid);\n  }\n\n  public async findParticipants(instance: InstanceDto, groupJid: GroupJid) {\n    return await this.waMonitor.waInstances[instance.instanceName].findParticipants(groupJid);\n  }\n\n  public async updateGParticipate(instance: InstanceDto, update: GroupUpdateParticipantDto) {\n    return await this.waMonitor.waInstances[instance.instanceName].updateGParticipant(update);\n  }\n\n  public async updateGSetting(instance: InstanceDto, update: GroupUpdateSettingDto) {\n    return await this.waMonitor.waInstances[instance.instanceName].updateGSetting(update);\n  }\n\n  public async toggleEphemeral(instance: InstanceDto, update: GroupToggleEphemeralDto) {\n    return await this.waMonitor.waInstances[instance.instanceName].toggleEphemeral(update);\n  }\n\n  public async leaveGroup(instance: InstanceDto, groupJid: GroupJid) {\n    return await this.waMonitor.waInstances[instance.instanceName].leaveGroup(groupJid);\n  }\n}\n","/* eslint-disable @typescript-eslint/no-namespace */\nimport { JsonValue } from '@prisma/client/runtime/library';\nimport { AuthenticationState, WAConnectionState } from 'baileys';\n\nexport enum Events {\n  APPLICATION_STARTUP = 'application.startup',\n  INSTANCE_CREATE = 'instance.create',\n  INSTANCE_DELETE = 'instance.delete',\n  QRCODE_UPDATED = 'qrcode.updated',\n  CONNECTION_UPDATE = 'connection.update',\n  STATUS_INSTANCE = 'status.instance',\n  MESSAGES_SET = 'messages.set',\n  MESSAGES_UPSERT = 'messages.upsert',\n  MESSAGES_EDITED = 'messages.edited',\n  MESSAGES_UPDATE = 'messages.update',\n  MESSAGES_DELETE = 'messages.delete',\n  SEND_MESSAGE = 'send.message',\n  SEND_MESSAGE_UPDATE = 'send.message.update',\n  CONTACTS_SET = 'contacts.set',\n  CONTACTS_UPSERT = 'contacts.upsert',\n  CONTACTS_UPDATE = 'contacts.update',\n  PRESENCE_UPDATE = 'presence.update',\n  CHATS_SET = 'chats.set',\n  CHATS_UPDATE = 'chats.update',\n  CHATS_UPSERT = 'chats.upsert',\n  CHATS_DELETE = 'chats.delete',\n  GROUPS_UPSERT = 'groups.upsert',\n  GROUPS_UPDATE = 'groups.update',\n  GROUP_PARTICIPANTS_UPDATE = 'group-participants.update',\n  CALL = 'call',\n  TYPEBOT_START = 'typebot.start',\n  TYPEBOT_CHANGE_STATUS = 'typebot.change-status',\n  LABELS_EDIT = 'labels.edit',\n  LABELS_ASSOCIATION = 'labels.association',\n  CREDS_UPDATE = 'creds.update',\n  MESSAGING_HISTORY_SET = 'messaging-history.set',\n  REMOVE_INSTANCE = 'remove.instance',\n  LOGOUT_INSTANCE = 'logout.instance',\n}\n\nexport declare namespace wa {\n  export type QrCode = {\n    count?: number;\n    pairingCode?: string;\n    base64?: string;\n    code?: string;\n  };\n\n  export type Instance = {\n    id?: string;\n    qrcode?: QrCode;\n    pairingCode?: string;\n    authState?: { state: AuthenticationState; saveCreds: () => void };\n    name?: string;\n    ownerJid?: string;\n    wuid?: string;\n    profileName?: string;\n    profilePictureUrl?: string;\n    token?: string;\n    number?: string;\n    integration?: string;\n    businessId?: string;\n  };\n\n  export type LocalChatwoot = {\n    enabled?: boolean;\n    accountId?: string;\n    token?: string;\n    url?: string;\n    nameInbox?: string;\n    signMsg?: boolean;\n    signDelimiter?: string;\n    number?: string;\n    reopenConversation?: boolean;\n    conversationPending?: boolean;\n    mergeBrazilContacts?: boolean;\n    importContacts?: boolean;\n    importMessages?: boolean;\n    daysLimitImportMessages?: number;\n  };\n\n  export type LocalSettings = {\n    rejectCall?: boolean;\n    msgCall?: string;\n    groupsIgnore?: boolean;\n    alwaysOnline?: boolean;\n    readMessages?: boolean;\n    readStatus?: boolean;\n    syncFullHistory?: boolean;\n    wavoipToken?: string;\n  };\n\n  export type LocalEvent = {\n    enabled?: boolean;\n    events?: JsonValue;\n  };\n\n  export type LocalWebHook = LocalEvent & {\n    url?: string;\n    headers?: JsonValue;\n    webhookByEvents?: boolean;\n    webhookBase64?: boolean;\n  };\n\n  export type LocalPusher = LocalEvent & {\n    appId?: string;\n    key?: string;\n    secret?: string;\n    cluster?: string;\n    useTLS?: boolean;\n  };\n\n  type Session = {\n    remoteJid?: string;\n    sessionId?: string;\n    createdAt?: number;\n  };\n\n  export type LocalProxy = {\n    enabled?: boolean;\n    host?: string;\n    port?: string;\n    protocol?: string;\n    username?: string;\n    password?: string;\n  };\n\n  export type StateConnection = {\n    instance?: string;\n    state?: WAConnectionState | 'refused';\n    statusReason?: number;\n  };\n\n  export type StatusMessage = 'ERROR' | 'PENDING' | 'SERVER_ACK' | 'DELIVERY_ACK' | 'READ' | 'DELETED' | 'PLAYED';\n}\n\nexport const TypeMediaMessage = [\n  'imageMessage',\n  'documentMessage',\n  'audioMessage',\n  'videoMessage',\n  'stickerMessage',\n  'ptvMessage',\n];\n\nexport const MessageSubtype = [\n  'ephemeralMessage',\n  'documentWithCaptionMessage',\n  'viewOnceMessage',\n  'viewOnceMessageV2',\n];\n\nexport const Integration = {\n  WHATSAPP_BUSINESS: 'WHATSAPP-BUSINESS',\n  WHATSAPP_BAILEYS: 'WHATSAPP-BAILEYS',\n  EVOLUTION: 'EVOLUTION',\n};\n","import { HttpStatus } from '@api/routes/index.router';\n\nexport class BadRequestException {\n  constructor(...objectError: any[]) {\n    throw {\n      status: HttpStatus.BAD_REQUEST,\n      error: 'Bad Request',\n      message: objectError.length > 0 ? objectError : undefined,\n    };\n  }\n}\n","import { HttpStatus } from '@api/routes/index.router';\n\nexport class UnauthorizedException {\n  constructor(...objectError: any[]) {\n    throw {\n      status: HttpStatus.UNAUTHORIZED,\n      error: 'Unauthorized',\n      message: objectError.length > 0 ? objectError : 'Unauthorized',\n    };\n  }\n}\n","import { HttpStatus } from '@api/routes/index.router';\n\nexport class ForbiddenException {\n  constructor(...objectError: any[]) {\n    throw {\n      status: HttpStatus.FORBIDDEN,\n      error: 'Forbidden',\n      message: objectError.length > 0 ? objectError : undefined,\n    };\n  }\n}\n","import { HttpStatus } from '@api/routes/index.router';\n\nexport class NotFoundException {\n  constructor(...objectError: any[]) {\n    throw {\n      status: HttpStatus.NOT_FOUND,\n      error: 'Not Found',\n      message: objectError.length > 0 ? objectError : undefined,\n    };\n  }\n}\n","import { HttpStatus } from '@api/routes/index.router';\n\nexport class InternalServerErrorException {\n  constructor(...objectError: any[]) {\n    throw {\n      status: HttpStatus.INTERNAL_SERVER_ERROR,\n      error: 'Internal Server Error',\n      message: objectError.length > 0 ? objectError : undefined,\n    };\n  }\n}\n","export * from './400.exception';\nexport * from './401.exception';\nexport * from './403.exception';\nexport * from './404.exception';\nexport * from './500.exception';\n","import { InstanceDto, SetPresenceDto } from '@api/dto/instance.dto';\nimport { ChatwootService } from '@api/integrations/chatbot/chatwoot/services/chatwoot.service';\nimport { ProviderFiles } from '@api/provider/sessions';\nimport { PrismaRepository } from '@api/repository/repository.service';\nimport { channelController, eventManager } from '@api/server.module';\nimport { CacheService } from '@api/services/cache.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { SettingsService } from '@api/services/settings.service';\nimport { Events, Integration, wa } from '@api/types/wa.types';\nimport { Auth, Chatwoot, ConfigService, HttpServer, WaBusiness } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\nimport { BadRequestException, InternalServerErrorException, UnauthorizedException } from '@exceptions';\nimport { delay } from 'baileys';\nimport { isArray, isURL } from 'class-validator';\nimport EventEmitter2 from 'eventemitter2';\nimport { v4 } from 'uuid';\n\nimport { ProxyController } from './proxy.controller';\n\nexport class InstanceController {\n  constructor(\n    private readonly waMonitor: WAMonitoringService,\n    private readonly configService: ConfigService,\n    private readonly prismaRepository: PrismaRepository,\n    private readonly eventEmitter: EventEmitter2,\n    private readonly chatwootService: ChatwootService,\n    private readonly settingsService: SettingsService,\n    private readonly proxyService: ProxyController,\n    private readonly cache: CacheService,\n    private readonly chatwootCache: CacheService,\n    private readonly baileysCache: CacheService,\n    private readonly providerFiles: ProviderFiles,\n  ) {}\n\n  private readonly logger = new Logger('InstanceController');\n\n  public async createInstance(instanceData: InstanceDto) {\n    try {\n      const instance = channelController.init(instanceData, {\n        configService: this.configService,\n        eventEmitter: this.eventEmitter,\n        prismaRepository: this.prismaRepository,\n        cache: this.cache,\n        chatwootCache: this.chatwootCache,\n        baileysCache: this.baileysCache,\n        providerFiles: this.providerFiles,\n      });\n\n      if (!instance) {\n        throw new BadRequestException('Invalid integration');\n      }\n\n      const instanceId = v4();\n\n      instanceData.instanceId = instanceId;\n\n      let hash: string;\n\n      if (!instanceData.token) hash = v4().toUpperCase();\n      else hash = instanceData.token;\n\n      await this.waMonitor.saveInstance({\n        instanceId,\n        integration: instanceData.integration,\n        instanceName: instanceData.instanceName,\n        ownerJid: instanceData.ownerJid,\n        profileName: instanceData.profileName,\n        profilePicUrl: instanceData.profilePicUrl,\n        hash,\n        number: instanceData.number,\n        businessId: instanceData.businessId,\n        status: instanceData.status,\n      });\n\n      instance.setInstance({\n        instanceName: instanceData.instanceName,\n        instanceId,\n        integration: instanceData.integration,\n        token: hash,\n        number: instanceData.number,\n        businessId: instanceData.businessId,\n      });\n\n      this.waMonitor.waInstances[instance.instanceName] = instance;\n      this.waMonitor.delInstanceTime(instance.instanceName);\n\n      // set events\n      await eventManager.setInstance(instance.instanceName, instanceData);\n\n      instance.sendDataWebhook(Events.INSTANCE_CREATE, {\n        instanceName: instanceData.instanceName,\n        instanceId: instanceId,\n      });\n\n      const instanceDto: InstanceDto = {\n        instanceName: instance.instanceName,\n        instanceId: instance.instanceId,\n        connectionStatus:\n          typeof instance.connectionStatus === 'string'\n            ? instance.connectionStatus\n            : instance.connectionStatus?.state || 'unknown',\n      };\n\n      if (instanceData.proxyHost && instanceData.proxyPort && instanceData.proxyProtocol) {\n        const testProxy = await this.proxyService.testProxy({\n          host: instanceData.proxyHost,\n          port: instanceData.proxyPort,\n          protocol: instanceData.proxyProtocol,\n          username: instanceData.proxyUsername,\n          password: instanceData.proxyPassword,\n        });\n        if (!testProxy) {\n          throw new BadRequestException('Invalid proxy');\n        }\n        await this.proxyService.createProxy(instanceDto, {\n          enabled: true,\n          host: instanceData.proxyHost,\n          port: instanceData.proxyPort,\n          protocol: instanceData.proxyProtocol,\n          username: instanceData.proxyUsername,\n          password: instanceData.proxyPassword,\n        });\n      }\n\n      const settings: wa.LocalSettings = {\n        rejectCall: instanceData.rejectCall === true,\n        msgCall: instanceData.msgCall || '',\n        groupsIgnore: instanceData.groupsIgnore === true,\n        alwaysOnline: instanceData.alwaysOnline === true,\n        readMessages: instanceData.readMessages === true,\n        readStatus: instanceData.readStatus === true,\n        syncFullHistory: instanceData.syncFullHistory === true,\n        wavoipToken: instanceData.wavoipToken || '',\n      };\n\n      await this.settingsService.create(instanceDto, settings);\n\n      let webhookWaBusiness = null,\n        accessTokenWaBusiness = '';\n\n      if (instanceData.integration === Integration.WHATSAPP_BUSINESS) {\n        if (!instanceData.number) {\n          throw new BadRequestException('number is required');\n        }\n        const urlServer = this.configService.get<HttpServer>('SERVER').URL;\n        webhookWaBusiness = `${urlServer}/webhook/meta`;\n        accessTokenWaBusiness = this.configService.get<WaBusiness>('WA_BUSINESS').TOKEN_WEBHOOK;\n      }\n\n      if (!instanceData.chatwootAccountId || !instanceData.chatwootToken || !instanceData.chatwootUrl) {\n        let getQrcode: wa.QrCode;\n\n        if (instanceData.qrcode && instanceData.integration === Integration.WHATSAPP_BAILEYS) {\n          await instance.connectToWhatsapp(instanceData.number);\n          await delay(5000);\n          getQrcode = instance.qrCode;\n        }\n\n        const result = {\n          instance: {\n            instanceName: instance.instanceName,\n            instanceId: instanceId,\n            integration: instanceData.integration,\n            webhookWaBusiness,\n            accessTokenWaBusiness,\n            status:\n              typeof instance.connectionStatus === 'string'\n                ? instance.connectionStatus\n                : instance.connectionStatus?.state || 'unknown',\n          },\n          hash,\n          webhook: {\n            webhookUrl: instanceData?.webhook?.url,\n            webhookHeaders: instanceData?.webhook?.headers,\n            webhookByEvents: instanceData?.webhook?.byEvents,\n            webhookBase64: instanceData?.webhook?.base64,\n          },\n          websocket: {\n            enabled: instanceData?.websocket?.enabled,\n          },\n          rabbitmq: {\n            enabled: instanceData?.rabbitmq?.enabled,\n          },\n          nats: {\n            enabled: instanceData?.nats?.enabled,\n          },\n          sqs: {\n            enabled: instanceData?.sqs?.enabled,\n          },\n          settings,\n          qrcode: getQrcode,\n        };\n\n        return result;\n      }\n\n      if (!this.configService.get<Chatwoot>('CHATWOOT').ENABLED)\n        throw new BadRequestException('Chatwoot is not enabled');\n\n      if (!instanceData.chatwootAccountId) {\n        throw new BadRequestException('accountId is required');\n      }\n\n      if (!instanceData.chatwootToken) {\n        throw new BadRequestException('token is required');\n      }\n\n      if (!instanceData.chatwootUrl) {\n        throw new BadRequestException('url is required');\n      }\n\n      if (!isURL(instanceData.chatwootUrl, { require_tld: false })) {\n        throw new BadRequestException('Invalid \"url\" property in chatwoot');\n      }\n\n      if (instanceData.chatwootSignMsg !== true && instanceData.chatwootSignMsg !== false) {\n        throw new BadRequestException('signMsg is required');\n      }\n\n      if (instanceData.chatwootReopenConversation !== true && instanceData.chatwootReopenConversation !== false) {\n        throw new BadRequestException('reopenConversation is required');\n      }\n\n      if (instanceData.chatwootConversationPending !== true && instanceData.chatwootConversationPending !== false) {\n        throw new BadRequestException('conversationPending is required');\n      }\n\n      const urlServer = this.configService.get<HttpServer>('SERVER').URL;\n\n      try {\n        this.chatwootService.create(instanceDto, {\n          enabled: true,\n          accountId: instanceData.chatwootAccountId,\n          token: instanceData.chatwootToken,\n          url: instanceData.chatwootUrl,\n          signMsg: instanceData.chatwootSignMsg || false,\n          nameInbox: instanceData.chatwootNameInbox ?? instance.instanceName.split('-cwId-')[0],\n          number: instanceData.number,\n          reopenConversation: instanceData.chatwootReopenConversation || false,\n          conversationPending: instanceData.chatwootConversationPending || false,\n          importContacts: instanceData.chatwootImportContacts ?? true,\n          mergeBrazilContacts: instanceData.chatwootMergeBrazilContacts ?? false,\n          importMessages: instanceData.chatwootImportMessages ?? true,\n          daysLimitImportMessages: instanceData.chatwootDaysLimitImportMessages ?? 60,\n          organization: instanceData.chatwootOrganization,\n          logo: instanceData.chatwootLogo,\n          autoCreate: instanceData.chatwootAutoCreate !== false,\n        });\n      } catch (error) {\n        this.logger.log(error);\n      }\n\n      return {\n        instance: {\n          instanceName: instance.instanceName,\n          instanceId: instanceId,\n          integration: instanceData.integration,\n          webhookWaBusiness,\n          accessTokenWaBusiness,\n          status:\n            typeof instance.connectionStatus === 'string'\n              ? instance.connectionStatus\n              : instance.connectionStatus?.state || 'unknown',\n        },\n        hash,\n        webhook: {\n          webhookUrl: instanceData?.webhook?.url,\n          webhookHeaders: instanceData?.webhook?.headers,\n          webhookByEvents: instanceData?.webhook?.byEvents,\n          webhookBase64: instanceData?.webhook?.base64,\n        },\n        websocket: {\n          enabled: instanceData?.websocket?.enabled,\n        },\n        rabbitmq: {\n          enabled: instanceData?.rabbitmq?.enabled,\n        },\n        nats: {\n          enabled: instanceData?.nats?.enabled,\n        },\n        sqs: {\n          enabled: instanceData?.sqs?.enabled,\n        },\n        settings,\n        chatwoot: {\n          enabled: true,\n          accountId: instanceData.chatwootAccountId,\n          token: instanceData.chatwootToken,\n          url: instanceData.chatwootUrl,\n          signMsg: instanceData.chatwootSignMsg || false,\n          reopenConversation: instanceData.chatwootReopenConversation || false,\n          conversationPending: instanceData.chatwootConversationPending || false,\n          mergeBrazilContacts: instanceData.chatwootMergeBrazilContacts ?? false,\n          importContacts: instanceData.chatwootImportContacts ?? true,\n          importMessages: instanceData.chatwootImportMessages ?? true,\n          daysLimitImportMessages: instanceData.chatwootDaysLimitImportMessages || 60,\n          number: instanceData.number,\n          nameInbox: instanceData.chatwootNameInbox ?? instance.instanceName,\n          webhookUrl: `${urlServer}/chatwoot/webhook/${encodeURIComponent(instance.instanceName)}`,\n        },\n      };\n    } catch (error) {\n      this.waMonitor.deleteInstance(instanceData.instanceName);\n      this.logger.error(isArray(error.message) ? error.message[0] : error.message);\n      throw new BadRequestException(isArray(error.message) ? error.message[0] : error.message);\n    }\n  }\n\n  public async connectToWhatsapp({ instanceName, number = null }: InstanceDto) {\n    try {\n      const instance = this.waMonitor.waInstances[instanceName];\n      const state = instance?.connectionStatus?.state;\n\n      if (!state) {\n        throw new BadRequestException('The \"' + instanceName + '\" instance does not exist');\n      }\n\n      if (state == 'open') {\n        return await this.connectionState({ instanceName });\n      }\n\n      if (state == 'connecting') {\n        return instance.qrCode;\n      }\n\n      if (state == 'close') {\n        await instance.connectToWhatsapp(number);\n\n        await delay(2000);\n        return instance.qrCode;\n      }\n\n      return {\n        instance: {\n          instanceName: instanceName,\n          status: state,\n        },\n        qrcode: instance?.qrCode,\n      };\n    } catch (error) {\n      this.logger.error(error);\n      return { error: true, message: error.toString() };\n    }\n  }\n\n  public async restartInstance({ instanceName }: InstanceDto) {\n    try {\n      const instance = this.waMonitor.waInstances[instanceName];\n      const state = instance?.connectionStatus?.state;\n\n      if (!state) {\n        throw new BadRequestException('The \"' + instanceName + '\" instance does not exist');\n      }\n\n      if (state === 'close') {\n        throw new BadRequestException('The \"' + instanceName + '\" instance is not connected');\n      }\n      this.logger.info(`Restarting instance: ${instanceName}`);\n\n      if (typeof instance.restart === 'function') {\n        await instance.restart();\n        // Wait a bit for the reconnection to be established\n        await new Promise((r) => setTimeout(r, 2000));\n        return {\n          instance: {\n            instanceName: instanceName,\n            status: instance.connectionStatus?.state || 'connecting',\n          },\n        };\n      }\n\n      // Fallback for Baileys (uses different mechanism)\n      if (state === 'open' || state === 'connecting') {\n        if (this.configService.get<Chatwoot>('CHATWOOT').ENABLED) instance.clearCacheChatwoot();\n\n        instance.client?.ws?.close();\n        instance.client?.end(new Error('restart'));\n        return await this.connectToWhatsapp({ instanceName });\n      }\n\n      return {\n        instance: {\n          instanceName: instanceName,\n          status: state,\n        },\n      };\n    } catch (error) {\n      this.logger.error(error);\n      return { error: true, message: error.toString() };\n    }\n  }\n\n  public async connectionState({ instanceName }: InstanceDto) {\n    return {\n      instance: {\n        instanceName: instanceName,\n        state: this.waMonitor.waInstances[instanceName]?.connectionStatus?.state,\n      },\n    };\n  }\n\n  public async fetchInstances({ instanceName, instanceId, number }: InstanceDto, key: string) {\n    const env = this.configService.get<Auth>('AUTHENTICATION').API_KEY;\n\n    if (env.KEY !== key) {\n      const instancesByKey = await this.prismaRepository.instance.findMany({\n        where: {\n          token: key,\n          name: instanceName || undefined,\n          id: instanceId || undefined,\n        },\n      });\n\n      if (instancesByKey.length > 0) {\n        const names = instancesByKey.map((instance) => instance.name);\n\n        return this.waMonitor.instanceInfo(names);\n      } else {\n        throw new UnauthorizedException();\n      }\n    }\n\n    if (instanceId || number) {\n      return this.waMonitor.instanceInfoById(instanceId, number);\n    }\n\n    const instanceNames = instanceName ? [instanceName] : null;\n\n    return this.waMonitor.instanceInfo(instanceNames);\n  }\n\n  public async setPresence({ instanceName }: InstanceDto, data: SetPresenceDto) {\n    return await this.waMonitor.waInstances[instanceName].setPresence(data);\n  }\n\n  public async logout({ instanceName }: InstanceDto) {\n    const { instance } = await this.connectionState({ instanceName });\n\n    if (instance.state === 'close') {\n      throw new BadRequestException('The \"' + instanceName + '\" instance is not connected');\n    }\n\n    try {\n      await this.waMonitor.waInstances[instanceName]?.logoutInstance();\n\n      return { status: 'SUCCESS', error: false, response: { message: 'Instance logged out' } };\n    } catch (error) {\n      throw new InternalServerErrorException(error.toString());\n    }\n  }\n\n  public async deleteInstance({ instanceName }: InstanceDto) {\n    const { instance } = await this.connectionState({ instanceName });\n    try {\n      const waInstances = this.waMonitor.waInstances[instanceName];\n      if (this.configService.get<Chatwoot>('CHATWOOT').ENABLED) waInstances?.clearCacheChatwoot();\n\n      if (instance.state === 'connecting' || instance.state === 'open') {\n        await this.logout({ instanceName });\n      }\n\n      try {\n        waInstances?.sendDataWebhook(Events.INSTANCE_DELETE, {\n          instanceName,\n          instanceId: waInstances.instanceId,\n        });\n      } catch (error) {\n        this.logger.error(error);\n      }\n\n      this.eventEmitter.emit('remove.instance', instanceName, 'inner');\n      return { status: 'SUCCESS', error: false, response: { message: 'Instance deleted' } };\n    } catch (error) {\n      throw new BadRequestException(error.toString());\n    }\n  }\n}\n","import { InstanceDto } from '@api/dto/instance.dto';\nimport { HandleLabelDto } from '@api/dto/label.dto';\nimport { WAMonitoringService } from '@api/services/monitor.service';\n\nexport class LabelController {\n  constructor(private readonly waMonitor: WAMonitoringService) {}\n\n  public async fetchLabels({ instanceName }: InstanceDto) {\n    return await this.waMonitor.waInstances[instanceName].fetchLabels();\n  }\n\n  public async handleLabel({ instanceName }: InstanceDto, data: HandleLabelDto) {\n    return await this.waMonitor.waInstances[instanceName].handleLabel(data);\n  }\n}\n","import { socksDispatcher } from 'fetch-socks';\nimport { HttpsProxyAgent } from 'https-proxy-agent';\nimport { SocksProxyAgent } from 'socks-proxy-agent';\nimport { ProxyAgent } from 'undici';\n\ntype Proxy = {\n  host: string;\n  password?: string;\n  port: string;\n  protocol: string;\n  username?: string;\n};\n\nfunction selectProxyAgent(proxyUrl: string): HttpsProxyAgent<string> | SocksProxyAgent {\n  const url = new URL(proxyUrl);\n\n  // NOTE: The following constants are not used in the function but are defined for clarity.\n  // When a proxy URL is used to build the URL object, the protocol returned by procotol's property contains a `:` at\n  // the end so, we add the protocol constants without the `:` to avoid confusion.\n  const PROXY_HTTP_PROTOCOL = 'http:';\n  const PROXY_SOCKS_PROTOCOL = 'socks:';\n  const PROXY_SOCKS5_PROTOCOL = 'socks5:';\n\n  switch (url.protocol) {\n    case PROXY_HTTP_PROTOCOL:\n      return new HttpsProxyAgent(url);\n    case PROXY_SOCKS_PROTOCOL:\n    case PROXY_SOCKS5_PROTOCOL: {\n      let urlSocks = '';\n\n      if (url.username && url.password) {\n        urlSocks = `socks://${url.username}:${url.password}@${url.hostname}:${url.port}`;\n      } else {\n        urlSocks = `socks://${url.hostname}:${url.port}`;\n      }\n\n      return new SocksProxyAgent(urlSocks);\n    }\n    default:\n      throw new Error(`Unsupported proxy protocol: ${url.protocol}`);\n  }\n}\n\nexport function makeProxyAgent(proxy: Proxy | string): HttpsProxyAgent<string> | SocksProxyAgent {\n  if (typeof proxy === 'string') {\n    return selectProxyAgent(proxy);\n  }\n\n  const { host, password, port, protocol, username } = proxy;\n  let proxyUrl = `${protocol}://${host}:${port}`;\n\n  if (username && password) {\n    proxyUrl = `${protocol}://${username}:${password}@${host}:${port}`;\n  }\n\n  return selectProxyAgent(proxyUrl);\n}\n\nexport function makeProxyAgentUndici(proxy: Proxy | string): ProxyAgent {\n  let proxyUrl: string;\n  let protocol: string;\n\n  if (typeof proxy === 'string') {\n    const url = new URL(proxy);\n    protocol = url.protocol.replace(':', '');\n    proxyUrl = proxy;\n  } else {\n    const { host, password, port, protocol: proto, username } = proxy;\n    protocol = (proto || 'http').replace(':', '');\n\n    if (protocol === 'socks') {\n      protocol = 'socks5';\n    }\n\n    const auth = username && password ? `${username}:${password}@` : '';\n    proxyUrl = `${protocol}://${auth}${host}:${port}`;\n  }\n\n  protocol = protocol.toLowerCase();\n\n  const PROXY_HTTP_PROTOCOL = 'http';\n  const PROXY_HTTPS_PROTOCOL = 'https';\n  const PROXY_SOCKS4_PROTOCOL = 'socks4';\n  const PROXY_SOCKS5_PROTOCOL = 'socks5';\n\n  switch (protocol) {\n    case PROXY_HTTP_PROTOCOL:\n    case PROXY_HTTPS_PROTOCOL:\n      return new ProxyAgent(proxyUrl);\n\n    case PROXY_SOCKS4_PROTOCOL:\n    case PROXY_SOCKS5_PROTOCOL: {\n      let type: 4 | 5 = 5;\n\n      if (PROXY_SOCKS4_PROTOCOL === protocol) type = 4;\n\n      const url = new URL(proxyUrl);\n\n      return socksDispatcher({\n        type: type,\n        host: url.hostname,\n        port: Number(url.port),\n        userId: url.username || undefined,\n        password: url.password || undefined,\n      });\n    }\n\n    default:\n      throw new Error(`Unsupported proxy protocol: ${protocol}`);\n  }\n}\n","import { InstanceDto } from '@api/dto/instance.dto';\nimport { ProxyDto } from '@api/dto/proxy.dto';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { ProxyService } from '@api/services/proxy.service';\nimport { Logger } from '@config/logger.config';\nimport { BadRequestException, NotFoundException } from '@exceptions';\nimport { makeProxyAgent } from '@utils/makeProxyAgent';\nimport axios from 'axios';\n\nconst logger = new Logger('ProxyController');\n\nexport class ProxyController {\n  constructor(\n    private readonly proxyService: ProxyService,\n    private readonly waMonitor: WAMonitoringService,\n  ) {}\n\n  public async createProxy(instance: InstanceDto, data: ProxyDto) {\n    if (!this.waMonitor.waInstances[instance.instanceName]) {\n      throw new NotFoundException(`The \"${instance.instanceName}\" instance does not exist`);\n    }\n\n    if (!data?.enabled) {\n      data.host = '';\n      data.port = '';\n      data.protocol = '';\n      data.username = '';\n      data.password = '';\n    }\n\n    if (data.host) {\n      const testProxy = await this.testProxy(data);\n      if (!testProxy) {\n        throw new BadRequestException('Invalid proxy');\n      }\n    }\n\n    return this.proxyService.create(instance, data);\n  }\n\n  public async findProxy(instance: InstanceDto) {\n    if (!this.waMonitor.waInstances[instance.instanceName]) {\n      throw new NotFoundException(`The \"${instance.instanceName}\" instance does not exist`);\n    }\n\n    return this.proxyService.find(instance);\n  }\n\n  public async testProxy(proxy: ProxyDto) {\n    try {\n      const serverIp = await axios.get('https://icanhazip.com/');\n      const response = await axios.get('https://icanhazip.com/', {\n        httpsAgent: makeProxyAgent(proxy),\n      });\n\n      const result = response?.data !== serverIp?.data;\n      if (result) {\n        logger.info('testProxy: proxy connection successful');\n      } else {\n        logger.warn(\"testProxy: proxy connection doesn't change the origin IP\");\n      }\n\n      return result;\n    } catch (error) {\n      if (axios.isAxiosError(error)) {\n        logger.error('testProxy error: axios error: ' + error.message);\n      } else {\n        logger.error('testProxy error: unexpected error: ' + error);\n      }\n\n      return false;\n    }\n  }\n}\n","import { InstanceDto } from '@api/dto/instance.dto';\nimport {\n  SendAudioDto,\n  SendButtonsDto,\n  SendContactDto,\n  SendListDto,\n  SendLocationDto,\n  SendMediaDto,\n  SendPollDto,\n  SendPtvDto,\n  SendReactionDto,\n  SendStatusDto,\n  SendStickerDto,\n  SendTemplateDto,\n  SendTextDto,\n} from '@api/dto/sendMessage.dto';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { BadRequestException } from '@exceptions';\nimport { isBase64, isURL } from 'class-validator';\nimport emojiRegex from 'emoji-regex';\n\nconst regex = emojiRegex();\n\nfunction isEmoji(str: string) {\n  if (str === '') return true;\n\n  const match = str.match(regex);\n  return match?.length === 1 && match[0] === str;\n}\n\nexport class SendMessageController {\n  constructor(private readonly waMonitor: WAMonitoringService) {}\n\n  public async sendTemplate({ instanceName }: InstanceDto, data: SendTemplateDto) {\n    return await this.waMonitor.waInstances[instanceName].templateMessage(data);\n  }\n\n  public async sendText({ instanceName }: InstanceDto, data: SendTextDto) {\n    return await this.waMonitor.waInstances[instanceName].textMessage(data);\n  }\n\n  public async sendMedia({ instanceName }: InstanceDto, data: SendMediaDto, file?: any) {\n    if (isBase64(data?.media) && !data?.fileName && data?.mediatype === 'document') {\n      throw new BadRequestException('For base64 the file name must be informed.');\n    }\n\n    if (file || isURL(data?.media) || isBase64(data?.media)) {\n      return await this.waMonitor.waInstances[instanceName].mediaMessage(data, file);\n    }\n    throw new BadRequestException('Owned media must be a url or base64');\n  }\n\n  public async sendPtv({ instanceName }: InstanceDto, data: SendPtvDto, file?: any) {\n    if (file || isURL(data?.video) || isBase64(data?.video)) {\n      return await this.waMonitor.waInstances[instanceName].ptvMessage(data, file);\n    }\n    throw new BadRequestException('Owned media must be a url or base64');\n  }\n\n  public async sendSticker({ instanceName }: InstanceDto, data: SendStickerDto, file?: any) {\n    if (file || isURL(data.sticker) || isBase64(data.sticker)) {\n      return await this.waMonitor.waInstances[instanceName].mediaSticker(data, file);\n    }\n    throw new BadRequestException('Owned media must be a url or base64');\n  }\n\n  public async sendWhatsAppAudio({ instanceName }: InstanceDto, data: SendAudioDto, file?: any) {\n    if (file?.buffer || isURL(data.audio) || isBase64(data.audio)) {\n      // Si file existe y tiene buffer, o si es una URL o Base64, contina\n      return await this.waMonitor.waInstances[instanceName].audioWhatsapp(data, file);\n    } else {\n      console.error('El archivo no tiene buffer o el audio no es una URL o Base64 vlida');\n      throw new BadRequestException('Owned media must be a url, base64, or valid file with buffer');\n    }\n  }\n\n  public async sendButtons({ instanceName }: InstanceDto, data: SendButtonsDto) {\n    return await this.waMonitor.waInstances[instanceName].buttonMessage(data);\n  }\n\n  public async sendLocation({ instanceName }: InstanceDto, data: SendLocationDto) {\n    return await this.waMonitor.waInstances[instanceName].locationMessage(data);\n  }\n\n  public async sendList({ instanceName }: InstanceDto, data: SendListDto) {\n    return await this.waMonitor.waInstances[instanceName].listMessage(data);\n  }\n\n  public async sendContact({ instanceName }: InstanceDto, data: SendContactDto) {\n    return await this.waMonitor.waInstances[instanceName].contactMessage(data);\n  }\n\n  public async sendReaction({ instanceName }: InstanceDto, data: SendReactionDto) {\n    if (!isEmoji(data.reaction)) {\n      throw new BadRequestException('Reaction must be a single emoji or empty string');\n    }\n    return await this.waMonitor.waInstances[instanceName].reactionMessage(data);\n  }\n\n  public async sendPoll({ instanceName }: InstanceDto, data: SendPollDto) {\n    return await this.waMonitor.waInstances[instanceName].pollMessage(data);\n  }\n\n  public async sendStatus({ instanceName }: InstanceDto, data: SendStatusDto, file?: any) {\n    return await this.waMonitor.waInstances[instanceName].statusMessage(data, file);\n  }\n}\n","import { InstanceDto } from '@api/dto/instance.dto';\nimport { SettingsDto } from '@api/dto/settings.dto';\nimport { SettingsService } from '@api/services/settings.service';\n\nexport class SettingsController {\n  constructor(private readonly settingsService: SettingsService) {}\n\n  public async createSettings(instance: InstanceDto, data: SettingsDto) {\n    return this.settingsService.create(instance, data);\n  }\n\n  public async findSettings(instance: InstanceDto) {\n    const settings = this.settingsService.find(instance);\n    return settings;\n  }\n}\n","import { InstanceDto } from '@api/dto/instance.dto';\nimport { TemplateDto } from '@api/dto/template.dto';\nimport { TemplateService } from '@api/services/template.service';\n\nexport class TemplateController {\n  constructor(private readonly templateService: TemplateService) {}\n\n  public async createTemplate(instance: InstanceDto, data: TemplateDto) {\n    return this.templateService.create(instance, data);\n  }\n\n  public async findTemplate(instance: InstanceDto) {\n    return this.templateService.find(instance);\n  }\n\n  public async editTemplate(\n    instance: InstanceDto,\n    data: { templateId: string; category?: string; components?: any; allowCategoryChange?: boolean; ttl?: number },\n  ) {\n    return this.templateService.edit(instance, data);\n  }\n\n  public async deleteTemplate(instance: InstanceDto, data: { name: string; hsmId?: string }) {\n    return this.templateService.delete(instance, data);\n  }\n}\n","import { ConfigService, S3 } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\nimport { BadRequestException } from '@exceptions';\nimport * as MinIo from 'minio';\nimport { join } from 'path';\nimport { Readable, Transform } from 'stream';\n\nconst logger = new Logger('S3 Service');\n\nconst BUCKET = new ConfigService().get<S3>('S3');\n\ninterface Metadata extends MinIo.ItemBucketMetadata {\n  'Content-Type': string;\n}\n\nconst minioClient = (() => {\n  if (BUCKET?.ENABLE) {\n    return new MinIo.Client({\n      endPoint: BUCKET.ENDPOINT,\n      port: BUCKET.PORT,\n      useSSL: BUCKET.USE_SSL,\n      accessKey: BUCKET.ACCESS_KEY,\n      secretKey: BUCKET.SECRET_KEY,\n      region: BUCKET.REGION,\n    });\n  }\n})();\n\nconst bucketName = BUCKET.BUCKET_NAME;\n\nconst bucketExists = async () => {\n  if (minioClient) {\n    try {\n      const list = await minioClient.listBuckets();\n      return list.find((bucket) => bucket.name === bucketName);\n    } catch {\n      return false;\n    }\n  }\n};\n\nconst setBucketPolicy = async () => {\n  if (minioClient) {\n    const policy = {\n      Version: '2012-10-17',\n      Statement: [\n        {\n          Effect: 'Allow',\n          Principal: '*',\n          Action: ['s3:GetObject'],\n          Resource: [`arn:aws:s3:::${bucketName}/*`],\n        },\n      ],\n    };\n    await minioClient.setBucketPolicy(bucketName, JSON.stringify(policy));\n  }\n};\n\nconst createBucket = async () => {\n  if (minioClient) {\n    try {\n      const exists = await bucketExists();\n      if (!exists) {\n        await minioClient.makeBucket(bucketName);\n      }\n      if (!BUCKET.SKIP_POLICY) {\n        await setBucketPolicy();\n      }\n      logger.info(`S3 Bucket ${bucketName} - ON`);\n      return true;\n    } catch (error) {\n      logger.error('S3 ERROR:');\n      logger.error(error);\n      return false;\n    }\n  }\n};\n\ncreateBucket();\n\nconst uploadFile = async (fileName: string, file: Buffer | Transform | Readable, size: number, metadata: Metadata) => {\n  if (minioClient) {\n    const objectName = join('evolution-api', fileName);\n    try {\n      metadata['custom-header-application'] = 'evolution-api';\n      return await minioClient.putObject(bucketName, objectName, file, size, metadata);\n    } catch (error) {\n      logger.error(error);\n      return error;\n    }\n  }\n};\n\nconst getObjectUrl = async (fileName: string, expiry?: number) => {\n  if (minioClient) {\n    try {\n      const objectName = join('evolution-api', fileName);\n      if (expiry) {\n        return await minioClient.presignedGetObject(bucketName, objectName, expiry);\n      }\n      return await minioClient.presignedGetObject(bucketName, objectName);\n    } catch (error) {\n      throw new BadRequestException(error?.message);\n    }\n  }\n};\n\nconst uploadTempFile = async (\n  folder: string,\n  fileName: string,\n  file: Buffer | Transform | Readable,\n  size: number,\n  metadata: Metadata,\n) => {\n  if (minioClient) {\n    const objectName = join(folder, fileName);\n    try {\n      metadata['custom-header-application'] = 'evolution-api';\n      return await minioClient.putObject(bucketName, objectName, file, size, metadata);\n    } catch (error) {\n      logger.error(error);\n      return error;\n    }\n  }\n};\n\nconst deleteFile = async (folder: string, fileName: string) => {\n  if (minioClient) {\n    const objectName = join(folder, fileName);\n    try {\n      return await minioClient.removeObject(bucketName, objectName);\n    } catch (error) {\n      logger.error(error);\n      return error;\n    }\n  }\n};\n\nexport { BUCKET, deleteFile, getObjectUrl, uploadFile, uploadTempFile };\n","import { Chatwoot, configService } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\nimport postgresql from 'pg';\n\nconst { Pool } = postgresql;\n\nclass Postgres {\n  private logger = new Logger('Postgres');\n  private pool;\n  private connected = false;\n\n  getConnection(connectionString: string) {\n    if (this.connected) {\n      return this.pool;\n    } else {\n      this.pool = new Pool({\n        connectionString,\n        ssl: {\n          rejectUnauthorized: false,\n        },\n      });\n\n      this.pool.on('error', () => {\n        this.logger.error('postgres disconnected');\n        this.connected = false;\n      });\n\n      try {\n        this.connected = true;\n      } catch (e) {\n        this.connected = false;\n        this.logger.error('postgres connect exception caught: ' + e);\n        return null;\n      }\n\n      return this.pool;\n    }\n  }\n\n  getChatwootConnection() {\n    const uri = configService.get<Chatwoot>('CHATWOOT').IMPORT.DATABASE.CONNECTION.URI;\n\n    return this.getConnection(uri);\n  }\n}\n\nexport const postgresClient = new Postgres();\n","import { InstanceDto } from '@api/dto/instance.dto';\nimport { ChatwootDto } from '@api/integrations/chatbot/chatwoot/dto/chatwoot.dto';\nimport { postgresClient } from '@api/integrations/chatbot/chatwoot/libs/postgres.client';\nimport { ChatwootService } from '@api/integrations/chatbot/chatwoot/services/chatwoot.service';\nimport { Chatwoot, configService } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\nimport { inbox } from '@figuro/chatwoot-sdk';\nimport { Chatwoot as ChatwootModel, Contact, Message } from '@prisma/client';\nimport { proto } from 'baileys';\n\ntype ChatwootUser = {\n  user_type: string;\n  user_id: number;\n};\n\ntype FksChatwoot = {\n  phone_number: string;\n  contact_id: string;\n  conversation_id: string;\n};\n\ntype firstLastTimestamp = {\n  first: number;\n  last: number;\n};\n\ntype IWebMessageInfo = Omit<proto.IWebMessageInfo, 'key'> & Partial<Pick<proto.IWebMessageInfo, 'key'>>;\n\nclass ChatwootImport {\n  private logger = new Logger('ChatwootImport');\n  private repositoryMessagesCache = new Map<string, Set<string>>();\n  private historyMessages = new Map<string, Message[]>();\n  private historyContacts = new Map<string, Contact[]>();\n\n  public getRepositoryMessagesCache(instance: InstanceDto) {\n    return this.repositoryMessagesCache.has(instance.instanceName)\n      ? this.repositoryMessagesCache.get(instance.instanceName)\n      : null;\n  }\n\n  public setRepositoryMessagesCache(instance: InstanceDto, repositoryMessagesCache: Set<string>) {\n    this.repositoryMessagesCache.set(instance.instanceName, repositoryMessagesCache);\n  }\n\n  public deleteRepositoryMessagesCache(instance: InstanceDto) {\n    this.repositoryMessagesCache.delete(instance.instanceName);\n  }\n\n  public addHistoryMessages(instance: InstanceDto, messagesRaw: Message[]) {\n    const actualValue = this.historyMessages.has(instance.instanceName)\n      ? this.historyMessages.get(instance.instanceName)\n      : [];\n    this.historyMessages.set(instance.instanceName, [...actualValue, ...messagesRaw]);\n  }\n\n  public addHistoryContacts(instance: InstanceDto, contactsRaw: Contact[]) {\n    const actualValue = this.historyContacts.has(instance.instanceName)\n      ? this.historyContacts.get(instance.instanceName)\n      : [];\n    this.historyContacts.set(instance.instanceName, actualValue.concat(contactsRaw));\n  }\n\n  public deleteHistoryMessages(instance: InstanceDto) {\n    this.historyMessages.delete(instance.instanceName);\n  }\n\n  public deleteHistoryContacts(instance: InstanceDto) {\n    this.historyContacts.delete(instance.instanceName);\n  }\n\n  public clearAll(instance: InstanceDto) {\n    this.deleteRepositoryMessagesCache(instance);\n    this.deleteHistoryMessages(instance);\n    this.deleteHistoryContacts(instance);\n  }\n\n  public getHistoryMessagesLenght(instance: InstanceDto) {\n    return this.historyMessages.get(instance.instanceName)?.length ?? 0;\n  }\n\n  public async importHistoryContacts(instance: InstanceDto, provider: ChatwootDto) {\n    try {\n      if (this.getHistoryMessagesLenght(instance) > 0) {\n        return;\n      }\n\n      const pgClient = postgresClient.getChatwootConnection();\n\n      let totalContactsImported = 0;\n\n      const contacts = this.historyContacts.get(instance.instanceName) || [];\n      if (contacts.length === 0) {\n        return 0;\n      }\n\n      let contactsChunk: Contact[] = this.sliceIntoChunks(contacts, 3000);\n      while (contactsChunk.length > 0) {\n        const labelSql = `SELECT id FROM labels WHERE title = '${provider.nameInbox}' AND account_id = ${provider.accountId} LIMIT 1`;\n\n        let labelId = (await pgClient.query(labelSql))?.rows[0]?.id;\n\n        if (!labelId) {\n          // creating label in chatwoot db and getting the id\n          const sqlLabel = `INSERT INTO labels (title, color, show_on_sidebar, account_id, created_at, updated_at) VALUES ('${provider.nameInbox}', '#34039B', true, ${provider.accountId}, NOW(), NOW()) RETURNING id`;\n\n          labelId = (await pgClient.query(sqlLabel))?.rows[0]?.id;\n        }\n\n        // inserting contacts in chatwoot db\n        let sqlInsert = `INSERT INTO contacts\n          (name, phone_number, account_id, identifier, created_at, updated_at) VALUES `;\n        const bindInsert = [provider.accountId];\n\n        for (const contact of contactsChunk) {\n          const isGroup = this.isIgnorePhoneNumber(contact.remoteJid);\n\n          const contactName = isGroup ? `${contact.pushName} (GROUP)` : contact.pushName;\n          bindInsert.push(contactName);\n          const bindName = `$${bindInsert.length}`;\n\n          let bindPhoneNumber: string;\n          if (!isGroup) {\n            bindInsert.push(`+${contact.remoteJid.split('@')[0]}`);\n            bindPhoneNumber = `$${bindInsert.length}`;\n          } else {\n            bindPhoneNumber = 'NULL';\n          }\n          bindInsert.push(contact.remoteJid);\n          const bindIdentifier = `$${bindInsert.length}`;\n\n          sqlInsert += `(${bindName}, ${bindPhoneNumber}, $1, ${bindIdentifier}, NOW(), NOW()),`;\n        }\n        if (sqlInsert.slice(-1) === ',') {\n          sqlInsert = sqlInsert.slice(0, -1);\n        }\n        sqlInsert += ` ON CONFLICT (identifier, account_id)\n                       DO UPDATE SET\n                        name = EXCLUDED.name,\n                        phone_number = EXCLUDED.phone_number,\n                        updated_at = NOW()`;\n\n        totalContactsImported += (await pgClient.query(sqlInsert, bindInsert))?.rowCount ?? 0;\n\n        const sqlTags = `SELECT id FROM tags WHERE name = '${provider.nameInbox}' LIMIT 1`;\n\n        const tagData = (await pgClient.query(sqlTags))?.rows[0];\n        let tagId = tagData?.id;\n\n        const sqlTag = `INSERT INTO tags (name, taggings_count) VALUES ('${provider.nameInbox}', ${totalContactsImported}) ON CONFLICT (name) DO UPDATE SET taggings_count = tags.taggings_count + ${totalContactsImported} RETURNING id`;\n\n        tagId = (await pgClient.query(sqlTag))?.rows[0]?.id;\n\n        await pgClient.query(sqlTag);\n\n        let sqlInsertLabel = `INSERT INTO taggings (tag_id, taggable_type, taggable_id, context, created_at) VALUES `;\n\n        contactsChunk.forEach((contact) => {\n          const bindTaggableId = `(SELECT id FROM contacts WHERE identifier = '${contact.remoteJid}' AND account_id = ${provider.accountId})`;\n          sqlInsertLabel += `($1, $2, ${bindTaggableId}, $3, NOW()),`;\n        });\n\n        if (sqlInsertLabel.slice(-1) === ',') {\n          sqlInsertLabel = sqlInsertLabel.slice(0, -1);\n        }\n\n        await pgClient.query(sqlInsertLabel, [tagId, 'Contact', 'labels']);\n\n        contactsChunk = this.sliceIntoChunks(contacts, 3000);\n      }\n\n      this.deleteHistoryContacts(instance);\n\n      return totalContactsImported;\n    } catch (error) {\n      this.logger.error(`Error on import history contacts: ${error.toString()}`);\n    }\n  }\n\n  public async getExistingSourceIds(sourceIds: string[], conversationId?: number): Promise<Set<string>> {\n    try {\n      const existingSourceIdsSet = new Set<string>();\n\n      if (sourceIds.length === 0) {\n        return existingSourceIdsSet;\n      }\n\n      // Ensure all sourceIds are consistently prefixed with 'WAID:' as required by downstream systems and database queries.\n      const formattedSourceIds = sourceIds.map((sourceId) => `WAID:${sourceId.replace('WAID:', '')}`);\n      const pgClient = postgresClient.getChatwootConnection();\n\n      const params = conversationId ? [formattedSourceIds, conversationId] : [formattedSourceIds];\n\n      const query = conversationId\n        ? 'SELECT source_id FROM messages WHERE source_id = ANY($1) AND conversation_id = $2'\n        : 'SELECT source_id FROM messages WHERE source_id = ANY($1)';\n\n      const result = await pgClient.query(query, params);\n      for (const row of result.rows) {\n        existingSourceIdsSet.add(row.source_id);\n      }\n\n      return existingSourceIdsSet;\n    } catch (error) {\n      this.logger.error(`Error on getExistingSourceIds: ${error.toString()}`);\n      return new Set<string>();\n    }\n  }\n\n  public async importHistoryMessages(\n    instance: InstanceDto,\n    chatwootService: ChatwootService,\n    inbox: inbox,\n    provider: ChatwootModel,\n  ) {\n    try {\n      const pgClient = postgresClient.getChatwootConnection();\n\n      const chatwootUser = await this.getChatwootUser(provider);\n      if (!chatwootUser) {\n        throw new Error('User not found to import messages.');\n      }\n\n      let totalMessagesImported = 0;\n\n      let messagesOrdered = this.historyMessages.get(instance.instanceName) || [];\n      if (messagesOrdered.length === 0) {\n        return 0;\n      }\n\n      // ordering messages by number and timestamp asc\n      messagesOrdered.sort((a, b) => {\n        const aKey = a.key as {\n          remoteJid: string;\n        };\n\n        const bKey = b.key as {\n          remoteJid: string;\n        };\n\n        const aMessageTimestamp = a.messageTimestamp as any as number;\n        const bMessageTimestamp = b.messageTimestamp as any as number;\n\n        return parseInt(aKey.remoteJid) - parseInt(bKey.remoteJid) || aMessageTimestamp - bMessageTimestamp;\n      });\n\n      const allMessagesMappedByPhoneNumber = this.createMessagesMapByPhoneNumber(messagesOrdered);\n      // Map structure: +552199999999 => { first message timestamp from number, last message timestamp from number}\n      const phoneNumbersWithTimestamp = new Map<string, firstLastTimestamp>();\n      allMessagesMappedByPhoneNumber.forEach((messages: Message[], phoneNumber: string) => {\n        phoneNumbersWithTimestamp.set(phoneNumber, {\n          first: messages[0]?.messageTimestamp as any as number,\n          last: messages[messages.length - 1]?.messageTimestamp as any as number,\n        });\n      });\n\n      const existingSourceIds = await this.getExistingSourceIds(messagesOrdered.map((message: any) => message.key.id));\n      messagesOrdered = messagesOrdered.filter((message: any) => !existingSourceIds.has(message.key.id));\n      // processing messages in batch\n      const batchSize = 4000;\n      let messagesChunk: Message[] = this.sliceIntoChunks(messagesOrdered, batchSize);\n      while (messagesChunk.length > 0) {\n        // Map structure: +552199999999 => Message[]\n        const messagesByPhoneNumber = this.createMessagesMapByPhoneNumber(messagesChunk);\n\n        if (messagesByPhoneNumber.size > 0) {\n          const fksByNumber = await this.selectOrCreateFksFromChatwoot(\n            provider,\n            inbox,\n            phoneNumbersWithTimestamp,\n            messagesByPhoneNumber,\n          );\n\n          // inserting messages in chatwoot db\n          let sqlInsertMsg = `INSERT INTO messages\n            (content, processed_message_content, account_id, inbox_id, conversation_id, message_type, private, content_type,\n            sender_type, sender_id, source_id, created_at, updated_at) VALUES `;\n          const bindInsertMsg = [provider.accountId, inbox.id];\n\n          messagesByPhoneNumber.forEach((messages: any[], phoneNumber: string) => {\n            const fksChatwoot = fksByNumber.get(phoneNumber);\n\n            messages.forEach((message) => {\n              if (!message.message) {\n                return;\n              }\n\n              if (!fksChatwoot?.conversation_id || !fksChatwoot?.contact_id) {\n                return;\n              }\n\n              const contentMessage = this.getContentMessage(chatwootService, message);\n              if (!contentMessage) {\n                return;\n              }\n\n              bindInsertMsg.push(contentMessage);\n              const bindContent = `$${bindInsertMsg.length}`;\n\n              bindInsertMsg.push(fksChatwoot.conversation_id);\n              const bindConversationId = `$${bindInsertMsg.length}`;\n\n              bindInsertMsg.push(message.key.fromMe ? '1' : '0');\n              const bindMessageType = `$${bindInsertMsg.length}`;\n\n              bindInsertMsg.push(message.key.fromMe ? chatwootUser.user_type : 'Contact');\n              const bindSenderType = `$${bindInsertMsg.length}`;\n\n              bindInsertMsg.push(message.key.fromMe ? chatwootUser.user_id : fksChatwoot.contact_id);\n              const bindSenderId = `$${bindInsertMsg.length}`;\n\n              bindInsertMsg.push('WAID:' + message.key.id);\n              const bindSourceId = `$${bindInsertMsg.length}`;\n\n              bindInsertMsg.push(message.messageTimestamp as number);\n              const bindmessageTimestamp = `$${bindInsertMsg.length}`;\n\n              sqlInsertMsg += `(${bindContent}, ${bindContent}, $1, $2, ${bindConversationId}, ${bindMessageType}, FALSE, 0,\n                  ${bindSenderType},${bindSenderId},${bindSourceId}, to_timestamp(${bindmessageTimestamp}), to_timestamp(${bindmessageTimestamp})),`;\n            });\n          });\n          if (bindInsertMsg.length > 2) {\n            if (sqlInsertMsg.slice(-1) === ',') {\n              sqlInsertMsg = sqlInsertMsg.slice(0, -1);\n            }\n            totalMessagesImported += (await pgClient.query(sqlInsertMsg, bindInsertMsg))?.rowCount ?? 0;\n          }\n        }\n        messagesChunk = this.sliceIntoChunks(messagesOrdered, batchSize);\n      }\n\n      this.deleteHistoryMessages(instance);\n      this.deleteRepositoryMessagesCache(instance);\n\n      const providerData: ChatwootDto = {\n        ...provider,\n        ignoreJids: Array.isArray(provider.ignoreJids) ? provider.ignoreJids.map((event) => String(event)) : [],\n      };\n\n      this.importHistoryContacts(instance, providerData);\n\n      return totalMessagesImported;\n    } catch (error) {\n      this.logger.error(`Error on import history messages: ${error.toString()}`);\n\n      this.deleteHistoryMessages(instance);\n      this.deleteRepositoryMessagesCache(instance);\n    }\n  }\n\n  public async selectOrCreateFksFromChatwoot(\n    provider: ChatwootModel,\n    inbox: inbox,\n    phoneNumbersWithTimestamp: Map<string, firstLastTimestamp>,\n    messagesByPhoneNumber: Map<string, Message[]>,\n  ): Promise<Map<string, FksChatwoot>> {\n    const pgClient = postgresClient.getChatwootConnection();\n\n    const bindValues = [provider.accountId, inbox.id];\n    const phoneNumberBind = Array.from(messagesByPhoneNumber.keys())\n      .map((phoneNumber) => {\n        const phoneNumberTimestamp = phoneNumbersWithTimestamp.get(phoneNumber);\n\n        if (phoneNumberTimestamp) {\n          bindValues.push(phoneNumber);\n          let bindStr = `($${bindValues.length},`;\n\n          bindValues.push(phoneNumberTimestamp.first);\n          bindStr += `$${bindValues.length},`;\n\n          bindValues.push(phoneNumberTimestamp.last);\n          return `${bindStr}$${bindValues.length})`;\n        }\n      })\n      .join(',');\n\n    // select (or insert when necessary) data from tables contacts, contact_inboxes, conversations from chatwoot db\n    const sqlFromChatwoot = `WITH\n              phone_number AS (\n                SELECT phone_number, created_at::INTEGER, last_activity_at::INTEGER FROM (\n                  VALUES \n                   ${phoneNumberBind}\n                 ) as t (phone_number, created_at, last_activity_at)\n              ),\n\n              only_new_phone_number AS (\n                SELECT * FROM phone_number\n                WHERE phone_number NOT IN (\n                  SELECT phone_number\n                  FROM contacts\n                    JOIN contact_inboxes ci ON ci.contact_id = contacts.id AND ci.inbox_id = $2\n                    JOIN conversations con ON con.contact_inbox_id = ci.id \n                      AND con.account_id = $1\n                      AND con.inbox_id = $2\n                      AND con.contact_id = contacts.id\n                  WHERE contacts.account_id = $1\n                )\n              ),\n\n              new_contact AS (\n                INSERT INTO contacts (name, phone_number, account_id, identifier, created_at, updated_at)\n                SELECT REPLACE(p.phone_number, '+', ''), p.phone_number, $1, CONCAT(REPLACE(p.phone_number, '+', ''),\n                  '@s.whatsapp.net'), to_timestamp(p.created_at), to_timestamp(p.last_activity_at)\n                FROM only_new_phone_number AS p\n                ON CONFLICT(identifier, account_id) DO UPDATE SET updated_at = EXCLUDED.updated_at\n                RETURNING id, phone_number, created_at, updated_at\n              ),\n\n              new_contact_inbox AS (\n                INSERT INTO contact_inboxes (contact_id, inbox_id, source_id, created_at, updated_at)\n                SELECT new_contact.id, $2, gen_random_uuid(), new_contact.created_at, new_contact.updated_at\n                FROM new_contact \n                RETURNING id, contact_id, created_at, updated_at\n              ),\n\n              new_conversation AS (\n                INSERT INTO conversations (account_id, inbox_id, status, contact_id,\n                  contact_inbox_id, uuid, last_activity_at, created_at, updated_at)\n                SELECT $1, $2, 0, new_contact_inbox.contact_id, new_contact_inbox.id, gen_random_uuid(),\n                  new_contact_inbox.updated_at, new_contact_inbox.created_at, new_contact_inbox.updated_at\n                FROM new_contact_inbox\n                RETURNING id, contact_id\n              )\n\n              SELECT new_contact.phone_number, new_conversation.contact_id, new_conversation.id AS conversation_id\n              FROM new_conversation \n              JOIN new_contact ON new_conversation.contact_id = new_contact.id\n\n              UNION\n\n              SELECT p.phone_number, c.id contact_id, con.id conversation_id\n                FROM phone_number p\n              JOIN contacts c ON c.phone_number = p.phone_number\n              JOIN contact_inboxes ci ON ci.contact_id = c.id AND ci.inbox_id = $2\n              JOIN conversations con ON con.contact_inbox_id = ci.id AND con.account_id = $1\n                AND con.inbox_id = $2 AND con.contact_id = c.id`;\n\n    const fksFromChatwoot = await pgClient.query(sqlFromChatwoot, bindValues);\n\n    return new Map(fksFromChatwoot.rows.map((item: FksChatwoot) => [item.phone_number, item]));\n  }\n\n  public async getChatwootUser(provider: ChatwootModel): Promise<ChatwootUser> {\n    try {\n      const pgClient = postgresClient.getChatwootConnection();\n\n      const sqlUser = `SELECT owner_type AS user_type, owner_id AS user_id\n                         FROM access_tokens\n                       WHERE token = $1`;\n\n      return (await pgClient.query(sqlUser, [provider.token]))?.rows[0] || false;\n    } catch (error) {\n      this.logger.error(`Error on getChatwootUser: ${error.toString()}`);\n    }\n  }\n\n  public createMessagesMapByPhoneNumber(messages: Message[]): Map<string, Message[]> {\n    return messages.reduce((acc: Map<string, Message[]>, message: Message) => {\n      const key = message?.key as {\n        remoteJid: string;\n      };\n      if (!this.isIgnorePhoneNumber(key?.remoteJid)) {\n        const phoneNumber = key?.remoteJid?.split('@')[0];\n        if (phoneNumber) {\n          const phoneNumberPlus = `+${phoneNumber}`;\n          const messages = acc.has(phoneNumberPlus) ? acc.get(phoneNumberPlus) : [];\n          messages.push(message);\n          acc.set(phoneNumberPlus, messages);\n        }\n      }\n\n      return acc;\n    }, new Map());\n  }\n\n  public async getContactsOrderByRecentConversations(\n    inbox: inbox,\n    provider: ChatwootModel,\n    limit = 50,\n  ): Promise<{ id: number; phone_number: string; identifier: string }[]> {\n    try {\n      const pgClient = postgresClient.getChatwootConnection();\n\n      const sql = `SELECT contacts.id, contacts.identifier, contacts.phone_number\n                     FROM conversations\n                   JOIN contacts ON contacts.id = conversations.contact_id\n                   WHERE conversations.account_id = $1\n                     AND inbox_id = $2\n                   ORDER BY conversations.last_activity_at DESC\n                   LIMIT $3`;\n\n      return (await pgClient.query(sql, [provider.accountId, inbox.id, limit]))?.rows;\n    } catch (error) {\n      this.logger.error(`Error on get recent conversations: ${error.toString()}`);\n    }\n  }\n\n  public getContentMessage(chatwootService: ChatwootService, msg: IWebMessageInfo) {\n    const contentMessage = chatwootService.getConversationMessage(msg.message);\n    if (contentMessage) {\n      return contentMessage;\n    }\n\n    if (!configService.get<Chatwoot>('CHATWOOT').IMPORT.PLACEHOLDER_MEDIA_MESSAGE) {\n      return '';\n    }\n\n    const types = {\n      documentMessage: msg.message.documentMessage,\n      documentWithCaptionMessage: msg.message.documentWithCaptionMessage?.message?.documentMessage,\n      imageMessage: msg.message.imageMessage,\n      videoMessage: msg.message.videoMessage,\n      audioMessage: msg.message.audioMessage,\n      stickerMessage: msg.message.stickerMessage,\n      templateMessage: msg.message.templateMessage?.hydratedTemplate?.hydratedContentText,\n    };\n\n    const typeKey = Object.keys(types).find((key) => types[key] !== undefined && types[key] !== null);\n    switch (typeKey) {\n      case 'documentMessage': {\n        const doc = msg.message.documentMessage;\n        const fileName = doc?.fileName || 'document';\n        const caption = doc?.caption ? ` ${doc.caption}` : '';\n        return `_<File: ${fileName}${caption}>_`;\n      }\n\n      case 'documentWithCaptionMessage': {\n        const doc = msg.message.documentWithCaptionMessage?.message?.documentMessage;\n        const fileName = doc?.fileName || 'document';\n        const caption = doc?.caption ? ` ${doc.caption}` : '';\n        return `_<File: ${fileName}${caption}>_`;\n      }\n\n      case 'templateMessage': {\n        const template = msg.message.templateMessage?.hydratedTemplate;\n        return (\n          (template?.hydratedTitleText ? `*${template.hydratedTitleText}*\\n` : '') +\n          (template?.hydratedContentText || '')\n        );\n      }\n\n      case 'imageMessage':\n        return '_<Image Message>_';\n\n      case 'videoMessage':\n        return '_<Video Message>_';\n\n      case 'audioMessage':\n        return '_<Audio Message>_';\n\n      case 'stickerMessage':\n        return '_<Sticker Message>_';\n\n      default:\n        return '';\n    }\n  }\n\n  public sliceIntoChunks(arr: any[], chunkSize: number) {\n    return arr.splice(0, chunkSize);\n  }\n\n  public isGroup(remoteJid: string) {\n    return remoteJid.includes('@g.us');\n  }\n\n  public isIgnorePhoneNumber(remoteJid: string) {\n    return this.isGroup(remoteJid) || remoteJid === 'status@broadcast' || remoteJid === '0@s.whatsapp.net';\n  }\n\n  public updateMessageSourceID(messageId: string | number, sourceId: string) {\n    const pgClient = postgresClient.getChatwootConnection();\n\n    const sql = `UPDATE messages SET source_id = $1, status = 0, created_at = NOW(), updated_at = NOW() WHERE id = $2;`;\n\n    return pgClient.query(sql, [`WAID:${sourceId}`, messageId]);\n  }\n}\n\nexport const chatwootImport = new ChatwootImport();\n","import { ConfigService, Language } from '@config/env.config';\nimport fs from 'fs';\nimport i18next from 'i18next';\nimport path from 'path';\n\nconst languages = ['en', 'pt-BR', 'es'];\nconst translationsPath = path.join(__dirname, 'translations');\nconst configService: ConfigService = new ConfigService();\n\nconst resources: any = {};\n\nlanguages.forEach((language) => {\n  const languagePath = path.join(translationsPath, `${language}.json`);\n  if (fs.existsSync(languagePath)) {\n    const translationContent = fs.readFileSync(languagePath, 'utf8');\n    resources[language] = {\n      translation: JSON.parse(translationContent),\n    };\n  }\n});\n\ni18next.init({\n  resources,\n  fallbackLng: 'en',\n  lng: configService.get<Language>('LANGUAGE'),\n  debug: false,\n\n  interpolation: {\n    escapeValue: false,\n  },\n});\nexport default i18next;\n","import { configService, Telemetry } from '@config/env.config';\nimport axios from 'axios';\nimport fs from 'fs';\n\nconst packageJson = JSON.parse(fs.readFileSync('./package.json', 'utf8'));\n\nexport interface TelemetryData {\n  route: string;\n  apiVersion: string;\n  timestamp: Date;\n}\n\nexport const sendTelemetry = async (route: string): Promise<void> => {\n  const telemetryConfig = configService.get<Telemetry>('TELEMETRY');\n\n  if (!telemetryConfig.ENABLED) {\n    return;\n  }\n\n  if (route === '/') {\n    return;\n  }\n\n  const telemetry: TelemetryData = {\n    route,\n    apiVersion: `${packageJson.version}`,\n    timestamp: new Date(),\n  };\n\n  const url =\n    telemetryConfig.URL && telemetryConfig.URL !== '' ? telemetryConfig.URL : 'https://log.evolution-api.com/telemetry';\n\n  axios\n    .post(url, telemetry)\n    .then(() => {})\n    .catch(() => {});\n};\n","import { InstanceDto } from '@api/dto/instance.dto';\nimport { Options, Quoted, SendAudioDto, SendMediaDto, SendTextDto } from '@api/dto/sendMessage.dto';\nimport { ChatwootDto } from '@api/integrations/chatbot/chatwoot/dto/chatwoot.dto';\nimport { postgresClient } from '@api/integrations/chatbot/chatwoot/libs/postgres.client';\nimport { chatwootImport } from '@api/integrations/chatbot/chatwoot/utils/chatwoot-import-helper';\nimport { PrismaRepository } from '@api/repository/repository.service';\nimport { CacheService } from '@api/services/cache.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { Events } from '@api/types/wa.types';\nimport { Chatwoot, ConfigService, Database, HttpServer } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\nimport ChatwootClient, {\n  ChatwootAPIConfig,\n  contact,\n  contact_inboxes,\n  conversation,\n  conversation_show,\n  generic_id,\n  inbox,\n} from '@figuro/chatwoot-sdk';\nimport { request as chatwootRequest } from '@figuro/chatwoot-sdk/dist/core/request';\nimport { Chatwoot as ChatwootModel, Contact as ContactModel, Message as MessageModel } from '@prisma/client';\nimport i18next from '@utils/i18n';\nimport { sendTelemetry } from '@utils/sendTelemetry';\nimport axios from 'axios';\nimport { WAMessageContent, WAMessageKey } from 'baileys';\nimport dayjs from 'dayjs';\nimport FormData from 'form-data';\nimport { Jimp, JimpMime } from 'jimp';\nimport { parsePhoneNumberFromString } from 'libphonenumber-js';\nimport Long from 'long';\nimport mimeTypes from 'mime-types';\nimport path from 'path';\nimport { Readable } from 'stream';\n\ninterface ChatwootMessage {\n  messageId?: number;\n  inboxId?: number;\n  conversationId?: number;\n  contactInboxSourceId?: string;\n  isRead?: boolean;\n}\n\nexport class ChatwootService {\n  private readonly logger = new Logger('ChatwootService');\n\n  // Lock polling delay\n  private readonly LOCK_POLLING_DELAY_MS = 300; // Delay between lock status checks\n\n  private provider: any;\n\n  constructor(\n    private readonly waMonitor: WAMonitoringService,\n    private readonly configService: ConfigService,\n    private readonly prismaRepository: PrismaRepository,\n    private readonly cache: CacheService,\n  ) {}\n\n  private pgClient = postgresClient.getChatwootConnection();\n\n  private async getProvider(instance: InstanceDto): Promise<ChatwootModel | null> {\n    const cacheKey = `${instance.instanceName}:getProvider`;\n    if (await this.cache.has(cacheKey)) {\n      const provider = (await this.cache.get(cacheKey)) as ChatwootModel;\n\n      return provider;\n    }\n\n    const provider = await this.waMonitor.waInstances[instance.instanceName]?.findChatwoot();\n\n    if (!provider) {\n      this.logger.warn('provider not found');\n      return null;\n    }\n\n    this.cache.set(cacheKey, provider);\n\n    return provider;\n  }\n\n  private async clientCw(instance: InstanceDto) {\n    const provider = await this.getProvider(instance);\n\n    if (!provider) {\n      this.logger.error('provider not found');\n      return null;\n    }\n\n    this.provider = provider;\n\n    const client = new ChatwootClient({\n      config: this.getClientCwConfig(),\n    });\n\n    return client;\n  }\n\n  public getClientCwConfig(): ChatwootAPIConfig & { nameInbox: string; mergeBrazilContacts: boolean } {\n    return {\n      basePath: this.provider.url,\n      with_credentials: true,\n      credentials: 'include',\n      token: this.provider.token,\n      nameInbox: this.provider.nameInbox,\n      mergeBrazilContacts: this.provider.mergeBrazilContacts,\n    };\n  }\n\n  public getCache() {\n    return this.cache;\n  }\n\n  public async create(instance: InstanceDto, data: ChatwootDto) {\n    await this.waMonitor.waInstances[instance.instanceName].setChatwoot(data);\n\n    if (data.autoCreate) {\n      this.logger.log('Auto create chatwoot instance');\n      const urlServer = this.configService.get<HttpServer>('SERVER').URL;\n\n      await this.initInstanceChatwoot(\n        instance,\n        data.nameInbox ?? instance.instanceName.split('-cwId-')[0],\n        `${urlServer}/chatwoot/webhook/${encodeURIComponent(instance.instanceName)}`,\n        true,\n        data.number,\n        data.organization,\n        data.logo,\n      );\n    }\n    return data;\n  }\n\n  public async find(instance: InstanceDto): Promise<ChatwootDto> {\n    try {\n      return await this.waMonitor.waInstances[instance.instanceName].findChatwoot();\n    } catch {\n      this.logger.error('chatwoot not found');\n      return { enabled: null, url: '' };\n    }\n  }\n\n  public async getContact(instance: InstanceDto, id: number) {\n    const client = await this.clientCw(instance);\n\n    if (!client) {\n      this.logger.warn('client not found');\n      return null;\n    }\n\n    if (!id) {\n      this.logger.warn('id is required');\n      return null;\n    }\n\n    const contact = await client.contact.getContactable({\n      accountId: this.provider.accountId,\n      id,\n    });\n\n    if (!contact) {\n      this.logger.warn('contact not found');\n      return null;\n    }\n\n    return contact;\n  }\n\n  public async initInstanceChatwoot(\n    instance: InstanceDto,\n    inboxName: string,\n    webhookUrl: string,\n    qrcode: boolean,\n    number: string,\n    organization?: string,\n    logo?: string,\n  ) {\n    const client = await this.clientCw(instance);\n\n    if (!client) {\n      this.logger.warn('client not found');\n      return null;\n    }\n\n    const findInbox: any = await client.inboxes.list({\n      accountId: this.provider.accountId,\n    });\n\n    const checkDuplicate = findInbox.payload.map((inbox) => inbox.name).includes(inboxName);\n\n    let inboxId: number;\n\n    this.logger.log('Creating chatwoot inbox');\n    if (!checkDuplicate) {\n      const data = {\n        type: 'api',\n        webhook_url: webhookUrl,\n      };\n\n      const inbox = await client.inboxes.create({\n        accountId: this.provider.accountId,\n        data: {\n          name: inboxName,\n          channel: data as any,\n        },\n      });\n\n      if (!inbox) {\n        this.logger.warn('inbox not found');\n        return null;\n      }\n\n      inboxId = inbox.id;\n    } else {\n      const inbox = findInbox.payload.find((inbox) => inbox.name === inboxName);\n\n      if (!inbox) {\n        this.logger.warn('inbox not found');\n        return null;\n      }\n\n      inboxId = inbox.id;\n    }\n    this.logger.log(`Inbox created - inboxId: ${inboxId}`);\n\n    if (!this.configService.get<Chatwoot>('CHATWOOT').BOT_CONTACT) {\n      this.logger.log('Chatwoot bot contact is disabled');\n\n      return true;\n    }\n\n    this.logger.log('Creating chatwoot bot contact');\n    const contact =\n      (await this.findContact(instance, '123456')) ||\n      ((await this.createContact(\n        instance,\n        '123456',\n        inboxId,\n        false,\n        organization ? organization : 'EvolutionAPI',\n        logo ? logo : 'https://evolution-api.com/files/evolution-api-favicon.png',\n      )) as any);\n\n    if (!contact) {\n      this.logger.warn('contact not found');\n      return null;\n    }\n\n    const contactId = contact.id || contact.payload.contact.id;\n    this.logger.log(`Contact created - contactId: ${contactId}`);\n\n    if (qrcode) {\n      this.logger.log('QR code enabled');\n      const data = {\n        contact_id: contactId.toString(),\n        inbox_id: inboxId.toString(),\n      };\n\n      const conversation = await client.conversations.create({\n        accountId: this.provider.accountId,\n        data,\n      });\n\n      if (!conversation) {\n        this.logger.warn('conversation not found');\n        return null;\n      }\n\n      let contentMsg = 'init';\n\n      if (number) {\n        contentMsg = `init:${number}`;\n      }\n\n      const message = await client.messages.create({\n        accountId: this.provider.accountId,\n        conversationId: conversation.id,\n        data: {\n          content: contentMsg,\n          message_type: 'outgoing',\n        },\n      });\n\n      if (!message) {\n        this.logger.warn('conversation not found');\n        return null;\n      }\n      this.logger.log('Init message sent');\n    }\n\n    return true;\n  }\n\n  public async createContact(\n    instance: InstanceDto,\n    phoneNumber: string,\n    inboxId: number,\n    isGroup: boolean,\n    name?: string,\n    avatar_url?: string,\n    jid?: string,\n  ) {\n    try {\n      const client = await this.clientCw(instance);\n\n      if (!client) {\n        this.logger.warn('client not found');\n        return null;\n      }\n\n      let data: any = {};\n      if (!isGroup) {\n        data = {\n          inbox_id: inboxId,\n          name: name || phoneNumber,\n          identifier: jid,\n          avatar_url: avatar_url,\n        };\n\n        if ((jid && jid.includes('@')) || !jid) {\n          data['phone_number'] = `+${phoneNumber}`;\n        }\n      } else {\n        data = {\n          inbox_id: inboxId,\n          name: name || phoneNumber,\n          identifier: phoneNumber,\n          avatar_url: avatar_url,\n        };\n      }\n\n      const contact = await client.contacts.create({\n        accountId: this.provider.accountId,\n        data,\n      });\n\n      if (!contact) {\n        this.logger.warn('contact not found');\n        return null;\n      }\n\n      const findContact = await this.findContact(instance, phoneNumber);\n\n      const contactId = findContact?.id;\n\n      await this.addLabelToContact(this.provider.nameInbox, contactId);\n\n      return contact;\n    } catch (error) {\n      if ((error.status === 422 || error.response?.status === 422) && jid) {\n        this.logger.warn(`Contact with identifier ${jid} creation failed (422). Checking if it already exists...`);\n        const existingContact = await this.findContactByIdentifier(instance, jid);\n        if (existingContact) {\n          const contactId = existingContact.id;\n          await this.addLabelToContact(this.provider.nameInbox, contactId);\n          return existingContact;\n        }\n      }\n\n      this.logger.error('Error creating contact');\n      console.log(error);\n      return null;\n    }\n  }\n\n  public async updateContact(instance: InstanceDto, id: number, data: any) {\n    const client = await this.clientCw(instance);\n\n    if (!client) {\n      this.logger.warn('client not found');\n      return null;\n    }\n\n    if (!id) {\n      this.logger.warn('id is required');\n      return null;\n    }\n\n    try {\n      const contact = await client.contacts.update({\n        accountId: this.provider.accountId,\n        id,\n        data,\n      });\n\n      return contact;\n    } catch {\n      return null;\n    }\n  }\n\n  public async addLabelToContact(nameInbox: string, contactId: number) {\n    try {\n      const uri = this.configService.get<Chatwoot>('CHATWOOT').IMPORT.DATABASE.CONNECTION.URI;\n\n      if (!uri) return false;\n\n      const sqlTags = `SELECT id, taggings_count FROM tags WHERE name = $1 LIMIT 1`;\n      const tagData = (await this.pgClient.query(sqlTags, [nameInbox]))?.rows[0];\n      let tagId = tagData?.id;\n      const taggingsCount = tagData?.taggings_count || 0;\n\n      const sqlTag = `INSERT INTO tags (name, taggings_count) \n                      VALUES ($1, $2) \n                      ON CONFLICT (name) \n                      DO UPDATE SET taggings_count = tags.taggings_count + 1 \n                      RETURNING id`;\n\n      tagId = (await this.pgClient.query(sqlTag, [nameInbox, taggingsCount + 1]))?.rows[0]?.id;\n\n      const sqlCheckTagging = `SELECT 1 FROM taggings \n                               WHERE tag_id = $1 AND taggable_type = 'Contact' AND taggable_id = $2 AND context = 'labels' LIMIT 1`;\n\n      const taggingExists = (await this.pgClient.query(sqlCheckTagging, [tagId, contactId]))?.rowCount > 0;\n\n      if (!taggingExists) {\n        const sqlInsertLabel = `INSERT INTO taggings (tag_id, taggable_type, taggable_id, context, created_at) \n                                VALUES ($1, 'Contact', $2, 'labels', NOW())`;\n\n        await this.pgClient.query(sqlInsertLabel, [tagId, contactId]);\n      }\n\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  public async findContactByIdentifier(instance: InstanceDto, identifier: string) {\n    const client = await this.clientCw(instance);\n\n    if (!client) {\n      this.logger.warn('client not found');\n      return null;\n    }\n\n    // Direct search by query (q) - most common way to search by identifier/email/phone\n    const contact = (await (client as any).get('contacts/search', {\n      params: {\n        q: identifier,\n        sort: 'name',\n      },\n    })) as any;\n\n    if (contact && contact.data && contact.data.payload && contact.data.payload.length > 0) {\n      return contact.data.payload[0];\n    }\n\n    // Fallback for older API versions or different response structures\n    if (contact && contact.payload && contact.payload.length > 0) {\n      return contact.payload[0];\n    }\n\n    // Try search by attribute\n    const contactByAttr = (await (client as any).post('contacts/filter', {\n      payload: [\n        {\n          attribute_key: 'identifier',\n          filter_operator: 'equal_to',\n          values: [identifier],\n          query_operator: null,\n        },\n      ],\n    })) as any;\n\n    if (contactByAttr && contactByAttr.payload && contactByAttr.payload.length > 0) {\n      return contactByAttr.payload[0];\n    }\n\n    // Check inside data property if using axios interceptors wrapper\n    if (contactByAttr && contactByAttr.data && contactByAttr.data.payload && contactByAttr.data.payload.length > 0) {\n      return contactByAttr.data.payload[0];\n    }\n\n    return null;\n  }\n\n  public async findContact(instance: InstanceDto, phoneNumber: string) {\n    const client = await this.clientCw(instance);\n\n    if (!client) {\n      this.logger.warn('client not found');\n      return null;\n    }\n\n    let query: any;\n    const isGroup = phoneNumber.includes('@g.us');\n\n    if (!isGroup) {\n      query = `+${phoneNumber}`;\n    } else {\n      query = phoneNumber;\n    }\n\n    let contact: any;\n\n    if (isGroup) {\n      contact = await client.contacts.search({\n        accountId: this.provider.accountId,\n        q: query,\n      });\n    } else {\n      contact = await chatwootRequest(this.getClientCwConfig(), {\n        method: 'POST',\n        url: `/api/v1/accounts/${this.provider.accountId}/contacts/filter`,\n        body: {\n          payload: this.getFilterPayload(query),\n        },\n      });\n    }\n\n    if (!contact && contact?.payload?.length === 0) {\n      this.logger.warn('contact not found');\n      return null;\n    }\n\n    if (!isGroup) {\n      return contact.payload.length > 1 ? this.findContactInContactList(contact.payload, query) : contact.payload[0];\n    } else {\n      return contact.payload.find((contact) => contact.identifier === query);\n    }\n  }\n\n  private async mergeContacts(baseId: number, mergeId: number) {\n    try {\n      const contact = await chatwootRequest(this.getClientCwConfig(), {\n        method: 'POST',\n        url: `/api/v1/accounts/${this.provider.accountId}/actions/contact_merge`,\n        body: {\n          base_contact_id: baseId,\n          mergee_contact_id: mergeId,\n        },\n      });\n\n      return contact;\n    } catch {\n      this.logger.error('Error merging contacts');\n      return null;\n    }\n  }\n\n  private async mergeBrazilianContacts(contacts: any[]) {\n    try {\n      const contact = await chatwootRequest(this.getClientCwConfig(), {\n        method: 'POST',\n        url: `/api/v1/accounts/${this.provider.accountId}/actions/contact_merge`,\n        body: {\n          base_contact_id: contacts.find((contact) => contact.phone_number.length === 14)?.id,\n          mergee_contact_id: contacts.find((contact) => contact.phone_number.length === 13)?.id,\n        },\n      });\n\n      return contact;\n    } catch {\n      this.logger.error('Error merging contacts');\n      return null;\n    }\n  }\n\n  private findContactInContactList(contacts: any[], query: string) {\n    const phoneNumbers = this.getNumbers(query);\n    const searchableFields = this.getSearchableFields();\n\n    // eslint-disable-next-line prettier/prettier\n    if (contacts.length === 2 && this.getClientCwConfig().mergeBrazilContacts && query.startsWith('+55')) {\n      const contact = this.mergeBrazilianContacts(contacts);\n      if (contact) {\n        return contact;\n      }\n    }\n\n    const phone = phoneNumbers.reduce(\n      (savedNumber, number) => (number.length > savedNumber.length ? number : savedNumber),\n      '',\n    );\n\n    const contact_with9 = contacts.find((contact) => contact.phone_number === phone);\n    if (contact_with9) {\n      return contact_with9;\n    }\n\n    for (const contact of contacts) {\n      for (const field of searchableFields) {\n        if (contact[field] && phoneNumbers.includes(contact[field])) {\n          return contact;\n        }\n      }\n    }\n\n    return null;\n  }\n\n  private getNumbers(query: string) {\n    const numbers = [];\n    numbers.push(query);\n\n    if (query.startsWith('+55') && query.length === 14) {\n      const withoutNine = query.slice(0, 5) + query.slice(6);\n      numbers.push(withoutNine);\n    } else if (query.startsWith('+55') && query.length === 13) {\n      const withNine = query.slice(0, 5) + '9' + query.slice(5);\n      numbers.push(withNine);\n    }\n\n    return numbers;\n  }\n\n  private getSearchableFields() {\n    return ['phone_number'];\n  }\n\n  private getFilterPayload(query: string) {\n    const filterPayload = [];\n\n    const numbers = this.getNumbers(query);\n    const fieldsToSearch = this.getSearchableFields();\n\n    fieldsToSearch.forEach((field, index1) => {\n      numbers.forEach((number, index2) => {\n        const queryOperator = fieldsToSearch.length - 1 === index1 && numbers.length - 1 === index2 ? null : 'OR';\n        filterPayload.push({\n          attribute_key: field,\n          filter_operator: 'equal_to',\n          values: [number.replace('+', '')],\n          query_operator: queryOperator,\n        });\n      });\n    });\n\n    return filterPayload;\n  }\n\n  public async createConversation(instance: InstanceDto, body: any) {\n    const isLid = body.key.addressingMode === 'lid';\n    const isGroup = body.key.remoteJid.endsWith('@g.us');\n    const phoneNumber = isLid && !isGroup ? body.key.remoteJidAlt : body.key.remoteJid;\n    const { remoteJid } = body.key;\n    const cacheKey = `${instance.instanceName}:createConversation-${remoteJid}`;\n    const lockKey = `${instance.instanceName}:lock:createConversation-${remoteJid}`;\n    const maxWaitTime = 5000; // 5 seconds\n    const client = await this.clientCw(instance);\n    if (!client) return null;\n\n    try {\n      // Processa atualizao de contatos j criados @lid\n      if (phoneNumber && remoteJid && !isGroup) {\n        const contact = await this.findContact(instance, phoneNumber.split('@')[0]);\n        if (contact && contact.identifier !== remoteJid) {\n          this.logger.verbose(\n            `Identifier needs update: (contact.identifier: ${contact.identifier}, phoneNumber: ${phoneNumber}, body.key.remoteJidAlt: ${remoteJid}`,\n          );\n          const updateContact = await this.updateContact(instance, contact.id, {\n            identifier: phoneNumber,\n            phone_number: `+${phoneNumber.split('@')[0]}`,\n          });\n\n          if (updateContact === null) {\n            const baseContact = await this.findContact(instance, phoneNumber.split('@')[0]);\n            if (baseContact) {\n              await this.mergeContacts(baseContact.id, contact.id);\n              this.logger.verbose(\n                `Merge contacts: (${baseContact.id}) ${baseContact.phone_number} and (${contact.id}) ${contact.phone_number}`,\n              );\n            }\n          }\n        }\n      }\n      this.logger.verbose(`--- Start createConversation ---`);\n      this.logger.verbose(`Instance: ${JSON.stringify(instance)}`);\n\n      // If it already exists in the cache, return conversationId\n      if (await this.cache.has(cacheKey)) {\n        const conversationId = (await this.cache.get(cacheKey)) as number;\n        this.logger.verbose(`Found conversation to: ${phoneNumber}, conversation ID: ${conversationId}`);\n        let conversationExists: any;\n        try {\n          conversationExists = await client.conversations.get({\n            accountId: this.provider.accountId,\n            conversationId: conversationId,\n          });\n          this.logger.verbose(\n            `Conversation exists: ID: ${conversationExists.id} - Name: ${conversationExists.meta.sender.name} - Identifier: ${conversationExists.meta.sender.identifier}`,\n          );\n        } catch (error) {\n          this.logger.error(`Error getting conversation: ${error}`);\n          conversationExists = false;\n        }\n        if (!conversationExists) {\n          this.logger.verbose('Conversation does not exist, re-calling createConversation');\n          this.cache.delete(cacheKey);\n          return await this.createConversation(instance, body);\n        }\n        return conversationId;\n      }\n\n      // If lock already exists, wait until release or timeout\n      if (await this.cache.has(lockKey)) {\n        this.logger.verbose(`Operao de criao j em andamento para ${remoteJid}, aguardando resultado...`);\n        const start = Date.now();\n        while (await this.cache.has(lockKey)) {\n          if (Date.now() - start > maxWaitTime) {\n            this.logger.warn(`Timeout aguardando lock para ${remoteJid}`);\n            break;\n          }\n          await new Promise((res) => setTimeout(res, this.LOCK_POLLING_DELAY_MS));\n          if (await this.cache.has(cacheKey)) {\n            const conversationId = (await this.cache.get(cacheKey)) as number;\n            this.logger.verbose(`Resolves creation of: ${remoteJid}, conversation ID: ${conversationId}`);\n            return conversationId;\n          }\n        }\n      }\n\n      // Adquire lock\n      await this.cache.set(lockKey, true, 30);\n      this.logger.verbose(`Bloqueio adquirido para: ${lockKey}`);\n\n      try {\n        /*\n        Double check after lock\n        Utilizei uma nova verificao para evitar que outra thread execute entre o terminio do while e o set lock\n        */\n        if (await this.cache.has(cacheKey)) {\n          return (await this.cache.get(cacheKey)) as number;\n        }\n\n        const chatId = isGroup ? remoteJid : phoneNumber.split('@')[0].split(':')[0];\n        let nameContact = !body.key.fromMe ? body.pushName : chatId;\n        const filterInbox = await this.getInbox(instance);\n        if (!filterInbox) return null;\n\n        if (isGroup) {\n          this.logger.verbose(`Processing group conversation`);\n          const group = await this.waMonitor.waInstances[instance.instanceName].client.groupMetadata(chatId);\n          this.logger.verbose(`Group metadata: JID:${group.JID} - Subject:${group?.subject || group?.Name}`);\n\n          const participantJid = isLid && !body.key.fromMe ? body.key.participantAlt : body.key.participant;\n          nameContact = `${group.subject} (GROUP)`;\n\n          const picture_url = await this.waMonitor.waInstances[instance.instanceName].profilePicture(\n            participantJid.split('@')[0],\n          );\n          this.logger.verbose(`Participant profile picture URL: ${JSON.stringify(picture_url)}`);\n\n          const findParticipant = await this.findContact(instance, participantJid.split('@')[0]);\n\n          if (findParticipant) {\n            this.logger.verbose(\n              `Found participant: ID:${findParticipant.id} - Name: ${findParticipant.name} - identifier: ${findParticipant.identifier}`,\n            );\n            if (!findParticipant.name || findParticipant.name === chatId) {\n              await this.updateContact(instance, findParticipant.id, {\n                name: body.pushName,\n                avatar_url: picture_url.profilePictureUrl || null,\n              });\n            }\n          } else {\n            await this.createContact(\n              instance,\n              participantJid.split('@')[0].split(':')[0],\n              filterInbox.id,\n              false,\n              body.pushName,\n              picture_url.profilePictureUrl || null,\n              participantJid,\n            );\n          }\n        }\n\n        const picture_url = await this.waMonitor.waInstances[instance.instanceName].profilePicture(chatId);\n        this.logger.verbose(`Contact profile picture URL: ${JSON.stringify(picture_url)}`);\n\n        this.logger.verbose(`Searching contact for: ${chatId}`);\n        let contact = await this.findContact(instance, chatId);\n\n        if (contact) {\n          this.logger.verbose(`Found contact: ID:${contact.id} - Name:${contact.name}`);\n          if (!body.key.fromMe) {\n            const waProfilePictureFile =\n              picture_url?.profilePictureUrl?.split('#')[0].split('?')[0].split('/').pop() || '';\n            const chatwootProfilePictureFile = contact?.thumbnail?.split('#')[0].split('?')[0].split('/').pop() || '';\n            const pictureNeedsUpdate = waProfilePictureFile !== chatwootProfilePictureFile;\n            const nameNeedsUpdate = !contact.name || contact.name === chatId;\n            this.logger.verbose(`Picture needs update: ${pictureNeedsUpdate}`);\n            this.logger.verbose(`Name needs update: ${nameNeedsUpdate}`);\n            if (pictureNeedsUpdate || nameNeedsUpdate) {\n              contact = await this.updateContact(instance, contact.id, {\n                ...(nameNeedsUpdate && { name: nameContact }),\n                ...(waProfilePictureFile === '' && { avatar: null }),\n                ...(pictureNeedsUpdate && { avatar_url: picture_url?.profilePictureUrl }),\n              });\n            }\n          }\n        } else {\n          contact = await this.createContact(\n            instance,\n            chatId,\n            filterInbox.id,\n            isGroup,\n            nameContact,\n            picture_url.profilePictureUrl || null,\n            phoneNumber,\n          );\n        }\n\n        if (!contact) {\n          this.logger.warn(`Contact not created or found`);\n          return null;\n        }\n\n        const contactId = contact?.payload?.id || contact?.payload?.contact?.id || contact?.id;\n        this.logger.verbose(`Contact ID: ${contactId}`);\n\n        const contactConversations = (await client.contacts.listConversations({\n          accountId: this.provider.accountId,\n          id: contactId,\n        })) as any;\n\n        if (!contactConversations || !contactConversations.payload) {\n          this.logger.error(`No conversations found or payload is undefined`);\n          return null;\n        }\n\n        let inboxConversation = contactConversations.payload.find(\n          (conversation) => conversation.inbox_id == filterInbox.id,\n        );\n        if (inboxConversation) {\n          if (this.provider.reopenConversation) {\n            this.logger.verbose(\n              `Found conversation in reopenConversation mode: ID: ${inboxConversation.id} - Name: ${inboxConversation.meta.sender.name} - Identifier: ${inboxConversation.meta.sender.identifier}`,\n            );\n            if (inboxConversation && this.provider.conversationPending && inboxConversation.status !== 'open') {\n              await client.conversations.toggleStatus({\n                accountId: this.provider.accountId,\n                conversationId: inboxConversation.id,\n                data: {\n                  status: 'pending',\n                },\n              });\n            }\n          } else {\n            inboxConversation = contactConversations.payload.find(\n              (conversation) =>\n                conversation && conversation.status !== 'resolved' && conversation.inbox_id == filterInbox.id,\n            );\n            this.logger.verbose(`Found conversation: ${JSON.stringify(inboxConversation)}`);\n          }\n\n          if (inboxConversation) {\n            this.logger.verbose(`Returning existing conversation ID: ${inboxConversation.id}`);\n            this.cache.set(cacheKey, inboxConversation.id, 1800);\n            return inboxConversation.id;\n          }\n        }\n\n        const data = {\n          contact_id: contactId.toString(),\n          inbox_id: filterInbox.id.toString(),\n        };\n\n        if (this.provider.conversationPending) {\n          data['status'] = 'pending';\n        }\n\n        const conversation = await client.conversations.create({\n          accountId: this.provider.accountId,\n          data,\n        });\n\n        if (!conversation) {\n          this.logger.warn(`Conversation not created or found`);\n          return null;\n        }\n\n        this.logger.verbose(`New conversation created of ${remoteJid} with ID: ${conversation.id}`);\n        this.cache.set(cacheKey, conversation.id, 1800);\n        return conversation.id;\n      } finally {\n        await this.cache.delete(lockKey);\n        this.logger.verbose(`Block released for: ${lockKey}`);\n      }\n    } catch (error) {\n      this.logger.error(`Error in createConversation: ${error}`);\n      return null;\n    }\n  }\n\n  public async getInbox(instance: InstanceDto): Promise<inbox | null> {\n    const cacheKey = `${instance.instanceName}:getInbox`;\n    if (await this.cache.has(cacheKey)) {\n      return (await this.cache.get(cacheKey)) as inbox;\n    }\n\n    const client = await this.clientCw(instance);\n\n    if (!client) {\n      this.logger.warn('client not found');\n      return null;\n    }\n\n    const inbox = (await client.inboxes.list({\n      accountId: this.provider.accountId,\n    })) as any;\n\n    if (!inbox) {\n      this.logger.warn('inbox not found');\n      return null;\n    }\n\n    const findByName = inbox.payload.find((inbox) => inbox.name === this.getClientCwConfig().nameInbox);\n\n    if (!findByName) {\n      this.logger.warn('inbox not found');\n      return null;\n    }\n\n    this.cache.set(cacheKey, findByName);\n    return findByName;\n  }\n\n  public async createMessage(\n    instance: InstanceDto,\n    conversationId: number,\n    content: string,\n    messageType: 'incoming' | 'outgoing' | undefined,\n    privateMessage?: boolean,\n    attachments?: {\n      content: unknown;\n      encoding: string;\n      filename: string;\n    }[],\n    messageBody?: any,\n    sourceId?: string,\n    quotedMsg?: MessageModel,\n  ) {\n    const client = await this.clientCw(instance);\n\n    if (!client) {\n      this.logger.warn('client not found');\n      return null;\n    }\n\n    const replyToIds = await this.getReplyToIds(messageBody, instance);\n\n    const sourceReplyId = quotedMsg?.chatwootMessageId || null;\n\n    const message = await client.messages.create({\n      accountId: this.provider.accountId,\n      conversationId: conversationId,\n      data: {\n        content: content,\n        message_type: messageType,\n        attachments: attachments,\n        private: privateMessage || false,\n        source_id: sourceId,\n        content_attributes: {\n          ...replyToIds,\n        },\n        source_reply_id: sourceReplyId ? sourceReplyId.toString() : null,\n      },\n    });\n\n    if (!message) {\n      this.logger.warn('message not found');\n      return null;\n    }\n\n    return message;\n  }\n\n  public async getOpenConversationByContact(\n    instance: InstanceDto,\n    inbox: inbox,\n    contact: generic_id & contact,\n  ): Promise<conversation> {\n    const client = await this.clientCw(instance);\n\n    if (!client) {\n      this.logger.warn('client not found');\n      return null;\n    }\n\n    const conversations = (await client.contacts.listConversations({\n      accountId: this.provider.accountId,\n      id: contact.id,\n    })) as any;\n\n    return (\n      conversations.payload.find(\n        (conversation) => conversation.inbox_id === inbox.id && conversation.status === 'open',\n      ) || undefined\n    );\n  }\n\n  public async createBotMessage(\n    instance: InstanceDto,\n    content: string,\n    messageType: 'incoming' | 'outgoing' | undefined,\n    attachments?: {\n      content: unknown;\n      encoding: string;\n      filename: string;\n    }[],\n  ) {\n    const client = await this.clientCw(instance);\n\n    if (!client) {\n      this.logger.warn('client not found');\n      return null;\n    }\n\n    const contact = await this.findContact(instance, '123456');\n\n    if (!contact) {\n      this.logger.warn('contact not found');\n      return null;\n    }\n\n    const filterInbox = await this.getInbox(instance);\n\n    if (!filterInbox) {\n      this.logger.warn('inbox not found');\n      return null;\n    }\n\n    const conversation = await this.getOpenConversationByContact(instance, filterInbox, contact);\n\n    if (!conversation) {\n      this.logger.warn('conversation not found');\n      return;\n    }\n\n    const message = await client.messages.create({\n      accountId: this.provider.accountId,\n      conversationId: conversation.id,\n      data: {\n        content: content,\n        message_type: messageType,\n        attachments: attachments,\n      },\n    });\n\n    if (!message) {\n      this.logger.warn('message not found');\n      return null;\n    }\n\n    return message;\n  }\n\n  private async sendData(\n    conversationId: number,\n    fileStream: Readable,\n    fileName: string,\n    messageType: 'incoming' | 'outgoing' | undefined,\n    content?: string,\n    instance?: InstanceDto,\n    messageBody?: any,\n    sourceId?: string,\n    quotedMsg?: MessageModel,\n  ) {\n    if (sourceId && this.isImportHistoryAvailable()) {\n      const messageAlreadySaved = await chatwootImport.getExistingSourceIds([sourceId], conversationId);\n      if (messageAlreadySaved) {\n        if (messageAlreadySaved.size > 0) {\n          this.logger.warn('Message already saved on chatwoot');\n          return null;\n        }\n      }\n    }\n    const data = new FormData();\n\n    if (content) {\n      data.append('content', content);\n    }\n\n    data.append('message_type', messageType);\n\n    data.append('attachments[]', fileStream, { filename: fileName });\n\n    const sourceReplyId = quotedMsg?.chatwootMessageId || null;\n\n    if (messageBody && instance) {\n      const replyToIds = await this.getReplyToIds(messageBody, instance);\n\n      if (replyToIds.in_reply_to || replyToIds.in_reply_to_external_id) {\n        const content = JSON.stringify({\n          ...replyToIds,\n        });\n        data.append('content_attributes', content);\n      }\n    }\n\n    if (sourceReplyId) {\n      data.append('source_reply_id', sourceReplyId.toString());\n    }\n\n    if (sourceId) {\n      data.append('source_id', sourceId);\n    }\n\n    const config = {\n      method: 'post',\n      maxBodyLength: Infinity,\n      url: `${this.provider.url}/api/v1/accounts/${this.provider.accountId}/conversations/${conversationId}/messages`,\n      headers: {\n        api_access_token: this.provider.token,\n        ...data.getHeaders(),\n      },\n      data: data,\n    };\n\n    try {\n      const { data } = await axios.request(config);\n\n      return data;\n    } catch (error) {\n      this.logger.error(error);\n    }\n  }\n\n  public async createBotQr(\n    instance: InstanceDto,\n    content: string,\n    messageType: 'incoming' | 'outgoing' | undefined,\n    fileStream?: Readable,\n    fileName?: string,\n  ) {\n    const client = await this.clientCw(instance);\n\n    if (!client) {\n      this.logger.warn('client not found');\n      return null;\n    }\n\n    if (!this.configService.get<Chatwoot>('CHATWOOT').BOT_CONTACT) {\n      this.logger.log('Chatwoot bot contact is disabled');\n\n      return true;\n    }\n\n    const contact = await this.findContact(instance, '123456');\n\n    if (!contact) {\n      this.logger.warn('contact not found');\n      return null;\n    }\n\n    const filterInbox = await this.getInbox(instance);\n\n    if (!filterInbox) {\n      this.logger.warn('inbox not found');\n      return null;\n    }\n\n    const conversation = await this.getOpenConversationByContact(instance, filterInbox, contact);\n\n    if (!conversation) {\n      this.logger.warn('conversation not found');\n      return;\n    }\n\n    const data = new FormData();\n\n    if (content) {\n      data.append('content', content);\n    }\n\n    data.append('message_type', messageType);\n\n    if (fileStream && fileName) {\n      data.append('attachments[]', fileStream, { filename: fileName });\n    }\n\n    const config = {\n      method: 'post',\n      maxBodyLength: Infinity,\n      url: `${this.provider.url}/api/v1/accounts/${this.provider.accountId}/conversations/${conversation.id}/messages`,\n      headers: {\n        api_access_token: this.provider.token,\n        ...data.getHeaders(),\n      },\n      data: data,\n    };\n\n    try {\n      const { data } = await axios.request(config);\n\n      return data;\n    } catch (error) {\n      this.logger.error(error);\n    }\n  }\n\n  public async sendAttachment(waInstance: any, number: string, media: any, caption?: string, options?: Options) {\n    try {\n      const parsedMedia = path.parse(decodeURIComponent(media));\n      let mimeType = mimeTypes.lookup(parsedMedia?.ext) || '';\n      let fileName = parsedMedia?.name + parsedMedia?.ext;\n\n      if (!mimeType) {\n        const parts = media.split('/');\n        fileName = decodeURIComponent(parts[parts.length - 1]);\n\n        const response = await axios.get(media, {\n          responseType: 'arraybuffer',\n        });\n        mimeType = response.headers['content-type'];\n      }\n\n      let type = 'document';\n\n      switch (mimeType.split('/')[0]) {\n        case 'image':\n          type = 'image';\n          break;\n        case 'video':\n          type = 'video';\n          break;\n        case 'audio':\n          type = 'audio';\n          break;\n        default:\n          type = 'document';\n          break;\n      }\n\n      if (type === 'audio') {\n        const data: SendAudioDto = {\n          number: number,\n          audio: media,\n          delay: Math.floor(Math.random() * (2000 - 500 + 1)) + 500,\n          quoted: options?.quoted,\n        };\n\n        sendTelemetry('/message/sendWhatsAppAudio');\n\n        const messageSent = await waInstance?.audioWhatsapp(data, null, true);\n\n        return messageSent;\n      }\n\n      const documentExtensions = ['.gif', '.svg', '.tiff', '.tif', '.dxf', '.dwg'];\n      if (type === 'image' && parsedMedia && documentExtensions.includes(parsedMedia?.ext)) {\n        type = 'document';\n      }\n\n      const data: SendMediaDto = {\n        number: number,\n        mediatype: type as any,\n        fileName: fileName,\n        media: media,\n        delay: 1200,\n        quoted: options?.quoted,\n      };\n\n      sendTelemetry('/message/sendMedia');\n\n      if (caption) {\n        data.caption = caption;\n      }\n\n      const messageSent = await waInstance?.mediaMessage(data, null, true);\n\n      return messageSent;\n    } catch (error) {\n      this.logger.error(error);\n      throw error; // Re-throw para que o erro seja tratado pelo caller\n    }\n  }\n\n  public async onSendMessageError(instance: InstanceDto, conversation: number, error?: any) {\n    this.logger.verbose(`onSendMessageError ${JSON.stringify(error)}`);\n\n    const client = await this.clientCw(instance);\n\n    if (!client) {\n      return;\n    }\n\n    if (error && error?.status === 400 && error?.message[0]?.exists === false) {\n      client.messages.create({\n        accountId: this.provider.accountId,\n        conversationId: conversation,\n        data: {\n          content: `${i18next.t('cw.message.numbernotinwhatsapp')}`,\n          message_type: 'outgoing',\n          private: true,\n        },\n      });\n\n      return;\n    }\n\n    client.messages.create({\n      accountId: this.provider.accountId,\n      conversationId: conversation,\n      data: {\n        content: i18next.t('cw.message.notsent', {\n          error: error ? `_${error.toString()}_` : '',\n        }),\n        message_type: 'outgoing',\n        private: true,\n      },\n    });\n  }\n\n  public async receiveWebhook(instance: InstanceDto, body: any) {\n    try {\n      await new Promise((resolve) => setTimeout(resolve, 500));\n\n      const client = await this.clientCw(instance);\n\n      if (!client) {\n        this.logger.warn('client not found');\n        return null;\n      }\n\n      if (\n        this.provider.reopenConversation === false &&\n        body.event === 'conversation_status_changed' &&\n        body.status === 'resolved' &&\n        body.meta?.sender?.identifier\n      ) {\n        const keyToDelete = `${instance.instanceName}:createConversation-${body.meta.sender.identifier}`;\n        this.cache.delete(keyToDelete);\n      }\n\n      if (\n        !body?.conversation ||\n        body.private ||\n        (body.event === 'message_updated' && !body.content_attributes?.deleted)\n      ) {\n        return { message: 'bot' };\n      }\n\n      const chatId =\n        body.conversation.meta.sender?.identifier || body.conversation.meta.sender?.phone_number.replace('+', '');\n      // Chatwoot to Whatsapp\n      const messageReceived = body.content\n        ? body.content\n            .replaceAll(/(?<!\\*)\\*((?!\\s)([^\\n*]+?)(?<!\\s))\\*(?!\\*)/g, '_$1_') // Substitui * por _\n            .replaceAll(/\\*{2}((?!\\s)([^\\n*]+?)(?<!\\s))\\*{2}/g, '*$1*') // Substitui ** por *\n            .replaceAll(/~{2}((?!\\s)([^\\n*]+?)(?<!\\s))~{2}/g, '~$1~') // Substitui ~~ por ~\n            .replaceAll(/(?<!`)`((?!\\s)([^`*]+?)(?<!\\s))`(?!`)/g, '```$1```') // Substitui ` por ```\n        : body.content;\n\n      const senderName = body?.conversation?.messages[0]?.sender?.available_name || body?.sender?.name;\n      const waInstance = this.waMonitor.waInstances[instance.instanceName];\n      instance.instanceId = waInstance.instanceId;\n\n      if (body.event === 'message_updated' && body.content_attributes?.deleted) {\n        const message = await this.prismaRepository.message.findFirst({\n          where: {\n            chatwootMessageId: body.id,\n            instanceId: instance.instanceId,\n          },\n        });\n\n        if (message) {\n          const key = message.key as WAMessageKey;\n\n          await waInstance?.client.sendMessage(key.remoteJid, { delete: key });\n\n          await this.prismaRepository.message.deleteMany({\n            where: {\n              instanceId: instance.instanceId,\n              chatwootMessageId: body.id,\n            },\n          });\n        }\n        return { message: 'bot' };\n      }\n\n      const cwBotContact = this.configService.get<Chatwoot>('CHATWOOT').BOT_CONTACT;\n\n      if (chatId === '123456' && body.message_type === 'outgoing') {\n        const command = messageReceived.replace('/', '');\n\n        if (cwBotContact && (command.includes('init') || command.includes('iniciar'))) {\n          const state = waInstance?.connectionStatus?.state;\n\n          if (state !== 'open') {\n            const number = command.split(':')[1];\n            await waInstance.connectToWhatsapp(number);\n          } else {\n            await this.createBotMessage(\n              instance,\n              i18next.t('cw.inbox.alreadyConnected', {\n                inboxName: body.inbox.name,\n              }),\n              'incoming',\n            );\n          }\n        }\n\n        if (command === 'clearcache') {\n          waInstance.clearCacheChatwoot();\n          await this.createBotMessage(\n            instance,\n            i18next.t('cw.inbox.clearCache', {\n              inboxName: body.inbox.name,\n            }),\n            'incoming',\n          );\n        }\n\n        if (command === 'status') {\n          const state = waInstance?.connectionStatus?.state;\n\n          if (!state) {\n            await this.createBotMessage(\n              instance,\n              i18next.t('cw.inbox.notFound', {\n                inboxName: body.inbox.name,\n              }),\n              'incoming',\n            );\n          }\n\n          if (state) {\n            await this.createBotMessage(\n              instance,\n              i18next.t('cw.inbox.status', {\n                inboxName: body.inbox.name,\n                state: state,\n              }),\n              'incoming',\n            );\n          }\n        }\n\n        if (cwBotContact && (command === 'disconnect' || command === 'desconectar')) {\n          const msgLogout = i18next.t('cw.inbox.disconnect', {\n            inboxName: body.inbox.name,\n          });\n\n          await this.createBotMessage(instance, msgLogout, 'incoming');\n\n          await waInstance?.client?.logout('Log out instance: ' + instance.instanceName);\n          await waInstance?.client?.ws?.close();\n        }\n      }\n\n      if (body.message_type === 'outgoing' && body?.conversation?.messages?.length && chatId !== '123456') {\n        if (body?.conversation?.messages[0]?.source_id?.substring(0, 5) === 'WAID:') {\n          return { message: 'bot' };\n        }\n\n        if (!waInstance && body.conversation?.id) {\n          this.onSendMessageError(instance, body.conversation?.id, 'Instance not found');\n          return { message: 'bot' };\n        }\n\n        let formatText: string;\n        if (senderName === null || senderName === undefined) {\n          formatText = messageReceived;\n        } else {\n          const formattedDelimiter = this.provider.signDelimiter\n            ? this.provider.signDelimiter.replaceAll('\\\\n', '\\n')\n            : '\\n';\n          const textToConcat = this.provider.signMsg ? [`*${senderName}:*`] : [];\n          textToConcat.push(messageReceived);\n\n          formatText = textToConcat.join(formattedDelimiter);\n        }\n\n        for (const message of body.conversation.messages) {\n          if (message.attachments && message.attachments.length > 0) {\n            for (const attachment of message.attachments) {\n              if (!messageReceived) {\n                formatText = null;\n              }\n\n              const options: Options = {\n                quoted: await this.getQuotedMessage(body, instance),\n              };\n\n              const messageSent = await this.sendAttachment(\n                waInstance,\n                chatId,\n                attachment.data_url,\n                formatText,\n                options,\n              );\n              if (!messageSent && body.conversation?.id) {\n                this.onSendMessageError(instance, body.conversation?.id);\n              }\n\n              await this.updateChatwootMessageId(\n                {\n                  ...messageSent,\n                },\n                {\n                  messageId: body.id,\n                  inboxId: body.inbox?.id,\n                  conversationId: body.conversation?.id,\n                  contactInboxSourceId: body.conversation?.contact_inbox?.source_id,\n                },\n                instance,\n              );\n            }\n          } else {\n            const data: SendTextDto = {\n              number: chatId,\n              text: formatText,\n              delay: Math.floor(Math.random() * (2000 - 500 + 1)) + 500,\n              quoted: await this.getQuotedMessage(body, instance),\n            };\n\n            sendTelemetry('/message/sendText');\n\n            let messageSent: any;\n            try {\n              messageSent = await waInstance?.textMessage(data, true);\n              if (!messageSent) {\n                throw new Error('Message not sent');\n              }\n\n              if (Long.isLong(messageSent?.messageTimestamp)) {\n                messageSent.messageTimestamp = messageSent.messageTimestamp?.toNumber();\n              }\n\n              await this.updateChatwootMessageId(\n                {\n                  ...messageSent,\n                },\n                {\n                  messageId: body.id,\n                  inboxId: body.inbox?.id,\n                  conversationId: body.conversation?.id,\n                  contactInboxSourceId: body.conversation?.contact_inbox?.source_id,\n                },\n                instance,\n              );\n            } catch (error) {\n              if (!messageSent && body.conversation?.id) {\n                this.onSendMessageError(instance, body.conversation?.id, error);\n              }\n              throw error;\n            }\n          }\n        }\n\n        const chatwootRead = this.configService.get<Chatwoot>('CHATWOOT').MESSAGE_READ;\n        if (chatwootRead) {\n          const lastMessage = await this.prismaRepository.message.findFirst({\n            where: {\n              key: {\n                path: ['fromMe'],\n                equals: false,\n              },\n              instanceId: instance.instanceId,\n            },\n          });\n          if (lastMessage && !lastMessage.chatwootIsRead) {\n            const key = lastMessage.key as WAMessageKey;\n\n            waInstance?.markMessageAsRead({\n              readMessages: [\n                {\n                  id: key.id,\n                  fromMe: key.fromMe,\n                  remoteJid: key.remoteJid,\n                },\n              ],\n            });\n            const updateMessage = {\n              chatwootMessageId: lastMessage.chatwootMessageId,\n              chatwootConversationId: lastMessage.chatwootConversationId,\n              chatwootInboxId: lastMessage.chatwootInboxId,\n              chatwootContactInboxSourceId: lastMessage.chatwootContactInboxSourceId,\n              chatwootIsRead: true,\n            };\n\n            await this.prismaRepository.message.updateMany({\n              where: {\n                instanceId: instance.instanceId,\n                key: {\n                  path: ['id'],\n                  equals: key.id,\n                },\n              },\n              data: updateMessage,\n            });\n          }\n        }\n      }\n\n      if (body.message_type === 'template' && body.event === 'message_created') {\n        const data: SendTextDto = {\n          number: chatId,\n          text: body.content.replace(/\\\\\\r\\n|\\\\\\n|\\n/g, '\\n'),\n          delay: Math.floor(Math.random() * (2000 - 500 + 1)) + 500,\n        };\n\n        sendTelemetry('/message/sendText');\n\n        await waInstance?.textMessage(data);\n      }\n\n      return { message: 'bot' };\n    } catch (error) {\n      this.logger.error(error);\n\n      return { message: 'bot' };\n    }\n  }\n\n  private async updateChatwootMessageId(\n    message: MessageModel,\n    chatwootMessageIds: ChatwootMessage,\n    instance: InstanceDto,\n  ) {\n    const key = message.key as WAMessageKey;\n\n    if (!chatwootMessageIds.messageId || !key?.id) {\n      return;\n    }\n\n    // Use raw SQL to avoid JSON path issues\n    const result = await this.prismaRepository.$executeRaw`\n      UPDATE \"Message\" \n      SET \n        \"chatwootMessageId\" = ${chatwootMessageIds.messageId},\n        \"chatwootConversationId\" = ${chatwootMessageIds.conversationId},\n        \"chatwootInboxId\" = ${chatwootMessageIds.inboxId},\n        \"chatwootContactInboxSourceId\" = ${chatwootMessageIds.contactInboxSourceId},\n        \"chatwootIsRead\" = ${chatwootMessageIds.isRead || false}\n      WHERE \"instanceId\" = ${instance.instanceId} \n      AND \"key\"->>'id' = ${key.id}\n    `;\n\n    this.logger.verbose(`Update result: ${result} rows affected`);\n\n    if (this.isImportHistoryAvailable()) {\n      try {\n        await chatwootImport.updateMessageSourceID(chatwootMessageIds.messageId, key.id);\n      } catch (error) {\n        this.logger.error(`Error updating Chatwoot message source ID: ${error}`);\n      }\n    }\n  }\n\n  private async getMessageByKeyId(instance: InstanceDto, keyId: string): Promise<MessageModel> {\n    // Use raw SQL query to avoid JSON path issues with Prisma\n    const messages = await this.prismaRepository.$queryRaw`\n      SELECT * FROM \"Message\" \n      WHERE \"instanceId\" = ${instance.instanceId} \n      AND \"key\"->>'id' = ${keyId}\n      LIMIT 1\n    `;\n\n    return (messages as MessageModel[])[0] || null;\n  }\n\n  private async getReplyToIds(\n    msg: any,\n    instance: InstanceDto,\n  ): Promise<{ in_reply_to: string; in_reply_to_external_id: string }> {\n    let inReplyTo = null;\n    let inReplyToExternalId = null;\n\n    if (msg) {\n      inReplyToExternalId = msg.message?.extendedTextMessage?.contextInfo?.stanzaId ?? msg.contextInfo?.stanzaId;\n      if (inReplyToExternalId) {\n        const message = await this.getMessageByKeyId(instance, inReplyToExternalId);\n        if (message?.chatwootMessageId) {\n          inReplyTo = message.chatwootMessageId;\n        }\n      }\n    }\n\n    return {\n      in_reply_to: inReplyTo,\n      in_reply_to_external_id: inReplyToExternalId,\n    };\n  }\n\n  private async getQuotedMessage(msg: any, instance: InstanceDto): Promise<Quoted> {\n    if (msg?.content_attributes?.in_reply_to) {\n      const message = await this.prismaRepository.message.findFirst({\n        where: {\n          chatwootMessageId: msg?.content_attributes?.in_reply_to,\n          instanceId: instance.instanceId,\n        },\n      });\n\n      const key = message?.key as WAMessageKey;\n      const messageContent = message?.message as WAMessageContent;\n\n      if (messageContent && key?.id) {\n        return {\n          key: key,\n          message: messageContent,\n        };\n      }\n    }\n\n    return null;\n  }\n\n  private isMediaMessage(message: any) {\n    const media = [\n      'imageMessage',\n      'documentMessage',\n      'documentWithCaptionMessage',\n      'audioMessage',\n      'videoMessage',\n      'stickerMessage',\n      'viewOnceMessageV2',\n    ];\n\n    const messageKeys = Object.keys(message);\n\n    const result = messageKeys.some((key) => media.includes(key));\n\n    return result;\n  }\n\n  private isInteractiveButtonMessage(messageType: string, message: any) {\n    return messageType === 'interactiveMessage' && message.interactiveMessage?.nativeFlowMessage?.buttons?.length > 0;\n  }\n\n  private getAdsMessage(msg: any) {\n    interface AdsMessage {\n      title: string;\n      body: string;\n      thumbnailUrl: string;\n      sourceUrl: string;\n    }\n\n    const adsMessage: AdsMessage | undefined = {\n      title: msg.extendedTextMessage?.contextInfo?.externalAdReply?.title || msg.contextInfo?.externalAdReply?.title,\n      body: msg.extendedTextMessage?.contextInfo?.externalAdReply?.body || msg.contextInfo?.externalAdReply?.body,\n      thumbnailUrl:\n        msg.extendedTextMessage?.contextInfo?.externalAdReply?.thumbnailUrl ||\n        msg.contextInfo?.externalAdReply?.thumbnailUrl,\n      sourceUrl:\n        msg.extendedTextMessage?.contextInfo?.externalAdReply?.sourceUrl || msg.contextInfo?.externalAdReply?.sourceUrl,\n    };\n\n    return adsMessage;\n  }\n\n  private getReactionMessage(msg: any) {\n    interface ReactionMessage {\n      key: {\n        id: string;\n        fromMe: boolean;\n        remoteJid: string;\n        participant?: string;\n      };\n      text: string;\n    }\n    const reactionMessage: ReactionMessage | undefined = msg?.reactionMessage;\n\n    return reactionMessage;\n  }\n\n  private getTypeMessage(msg: any) {\n    const types = {\n      conversation: msg.conversation,\n      imageMessage: msg.imageMessage?.caption,\n      videoMessage: msg.videoMessage?.caption,\n      extendedTextMessage: msg.extendedTextMessage?.text,\n      messageContextInfo: msg.messageContextInfo?.stanzaId,\n      stickerMessage: undefined,\n      documentMessage: msg.documentMessage?.caption,\n      documentWithCaptionMessage: msg.documentWithCaptionMessage?.message?.documentMessage?.caption,\n      audioMessage: msg.audioMessage ? (msg.audioMessage.caption ?? '') : undefined,\n      contactMessage: msg.contactMessage?.vcard,\n      contactsArrayMessage: msg.contactsArrayMessage,\n      locationMessage: msg.locationMessage,\n      liveLocationMessage: msg.liveLocationMessage,\n      listMessage: msg.listMessage,\n      listResponseMessage: msg.listResponseMessage,\n      viewOnceMessageV2:\n        msg?.message?.viewOnceMessageV2?.message?.imageMessage?.url ||\n        msg?.message?.viewOnceMessageV2?.message?.videoMessage?.url ||\n        msg?.message?.viewOnceMessageV2?.message?.audioMessage?.url,\n    };\n\n    return types;\n  }\n\n  private getMessageContent(types: any) {\n    const typeKey = Object.keys(types).find((key) => types[key] !== undefined);\n\n    let result = typeKey ? types[typeKey] : undefined;\n\n    // Remove externalAdReplyBody| in Chatwoot (Already Have)\n    if (result && typeof result === 'string' && result.includes('externalAdReplyBody|')) {\n      result = result.split('externalAdReplyBody|').filter(Boolean).join('');\n    }\n\n    if (typeKey === 'locationMessage' || typeKey === 'liveLocationMessage') {\n      const latitude = result.degreesLatitude;\n      const longitude = result.degreesLongitude;\n\n      const locationName = result?.name;\n      const locationAddress = result?.address;\n\n      const formattedLocation =\n        `*${i18next.t('cw.locationMessage.location')}:*\\n\\n` +\n        `_${i18next.t('cw.locationMessage.latitude')}:_ ${latitude} \\n` +\n        `_${i18next.t('cw.locationMessage.longitude')}:_ ${longitude} \\n` +\n        (locationName ? `_${i18next.t('cw.locationMessage.locationName')}:_ ${locationName}\\n` : '') +\n        (locationAddress ? `_${i18next.t('cw.locationMessage.locationAddress')}:_ ${locationAddress} \\n` : '') +\n        `_${i18next.t('cw.locationMessage.locationUrl')}:_ ` +\n        `https://www.google.com/maps/search/?api=1&query=${latitude},${longitude}`;\n\n      return formattedLocation;\n    }\n\n    if (typeKey === 'contactMessage') {\n      const vCardData = result.split('\\n');\n      const contactInfo = {};\n\n      vCardData.forEach((line) => {\n        const [key, value] = line.split(':');\n        if (key && value) {\n          contactInfo[key] = value;\n        }\n      });\n\n      let formattedContact =\n        `*${i18next.t('cw.contactMessage.contact')}:*\\n\\n` +\n        `_${i18next.t('cw.contactMessage.name')}:_ ${contactInfo['FN']}`;\n\n      let numberCount = 1;\n      Object.keys(contactInfo).forEach((key) => {\n        if (key.startsWith('item') && key.includes('TEL')) {\n          const phoneNumber = contactInfo[key];\n          formattedContact += `\\n_${i18next.t('cw.contactMessage.number')} (${numberCount}):_ ${phoneNumber}`;\n          numberCount++;\n        } else if (key.includes('TEL')) {\n          const phoneNumber = contactInfo[key];\n          formattedContact += `\\n_${i18next.t('cw.contactMessage.number')} (${numberCount}):_ ${phoneNumber}`;\n          numberCount++;\n        }\n      });\n\n      return formattedContact;\n    }\n\n    if (typeKey === 'contactsArrayMessage') {\n      const formattedContacts = result.contacts.map((contact) => {\n        const vCardData = contact.vcard.split('\\n');\n        const contactInfo = {};\n\n        vCardData.forEach((line) => {\n          const [key, value] = line.split(':');\n          if (key && value) {\n            contactInfo[key] = value;\n          }\n        });\n\n        let formattedContact = `*${i18next.t('cw.contactMessage.contact')}:*\\n\\n_${i18next.t(\n          'cw.contactMessage.name',\n        )}:_ ${contact.displayName}`;\n\n        let numberCount = 1;\n        Object.keys(contactInfo).forEach((key) => {\n          if (key.startsWith('item') && key.includes('TEL')) {\n            const phoneNumber = contactInfo[key];\n            formattedContact += `\\n_${i18next.t('cw.contactMessage.number')} (${numberCount}):_ ${phoneNumber}`;\n            numberCount++;\n          } else if (key.includes('TEL')) {\n            const phoneNumber = contactInfo[key];\n            formattedContact += `\\n_${i18next.t('cw.contactMessage.number')} (${numberCount}):_ ${phoneNumber}`;\n            numberCount++;\n          }\n        });\n\n        return formattedContact;\n      });\n\n      const formattedContactsArray = formattedContacts.join('\\n\\n');\n\n      return formattedContactsArray;\n    }\n\n    if (typeKey === 'listMessage') {\n      const listTitle = result?.title || 'Unknown';\n      const listDescription = result?.description || 'Unknown';\n      const listFooter = result?.footerText || 'Unknown';\n\n      let formattedList =\n        '*List Menu:*\\n\\n' +\n        '_Title_: ' +\n        listTitle +\n        '\\n' +\n        '_Description_: ' +\n        listDescription +\n        '\\n' +\n        '_Footer_: ' +\n        listFooter;\n\n      if (result.sections && result.sections.length > 0) {\n        result.sections.forEach((section, sectionIndex) => {\n          formattedList += '\\n\\n*Section ' + (sectionIndex + 1) + ':* ' + section.title || 'Unknown\\n';\n\n          if (section.rows && section.rows.length > 0) {\n            section.rows.forEach((row, rowIndex) => {\n              formattedList += '\\n*Line ' + (rowIndex + 1) + ':*\\n';\n              formattedList += '_ Title:_ ' + (row.title || 'Unknown') + '\\n';\n              formattedList += '_ Description:_ ' + (row.description || 'Unknown') + '\\n';\n              formattedList += '_ ID:_ ' + (row.rowId || 'Unknown') + '\\n';\n            });\n          } else {\n            formattedList += '\\nNo lines found in this section.\\n';\n          }\n        });\n      } else {\n        formattedList += '\\nNo sections found.\\n';\n      }\n\n      return formattedList;\n    }\n\n    if (typeKey === 'listResponseMessage') {\n      const responseTitle = result?.title || 'Unknown';\n      const responseDescription = result?.description || 'Unknown';\n      const responseRowId = result?.singleSelectReply?.selectedRowId || 'Unknown';\n\n      const formattedResponseList =\n        '*List Response:*\\n\\n' +\n        '_Title_: ' +\n        responseTitle +\n        '\\n' +\n        '_Description_: ' +\n        responseDescription +\n        '\\n' +\n        '_ID_: ' +\n        responseRowId;\n      return formattedResponseList;\n    }\n\n    return result;\n  }\n\n  public getConversationMessage(msg: any) {\n    const types = this.getTypeMessage(msg);\n\n    const messageContent = this.getMessageContent(types);\n\n    return messageContent;\n  }\n\n  public async eventWhatsapp(event: string, instance: InstanceDto, body: any) {\n    try {\n      const waInstance = this.waMonitor.waInstances[instance.instanceName];\n\n      if (!waInstance) {\n        this.logger.warn('wa instance not found');\n        return null;\n      }\n\n      const client = await this.clientCw(instance);\n\n      if (!client) {\n        this.logger.warn('client not found');\n        return null;\n      }\n\n      if (this.provider?.ignoreJids && this.provider?.ignoreJids.length > 0) {\n        const ignoreJids: any = this.provider?.ignoreJids;\n\n        let ignoreGroups = false;\n        let ignoreContacts = false;\n\n        if (ignoreJids.includes('@g.us')) {\n          ignoreGroups = true;\n        }\n\n        if (ignoreJids.includes('@s.whatsapp.net')) {\n          ignoreContacts = true;\n        }\n\n        if (ignoreGroups && body?.key?.remoteJid.endsWith('@g.us')) {\n          this.logger.warn('Ignoring message from group: ' + body?.key?.remoteJid);\n          return;\n        }\n\n        if (ignoreContacts && body?.key?.remoteJid.endsWith('@s.whatsapp.net')) {\n          this.logger.warn('Ignoring message from contact: ' + body?.key?.remoteJid);\n          return;\n        }\n\n        if (ignoreJids.includes(body?.key?.remoteJid)) {\n          this.logger.warn('Ignoring message from jid: ' + body?.key?.remoteJid);\n          return;\n        }\n      }\n\n      if (event === 'messages.upsert' || event === 'send.message') {\n        this.logger.info(`[${event}] New message received - Instance: ${JSON.stringify(body, null, 2)}`);\n        if (body.key.remoteJid === 'status@broadcast') {\n          return;\n        }\n\n        if (body.message?.ephemeralMessage?.message) {\n          body.message = {\n            ...body.message?.ephemeralMessage?.message,\n          };\n        }\n\n        const originalMessage = await this.getConversationMessage(body.message);\n        const bodyMessage = originalMessage\n          ? originalMessage\n              .replaceAll(/\\*((?!\\s)([^\\n*]+?)(?<!\\s))\\*/g, '**$1**')\n              .replaceAll(/_((?!\\s)([^\\n_]+?)(?<!\\s))_/g, '*$1*')\n              .replaceAll(/~((?!\\s)([^\\n~]+?)(?<!\\s))~/g, '~~$1~~')\n          : originalMessage;\n\n        if (bodyMessage && bodyMessage.includes('/survey/responses/') && bodyMessage.includes('http')) {\n          return;\n        }\n\n        const quotedId = body.contextInfo?.stanzaId || body.message?.contextInfo?.stanzaId;\n\n        let quotedMsg = null;\n\n        if (quotedId)\n          quotedMsg = await this.prismaRepository.message.findFirst({\n            where: {\n              key: {\n                path: ['id'],\n                equals: quotedId,\n              },\n              chatwootMessageId: {\n                not: null,\n              },\n            },\n          });\n\n        const isMedia = this.isMediaMessage(body.message);\n\n        const adsMessage = this.getAdsMessage(body);\n\n        const reactionMessage = this.getReactionMessage(body.message);\n        const isInteractiveButtonMessage = this.isInteractiveButtonMessage(body.messageType, body.message);\n\n        if (!bodyMessage && !isMedia && !reactionMessage && !isInteractiveButtonMessage) {\n          this.logger.warn('no body message found');\n          return;\n        }\n\n        const getConversation = await this.createConversation(instance, body);\n\n        if (!getConversation) {\n          this.logger.warn('conversation not found');\n          return;\n        }\n\n        const messageType = body.key.fromMe ? 'outgoing' : 'incoming';\n\n        if (isMedia) {\n          const downloadBase64 = await waInstance?.getBase64FromMediaMessage({\n            message: {\n              ...body,\n            },\n          });\n\n          let nameFile: string;\n          const messageBody = body?.message[body?.messageType];\n          const originalFilename =\n            messageBody?.fileName || messageBody?.filename || messageBody?.message?.documentMessage?.fileName;\n          if (originalFilename) {\n            const parsedFile = path.parse(originalFilename);\n            if (parsedFile.name && parsedFile.ext) {\n              nameFile = `${parsedFile.name}-${Math.floor(Math.random() * (99 - 10 + 1) + 10)}${parsedFile.ext}`;\n            }\n          }\n\n          if (!nameFile) {\n            nameFile = `${Math.random().toString(36).substring(7)}.${mimeTypes.extension(downloadBase64.mimetype) || ''}`;\n          }\n\n          const fileData = Buffer.from(downloadBase64.base64, 'base64');\n\n          const fileStream = new Readable();\n          fileStream._read = () => {};\n          fileStream.push(fileData);\n          fileStream.push(null);\n\n          if (body.key.remoteJid.includes('@g.us')) {\n            const participantName = body.pushName;\n            const rawPhoneNumber =\n              body.key.addressingMode === 'lid' && !body.key.fromMe && body.key.participantAlt\n                ? body.key.participantAlt.split('@')[0].split(':')[0]\n                : body.key.participant.split('@')[0].split(':')[0];\n            const formattedPhoneNumber = parsePhoneNumberFromString(`+${rawPhoneNumber}`).formatInternational();\n\n            let content: string;\n\n            if (!body.key.fromMe) {\n              content = bodyMessage\n                ? `**${formattedPhoneNumber} - ${participantName}:**\\n\\n${bodyMessage}`\n                : `**${formattedPhoneNumber} - ${participantName}:**`;\n            } else {\n              content = bodyMessage || '';\n            }\n\n            const send = await this.sendData(\n              getConversation,\n              fileStream,\n              nameFile,\n              messageType,\n              content,\n              instance,\n              body,\n              'WAID:' + body.key.id,\n              quotedMsg,\n            );\n\n            if (!send) {\n              this.logger.warn('message not sent');\n              return;\n            }\n\n            return send;\n          } else {\n            const send = await this.sendData(\n              getConversation,\n              fileStream,\n              nameFile,\n              messageType,\n              bodyMessage,\n              instance,\n              body,\n              'WAID:' + body.key.id,\n              quotedMsg,\n            );\n\n            if (!send) {\n              this.logger.warn('message not sent');\n              return;\n            }\n\n            return send;\n          }\n        }\n\n        if (reactionMessage) {\n          if (reactionMessage.text) {\n            const send = await this.createMessage(\n              instance,\n              getConversation,\n              reactionMessage.text,\n              messageType,\n              false,\n              [],\n              {\n                message: { extendedTextMessage: { contextInfo: { stanzaId: reactionMessage.key.id } } },\n              },\n              'WAID:' + body.key.id,\n              quotedMsg,\n            );\n            if (!send) {\n              this.logger.warn('message not sent');\n              return;\n            }\n          }\n\n          return;\n        }\n\n        if (isInteractiveButtonMessage) {\n          const buttons = body.message.interactiveMessage.nativeFlowMessage.buttons;\n          this.logger.info('is Interactive Button Message: ' + JSON.stringify(buttons));\n\n          for (const button of buttons) {\n            const buttonParams = JSON.parse(button.buttonParamsJson);\n            const paymentSettings = buttonParams.payment_settings;\n\n            if (button.name === 'payment_info' && paymentSettings[0].type === 'pix_static_code') {\n              const pixSettings = paymentSettings[0].pix_static_code;\n              const pixKeyType = (() => {\n                switch (pixSettings.key_type) {\n                  case 'EVP':\n                    return 'Chave Aleatria';\n                  case 'EMAIL':\n                    return 'E-mail';\n                  case 'PHONE':\n                    return 'Telefone';\n                  default:\n                    return pixSettings.key_type;\n                }\n              })();\n              const pixKey = pixSettings.key_type === 'PHONE' ? pixSettings.key.replace('+55', '') : pixSettings.key;\n              const content = `*${pixSettings.merchant_name}*\\nChave PIX: ${pixKey} (${pixKeyType})`;\n\n              const send = await this.createMessage(\n                instance,\n                getConversation,\n                content,\n                messageType,\n                false,\n                [],\n                body,\n                'WAID:' + body.key.id,\n                quotedMsg,\n              );\n              if (!send) this.logger.warn('message not sent');\n            } else {\n              this.logger.warn('Interactive Button Message not mapped');\n            }\n          }\n          return;\n        }\n\n        const isAdsMessage = (adsMessage && adsMessage.title) || adsMessage.body || adsMessage.thumbnailUrl;\n        if (isAdsMessage) {\n          const imgBuffer = await axios.get(adsMessage.thumbnailUrl, { responseType: 'arraybuffer' });\n\n          const extension = mimeTypes.extension(imgBuffer.headers['content-type']);\n          const mimeType = extension && mimeTypes.lookup(extension);\n\n          if (!mimeType) {\n            this.logger.warn('mimetype of Ads message not found');\n            return;\n          }\n\n          const random = Math.random().toString(36).substring(7);\n          const nameFile = `${random}.${mimeTypes.extension(mimeType)}`;\n          const fileData = Buffer.from(imgBuffer.data, 'binary');\n\n          const img = await Jimp.read(fileData);\n          await img.cover({\n            w: 320,\n            h: 180,\n          });\n          const processedBuffer = await img.getBuffer(JimpMime.png);\n\n          const fileStream = new Readable();\n          fileStream._read = () => {}; // _read is required but you can noop it\n          fileStream.push(processedBuffer);\n          fileStream.push(null);\n\n          const truncStr = (str: string, len: number) => {\n            if (!str) return '';\n\n            return str.length > len ? str.substring(0, len) + '...' : str;\n          };\n\n          const title = truncStr(adsMessage.title, 40);\n          const description = truncStr(adsMessage?.body, 75);\n\n          const send = await this.sendData(\n            getConversation,\n            fileStream,\n            nameFile,\n            messageType,\n            `${bodyMessage}\\n\\n\\n**${title}**\\n${description}\\n${adsMessage.sourceUrl}`,\n            instance,\n            body,\n            'WAID:' + body.key.id,\n          );\n\n          if (!send) {\n            this.logger.warn('message not sent');\n            return;\n          }\n\n          return send;\n        }\n\n        if (body.key.remoteJid.includes('@g.us')) {\n          const participantName = body.pushName;\n          const rawPhoneNumber =\n            body.key.addressingMode === 'lid' && !body.key.fromMe && body.key.participantAlt\n              ? body.key.participantAlt.split('@')[0].split(':')[0]\n              : body.key.participant.split('@')[0].split(':')[0];\n          const formattedPhoneNumber = parsePhoneNumberFromString(`+${rawPhoneNumber}`).formatInternational();\n\n          let content: string;\n\n          if (!body.key.fromMe) {\n            content = `**${formattedPhoneNumber} - ${participantName}:**\\n\\n${bodyMessage}`;\n          } else {\n            content = `${bodyMessage}`;\n          }\n\n          const send = await this.createMessage(\n            instance,\n            getConversation,\n            content,\n            messageType,\n            false,\n            [],\n            body,\n            'WAID:' + body.key.id,\n            quotedMsg,\n          );\n\n          if (!send) {\n            this.logger.warn('message not sent');\n            return;\n          }\n\n          return send;\n        } else {\n          const send = await this.createMessage(\n            instance,\n            getConversation,\n            bodyMessage,\n            messageType,\n            false,\n            [],\n            body,\n            'WAID:' + body.key.id,\n            quotedMsg,\n          );\n\n          if (!send) {\n            this.logger.warn('message not sent');\n            return;\n          }\n\n          return send;\n        }\n      }\n\n      if (event === Events.MESSAGES_DELETE) {\n        const chatwootDelete = this.configService.get<Chatwoot>('CHATWOOT').MESSAGE_DELETE;\n\n        if (chatwootDelete === true) {\n          if (!body?.key?.id) {\n            this.logger.warn('message id not found');\n            return;\n          }\n\n          const message = await this.getMessageByKeyId(instance, body.key.id);\n\n          if (message?.chatwootMessageId && message?.chatwootConversationId) {\n            await this.prismaRepository.message.deleteMany({\n              where: {\n                key: {\n                  path: ['id'],\n                  equals: body.key.id,\n                },\n                instanceId: instance.instanceId,\n              },\n            });\n\n            return await client.messages.delete({\n              accountId: this.provider.accountId,\n              conversationId: message.chatwootConversationId,\n              messageId: message.chatwootMessageId,\n            });\n          }\n        }\n      }\n\n      if (event === 'messages.edit' || event === 'send.message.update') {\n        const editedMessageContentRaw =\n          body?.editedMessage?.conversation ??\n          body?.editedMessage?.extendedTextMessage?.text ??\n          body?.editedMessage?.imageMessage?.caption ??\n          body?.editedMessage?.videoMessage?.caption ??\n          body?.editedMessage?.documentMessage?.caption ??\n          (typeof body?.text === 'string' ? body.text : undefined);\n\n        const editedMessageContent = (editedMessageContentRaw ?? '').trim();\n\n        if (!editedMessageContent) {\n          this.logger.info('[CW.EDIT] Contedo vazio  ignorando (DELETE tratar se for revoke).');\n          return;\n        }\n\n        const message = await this.getMessageByKeyId(instance, body?.key?.id);\n\n        if (!message) {\n          this.logger.warn('Message not found for edit event');\n          return;\n        }\n\n        const key = message.key as WAMessageKey;\n\n        const messageType = key?.fromMe ? 'outgoing' : 'incoming';\n\n        if (message && message.chatwootConversationId && message.chatwootMessageId) {\n          // Criar nova mensagem com formato: \"Mensagem editada:\\n\\nteste1\"\n          const editedText = `\\n\\n\\`${i18next.t('cw.message.edited')}:\\`\\n\\n${editedMessageContent}`;\n\n          const send = await this.createMessage(\n            instance,\n            message.chatwootConversationId,\n            editedText,\n            messageType,\n            false,\n            [],\n            {\n              message: { extendedTextMessage: { contextInfo: { stanzaId: key.id } } },\n            },\n            'WAID:' + body.key.id,\n            null,\n          );\n          if (!send) {\n            this.logger.warn('edited message not sent');\n            return;\n          }\n        }\n        return;\n      }\n\n      if (event === 'messages.read') {\n        if (!body?.key?.id || !body?.key?.remoteJid) {\n          this.logger.warn('message id not found');\n          return;\n        }\n\n        const message = await this.getMessageByKeyId(instance, body.key.id);\n        const conversationId = message?.chatwootConversationId;\n        const contactInboxSourceId = message?.chatwootContactInboxSourceId;\n\n        if (conversationId) {\n          let sourceId = contactInboxSourceId;\n          const inbox = (await this.getInbox(instance)) as inbox & {\n            inbox_identifier?: string;\n          };\n\n          if (!sourceId && inbox) {\n            const conversation = (await client.conversations.get({\n              accountId: this.provider.accountId,\n              conversationId: conversationId,\n            })) as conversation_show & {\n              last_non_activity_message: { conversation: { contact_inbox: contact_inboxes } };\n            };\n            sourceId = conversation.last_non_activity_message?.conversation?.contact_inbox?.source_id;\n          }\n\n          if (sourceId && inbox?.inbox_identifier) {\n            const url =\n              `/public/api/v1/inboxes/${inbox.inbox_identifier}/contacts/${sourceId}` +\n              `/conversations/${conversationId}/update_last_seen`;\n            await chatwootRequest(this.getClientCwConfig(), {\n              method: 'POST',\n              url: url,\n            });\n          }\n        }\n        return;\n      }\n\n      if (event === 'status.instance') {\n        const data = body;\n        const inbox = await this.getInbox(instance);\n\n        if (!inbox) {\n          this.logger.warn('inbox not found');\n          return;\n        }\n\n        const msgStatus = i18next.t('cw.inbox.status', {\n          inboxName: inbox.name,\n          state: data.status,\n        });\n\n        await this.createBotMessage(instance, msgStatus, 'incoming');\n      }\n\n      if (event === 'connection.update' && body.status === 'open') {\n        const waInstance = this.waMonitor.waInstances[instance.instanceName];\n        if (!waInstance) return;\n\n        const now = Date.now();\n        const timeSinceLastNotification = now - (waInstance.lastConnectionNotification || 0);\n\n        // Se a conexo foi estabelecida via QR code, notifica imediatamente.\n        if (waInstance.qrCode && waInstance.qrCode.count > 0) {\n          const msgConnection = i18next.t('cw.inbox.connected');\n          await this.createBotMessage(instance, msgConnection, 'incoming');\n          waInstance.qrCode.count = 0;\n          waInstance.lastConnectionNotification = now;\n          chatwootImport.clearAll(instance);\n        }\n        // Se no foi via QR code, verifica o throttling.\n        else if (timeSinceLastNotification >= 30000) {\n          const msgConnection = i18next.t('cw.inbox.connected');\n          await this.createBotMessage(instance, msgConnection, 'incoming');\n          waInstance.lastConnectionNotification = now;\n        } else {\n          this.logger.warn(\n            `Connection notification skipped for ${instance.instanceName} - too frequent (${timeSinceLastNotification}ms since last)`,\n          );\n        }\n      }\n\n      if (event === 'qrcode.updated') {\n        if (body.statusCode === 500) {\n          const erroQRcode = ` ${i18next.t('qrlimitreached')}`;\n          return await this.createBotMessage(instance, erroQRcode, 'incoming');\n        } else {\n          const fileData = Buffer.from(body?.qrcode.base64.replace('data:image/png;base64,', ''), 'base64');\n\n          const fileStream = new Readable();\n          fileStream._read = () => {};\n          fileStream.push(fileData);\n          fileStream.push(null);\n\n          await this.createBotQr(\n            instance,\n            i18next.t('qrgeneratedsuccesfully'),\n            'incoming',\n            fileStream,\n            `${instance.instanceName}.png`,\n          );\n\n          let msgQrCode = `${i18next.t('qrgeneratedsuccesfully')}\\n\\n${i18next.t('scanqr')}`;\n\n          if (body?.qrcode?.pairingCode) {\n            msgQrCode =\n              msgQrCode +\n              `\\n\\n*Pairing Code:* ${body.qrcode.pairingCode.substring(0, 4)}-${body.qrcode.pairingCode.substring(\n                4,\n                8,\n              )}`;\n          }\n\n          await this.createBotMessage(instance, msgQrCode, 'incoming');\n        }\n      }\n    } catch (error) {\n      this.logger.error(error);\n    }\n  }\n\n  public normalizeJidIdentifier(remoteJid: string) {\n    if (!remoteJid) {\n      return '';\n    }\n    if (remoteJid.includes('@lid')) {\n      return remoteJid;\n    }\n    return remoteJid.replace(/:\\d+/, '').split('@')[0];\n  }\n\n  public startImportHistoryMessages(instance: InstanceDto) {\n    if (!this.isImportHistoryAvailable()) {\n      return;\n    }\n\n    this.createBotMessage(instance, i18next.t('cw.import.startImport'), 'incoming');\n  }\n\n  public isImportHistoryAvailable() {\n    const uri = this.configService.get<Chatwoot>('CHATWOOT').IMPORT.DATABASE.CONNECTION.URI;\n\n    return uri && uri !== 'postgres://user:password@hostname:port/dbname';\n  }\n\n  public addHistoryMessages(instance: InstanceDto, messagesRaw: MessageModel[]) {\n    if (!this.isImportHistoryAvailable()) {\n      return;\n    }\n\n    chatwootImport.addHistoryMessages(instance, messagesRaw);\n  }\n\n  public addHistoryContacts(instance: InstanceDto, contactsRaw: ContactModel[]) {\n    if (!this.isImportHistoryAvailable()) {\n      return;\n    }\n\n    return chatwootImport.addHistoryContacts(instance, contactsRaw);\n  }\n\n  public async importHistoryMessages(instance: InstanceDto) {\n    if (!this.isImportHistoryAvailable()) {\n      return;\n    }\n\n    this.createBotMessage(instance, i18next.t('cw.import.importingMessages'), 'incoming');\n\n    const totalMessagesImported = await chatwootImport.importHistoryMessages(\n      instance,\n      this,\n      await this.getInbox(instance),\n      this.provider,\n    );\n    this.updateContactAvatarInRecentConversations(instance);\n\n    const msg = Number.isInteger(totalMessagesImported)\n      ? i18next.t('cw.import.messagesImported', { totalMessagesImported })\n      : i18next.t('cw.import.messagesException');\n\n    this.createBotMessage(instance, msg, 'incoming');\n\n    return totalMessagesImported;\n  }\n\n  public async updateContactAvatarInRecentConversations(instance: InstanceDto, limitContacts = 100) {\n    try {\n      if (!this.isImportHistoryAvailable()) {\n        return;\n      }\n\n      const client = await this.clientCw(instance);\n      if (!client) {\n        this.logger.warn('client not found');\n        return null;\n      }\n\n      const inbox = await this.getInbox(instance);\n      if (!inbox) {\n        this.logger.warn('inbox not found');\n        return null;\n      }\n\n      const recentContacts = await chatwootImport.getContactsOrderByRecentConversations(\n        inbox,\n        this.provider,\n        limitContacts,\n      );\n\n      const contactIdentifiers = recentContacts\n        .map((contact) => contact.identifier)\n        .filter((identifier) => identifier !== null);\n\n      const contactsWithProfilePicture = (\n        await this.prismaRepository.contact.findMany({\n          where: {\n            instanceId: instance.instanceId,\n            id: {\n              in: contactIdentifiers,\n            },\n            profilePicUrl: {\n              not: null,\n            },\n          },\n        })\n      ).reduce((acc: Map<string, ContactModel>, contact: ContactModel) => acc.set(contact.id, contact), new Map());\n\n      recentContacts.forEach(async (contact) => {\n        if (contactsWithProfilePicture.has(contact.identifier)) {\n          client.contacts.update({\n            accountId: this.provider.accountId,\n            id: contact.id,\n            data: {\n              avatar_url: contactsWithProfilePicture.get(contact.identifier).profilePictureUrl || null,\n            },\n          });\n        }\n      });\n    } catch (error) {\n      this.logger.error(`Error on update avatar in recent conversations: ${error.toString()}`);\n    }\n  }\n\n  public async syncLostMessages(\n    instance: InstanceDto,\n    chatwootConfig: ChatwootDto,\n    prepareMessage: (message: any) => any,\n  ) {\n    try {\n      if (!this.isImportHistoryAvailable()) {\n        return;\n      }\n      if (!this.configService.get<Database>('DATABASE').SAVE_DATA.MESSAGE_UPDATE) {\n        return;\n      }\n\n      const inbox = await this.getInbox(instance);\n\n      const sqlMessages = `select * from messages m\n      where account_id = ${chatwootConfig.accountId}\n      and inbox_id = ${inbox.id}\n      and created_at >= now() - interval '6h'\n      order by created_at desc`;\n\n      const messagesData = (await this.pgClient.query(sqlMessages))?.rows;\n      const ids: string[] = messagesData\n        .filter((message) => !!message.source_id)\n        .map((message) => message.source_id.replace('WAID:', ''));\n\n      const savedMessages = await this.prismaRepository.message.findMany({\n        where: {\n          Instance: { name: instance.instanceName },\n          messageTimestamp: { gte: Number(dayjs().subtract(6, 'hours').unix()) },\n          AND: ids.map((id) => ({ key: { path: ['id'], not: id } })),\n        },\n      });\n\n      const filteredMessages = savedMessages.filter(\n        (msg: any) => !chatwootImport.isIgnorePhoneNumber(msg.key?.remoteJid),\n      );\n      const messagesRaw: any[] = [];\n      for (const m of filteredMessages) {\n        if (!m.message || !m.key || !m.messageTimestamp) {\n          continue;\n        }\n\n        if (Long.isLong(m?.messageTimestamp)) {\n          m.messageTimestamp = m.messageTimestamp?.toNumber();\n        }\n\n        messagesRaw.push(prepareMessage(m as any));\n      }\n\n      this.addHistoryMessages(\n        instance,\n        messagesRaw.filter((msg) => !chatwootImport.isIgnorePhoneNumber(msg.key?.remoteJid)),\n      );\n\n      await chatwootImport.importHistoryMessages(instance, this, inbox, this.provider);\n      const waInstance = this.waMonitor.waInstances[instance.instanceName];\n      waInstance.clearCacheChatwoot();\n    } catch {\n      return;\n    }\n  }\n}\n","import { InstanceDto } from '@api/dto/instance.dto';\nimport { PrismaRepository } from '@api/repository/repository.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { Integration } from '@api/types/wa.types';\nimport { ConfigService } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\nimport { IntegrationSession } from '@prisma/client';\n\n/**\n * Base class for all chatbot service implementations\n * Contains common methods shared across different chatbot integrations\n */\nexport abstract class BaseChatbotService<BotType = any, SettingsType = any> {\n  protected readonly logger: Logger;\n  protected readonly waMonitor: WAMonitoringService;\n  protected readonly prismaRepository: PrismaRepository;\n  protected readonly configService?: ConfigService;\n\n  constructor(\n    waMonitor: WAMonitoringService,\n    prismaRepository: PrismaRepository,\n    loggerName: string,\n    configService?: ConfigService,\n  ) {\n    this.waMonitor = waMonitor;\n    this.prismaRepository = prismaRepository;\n    this.logger = new Logger(loggerName);\n    this.configService = configService;\n  }\n\n  /**\n   * Check if a message contains an image\n   */\n  protected isImageMessage(content: string): boolean {\n    return content.includes('imageMessage');\n  }\n\n  /**\n   * Check if a message contains audio\n   */\n  protected isAudioMessage(content: string): boolean {\n    return content.includes('audioMessage');\n  }\n\n  /**\n   * Check if a string is valid JSON\n   */\n  protected isJSON(str: string): boolean {\n    try {\n      JSON.parse(str);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Determine the media type from a URL based on its extension\n   */\n  protected getMediaType(url: string): string | null {\n    const extension = url.split('.').pop()?.toLowerCase();\n    const imageExtensions = ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp'];\n    const audioExtensions = ['mp3', 'wav', 'aac', 'ogg'];\n    const videoExtensions = ['mp4', 'avi', 'mkv', 'mov'];\n    const documentExtensions = ['pdf', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx', 'txt'];\n\n    if (imageExtensions.includes(extension || '')) return 'image';\n    if (audioExtensions.includes(extension || '')) return 'audio';\n    if (videoExtensions.includes(extension || '')) return 'video';\n    if (documentExtensions.includes(extension || '')) return 'document';\n    return null;\n  }\n\n  /**\n   * Create a new chatbot session\n   */\n  public async createNewSession(instance: InstanceDto | any, data: any, type: string) {\n    try {\n      // Extract pushName safely - if data.pushName is an object with a pushName property, use that\n      const pushNameValue =\n        typeof data.pushName === 'object' && data.pushName?.pushName\n          ? data.pushName.pushName\n          : typeof data.pushName === 'string'\n            ? data.pushName\n            : null;\n\n      // Extract remoteJid safely\n      const remoteJidValue =\n        typeof data.remoteJid === 'object' && data.remoteJid?.remoteJid ? data.remoteJid.remoteJid : data.remoteJid;\n\n      const session = await this.prismaRepository.integrationSession.create({\n        data: {\n          remoteJid: remoteJidValue,\n          pushName: pushNameValue,\n          sessionId: remoteJidValue,\n          status: 'opened',\n          awaitUser: false,\n          botId: data.botId,\n          instanceId: instance.instanceId,\n          type: type,\n        },\n      });\n\n      return { session };\n    } catch (error) {\n      this.logger.error(error);\n      return;\n    }\n  }\n\n  /**\n   * Standard implementation for processing incoming messages\n   * This handles the common workflow across all chatbot types:\n   * 1. Check for existing session or create new one\n   * 2. Handle message based on session state\n   */\n  public async process(\n    instance: any,\n    remoteJid: string,\n    bot: BotType,\n    session: IntegrationSession,\n    settings: SettingsType,\n    content: string,\n    pushName?: string,\n    msg?: any,\n  ): Promise<void> {\n    try {\n      // For new sessions or sessions awaiting initialization\n      if (!session) {\n        await this.initNewSession(instance, remoteJid, bot, settings, session, content, pushName, msg);\n        return;\n      }\n\n      // If session is paused, ignore the message\n      if (session.status === 'paused') {\n        return;\n      }\n\n      // For existing sessions, keywords might indicate the conversation should end\n      const keywordFinish = (settings as any)?.keywordFinish || '';\n      const normalizedContent = content.toLowerCase().trim();\n      if (keywordFinish.length > 0 && normalizedContent === keywordFinish.toLowerCase()) {\n        // Update session to closed and return\n        await this.prismaRepository.integrationSession.update({\n          where: {\n            id: session.id,\n          },\n          data: {\n            status: 'closed',\n          },\n        });\n        return;\n      }\n\n      // Forward the message to the chatbot API\n      await this.sendMessageToBot(instance, session, settings, bot, remoteJid, pushName || '', content, msg);\n\n      // Update session to indicate we're waiting for user response\n      await this.prismaRepository.integrationSession.update({\n        where: {\n          id: session.id,\n        },\n        data: {\n          status: 'opened',\n          awaitUser: true,\n        },\n      });\n    } catch (error) {\n      this.logger.error(`Error in process: ${error}`);\n      return;\n    }\n  }\n\n  /**\n   * Standard implementation for sending messages to WhatsApp\n   * This handles common patterns like markdown links and formatting\n   */\n  protected async sendMessageWhatsApp(\n    instance: any,\n    remoteJid: string,\n    message: string,\n    settings: SettingsType,\n    linkPreview: boolean = true,\n  ): Promise<void> {\n    if (!message) return;\n\n    const linkRegex = /!?\\[(.*?)\\]\\((.*?)\\)/g;\n    let textBuffer = '';\n    let lastIndex = 0;\n    let match: RegExpExecArray | null;\n\n    const splitMessages = (settings as any)?.splitMessages ?? false;\n\n    while ((match = linkRegex.exec(message)) !== null) {\n      const [fullMatch, altText, url] = match;\n      const mediaType = this.getMediaType(url);\n      const beforeText = message.slice(lastIndex, match.index);\n\n      if (beforeText) {\n        textBuffer += beforeText;\n      }\n\n      if (mediaType) {\n        // Send accumulated text before sending media\n        if (textBuffer.trim()) {\n          await this.sendFormattedText(instance, remoteJid, textBuffer.trim(), settings, splitMessages, linkPreview);\n          textBuffer = '';\n        }\n\n        // Handle sending the media\n        try {\n          if (mediaType === 'audio') {\n            await instance.audioWhatsapp({\n              number: remoteJid.includes('@lid') ? remoteJid : remoteJid.split('@')[0],\n              delay: (settings as any)?.delayMessage || 1000,\n              audio: url,\n              caption: altText,\n            });\n          } else {\n            await instance.mediaMessage(\n              {\n                number: remoteJid.includes('@lid') ? remoteJid : remoteJid.split('@')[0],\n                delay: (settings as any)?.delayMessage || 1000,\n                mediatype: mediaType,\n                media: url,\n                caption: altText,\n                fileName: mediaType === 'document' ? altText || 'document' : undefined,\n              },\n              null,\n              false,\n            );\n          }\n        } catch (error) {\n          this.logger.error(`Error sending media: ${error}`);\n          // If media fails, at least send the alt text and URL\n          textBuffer += `${altText}: ${url}`;\n        }\n      } else {\n        // It's a regular link, keep it in the text\n        textBuffer += fullMatch;\n      }\n\n      lastIndex = linkRegex.lastIndex;\n    }\n\n    // Add any remaining text after the last match\n    if (lastIndex < message.length) {\n      const remainingText = message.slice(lastIndex);\n      if (remainingText.trim()) {\n        textBuffer += remainingText;\n      }\n    }\n\n    // Send any remaining text\n    if (textBuffer.trim()) {\n      await this.sendFormattedText(instance, remoteJid, textBuffer.trim(), settings, splitMessages, linkPreview);\n    }\n  }\n\n  /**\n   * Split message by double line breaks and return array of message parts\n   */\n  private splitMessageByDoubleLineBreaks(message: string): string[] {\n    return message.split('\\n\\n').filter((part) => part.trim().length > 0);\n  }\n\n  /**\n   * Send a single message with proper typing indicators and delays\n   */\n  private async sendSingleMessage(\n    instance: any,\n    remoteJid: string,\n    message: string,\n    settings: any,\n    linkPreview: boolean = true,\n  ): Promise<void> {\n    const timePerChar = settings?.timePerChar ?? 0;\n    const minDelay = 1000;\n    const maxDelay = 20000;\n    const delay = Math.min(Math.max(message.length * timePerChar, minDelay), maxDelay);\n\n    this.logger.debug(`[BaseChatbot] Sending single message with linkPreview: ${linkPreview}`);\n\n    if (instance.integration === Integration.WHATSAPP_BAILEYS) {\n      await instance.client.presenceSubscribe(remoteJid);\n      await instance.client.sendPresenceUpdate('composing', remoteJid);\n    }\n\n    await new Promise<void>((resolve) => {\n      setTimeout(async () => {\n        await instance.textMessage(\n          {\n            number: remoteJid.includes('@lid') ? remoteJid : remoteJid.split('@')[0],\n            delay: settings?.delayMessage || 1000,\n            text: message,\n            linkPreview,\n          },\n          false,\n        );\n        resolve();\n      }, delay);\n    });\n\n    if (instance.integration === Integration.WHATSAPP_BAILEYS) {\n      await instance.client.sendPresenceUpdate('paused', remoteJid);\n    }\n  }\n\n  /**\n   * Helper method to send formatted text with proper typing indicators and delays\n   */\n  private async sendFormattedText(\n    instance: any,\n    remoteJid: string,\n    text: string,\n    settings: any,\n    splitMessages: boolean,\n    linkPreview: boolean = true,\n  ): Promise<void> {\n    if (splitMessages) {\n      const messageParts = this.splitMessageByDoubleLineBreaks(text);\n\n      this.logger.debug(`[BaseChatbot] Splitting message into ${messageParts.length} parts`);\n\n      for (let index = 0; index < messageParts.length; index++) {\n        const message = messageParts[index];\n\n        this.logger.debug(`[BaseChatbot] Sending message part ${index + 1}/${messageParts.length}`);\n        await this.sendSingleMessage(instance, remoteJid, message, settings, linkPreview);\n      }\n\n      this.logger.debug(`[BaseChatbot] All message parts sent successfully`);\n    } else {\n      this.logger.debug(`[BaseChatbot] Sending single message`);\n      await this.sendSingleMessage(instance, remoteJid, text, settings, linkPreview);\n    }\n  }\n\n  /**\n   * Standard implementation for initializing a new session\n   * This method should be overridden if a subclass needs specific initialization\n   */\n  protected async initNewSession(\n    instance: any,\n    remoteJid: string,\n    bot: BotType,\n    settings: SettingsType,\n    session: IntegrationSession,\n    content: string,\n    pushName?: string | any,\n    msg?: any,\n  ): Promise<void> {\n    // Create a session if none exists\n    if (!session) {\n      // Extract pushName properly - if it's an object with pushName property, use that\n      const pushNameValue =\n        typeof pushName === 'object' && pushName?.pushName\n          ? pushName.pushName\n          : typeof pushName === 'string'\n            ? pushName\n            : null;\n\n      const sessionResult = await this.createNewSession(\n        {\n          instanceName: instance.instanceName,\n          instanceId: instance.instanceId,\n        },\n        {\n          remoteJid,\n          pushName: pushNameValue,\n          botId: (bot as any).id,\n        },\n        this.getBotType(),\n      );\n\n      if (!sessionResult || !sessionResult.session) {\n        this.logger.error('Failed to create new session');\n        return;\n      }\n\n      session = sessionResult.session;\n    }\n\n    // Update session status to opened\n    await this.prismaRepository.integrationSession.update({\n      where: {\n        id: session.id,\n      },\n      data: {\n        status: 'opened',\n        awaitUser: false,\n      },\n    });\n\n    // Forward the message to the chatbot\n    await this.sendMessageToBot(instance, session, settings, bot, remoteJid, pushName || '', content, msg);\n  }\n\n  /**\n   * Get the bot type identifier (e.g., 'dify', 'n8n', 'evoai')\n   * This should match the type field used in the IntegrationSession\n   */\n  protected abstract getBotType(): string;\n\n  /**\n   * Send a message to the chatbot API\n   * This is specific to each chatbot integration\n   */\n  protected abstract sendMessageToBot(\n    instance: any,\n    session: IntegrationSession,\n    settings: SettingsType,\n    bot: BotType,\n    remoteJid: string,\n    pushName: string,\n    content: string,\n    msg?: any,\n  ): Promise<void>;\n}\n","import { PrismaRepository } from '@api/repository/repository.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { Integration } from '@api/types/wa.types';\nimport { ConfigService, HttpServer } from '@config/env.config';\nimport { Dify, DifySetting, IntegrationSession } from '@prisma/client';\nimport axios from 'axios';\nimport { isURL } from 'class-validator';\n\nimport { BaseChatbotService } from '../../base-chatbot.service';\nimport { OpenaiService } from '../../openai/services/openai.service';\n\nexport class DifyService extends BaseChatbotService<Dify, DifySetting> {\n  private openaiService: OpenaiService;\n\n  constructor(\n    waMonitor: WAMonitoringService,\n    prismaRepository: PrismaRepository,\n    configService: ConfigService,\n    openaiService: OpenaiService,\n  ) {\n    super(waMonitor, prismaRepository, 'DifyService', configService);\n    this.openaiService = openaiService;\n  }\n\n  /**\n   * Return the bot type for Dify\n   */\n  protected getBotType(): string {\n    return 'dify';\n  }\n\n  protected async sendMessageToBot(\n    instance: any,\n    session: IntegrationSession,\n    settings: DifySetting,\n    dify: Dify,\n    remoteJid: string,\n    pushName: string,\n    content: string,\n    msg?: any,\n  ): Promise<void> {\n    try {\n      let endpoint: string = dify.apiUrl;\n\n      if (!endpoint) {\n        this.logger.error('No Dify endpoint defined');\n        return;\n      }\n\n      // Handle audio messages - transcribe using OpenAI Whisper\n      let processedContent = content;\n      if (this.isAudioMessage(content) && msg) {\n        try {\n          this.logger.debug(`[Dify] Downloading audio for Whisper transcription`);\n          const transcription = await this.openaiService.speechToText(msg, instance);\n          if (transcription) {\n            processedContent = `[audio] ${transcription}`;\n          }\n        } catch (err) {\n          this.logger.error(`[Dify] Failed to transcribe audio: ${err}`);\n        }\n      }\n\n      if (dify.botType === 'chatBot') {\n        endpoint += '/chat-messages';\n        const payload: any = {\n          inputs: {\n            remoteJid: remoteJid,\n            pushName: pushName,\n            instanceName: instance.instanceName,\n            serverUrl: this.configService.get<HttpServer>('SERVER').URL,\n            apiKey: instance.token,\n          },\n          query: processedContent,\n          response_mode: 'blocking',\n          conversation_id: session.sessionId === remoteJid ? undefined : session.sessionId,\n          user: remoteJid,\n        };\n\n        // Handle image messages\n        if (this.isImageMessage(content)) {\n          const media = content.split('|');\n\n          if (msg.message.mediaUrl || msg.message.base64) {\n            let mediaBase64 = msg.message.base64 || null;\n\n            if (msg.message.mediaUrl && isURL(msg.message.mediaUrl)) {\n              const result = await axios.get(msg.message.mediaUrl, { responseType: 'arraybuffer' });\n              mediaBase64 = Buffer.from(result.data).toString('base64');\n            }\n\n            if (mediaBase64) {\n              payload.files = [\n                {\n                  type: 'image',\n                  transfer_method: 'remote_url',\n                  url: mediaBase64,\n                },\n              ];\n            }\n          } else {\n            payload.files = [\n              {\n                type: 'image',\n                transfer_method: 'remote_url',\n                url: media[1].split('?')[0],\n              },\n            ];\n          }\n          payload.query = media[2] || content;\n        }\n\n        if (instance.integration === Integration.WHATSAPP_BAILEYS) {\n          await instance.client.presenceSubscribe(remoteJid);\n          await instance.client.sendPresenceUpdate('composing', remoteJid);\n        }\n\n        const response = await axios.post(endpoint, payload, {\n          headers: {\n            Authorization: `Bearer ${dify.apiKey}`,\n          },\n        });\n\n        if (instance.integration === Integration.WHATSAPP_BAILEYS)\n          await instance.client.sendPresenceUpdate('paused', remoteJid);\n\n        const message = response?.data?.answer;\n        const conversationId = response?.data?.conversation_id;\n\n        if (message) {\n          await this.sendMessageWhatsApp(instance, remoteJid, message, settings, true);\n        }\n\n        await this.prismaRepository.integrationSession.update({\n          where: {\n            id: session.id,\n          },\n          data: {\n            status: 'opened',\n            awaitUser: true,\n            sessionId: session.sessionId === remoteJid ? conversationId : session.sessionId,\n          },\n        });\n      }\n\n      if (dify.botType === 'textGenerator') {\n        endpoint += '/completion-messages';\n        const payload: any = {\n          inputs: {\n            query: processedContent,\n            pushName: pushName,\n            remoteJid: remoteJid,\n            instanceName: instance.instanceName,\n            serverUrl: this.configService.get<HttpServer>('SERVER').URL,\n            apiKey: instance.token,\n          },\n          response_mode: 'blocking',\n          conversation_id: session.sessionId === remoteJid ? undefined : session.sessionId,\n          user: remoteJid,\n        };\n\n        // Handle image messages\n        if (this.isImageMessage(content)) {\n          const media = content.split('|');\n\n          if (msg.message.mediaUrl || msg.message.base64) {\n            let mediaBase64 = msg.message.base64 || null;\n\n            if (msg.message.mediaUrl && isURL(msg.message.mediaUrl)) {\n              const result = await axios.get(msg.message.mediaUrl, { responseType: 'arraybuffer' });\n              mediaBase64 = Buffer.from(result.data).toString('base64');\n            }\n\n            if (mediaBase64) {\n              payload.files = [\n                {\n                  type: 'image',\n                  transfer_method: 'remote_url',\n                  url: mediaBase64,\n                },\n              ];\n            }\n          } else {\n            payload.files = [\n              {\n                type: 'image',\n                transfer_method: 'remote_url',\n                url: media[1].split('?')[0],\n              },\n            ];\n            payload.inputs.query = media[2] || content;\n          }\n        }\n\n        if (instance.integration === Integration.WHATSAPP_BAILEYS) {\n          await instance.client.presenceSubscribe(remoteJid);\n          await instance.client.sendPresenceUpdate('composing', remoteJid);\n        }\n\n        const response = await axios.post(endpoint, payload, {\n          headers: {\n            Authorization: `Bearer ${dify.apiKey}`,\n          },\n        });\n\n        if (instance.integration === Integration.WHATSAPP_BAILEYS)\n          await instance.client.sendPresenceUpdate('paused', remoteJid);\n\n        const message = response?.data?.answer;\n        const conversationId = response?.data?.conversation_id;\n\n        if (message) {\n          await this.sendMessageWhatsApp(instance, remoteJid, message, settings, true);\n        }\n\n        await this.prismaRepository.integrationSession.update({\n          where: {\n            id: session.id,\n          },\n          data: {\n            status: 'opened',\n            awaitUser: true,\n            sessionId: session.sessionId === remoteJid ? conversationId : session.sessionId,\n          },\n        });\n      }\n\n      if (dify.botType === 'agent') {\n        endpoint += '/chat-messages';\n        const payload: any = {\n          inputs: {\n            remoteJid: remoteJid,\n            pushName: pushName,\n            instanceName: instance.instanceName,\n            serverUrl: this.configService.get<HttpServer>('SERVER').URL,\n            apiKey: instance.token,\n          },\n          query: processedContent,\n          response_mode: 'streaming',\n          conversation_id: session.sessionId === remoteJid ? undefined : session.sessionId,\n          user: remoteJid,\n        };\n\n        // Handle image messages\n        if (this.isImageMessage(content)) {\n          const media = content.split('|');\n\n          if (msg.message.mediaUrl || msg.message.base64) {\n            payload.files = [\n              {\n                type: 'image',\n                transfer_method: 'remote_url',\n                url: msg.message.mediaUrl || msg.message.base64,\n              },\n            ];\n          } else {\n            payload.files = [\n              {\n                type: 'image',\n                transfer_method: 'remote_url',\n                url: media[1].split('?')[0],\n              },\n            ];\n            payload.query = media[2] || content;\n          }\n        }\n\n        if (instance.integration === Integration.WHATSAPP_BAILEYS) {\n          await instance.client.presenceSubscribe(remoteJid);\n          await instance.client.sendPresenceUpdate('composing', remoteJid);\n        }\n\n        const response = await axios.post(endpoint, payload, {\n          headers: {\n            Authorization: `Bearer ${dify.apiKey}`,\n          },\n        });\n\n        let conversationId;\n        let answer = '';\n\n        const data = response.data.replaceAll('data: ', '');\n        const events = data.split('\\n').filter((line) => line.trim() !== '');\n\n        for (const eventString of events) {\n          if (eventString.trim().startsWith('{')) {\n            const event = JSON.parse(eventString);\n\n            if (event?.event === 'agent_message') {\n              console.log('event:', event);\n              conversationId = conversationId ?? event?.conversation_id;\n              answer += event?.answer;\n            }\n          }\n        }\n\n        if (instance.integration === Integration.WHATSAPP_BAILEYS)\n          await instance.client.sendPresenceUpdate('paused', remoteJid);\n\n        if (answer) {\n          await this.sendMessageWhatsApp(instance, remoteJid, answer, settings, true);\n        }\n\n        await this.prismaRepository.integrationSession.update({\n          where: {\n            id: session.id,\n          },\n          data: {\n            status: 'opened',\n            awaitUser: true,\n            sessionId: session.sessionId === remoteJid ? conversationId : session.sessionId,\n          },\n        });\n      }\n    } catch (error) {\n      this.logger.error(error.response?.data || error);\n      return;\n    }\n  }\n}\n","import { PrismaRepository } from '@api/repository/repository.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { Integration } from '@api/types/wa.types';\nimport { ConfigService, Language, Openai as OpenaiConfig } from '@config/env.config';\nimport { IntegrationSession, OpenaiBot, OpenaiSetting } from '@prisma/client';\nimport { sendTelemetry } from '@utils/sendTelemetry';\nimport axios from 'axios';\nimport { downloadMediaMessage } from 'baileys';\nimport { isURL } from 'class-validator';\nimport FormData from 'form-data';\nimport OpenAI from 'openai';\nimport P from 'pino';\n\nimport { BaseChatbotService } from '../../base-chatbot.service';\n\n/**\n * OpenAI service that extends the common BaseChatbotService\n * Handles both Assistant API and ChatCompletion API\n */\nexport class OpenaiService extends BaseChatbotService<OpenaiBot, OpenaiSetting> {\n  protected client: OpenAI;\n\n  constructor(waMonitor: WAMonitoringService, prismaRepository: PrismaRepository, configService: ConfigService) {\n    super(waMonitor, prismaRepository, 'OpenaiService', configService);\n  }\n\n  /**\n   * Return the bot type for OpenAI\n   */\n  protected getBotType(): string {\n    return 'openai';\n  }\n\n  /**\n   * Initialize the OpenAI client with the provided API key\n   */\n  protected initClient(apiKey: string) {\n    this.client = new OpenAI({ apiKey });\n    return this.client;\n  }\n\n  /**\n   * Process a message based on the bot type (assistant or chat completion)\n   */\n  public async process(\n    instance: any,\n    remoteJid: string,\n    openaiBot: OpenaiBot,\n    session: IntegrationSession,\n    settings: OpenaiSetting,\n    content: string,\n    pushName?: string,\n    msg?: any,\n  ): Promise<void> {\n    try {\n      this.logger.log(`Starting process for remoteJid: ${remoteJid}, bot type: ${openaiBot.botType}`);\n\n      // Handle audio message transcription\n      if (content.startsWith('audioMessage|') && msg) {\n        this.logger.log('Detected audio message, attempting to transcribe');\n\n        // Get OpenAI credentials for transcription\n        const creds = await this.prismaRepository.openaiCreds.findUnique({\n          where: { id: openaiBot.openaiCredsId },\n        });\n\n        if (!creds) {\n          this.logger.error(`OpenAI credentials not found. CredsId: ${openaiBot.openaiCredsId}`);\n          return;\n        }\n\n        // Initialize OpenAI client for transcription\n        this.initClient(creds.apiKey);\n\n        // Transcribe the audio\n        const transcription = await this.speechToText(msg, instance);\n\n        if (transcription) {\n          this.logger.log(`Audio transcribed: ${transcription}`);\n          // Replace the audio message identifier with the transcription\n          content = transcription;\n        } else {\n          this.logger.error('Failed to transcribe audio');\n          await this.sendMessageWhatsApp(\n            instance,\n            remoteJid,\n            \"Sorry, I couldn't transcribe your audio message. Could you please type your message instead?\",\n            settings,\n            true,\n          );\n          return;\n        }\n      } else {\n        // Get the OpenAI credentials\n        const creds = await this.prismaRepository.openaiCreds.findUnique({\n          where: { id: openaiBot.openaiCredsId },\n        });\n\n        if (!creds) {\n          this.logger.error(`OpenAI credentials not found. CredsId: ${openaiBot.openaiCredsId}`);\n          return;\n        }\n\n        // Initialize OpenAI client\n        this.initClient(creds.apiKey);\n      }\n\n      // Handle keyword finish\n      const keywordFinish = settings?.keywordFinish || '';\n      const normalizedContent = content.toLowerCase().trim();\n      if (keywordFinish.length > 0 && normalizedContent === keywordFinish.toLowerCase()) {\n        if (settings?.keepOpen) {\n          await this.prismaRepository.integrationSession.update({\n            where: {\n              id: session.id,\n            },\n            data: {\n              status: 'closed',\n            },\n          });\n        } else {\n          await this.prismaRepository.integrationSession.delete({\n            where: {\n              id: session.id,\n            },\n          });\n        }\n\n        await sendTelemetry('/openai/session/finish');\n        return;\n      }\n\n      // If session is new or doesn't exist\n      if (!session) {\n        const data = {\n          remoteJid,\n          pushName,\n          botId: openaiBot.id,\n        };\n\n        const createSession = await this.createNewSession(\n          { instanceName: instance.instanceName, instanceId: instance.instanceId },\n          data,\n          this.getBotType(),\n        );\n\n        await this.initNewSession(\n          instance,\n          remoteJid,\n          openaiBot,\n          settings,\n          createSession.session,\n          content,\n          pushName,\n          msg,\n        );\n\n        await sendTelemetry('/openai/session/start');\n        return;\n      }\n\n      // If session exists but is paused\n      if (session.status === 'paused') {\n        await this.prismaRepository.integrationSession.update({\n          where: {\n            id: session.id,\n          },\n          data: {\n            status: 'opened',\n            awaitUser: true,\n          },\n        });\n\n        return;\n      }\n\n      // Process with the appropriate API based on bot type\n      await this.sendMessageToBot(instance, session, settings, openaiBot, remoteJid, pushName || '', content, msg);\n    } catch (error) {\n      this.logger.error(`Error in process: ${error.message || JSON.stringify(error)}`);\n      return;\n    }\n  }\n\n  /**\n   * Send message to OpenAI - this handles both Assistant API and ChatCompletion API\n   */\n  protected async sendMessageToBot(\n    instance: any,\n    session: IntegrationSession,\n    settings: OpenaiSetting,\n    openaiBot: OpenaiBot,\n    remoteJid: string,\n    pushName: string,\n    content: string,\n    msg?: any,\n  ): Promise<void> {\n    this.logger.log(`Sending message to bot for remoteJid: ${remoteJid}, bot type: ${openaiBot.botType}`);\n\n    if (!this.client) {\n      this.logger.log('Client not initialized, initializing now');\n      const creds = await this.prismaRepository.openaiCreds.findUnique({\n        where: { id: openaiBot.openaiCredsId },\n      });\n\n      if (!creds) {\n        this.logger.error(`OpenAI credentials not found in sendMessageToBot. CredsId: ${openaiBot.openaiCredsId}`);\n        return;\n      }\n\n      this.initClient(creds.apiKey);\n    }\n\n    try {\n      let message: string;\n\n      // Handle different bot types\n      if (openaiBot.botType === 'assistant') {\n        this.logger.log('Processing with Assistant API');\n        message = await this.processAssistantMessage(\n          instance,\n          session,\n          openaiBot,\n          remoteJid,\n          pushName,\n          false, // Not fromMe\n          content,\n          msg,\n        );\n      } else {\n        this.logger.log('Processing with ChatCompletion API');\n        message = await this.processChatCompletionMessage(instance, openaiBot, remoteJid, content, msg);\n      }\n\n      this.logger.log(`Got response from OpenAI: ${message?.substring(0, 50)}${message?.length > 50 ? '...' : ''}`);\n\n      // Send the response\n      if (message) {\n        this.logger.log('Sending message to WhatsApp');\n        await this.sendMessageWhatsApp(instance, remoteJid, message, settings, true);\n      } else {\n        this.logger.error('No message to send to WhatsApp');\n      }\n\n      // Update session status\n      await this.prismaRepository.integrationSession.update({\n        where: {\n          id: session.id,\n        },\n        data: {\n          status: 'opened',\n          awaitUser: true,\n        },\n      });\n    } catch (error) {\n      this.logger.error(`Error in sendMessageToBot: ${error.message || JSON.stringify(error)}`);\n      if (error.response) {\n        this.logger.error(`API Response data: ${JSON.stringify(error.response.data || {})}`);\n      }\n      return;\n    }\n  }\n\n  /**\n   * Process message using the OpenAI Assistant API\n   */\n  private async processAssistantMessage(\n    instance: any,\n    session: IntegrationSession,\n    openaiBot: OpenaiBot,\n    remoteJid: string,\n    pushName: string,\n    fromMe: boolean,\n    content: string,\n    msg?: any,\n  ): Promise<string> {\n    const messageData: any = {\n      role: fromMe ? 'assistant' : 'user',\n      content: [{ type: 'text', text: content }],\n    };\n\n    // Handle image messages\n    if (this.isImageMessage(content)) {\n      const media = content.split('|');\n\n      if (msg.message.mediaUrl || msg.message.base64) {\n        let mediaBase64 = msg.message.base64 || null;\n\n        if (msg.message.mediaUrl && isURL(msg.message.mediaUrl)) {\n          const result = await axios.get(msg.message.mediaUrl, { responseType: 'arraybuffer' });\n          mediaBase64 = Buffer.from(result.data).toString('base64');\n        }\n\n        if (mediaBase64) {\n          messageData.content = [\n            { type: 'text', text: media[2] || content },\n            { type: 'image_url', image_url: { url: mediaBase64 } },\n          ];\n        }\n      } else {\n        const url = media[1].split('?')[0];\n\n        messageData.content = [\n          { type: 'text', text: media[2] || content },\n          {\n            type: 'image_url',\n            image_url: {\n              url: url,\n            },\n          },\n        ];\n      }\n    }\n\n    // Get thread ID from session or create new thread\n    let threadId = session.sessionId;\n\n    // Create a new thread if one doesn't exist or invalid format\n    if (!threadId || threadId === remoteJid) {\n      const newThread = await this.client.beta.threads.create();\n      threadId = newThread.id;\n\n      // Save the new thread ID to the session\n      await this.prismaRepository.integrationSession.update({\n        where: {\n          id: session.id,\n        },\n        data: {\n          sessionId: threadId,\n        },\n      });\n      this.logger.log(`Created new thread ID: ${threadId} for session: ${session.id}`);\n    }\n\n    // Add message to thread\n    await this.client.beta.threads.messages.create(threadId, messageData);\n\n    if (fromMe) {\n      sendTelemetry('/message/sendText');\n      return '';\n    }\n\n    // Run the assistant\n    const runAssistant = await this.client.beta.threads.runs.create(threadId, {\n      assistant_id: openaiBot.assistantId,\n    });\n\n    if (instance.integration === Integration.WHATSAPP_BAILEYS) {\n      await instance.client.presenceSubscribe(remoteJid);\n      await instance.client.sendPresenceUpdate('composing', remoteJid);\n    }\n\n    // Wait for the assistant to complete\n    const response = await this.getAIResponse(threadId, runAssistant.id, openaiBot.functionUrl, remoteJid, pushName);\n\n    if (instance.integration === Integration.WHATSAPP_BAILEYS) {\n      await instance.client.sendPresenceUpdate('paused', remoteJid);\n    }\n\n    // Extract the response text safely with type checking\n    let responseText = \"I couldn't generate a proper response. Please try again.\";\n    try {\n      const messages = response?.data || [];\n      if (messages.length > 0) {\n        const messageContent = messages[0]?.content || [];\n        if (messageContent.length > 0) {\n          const textContent = messageContent[0];\n          if (textContent && 'text' in textContent && textContent.text && 'value' in textContent.text) {\n            responseText = textContent.text.value;\n          }\n        }\n      }\n    } catch (error) {\n      this.logger.error(`Error extracting response text: ${error}`);\n    }\n\n    // Update session with the thread ID to ensure continuity\n    await this.prismaRepository.integrationSession.update({\n      where: {\n        id: session.id,\n      },\n      data: {\n        status: 'opened',\n        awaitUser: true,\n        sessionId: threadId, // Ensure thread ID is saved consistently\n      },\n    });\n\n    // Return fallback message if unable to extract text\n    return responseText;\n  }\n\n  /**\n   * Process message using the OpenAI ChatCompletion API\n   */\n  private async processChatCompletionMessage(\n    instance: any,\n    openaiBot: OpenaiBot,\n    remoteJid: string,\n    content: string,\n    msg?: any,\n  ): Promise<string> {\n    this.logger.log('Starting processChatCompletionMessage');\n\n    // Check if client is initialized\n    if (!this.client) {\n      this.logger.log('Client not initialized in processChatCompletionMessage, initializing now');\n      const creds = await this.prismaRepository.openaiCreds.findUnique({\n        where: { id: openaiBot.openaiCredsId },\n      });\n\n      if (!creds) {\n        this.logger.error(`OpenAI credentials not found. CredsId: ${openaiBot.openaiCredsId}`);\n        return 'Error: OpenAI credentials not found';\n      }\n\n      this.initClient(creds.apiKey);\n    }\n\n    // Check if model is defined\n    if (!openaiBot.model) {\n      this.logger.error('OpenAI model not defined');\n      return 'Error: OpenAI model not configured';\n    }\n\n    this.logger.log(`Using model: ${openaiBot.model}, max tokens: ${openaiBot.maxTokens || 500}`);\n\n    // Get existing conversation history from the session\n    const session = await this.prismaRepository.integrationSession.findFirst({\n      where: {\n        remoteJid,\n        botId: openaiBot.id,\n        status: 'opened',\n      },\n    });\n\n    let conversationHistory = [];\n\n    if (session && session.context) {\n      try {\n        const sessionData =\n          typeof session.context === 'string' ? JSON.parse(session.context as string) : session.context;\n\n        conversationHistory = sessionData.history || [];\n        this.logger.log(`Retrieved conversation history from session, ${conversationHistory.length} messages`);\n      } catch (error) {\n        this.logger.error(`Error parsing session context: ${error.message}`);\n        // Continue with empty history if we can't parse the session data\n        conversationHistory = [];\n      }\n    }\n\n    // Log bot data\n    this.logger.log(`Bot data - systemMessages: ${JSON.stringify(openaiBot.systemMessages || [])}`);\n    this.logger.log(`Bot data - assistantMessages: ${JSON.stringify(openaiBot.assistantMessages || [])}`);\n    this.logger.log(`Bot data - userMessages: ${JSON.stringify(openaiBot.userMessages || [])}`);\n\n    // Prepare system messages\n    const systemMessages: any = openaiBot.systemMessages || [];\n    const messagesSystem: any[] = systemMessages.map((message) => {\n      return {\n        role: 'system',\n        content: message,\n      };\n    });\n\n    // Prepare assistant messages\n    const assistantMessages: any = openaiBot.assistantMessages || [];\n    const messagesAssistant: any[] = assistantMessages.map((message) => {\n      return {\n        role: 'assistant',\n        content: message,\n      };\n    });\n\n    // Prepare user messages\n    const userMessages: any = openaiBot.userMessages || [];\n    const messagesUser: any[] = userMessages.map((message) => {\n      return {\n        role: 'user',\n        content: message,\n      };\n    });\n\n    // Prepare current message\n    const messageData: any = {\n      role: 'user',\n      content: [{ type: 'text', text: content }],\n    };\n\n    // Handle image messages\n    if (this.isImageMessage(content)) {\n      this.logger.log('Found image message');\n      const media = content.split('|');\n\n      if (msg.message.mediaUrl || msg.message.base64) {\n        messageData.content = [\n          { type: 'text', text: media[2] || content },\n          { type: 'image_url', image_url: { url: msg.message.base64 || msg.message.mediaUrl } },\n        ];\n      } else {\n        const url = media[1].split('?')[0];\n\n        messageData.content = [\n          { type: 'text', text: media[2] || content },\n          {\n            type: 'image_url',\n            image_url: {\n              url: url,\n            },\n          },\n        ];\n      }\n    }\n\n    // Combine all messages: system messages, pre-defined messages, conversation history, and current message\n    const messages: any[] = [\n      ...messagesSystem,\n      ...messagesAssistant,\n      ...messagesUser,\n      ...conversationHistory,\n      messageData,\n    ];\n\n    this.logger.log(`Final messages payload: ${JSON.stringify(messages)}`);\n\n    if (instance.integration === Integration.WHATSAPP_BAILEYS) {\n      this.logger.log('Setting typing indicator');\n      await instance.client.presenceSubscribe(remoteJid);\n      await instance.client.sendPresenceUpdate('composing', remoteJid);\n    }\n\n    // Send the request to OpenAI\n    try {\n      this.logger.log('Sending request to OpenAI API');\n      const completions = await this.client.chat.completions.create({\n        model: openaiBot.model,\n        messages: messages,\n        max_tokens: openaiBot.maxTokens || 500, // Add default if maxTokens is missing\n      });\n\n      if (instance.integration === Integration.WHATSAPP_BAILEYS) {\n        await instance.client.sendPresenceUpdate('paused', remoteJid);\n      }\n\n      const responseContent = completions.choices[0].message.content;\n      this.logger.log(`Received response from OpenAI: ${JSON.stringify(completions.choices[0])}`);\n\n      // Add the current exchange to the conversation history and update the session\n      conversationHistory.push(messageData);\n      conversationHistory.push({\n        role: 'assistant',\n        content: responseContent,\n      });\n\n      // Limit history length to avoid token limits (keep last 10 messages)\n      if (conversationHistory.length > 10) {\n        conversationHistory = conversationHistory.slice(conversationHistory.length - 10);\n      }\n\n      // Save the updated conversation history to the session\n      if (session) {\n        await this.prismaRepository.integrationSession.update({\n          where: { id: session.id },\n          data: {\n            context: JSON.stringify({\n              history: conversationHistory,\n            }),\n          },\n        });\n        this.logger.log(`Updated session with conversation history, now ${conversationHistory.length} messages`);\n      }\n\n      return responseContent;\n    } catch (error) {\n      this.logger.error(`Error calling OpenAI: ${error.message || JSON.stringify(error)}`);\n      if (error.response) {\n        this.logger.error(`API Response status: ${error.response.status}`);\n        this.logger.error(`API Response data: ${JSON.stringify(error.response.data || {})}`);\n      }\n      return `Sorry, there was an error: ${error.message || 'Unknown error'}`;\n    }\n  }\n\n  /**\n   * Wait for and retrieve the AI response\n   */\n  private async getAIResponse(\n    threadId: string,\n    runId: string,\n    functionUrl: string | null,\n    remoteJid: string,\n    pushName: string,\n  ) {\n    let status = await this.client.beta.threads.runs.retrieve(threadId, runId);\n\n    let maxRetries = 60; // 1 minute with 1s intervals\n    const checkInterval = 1000; // 1 second\n\n    while (\n      status.status !== 'completed' &&\n      status.status !== 'failed' &&\n      status.status !== 'cancelled' &&\n      status.status !== 'expired' &&\n      maxRetries > 0\n    ) {\n      await new Promise((resolve) => setTimeout(resolve, checkInterval));\n      status = await this.client.beta.threads.runs.retrieve(threadId, runId);\n\n      // Handle tool calls\n      if (status.status === 'requires_action' && status.required_action?.type === 'submit_tool_outputs') {\n        const toolCalls = status.required_action.submit_tool_outputs.tool_calls;\n        const toolOutputs = [];\n\n        for (const toolCall of toolCalls) {\n          if (functionUrl) {\n            try {\n              const payloadData = JSON.parse(toolCall.function.arguments);\n\n              // Add context\n              payloadData.remoteJid = remoteJid;\n              payloadData.pushName = pushName;\n\n              const response = await axios.post(functionUrl, {\n                functionName: toolCall.function.name,\n                functionArguments: payloadData,\n              });\n\n              toolOutputs.push({\n                tool_call_id: toolCall.id,\n                output: JSON.stringify(response.data),\n              });\n            } catch (error) {\n              this.logger.error(`Error calling function: ${error}`);\n              toolOutputs.push({\n                tool_call_id: toolCall.id,\n                output: JSON.stringify({ error: 'Function call failed' }),\n              });\n            }\n          } else {\n            toolOutputs.push({\n              tool_call_id: toolCall.id,\n              output: JSON.stringify({ error: 'No function URL configured' }),\n            });\n          }\n        }\n\n        await this.client.beta.threads.runs.submitToolOutputs(threadId, runId, {\n          tool_outputs: toolOutputs,\n        });\n      }\n\n      maxRetries--;\n    }\n\n    if (status.status === 'completed') {\n      const messages = await this.client.beta.threads.messages.list(threadId);\n      return messages;\n    } else {\n      this.logger.error(`Assistant run failed with status: ${status.status}`);\n      return { data: [{ content: [{ text: { value: 'Failed to get a response from the assistant.' } }] }] };\n    }\n  }\n\n  protected isImageMessage(content: string): boolean {\n    return content.includes('imageMessage');\n  }\n\n  /**\n   * Implementation of speech-to-text transcription for audio messages\n   */\n  public async speechToText(msg: any, instance: any): Promise<string | null> {\n    const settings = await this.prismaRepository.openaiSetting.findFirst({\n      where: {\n        instanceId: instance.instanceId,\n      },\n    });\n\n    if (!settings) {\n      this.logger.error(`OpenAI settings not found. InstanceId: ${instance.instanceId}`);\n      return null;\n    }\n\n    const creds = await this.prismaRepository.openaiCreds.findUnique({\n      where: { id: settings.openaiCredsId },\n    });\n\n    if (!creds) {\n      this.logger.error(`OpenAI credentials not found. CredsId: ${settings.openaiCredsId}`);\n      return null;\n    }\n\n    let audio: Buffer;\n\n    if (msg.message.mediaUrl) {\n      audio = await axios.get(msg.message.mediaUrl, { responseType: 'arraybuffer' }).then((response) => {\n        return Buffer.from(response.data, 'binary');\n      });\n    } else if (msg.message.base64) {\n      audio = Buffer.from(msg.message.base64, 'base64');\n    } else {\n      // Fallback for raw WhatsApp audio messages that need downloadMediaMessage\n      audio = await downloadMediaMessage(\n        { key: msg.key, message: msg?.message },\n        'buffer',\n        {},\n        {\n          logger: P({ level: 'error' }) as any,\n          reuploadRequest: instance,\n        },\n      );\n    }\n\n    const lang = this.configService.get<Language>('LANGUAGE').includes('pt')\n      ? 'pt'\n      : this.configService.get<Language>('LANGUAGE');\n\n    const formData = new FormData();\n    formData.append('file', audio, 'audio.ogg');\n    formData.append('model', 'whisper-1');\n    formData.append('language', lang);\n\n    const apiKey = creds?.apiKey || this.configService.get<OpenaiConfig>('OPENAI').API_KEY_GLOBAL;\n\n    const response = await axios.post('https://api.openai.com/v1/audio/transcriptions', formData, {\n      headers: {\n        'Content-Type': 'multipart/form-data',\n        Authorization: `Bearer ${apiKey}`,\n      },\n    });\n\n    return response?.data?.text;\n  }\n}\n","import { configService, S3 } from '@config/env.config';\n\nconst getTypeMessage = (msg: any) => {\n  let mediaId: string;\n\n  if (\n    configService.get<S3>('S3').ENABLE &&\n    (configService.get<S3>('S3').SAVE_VIDEO ||\n      (msg?.message?.videoMessage === undefined &&\n        msg?.message?.viewOnceMessageV2?.message?.videoMessage === undefined))\n  )\n    mediaId = msg.message?.mediaUrl;\n  else mediaId = msg.key?.id;\n\n  const types = {\n    conversation: msg?.message?.conversation,\n    extendedTextMessage: msg?.message?.extendedTextMessage?.text,\n    contactMessage: msg?.message?.contactMessage?.displayName,\n    locationMessage: msg?.message?.locationMessage?.degreesLatitude.toString(),\n    viewOnceMessageV2:\n      msg?.message?.viewOnceMessageV2?.message?.imageMessage?.url ||\n      msg?.message?.viewOnceMessageV2?.message?.videoMessage?.url ||\n      msg?.message?.viewOnceMessageV2?.message?.audioMessage?.url,\n    listResponseMessage: msg?.message?.listResponseMessage?.title || msg?.listResponseMessage?.title,\n    responseRowId: msg?.message?.listResponseMessage?.singleSelectReply?.selectedRowId,\n    templateButtonReplyMessage:\n      msg?.message?.templateButtonReplyMessage?.selectedId || msg?.message?.buttonsResponseMessage?.selectedButtonId,\n    // Medias\n    audioMessage: msg?.message?.speechToText\n      ? msg?.message?.speechToText\n      : msg?.message?.audioMessage\n        ? `audioMessage|${mediaId}`\n        : undefined,\n    imageMessage: msg?.message?.imageMessage\n      ? `imageMessage|${mediaId}${msg?.message?.imageMessage?.caption ? `|${msg?.message?.imageMessage?.caption}` : ''}`\n      : undefined,\n    videoMessage: msg?.message?.videoMessage\n      ? `videoMessage|${mediaId}${msg?.message?.videoMessage?.caption ? `|${msg?.message?.videoMessage?.caption}` : ''}`\n      : undefined,\n    documentMessage: msg?.message?.documentMessage\n      ? `documentMessage|${mediaId}${\n          msg?.message?.documentMessage?.caption ? `|${msg?.message?.documentMessage?.caption}` : ''\n        }`\n      : undefined,\n    documentWithCaptionMessage: msg?.message?.documentWithCaptionMessage?.message?.documentMessage\n      ? `documentWithCaptionMessage|${mediaId}${\n          msg?.message?.documentWithCaptionMessage?.message?.documentMessage?.caption\n            ? `|${msg?.message?.documentWithCaptionMessage?.message?.documentMessage?.caption}`\n            : ''\n        }`\n      : undefined,\n    externalAdReplyBody: msg?.contextInfo?.externalAdReply?.body\n      ? `externalAdReplyBody|${msg.contextInfo.externalAdReply.body}`\n      : undefined,\n  };\n\n  const messageType = Object.keys(types).find((key) => types[key] !== undefined) || 'unknown';\n\n  return { ...types, messageType };\n};\n\nconst getMessageContent = (types: any) => {\n  const typeKey = Object.keys(types).find((key) => key !== 'externalAdReplyBody' && types[key] !== undefined);\n\n  let result = typeKey ? types[typeKey] : undefined;\n\n  if (types.externalAdReplyBody) {\n    result = result ? `${result}\\n${types.externalAdReplyBody}` : types.externalAdReplyBody;\n  }\n\n  return result;\n};\n\nexport const getConversationMessage = (msg: any) => {\n  const types = getTypeMessage(msg);\n\n  const messageContent = getMessageContent(types);\n\n  return messageContent;\n};\n","import { PrismaRepository } from '@api/repository/repository.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { Events } from '@api/types/wa.types';\nimport { Auth, ConfigService, HttpServer, Typebot } from '@config/env.config';\nimport { Instance, IntegrationSession, Message, Typebot as TypebotModel } from '@prisma/client';\nimport { getConversationMessage } from '@utils/getConversationMessage';\nimport { sendTelemetry } from '@utils/sendTelemetry';\nimport axios from 'axios';\n\nimport { BaseChatbotService } from '../../base-chatbot.service';\nimport { OpenaiService } from '../../openai/services/openai.service';\n\nexport class TypebotService extends BaseChatbotService<TypebotModel, any> {\n  private openaiService: OpenaiService;\n\n  constructor(\n    waMonitor: WAMonitoringService,\n    configService: ConfigService,\n    prismaRepository: PrismaRepository,\n    openaiService: OpenaiService,\n  ) {\n    super(waMonitor, prismaRepository, 'TypebotService', configService);\n    this.openaiService = openaiService;\n  }\n\n  /**\n   * Get the bot type identifier\n   */\n  protected getBotType(): string {\n    return 'typebot';\n  }\n\n  /**\n   * Base class wrapper - calls the original processTypebot method\n   */\n  protected async sendMessageToBot(\n    instance: any,\n    session: IntegrationSession,\n    settings: any,\n    bot: TypebotModel,\n    remoteJid: string,\n    pushName: string,\n    content: string,\n    msg?: any,\n  ): Promise<void> {\n    // Map the base class call to the original processTypebot method\n    await this.processTypebot(\n      instance,\n      remoteJid,\n      msg,\n      session,\n      bot,\n      bot.url,\n      settings.expire,\n      bot.typebot,\n      settings.keywordFinish,\n      settings.delayMessage,\n      settings.unknownMessage,\n      settings.listeningFromMe,\n      settings.stopBotFromMe,\n      settings.keepOpen,\n      content,\n    );\n  }\n\n  /**\n   * Simplified wrapper for controller compatibility\n   */\n  public async processTypebotSimple(\n    instance: any,\n    remoteJid: string,\n    bot: TypebotModel,\n    session: IntegrationSession,\n    settings: any,\n    content: string,\n    pushName?: string,\n    msg?: any,\n  ): Promise<void> {\n    return this.process(instance, remoteJid, bot, session, settings, content, pushName, msg);\n  }\n\n  /**\n   * Create a new TypeBot session with prefilled variables\n   */\n  public async createNewSession(instance: Instance, data: any) {\n    if (data.remoteJid === 'status@broadcast') return;\n    const id = Math.floor(Math.random() * 10000000000).toString();\n\n    try {\n      const version = this.configService.get<Typebot>('TYPEBOT').API_VERSION;\n      let url: string;\n      let reqData: {};\n      if (version === 'latest') {\n        url = `${data.url}/api/v1/typebots/${data.typebot}/startChat`;\n\n        reqData = {\n          prefilledVariables: {\n            ...data.prefilledVariables,\n            remoteJid: data.remoteJid,\n            pushName: data.pushName || data.prefilledVariables?.pushName || '',\n            instanceName: instance.name,\n            serverUrl: this.configService.get<HttpServer>('SERVER').URL,\n            apiKey: this.configService.get<Auth>('AUTHENTICATION').API_KEY.KEY,\n            ownerJid: instance.number,\n          },\n        };\n      } else {\n        url = `${data.url}/api/v1/sendMessage`;\n\n        reqData = {\n          startParams: {\n            publicId: data.typebot,\n            prefilledVariables: {\n              ...data.prefilledVariables,\n              remoteJid: data.remoteJid,\n              pushName: data.pushName || data.prefilledVariables?.pushName || '',\n              instanceName: instance.name,\n              serverUrl: this.configService.get<HttpServer>('SERVER').URL,\n              apiKey: this.configService.get<Auth>('AUTHENTICATION').API_KEY.KEY,\n              ownerJid: instance.number,\n            },\n          },\n        };\n      }\n      const request = await axios.post(url, reqData);\n\n      let session = null;\n      if (request?.data?.sessionId) {\n        session = await this.prismaRepository.integrationSession.create({\n          data: {\n            remoteJid: data.remoteJid,\n            pushName: data.pushName || '',\n            sessionId: `${id}-${request.data.sessionId}`,\n            status: 'opened',\n            parameters: {\n              ...data.prefilledVariables,\n              remoteJid: data.remoteJid,\n              pushName: data.pushName || '',\n              instanceName: instance.name,\n              serverUrl: this.configService.get<HttpServer>('SERVER').URL,\n              apiKey: this.configService.get<Auth>('AUTHENTICATION').API_KEY.KEY,\n              ownerJid: instance.number,\n            },\n            awaitUser: false,\n            botId: data.botId,\n            type: 'typebot',\n            Instance: {\n              connect: {\n                id: instance.id,\n              },\n            },\n          },\n        });\n      }\n\n      const typebotData = {\n        remoteJid: data.remoteJid,\n        status: 'opened',\n        session,\n      };\n      this.waMonitor.waInstances[instance.name].sendDataWebhook(Events.TYPEBOT_CHANGE_STATUS, typebotData);\n\n      return { ...request.data, session };\n    } catch (error) {\n      this.logger.error(error);\n      return;\n    }\n  }\n\n  /**\n   * Send WhatsApp message with complex TypeBot formatting\n   */\n  public async sendWAMessage(\n    instanceDb: Instance,\n    session: IntegrationSession,\n    settings: {\n      expire: number;\n      keywordFinish: string;\n      delayMessage: number;\n      unknownMessage: string;\n      listeningFromMe: boolean;\n      stopBotFromMe: boolean;\n      keepOpen: boolean;\n    },\n    remoteJid: string,\n    messages: any,\n    input: any,\n    clientSideActions: any,\n  ) {\n    const waInstance = this.waMonitor.waInstances[instanceDb.name];\n    await this.processMessages(\n      waInstance,\n      session,\n      settings,\n      messages,\n      input,\n      clientSideActions,\n      this.applyFormatting.bind(this),\n      this.prismaRepository,\n    ).catch((err) => {\n      console.error('Erro ao processar mensagens:', err);\n    });\n  }\n\n  /**\n   * Apply rich text formatting for TypeBot messages\n   */\n  private applyFormatting(element: any): string {\n    let text = '';\n\n    if (element.text) {\n      text += element.text;\n    }\n\n    if (element.children && element.type !== 'a') {\n      for (const child of element.children) {\n        text += this.applyFormatting(child);\n      }\n    }\n\n    if (element.type === 'p' && element.type !== 'inline-variable') {\n      text = text.trim() + '\\n';\n    }\n\n    if (element.type === 'inline-variable') {\n      text = text.trim();\n    }\n\n    if (element.type === 'ol') {\n      text =\n        '\\n' +\n        text\n          .split('\\n')\n          .map((line, index) => (line ? `${index + 1}. ${line}` : ''))\n          .join('\\n');\n    }\n\n    if (element.type === 'li') {\n      text = text\n        .split('\\n')\n        .map((line) => (line ? `  ${line}` : ''))\n        .join('\\n');\n    }\n\n    let formats = '';\n\n    if (element.bold) {\n      formats += '*';\n    }\n\n    if (element.italic) {\n      formats += '_';\n    }\n\n    if (element.underline) {\n      formats += '~';\n    }\n\n    let formattedText = `${formats}${text}${formats.split('').reverse().join('')}`;\n\n    if (element.url) {\n      formattedText = element.children[0]?.text ? `[${formattedText}]\\n(${element.url})` : `${element.url}`;\n    }\n\n    return formattedText;\n  }\n\n  /**\n   * Process TypeBot messages with full feature support\n   */\n  private async processMessages(\n    instance: any,\n    session: IntegrationSession,\n    settings: {\n      expire: number;\n      keywordFinish: string;\n      delayMessage: number;\n      unknownMessage: string;\n      listeningFromMe: boolean;\n      stopBotFromMe: boolean;\n      keepOpen: boolean;\n    },\n    messages: any,\n    input: any,\n    clientSideActions: any,\n    applyFormatting: any,\n    prismaRepository: PrismaRepository,\n  ) {\n    // Helper function to find wait time\n    const findItemAndGetSecondsToWait = (array: any[], targetId: string) => {\n      if (!array) return null;\n\n      for (const item of array) {\n        if (item.lastBubbleBlockId === targetId) {\n          return item.wait?.secondsToWaitFor;\n        }\n      }\n      return null;\n    };\n\n    for (const message of messages) {\n      if (message.type === 'text') {\n        let formattedText = '';\n\n        for (const richText of message.content.richText) {\n          for (const element of richText.children) {\n            formattedText += applyFormatting(element);\n          }\n          formattedText += '\\n';\n        }\n\n        formattedText = formattedText.replace(/\\*\\*/g, '').replace(/__/, '').replace(/~~/, '').replace(/\\n$/, '');\n\n        formattedText = formattedText.replace(/\\n$/, '');\n\n        if (formattedText.includes('[list]')) {\n          await this.processListMessage(instance, formattedText, session.remoteJid);\n        } else if (formattedText.includes('[buttons]')) {\n          await this.processButtonMessage(instance, formattedText, session.remoteJid);\n        } else {\n          await this.sendMessageWhatsApp(instance, session.remoteJid, formattedText, settings, true);\n        }\n\n        sendTelemetry('/message/sendText');\n      }\n\n      if (message.type === 'image') {\n        await instance.mediaMessage(\n          {\n            number: session.remoteJid,\n            delay: settings?.delayMessage || 1000,\n            mediatype: 'image',\n            media: message.content.url,\n          },\n          null,\n          false,\n        );\n\n        sendTelemetry('/message/sendMedia');\n      }\n\n      if (message.type === 'video') {\n        await instance.mediaMessage(\n          {\n            number: session.remoteJid,\n            delay: settings?.delayMessage || 1000,\n            mediatype: 'video',\n            media: message.content.url,\n          },\n          null,\n          false,\n        );\n\n        sendTelemetry('/message/sendMedia');\n      }\n\n      if (message.type === 'audio') {\n        await instance.audioWhatsapp(\n          {\n            number: session.remoteJid,\n            delay: settings?.delayMessage || 1000,\n            encoding: true,\n            audio: message.content.url,\n          },\n          false,\n        );\n\n        sendTelemetry('/message/sendWhatsAppAudio');\n      }\n\n      const wait = findItemAndGetSecondsToWait(clientSideActions, message.id);\n\n      if (wait) {\n        await new Promise((resolve) => setTimeout(resolve, wait * 1000));\n      }\n    }\n\n    // Process input choices\n    if (input) {\n      if (input.type === 'choice input') {\n        let formattedText = '';\n\n        const items = input.items;\n\n        for (const item of items) {\n          formattedText += ` ${item.content}\\n`;\n        }\n\n        formattedText = formattedText.replace(/\\n$/, '');\n\n        if (formattedText.includes('[list]')) {\n          await this.processListMessage(instance, formattedText, session.remoteJid);\n        } else if (formattedText.includes('[buttons]')) {\n          await this.processButtonMessage(instance, formattedText, session.remoteJid);\n        } else {\n          await this.sendMessageWhatsApp(instance, session.remoteJid, formattedText, settings, true);\n        }\n\n        sendTelemetry('/message/sendText');\n      }\n\n      await prismaRepository.integrationSession.update({\n        where: {\n          id: session.id,\n        },\n        data: {\n          awaitUser: true,\n        },\n      });\n    } else {\n      let statusChange = 'closed';\n      if (!settings?.keepOpen) {\n        await prismaRepository.integrationSession.deleteMany({\n          where: {\n            id: session.id,\n          },\n        });\n        statusChange = 'delete';\n      } else {\n        await prismaRepository.integrationSession.update({\n          where: {\n            id: session.id,\n          },\n          data: {\n            status: 'closed',\n          },\n        });\n      }\n\n      const typebotData = {\n        remoteJid: session.remoteJid,\n        status: statusChange,\n        session,\n      };\n      instance.sendDataWebhook(Events.TYPEBOT_CHANGE_STATUS, typebotData);\n    }\n  }\n\n  /**\n   * Process list messages for WhatsApp\n   */\n  private async processListMessage(instance: any, formattedText: string, remoteJid: string) {\n    const listJson = {\n      number: remoteJid,\n      title: '',\n      description: '',\n      buttonText: '',\n      footerText: '',\n      sections: [],\n    };\n\n    const titleMatch = formattedText.match(/\\[title\\]([\\s\\S]*?)(?=\\[description\\])/);\n    const descriptionMatch = formattedText.match(/\\[description\\]([\\s\\S]*?)(?=\\[buttonText\\])/);\n    const buttonTextMatch = formattedText.match(/\\[buttonText\\]([\\s\\S]*?)(?=\\[footerText\\])/);\n    const footerTextMatch = formattedText.match(/\\[footerText\\]([\\s\\S]*?)(?=\\[menu\\])/);\n\n    if (titleMatch) listJson.title = titleMatch[1].trim();\n    if (descriptionMatch) listJson.description = descriptionMatch[1].trim();\n    if (buttonTextMatch) listJson.buttonText = buttonTextMatch[1].trim();\n    if (footerTextMatch) listJson.footerText = footerTextMatch[1].trim();\n\n    const menuContent = formattedText.match(/\\[menu\\]([\\s\\S]*?)\\[\\/menu\\]/)?.[1];\n    if (menuContent) {\n      const sections = menuContent.match(/\\[section\\]([\\s\\S]*?)(?=\\[section\\]|\\[\\/section\\]|\\[\\/menu\\])/g);\n      if (sections) {\n        sections.forEach((section) => {\n          const sectionTitle = section.match(/title: (.*?)(?:\\n|$)/)?.[1]?.trim();\n          const rows = section.match(/\\[row\\]([\\s\\S]*?)(?=\\[row\\]|\\[\\/row\\]|\\[\\/section\\]|\\[\\/menu\\])/g);\n\n          const sectionData = {\n            title: sectionTitle,\n            rows:\n              rows?.map((row) => ({\n                title: row.match(/title: (.*?)(?:\\n|$)/)?.[1]?.trim(),\n                description: row.match(/description: (.*?)(?:\\n|$)/)?.[1]?.trim(),\n                rowId: row.match(/rowId: (.*?)(?:\\n|$)/)?.[1]?.trim(),\n              })) || [],\n          };\n\n          listJson.sections.push(sectionData);\n        });\n      }\n    }\n\n    await instance.listMessage(listJson);\n  }\n\n  /**\n   * Process button messages for WhatsApp\n   */\n  private async processButtonMessage(instance: any, formattedText: string, remoteJid: string) {\n    const buttonJson = {\n      number: remoteJid,\n      thumbnailUrl: undefined,\n      title: '',\n      description: '',\n      footer: '',\n      buttons: [],\n    };\n\n    const thumbnailUrlMatch = formattedText.match(/\\[thumbnailUrl\\]([\\s\\S]*?)(?=\\[title\\])/);\n    const titleMatch = formattedText.match(/\\[title\\]([\\s\\S]*?)(?=\\[description\\])/);\n    const descriptionMatch = formattedText.match(/\\[description\\]([\\s\\S]*?)(?=\\[footer\\])/);\n    const footerMatch = formattedText.match(/\\[footer\\]([\\s\\S]*?)(?=\\[(?:reply|pix|copy|call|url))/);\n\n    if (titleMatch) buttonJson.title = titleMatch[1].trim();\n    if (thumbnailUrlMatch) buttonJson.thumbnailUrl = thumbnailUrlMatch[1].trim();\n    if (descriptionMatch) buttonJson.description = descriptionMatch[1].trim();\n    if (footerMatch) buttonJson.footer = footerMatch[1].trim();\n\n    const buttonTypes = {\n      reply: /\\[reply\\]([\\s\\S]*?)(?=\\[(?:reply|pix|copy|call|url)|$)/g,\n      pix: /\\[pix\\]([\\s\\S]*?)(?=\\[(?:reply|pix|copy|call|url)|$)/g,\n      copy: /\\[copy\\]([\\s\\S]*?)(?=\\[(?:reply|pix|copy|call|url)|$)/g,\n      call: /\\[call\\]([\\s\\S]*?)(?=\\[(?:reply|pix|copy|call|url)|$)/g,\n      url: /\\[url\\]([\\s\\S]*?)(?=\\[(?:reply|pix|copy|call|url)|$)/g,\n    };\n\n    for (const [type, pattern] of Object.entries(buttonTypes)) {\n      let match;\n      while ((match = pattern.exec(formattedText)) !== null) {\n        const content = match[1].trim();\n        const button: any = { type };\n\n        switch (type) {\n          case 'pix':\n            button.currency = content.match(/currency: (.*?)(?:\\n|$)/)?.[1]?.trim();\n            button.name = content.match(/name: (.*?)(?:\\n|$)/)?.[1]?.trim();\n            button.keyType = content.match(/keyType: (.*?)(?:\\n|$)/)?.[1]?.trim();\n            button.key = content.match(/key: (.*?)(?:\\n|$)/)?.[1]?.trim();\n            break;\n\n          case 'reply':\n            button.displayText = content.match(/displayText: (.*?)(?:\\n|$)/)?.[1]?.trim();\n            button.id = content.match(/id: (.*?)(?:\\n|$)/)?.[1]?.trim();\n            break;\n\n          case 'copy':\n            button.displayText = content.match(/displayText: (.*?)(?:\\n|$)/)?.[1]?.trim();\n            button.copyCode = content.match(/copyCode: (.*?)(?:\\n|$)/)?.[1]?.trim();\n            break;\n\n          case 'call':\n            button.displayText = content.match(/displayText: (.*?)(?:\\n|$)/)?.[1]?.trim();\n            button.phoneNumber = content.match(/phone: (.*?)(?:\\n|$)/)?.[1]?.trim();\n            break;\n\n          case 'url':\n            button.displayText = content.match(/displayText: (.*?)(?:\\n|$)/)?.[1]?.trim();\n            button.url = content.match(/url: (.*?)(?:\\n|$)/)?.[1]?.trim();\n            break;\n        }\n\n        if (Object.keys(button).length > 1) {\n          buttonJson.buttons.push(button);\n        }\n      }\n    }\n\n    await instance.buttonMessage(buttonJson);\n  }\n\n  /**\n   * Original TypeBot processing method with full functionality\n   */\n  public async processTypebot(\n    waInstance: any,\n    remoteJid: string,\n    msg: Message,\n    session: IntegrationSession,\n    findTypebot: TypebotModel,\n    url: string,\n    expire: number,\n    typebot: string,\n    keywordFinish: string,\n    delayMessage: number,\n    unknownMessage: string,\n    listeningFromMe: boolean,\n    stopBotFromMe: boolean,\n    keepOpen: boolean,\n    content: string,\n    prefilledVariables?: any,\n  ) {\n    // Get the database instance record\n    const instance = await this.prismaRepository.instance.findFirst({\n      where: {\n        name: waInstance.instanceName,\n      },\n    });\n\n    if (!instance) {\n      this.logger.error('Instance not found in database');\n      return;\n    }\n    // Handle session expiration\n    if (session && expire && expire > 0) {\n      const now = Date.now();\n      const sessionUpdatedAt = new Date(session.updatedAt).getTime();\n      const diff = now - sessionUpdatedAt;\n      const diffInMinutes = Math.floor(diff / 1000 / 60);\n\n      if (diffInMinutes > expire) {\n        if (keepOpen) {\n          await this.prismaRepository.integrationSession.update({\n            where: {\n              id: session.id,\n            },\n            data: {\n              status: 'closed',\n            },\n          });\n        } else {\n          await this.prismaRepository.integrationSession.deleteMany({\n            where: {\n              botId: findTypebot.id,\n              remoteJid: remoteJid,\n            },\n          });\n        }\n\n        const data = await this.createNewSession(instance, {\n          enabled: findTypebot?.enabled,\n          url: url,\n          typebot: typebot,\n          expire: expire,\n          keywordFinish: keywordFinish,\n          delayMessage: delayMessage,\n          unknownMessage: unknownMessage,\n          listeningFromMe: listeningFromMe,\n          remoteJid: remoteJid,\n          pushName: msg.pushName,\n          botId: findTypebot.id,\n          prefilledVariables: prefilledVariables,\n        });\n\n        if (data?.session) {\n          session = data.session;\n        }\n\n        if (!data?.messages || data.messages.length === 0) {\n          const content = getConversationMessage(msg.message);\n\n          if (!content) {\n            if (unknownMessage) {\n              await this.sendMessageWhatsApp(\n                waInstance,\n                remoteJid,\n                unknownMessage,\n                {\n                  delayMessage,\n                  expire,\n                  keywordFinish,\n                  listeningFromMe,\n                  stopBotFromMe,\n                  keepOpen,\n                  unknownMessage,\n                },\n                true,\n              );\n              sendTelemetry('/message/sendText');\n            }\n            return;\n          }\n\n          if (keywordFinish && content.toLowerCase() === keywordFinish.toLowerCase()) {\n            let statusChange = 'closed';\n            if (keepOpen) {\n              await this.prismaRepository.integrationSession.update({\n                where: {\n                  id: session.id,\n                },\n                data: {\n                  status: 'closed',\n                },\n              });\n            } else {\n              statusChange = 'delete';\n              await this.prismaRepository.integrationSession.deleteMany({\n                where: {\n                  botId: findTypebot.id,\n                  remoteJid: remoteJid,\n                },\n              });\n            }\n\n            const typebotData = {\n              remoteJid: remoteJid,\n              status: statusChange,\n              session,\n            };\n            waInstance.sendDataWebhook(Events.TYPEBOT_CHANGE_STATUS, typebotData);\n\n            return;\n          }\n\n          try {\n            const version = this.configService.get<Typebot>('TYPEBOT').API_VERSION;\n            let urlTypebot: string;\n            let reqData: {};\n            if (version === 'latest') {\n              urlTypebot = `${url}/api/v1/sessions/${data?.sessionId}/continueChat`;\n              reqData = {\n                message: content,\n              };\n            } else {\n              urlTypebot = `${url}/api/v1/sendMessage`;\n              reqData = {\n                message: content,\n                sessionId: data?.sessionId,\n              };\n            }\n\n            const request = await axios.post(urlTypebot, reqData);\n\n            await this.sendWAMessage(\n              instance,\n              session,\n              {\n                expire: expire,\n                keywordFinish: keywordFinish,\n                delayMessage: delayMessage,\n                unknownMessage: unknownMessage,\n                listeningFromMe: listeningFromMe,\n                stopBotFromMe: stopBotFromMe,\n                keepOpen: keepOpen,\n              },\n              remoteJid,\n              request?.data?.messages,\n              request?.data?.input,\n              request?.data?.clientSideActions,\n            );\n          } catch (error) {\n            this.logger.error(error);\n            return;\n          }\n        }\n\n        if (data?.messages && data.messages.length > 0) {\n          await this.sendWAMessage(\n            instance,\n            session,\n            {\n              expire: expire,\n              keywordFinish: keywordFinish,\n              delayMessage: delayMessage,\n              unknownMessage: unknownMessage,\n              listeningFromMe: listeningFromMe,\n              stopBotFromMe: stopBotFromMe,\n              keepOpen: keepOpen,\n            },\n            remoteJid,\n            data.messages,\n            data.input,\n            data.clientSideActions,\n          );\n        }\n\n        return;\n      }\n    }\n\n    if (session && session.status !== 'opened') {\n      return;\n    }\n\n    // Handle new sessions\n    if (!session) {\n      const data = await this.createNewSession(instance, {\n        enabled: findTypebot?.enabled,\n        url: url,\n        typebot: typebot,\n        expire: expire,\n        keywordFinish: keywordFinish,\n        delayMessage: delayMessage,\n        unknownMessage: unknownMessage,\n        listeningFromMe: listeningFromMe,\n        remoteJid: remoteJid,\n        pushName: msg?.pushName,\n        botId: findTypebot.id,\n        prefilledVariables: prefilledVariables,\n      });\n\n      if (data?.session) {\n        session = data.session;\n      }\n\n      if (data?.messages && data.messages.length > 0) {\n        await this.sendWAMessage(\n          instance,\n          session,\n          {\n            expire: expire,\n            keywordFinish: keywordFinish,\n            delayMessage: delayMessage,\n            unknownMessage: unknownMessage,\n            listeningFromMe: listeningFromMe,\n            stopBotFromMe: stopBotFromMe,\n            keepOpen: keepOpen,\n          },\n          remoteJid,\n          data.messages,\n          data.input,\n          data.clientSideActions,\n        );\n      }\n\n      if (!data?.messages || data.messages.length === 0) {\n        if (!content) {\n          if (unknownMessage) {\n            await this.sendMessageWhatsApp(\n              waInstance,\n              remoteJid,\n              unknownMessage,\n              {\n                delayMessage,\n                expire,\n                keywordFinish,\n                listeningFromMe,\n                stopBotFromMe,\n                keepOpen,\n                unknownMessage,\n              },\n              true,\n            );\n            sendTelemetry('/message/sendText');\n          }\n          return;\n        }\n\n        if (keywordFinish && content.toLowerCase() === keywordFinish.toLowerCase()) {\n          let statusChange = 'closed';\n          if (keepOpen) {\n            await this.prismaRepository.integrationSession.update({\n              where: {\n                id: session.id,\n              },\n              data: {\n                status: 'closed',\n              },\n            });\n          } else {\n            statusChange = 'delete';\n            await this.prismaRepository.integrationSession.deleteMany({\n              where: {\n                botId: findTypebot.id,\n                remoteJid: remoteJid,\n              },\n            });\n          }\n\n          const typebotData = {\n            remoteJid: remoteJid,\n            status: statusChange,\n            session,\n          };\n          waInstance.sendDataWebhook(Events.TYPEBOT_CHANGE_STATUS, typebotData);\n\n          return;\n        }\n\n        let request: any;\n        try {\n          const version = this.configService.get<Typebot>('TYPEBOT').API_VERSION;\n          let urlTypebot: string;\n          let reqData: {};\n          if (version === 'latest') {\n            urlTypebot = `${url}/api/v1/sessions/${data?.sessionId}/continueChat`;\n            reqData = {\n              message: content,\n            };\n          } else {\n            urlTypebot = `${url}/api/v1/sendMessage`;\n            reqData = {\n              message: content,\n              sessionId: data?.sessionId,\n            };\n          }\n          request = await axios.post(urlTypebot, reqData);\n\n          await this.sendWAMessage(\n            instance,\n            session,\n            {\n              expire: expire,\n              keywordFinish: keywordFinish,\n              delayMessage: delayMessage,\n              unknownMessage: unknownMessage,\n              listeningFromMe: listeningFromMe,\n              stopBotFromMe: stopBotFromMe,\n              keepOpen: keepOpen,\n            },\n            remoteJid,\n            request?.data?.messages,\n            request?.data?.input,\n            request?.data?.clientSideActions,\n          );\n        } catch (error) {\n          this.logger.error(error);\n          return;\n        }\n      }\n      return;\n    }\n\n    // Update existing session\n    await this.prismaRepository.integrationSession.update({\n      where: {\n        id: session.id,\n      },\n      data: {\n        status: 'opened',\n        awaitUser: false,\n      },\n    });\n\n    if (!content) {\n      if (unknownMessage) {\n        await this.sendMessageWhatsApp(\n          waInstance,\n          remoteJid,\n          unknownMessage,\n          {\n            delayMessage,\n            expire,\n            keywordFinish,\n            listeningFromMe,\n            stopBotFromMe,\n            keepOpen,\n            unknownMessage,\n          },\n          true,\n        );\n        sendTelemetry('/message/sendText');\n      }\n      return;\n    }\n\n    if (keywordFinish && content.toLowerCase() === keywordFinish.toLowerCase()) {\n      let statusChange = 'closed';\n      if (keepOpen) {\n        await this.prismaRepository.integrationSession.update({\n          where: {\n            id: session.id,\n          },\n          data: {\n            status: 'closed',\n          },\n        });\n      } else {\n        statusChange = 'delete';\n        await this.prismaRepository.integrationSession.deleteMany({\n          where: {\n            botId: findTypebot.id,\n            remoteJid: remoteJid,\n          },\n        });\n      }\n\n      const typebotData = {\n        remoteJid: remoteJid,\n        status: statusChange,\n        session,\n      };\n\n      waInstance.sendDataWebhook(Events.TYPEBOT_CHANGE_STATUS, typebotData);\n\n      return;\n    }\n\n    // Continue existing chat\n    const version = this.configService.get<Typebot>('TYPEBOT').API_VERSION;\n    let urlTypebot: string;\n    let reqData: { message: string; sessionId?: string };\n    if (version === 'latest') {\n      urlTypebot = `${url}/api/v1/sessions/${session.sessionId.split('-')[1]}/continueChat`;\n      reqData = {\n        message: content,\n      };\n    } else {\n      urlTypebot = `${url}/api/v1/sendMessage`;\n      reqData = {\n        message: content,\n        sessionId: session.sessionId.split('-')[1],\n      };\n    }\n\n    // Handle audio transcription if OpenAI service is available\n    if (this.isAudioMessage(content) && msg) {\n      try {\n        this.logger.debug(`[TypeBot] Downloading audio for Whisper transcription`);\n        const transcription = await this.openaiService.speechToText(msg, instance);\n        if (transcription) {\n          reqData.message = `[audio] ${transcription}`;\n        }\n      } catch (err) {\n        this.logger.error(`[TypeBot] Failed to transcribe audio: ${err}`);\n      }\n    }\n\n    const request = await axios.post(urlTypebot, reqData);\n\n    await this.sendWAMessage(\n      instance,\n      session,\n      {\n        expire: expire,\n        keywordFinish: keywordFinish,\n        delayMessage: delayMessage,\n        unknownMessage: unknownMessage,\n        listeningFromMe: listeningFromMe,\n        stopBotFromMe: stopBotFromMe,\n        keepOpen: keepOpen,\n      },\n      remoteJid,\n      request?.data?.messages,\n      request?.data?.input,\n      request?.data?.clientSideActions,\n    );\n\n    return;\n  }\n}\n","// Check if the number is MX or AR\nfunction formatMXOrARNumber(jid: string): string {\n  const countryCode = jid.substring(0, 2);\n\n  if (Number(countryCode) === 52 || Number(countryCode) === 54) {\n    if (jid.length === 13) {\n      const number = countryCode + jid.substring(3);\n      return number;\n    }\n\n    return jid;\n  }\n  return jid;\n}\n\n// Check if the number is br\nfunction formatBRNumber(jid: string) {\n  const regexp = new RegExp(/^(\\d{2})(\\d{2})\\d{1}(\\d{8})$/);\n  if (regexp.test(jid)) {\n    const match = regexp.exec(jid);\n    if (match && match[1] === '55') {\n      const joker = Number.parseInt(match[3][0]);\n      const ddd = Number.parseInt(match[2]);\n      if (joker < 7 || ddd < 31) {\n        return match[0];\n      }\n      return match[1] + match[2] + match[3];\n    }\n    return jid;\n  } else {\n    return jid;\n  }\n}\n\nexport function createJid(number: string): string {\n  number = number.replace(/:\\d+/, '');\n\n  if (number.includes('@g.us') || number.includes('@s.whatsapp.net') || number.includes('@lid')) {\n    return number;\n  }\n\n  if (number.includes('@broadcast')) {\n    return number;\n  }\n\n  number = number\n    ?.replace(/\\s/g, '')\n    .replace(/\\+/g, '')\n    .replace(/\\(/g, '')\n    .replace(/\\)/g, '')\n    .split(':')[0]\n    .split('@')[0];\n\n  if (number.includes('-') && number.length >= 24) {\n    number = number.replace(/[^\\d-]/g, '');\n    return `${number}@g.us`;\n  }\n\n  number = number.replace(/\\D/g, '');\n\n  if (number.length >= 18) {\n    number = number.replace(/[^\\d-]/g, '');\n    return `${number}@g.us`;\n  }\n\n  number = formatMXOrARNumber(number);\n\n  number = formatBRNumber(number);\n\n  return `${number}@s.whatsapp.net`;\n}\n","import { InstanceDto } from '@api/dto/instance.dto';\nimport { ProxyDto } from '@api/dto/proxy.dto';\nimport { SettingsDto } from '@api/dto/settings.dto';\nimport { ChatwootDto } from '@api/integrations/chatbot/chatwoot/dto/chatwoot.dto';\nimport { ChatwootService } from '@api/integrations/chatbot/chatwoot/services/chatwoot.service';\nimport { DifyService } from '@api/integrations/chatbot/dify/services/dify.service';\nimport { OpenaiService } from '@api/integrations/chatbot/openai/services/openai.service';\nimport { TypebotService } from '@api/integrations/chatbot/typebot/services/typebot.service';\nimport { PrismaRepository, Query } from '@api/repository/repository.service';\nimport { eventManager, waMonitor } from '@api/server.module';\nimport { Events, wa } from '@api/types/wa.types';\nimport { Auth, Chatwoot, ConfigService, HttpServer, Proxy } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\nimport { NotFoundException } from '@exceptions';\nimport { Contact, Message, Prisma } from '@prisma/client';\nimport { createJid } from '@utils/createJid';\nimport { WASocket } from 'baileys';\nimport { isArray } from 'class-validator';\nimport EventEmitter2 from 'eventemitter2';\nimport { v4 } from 'uuid';\n\nimport { CacheService } from './cache.service';\n\nexport class ChannelStartupService {\n  constructor(\n    public readonly configService: ConfigService,\n    public readonly eventEmitter: EventEmitter2,\n    public readonly prismaRepository: PrismaRepository,\n    public readonly chatwootCache: CacheService,\n  ) {}\n\n  public readonly logger = new Logger('ChannelStartupService');\n\n  public client: WASocket;\n  public readonly instance: wa.Instance = {};\n  public readonly localChatwoot: wa.LocalChatwoot = {};\n  public readonly localProxy: wa.LocalProxy = {};\n  public readonly localSettings: wa.LocalSettings = {};\n  public readonly localWebhook: wa.LocalWebHook = {};\n\n  public chatwootService = new ChatwootService(\n    waMonitor,\n    this.configService,\n    this.prismaRepository,\n    this.chatwootCache,\n  );\n\n  public openaiService = new OpenaiService(waMonitor, this.prismaRepository, this.configService);\n\n  public typebotService = new TypebotService(waMonitor, this.configService, this.prismaRepository, this.openaiService);\n\n  public difyService = new DifyService(waMonitor, this.prismaRepository, this.configService, this.openaiService);\n\n  public setInstance(instance: InstanceDto) {\n    this.logger.setInstance(instance.instanceName);\n\n    this.instance.name = instance.instanceName;\n    this.instance.id = instance.instanceId;\n    this.instance.integration = instance.integration;\n    this.instance.number = instance.number;\n    this.instance.token = instance.token;\n    this.instance.businessId = instance.businessId;\n    this.instance.ownerJid = instance.ownerJid;\n\n    if (this.configService.get<Chatwoot>('CHATWOOT').ENABLED && this.localChatwoot?.enabled) {\n      this.chatwootService.eventWhatsapp(\n        Events.STATUS_INSTANCE,\n        { instanceName: this.instance.name },\n        {\n          instance: this.instance.name,\n          status: 'created',\n        },\n      );\n    }\n  }\n\n  public set instanceName(name: string) {\n    this.logger.setInstance(name);\n\n    if (!name) {\n      this.instance.name = v4();\n      return;\n    }\n    this.instance.name = name;\n  }\n\n  public get instanceName() {\n    return this.instance.name;\n  }\n\n  public set instanceId(id: string) {\n    if (!id) {\n      this.instance.id = v4();\n      return;\n    }\n    this.instance.id = id;\n  }\n\n  public get instanceId() {\n    return this.instance.id;\n  }\n\n  public set integration(integration: string) {\n    this.instance.integration = integration;\n  }\n\n  public get integration() {\n    return this.instance.integration;\n  }\n\n  public set number(number: string) {\n    this.instance.number = number;\n  }\n\n  public get number() {\n    return this.instance.number;\n  }\n\n  public set token(token: string) {\n    this.instance.token = token;\n  }\n\n  public get token() {\n    return this.instance.token;\n  }\n\n  public get wuid() {\n    return this.instance.wuid;\n  }\n\n  public async loadWebhook() {\n    const data = await this.prismaRepository.webhook.findUnique({\n      where: {\n        instanceId: this.instanceId,\n      },\n    });\n\n    this.localWebhook.enabled = data?.enabled;\n    this.localWebhook.webhookBase64 = data?.webhookBase64;\n  }\n\n  public async loadSettings() {\n    const data = await this.prismaRepository.setting.findUnique({\n      where: {\n        instanceId: this.instanceId,\n      },\n    });\n\n    this.localSettings.rejectCall = data?.rejectCall;\n    this.localSettings.msgCall = data?.msgCall;\n    this.localSettings.groupsIgnore = data?.groupsIgnore;\n    this.localSettings.alwaysOnline = data?.alwaysOnline;\n    this.localSettings.readMessages = data?.readMessages;\n    this.localSettings.readStatus = data?.readStatus;\n    this.localSettings.syncFullHistory = data?.syncFullHistory;\n    this.localSettings.wavoipToken = data?.wavoipToken;\n  }\n\n  public async setSettings(data: SettingsDto) {\n    await this.prismaRepository.setting.upsert({\n      where: {\n        instanceId: this.instanceId,\n      },\n      update: {\n        rejectCall: data.rejectCall,\n        msgCall: data.msgCall,\n        groupsIgnore: data.groupsIgnore,\n        alwaysOnline: data.alwaysOnline,\n        readMessages: data.readMessages,\n        readStatus: data.readStatus,\n        syncFullHistory: data.syncFullHistory,\n        wavoipToken: data.wavoipToken,\n      },\n      create: {\n        rejectCall: data.rejectCall,\n        msgCall: data.msgCall,\n        groupsIgnore: data.groupsIgnore,\n        alwaysOnline: data.alwaysOnline,\n        readMessages: data.readMessages,\n        readStatus: data.readStatus,\n        syncFullHistory: data.syncFullHistory,\n        wavoipToken: data.wavoipToken,\n        instanceId: this.instanceId,\n      },\n    });\n\n    this.localSettings.rejectCall = data?.rejectCall;\n    this.localSettings.msgCall = data?.msgCall;\n    this.localSettings.groupsIgnore = data?.groupsIgnore;\n    this.localSettings.alwaysOnline = data?.alwaysOnline;\n    this.localSettings.readMessages = data?.readMessages;\n    this.localSettings.readStatus = data?.readStatus;\n    this.localSettings.syncFullHistory = data?.syncFullHistory;\n    this.localSettings.wavoipToken = data?.wavoipToken;\n\n    if (this.localSettings.wavoipToken && this.localSettings.wavoipToken.length > 0) {\n      this.client.ws.close();\n      this.client.ws.connect();\n    }\n  }\n\n  public async findSettings() {\n    const data = await this.prismaRepository.setting.findUnique({\n      where: {\n        instanceId: this.instanceId,\n      },\n    });\n\n    if (!data) {\n      return null;\n    }\n\n    return {\n      rejectCall: data.rejectCall,\n      msgCall: data.msgCall,\n      groupsIgnore: data.groupsIgnore,\n      alwaysOnline: data.alwaysOnline,\n      readMessages: data.readMessages,\n      readStatus: data.readStatus,\n      syncFullHistory: data.syncFullHistory,\n      wavoipToken: data.wavoipToken,\n    };\n  }\n\n  public async loadChatwoot() {\n    if (!this.configService.get<Chatwoot>('CHATWOOT').ENABLED) {\n      return;\n    }\n\n    const data = await this.prismaRepository.chatwoot.findUnique({\n      where: {\n        instanceId: this.instanceId,\n      },\n    });\n\n    this.localChatwoot.enabled = data?.enabled;\n    this.localChatwoot.accountId = data?.accountId;\n    this.localChatwoot.token = data?.token;\n    this.localChatwoot.url = data?.url;\n    this.localChatwoot.nameInbox = data?.nameInbox;\n    this.localChatwoot.signMsg = data?.signMsg;\n    this.localChatwoot.signDelimiter = data?.signDelimiter;\n    this.localChatwoot.number = data?.number;\n    this.localChatwoot.reopenConversation = data?.reopenConversation;\n    this.localChatwoot.conversationPending = data?.conversationPending;\n    this.localChatwoot.mergeBrazilContacts = data?.mergeBrazilContacts;\n    this.localChatwoot.importContacts = data?.importContacts;\n    this.localChatwoot.importMessages = data?.importMessages;\n    this.localChatwoot.daysLimitImportMessages = data?.daysLimitImportMessages;\n  }\n\n  public async setChatwoot(data: ChatwootDto) {\n    if (!this.configService.get<Chatwoot>('CHATWOOT').ENABLED) {\n      return;\n    }\n\n    const chatwoot = await this.prismaRepository.chatwoot.findUnique({\n      where: {\n        instanceId: this.instanceId,\n      },\n    });\n\n    if (chatwoot) {\n      await this.prismaRepository.chatwoot.update({\n        where: {\n          instanceId: this.instanceId,\n        },\n        data: {\n          enabled: data?.enabled,\n          accountId: data.accountId,\n          token: data.token,\n          url: data.url,\n          nameInbox: data.nameInbox,\n          signMsg: data.signMsg,\n          signDelimiter: data.signMsg ? data.signDelimiter : null,\n          number: data.number,\n          reopenConversation: data.reopenConversation,\n          conversationPending: data.conversationPending,\n          mergeBrazilContacts: data.mergeBrazilContacts,\n          importContacts: data.importContacts,\n          importMessages: data.importMessages,\n          daysLimitImportMessages: data.daysLimitImportMessages,\n          organization: data.organization,\n          logo: data.logo,\n          ignoreJids: data.ignoreJids,\n        },\n      });\n\n      Object.assign(this.localChatwoot, { ...data, signDelimiter: data.signMsg ? data.signDelimiter : null });\n\n      this.clearCacheChatwoot();\n      return;\n    }\n\n    await this.prismaRepository.chatwoot.create({\n      data: {\n        enabled: data?.enabled,\n        accountId: data.accountId,\n        token: data.token,\n        url: data.url,\n        nameInbox: data.nameInbox,\n        signMsg: data.signMsg,\n        number: data.number,\n        reopenConversation: data.reopenConversation,\n        conversationPending: data.conversationPending,\n        mergeBrazilContacts: data.mergeBrazilContacts,\n        importContacts: data.importContacts,\n        importMessages: data.importMessages,\n        daysLimitImportMessages: data.daysLimitImportMessages,\n        organization: data.organization,\n        logo: data.logo,\n        ignoreJids: data.ignoreJids,\n        instanceId: this.instanceId,\n      },\n    });\n\n    Object.assign(this.localChatwoot, { ...data, signDelimiter: data.signMsg ? data.signDelimiter : null });\n\n    this.clearCacheChatwoot();\n  }\n\n  public async findChatwoot(): Promise<ChatwootDto | null> {\n    if (!this.configService.get<Chatwoot>('CHATWOOT').ENABLED) {\n      return null;\n    }\n\n    const data = await this.prismaRepository.chatwoot.findUnique({\n      where: {\n        instanceId: this.instanceId,\n      },\n    });\n\n    if (!data) {\n      return null;\n    }\n\n    const ignoreJidsArray = Array.isArray(data.ignoreJids) ? data.ignoreJids.map((event) => String(event)) : [];\n\n    return {\n      enabled: data?.enabled,\n      accountId: data.accountId,\n      token: data.token,\n      url: data.url,\n      nameInbox: data.nameInbox,\n      signMsg: data.signMsg,\n      signDelimiter: data.signDelimiter || null,\n      reopenConversation: data.reopenConversation,\n      conversationPending: data.conversationPending,\n      mergeBrazilContacts: data.mergeBrazilContacts,\n      importContacts: data.importContacts,\n      importMessages: data.importMessages,\n      daysLimitImportMessages: data.daysLimitImportMessages,\n      organization: data.organization,\n      logo: data.logo,\n      ignoreJids: ignoreJidsArray,\n    };\n  }\n\n  public clearCacheChatwoot() {\n    if (this.localChatwoot?.enabled) {\n      this.chatwootService.getCache()?.deleteAll(this.instanceName);\n    }\n  }\n\n  public async loadProxy() {\n    this.localProxy.enabled = false;\n\n    const proxyConfig = this.configService.get<Proxy>('PROXY');\n    if (proxyConfig.HOST) {\n      this.localProxy.enabled = true;\n      this.localProxy.host = proxyConfig.HOST;\n      this.localProxy.port = proxyConfig.PORT || '80';\n      this.localProxy.protocol = proxyConfig.PROTOCOL || 'http';\n      this.localProxy.username = proxyConfig.USERNAME;\n      this.localProxy.password = proxyConfig.PASSWORD;\n    }\n\n    const data = await this.prismaRepository.proxy.findUnique({\n      where: {\n        instanceId: this.instanceId,\n      },\n    });\n\n    if (data?.enabled) {\n      this.localProxy.enabled = true;\n      this.localProxy.host = data?.host;\n      this.localProxy.port = data?.port;\n      this.localProxy.protocol = data?.protocol;\n      this.localProxy.username = data?.username;\n      this.localProxy.password = data?.password;\n    }\n  }\n\n  public async setProxy(data: ProxyDto) {\n    await this.prismaRepository.proxy.upsert({\n      where: {\n        instanceId: this.instanceId,\n      },\n      update: {\n        enabled: data?.enabled,\n        host: data.host,\n        port: data.port,\n        protocol: data.protocol,\n        username: data.username,\n        password: data.password,\n      },\n      create: {\n        enabled: data?.enabled,\n        host: data.host,\n        port: data.port,\n        protocol: data.protocol,\n        username: data.username,\n        password: data.password,\n        instanceId: this.instanceId,\n      },\n    });\n\n    Object.assign(this.localProxy, data);\n  }\n\n  public async findProxy() {\n    const data = await this.prismaRepository.proxy.findUnique({\n      where: {\n        instanceId: this.instanceId,\n      },\n    });\n\n    if (!data) {\n      throw new NotFoundException('Proxy not found');\n    }\n\n    return data;\n  }\n\n  public async sendDataWebhook<T extends object = any>(\n    event: Events,\n    data: T,\n    local = true,\n    integration?: string[],\n    extra?: Record<string, any>,\n  ) {\n    const serverUrl = this.configService.get<HttpServer>('SERVER').URL;\n    const tzoffset = new Date().getTimezoneOffset() * 60000; //offset in milliseconds\n    const localISOTime = new Date(Date.now() - tzoffset).toISOString();\n    const now = localISOTime;\n\n    const expose = this.configService.get<Auth>('AUTHENTICATION').EXPOSE_IN_FETCH_INSTANCES;\n\n    const instanceApikey = this.token || 'Apikey not found';\n\n    await eventManager.emit({\n      instanceName: this.instance.name,\n      origin: ChannelStartupService.name,\n      event,\n      data,\n      serverUrl,\n      dateTime: now,\n      sender: this.wuid,\n      apiKey: expose && instanceApikey ? instanceApikey : null,\n      local,\n      integration,\n      extra,\n    });\n  }\n\n  // Check if the number is MX or AR\n  public formatMXOrARNumber(jid: string): string {\n    const countryCode = jid.substring(0, 2);\n\n    if (Number(countryCode) === 52 || Number(countryCode) === 54) {\n      if (jid.length === 13) {\n        const number = countryCode + jid.substring(3);\n        return number;\n      }\n\n      return jid;\n    }\n    return jid;\n  }\n\n  // Check if the number is br\n  public formatBRNumber(jid: string) {\n    const regexp = new RegExp(/^(\\d{2})(\\d{2})\\d{1}(\\d{8})$/);\n    if (regexp.test(jid)) {\n      const match = regexp.exec(jid);\n      if (match && match[1] === '55') {\n        const joker = Number.parseInt(match[3][0]);\n        const ddd = Number.parseInt(match[2]);\n        if (joker < 7 || ddd < 31) {\n          return match[0];\n        }\n        return match[1] + match[2] + match[3];\n      }\n      return jid;\n    } else {\n      return jid;\n    }\n  }\n\n  public async fetchContacts(query: Query<Contact>) {\n    const where: any = {\n      instanceId: this.instanceId,\n    };\n\n    if (query?.where?.remoteJid) {\n      const remoteJid = query.where.remoteJid.includes('@') ? query.where.remoteJid : createJid(query.where.remoteJid);\n      where['remoteJid'] = remoteJid;\n    }\n\n    if (query?.where?.id) {\n      where['id'] = query.where.id;\n    }\n\n    if (query?.where?.pushName) {\n      where['pushName'] = query.where.pushName;\n    }\n\n    const contactFindManyArgs: Prisma.ContactFindManyArgs = {\n      where,\n    };\n\n    if (query.offset) contactFindManyArgs.take = query.offset;\n    if (query.page) {\n      const validPage = Math.max(query.page as number, 1);\n      contactFindManyArgs.skip = query.offset * (validPage - 1);\n    }\n\n    const contacts = await this.prismaRepository.contact.findMany(contactFindManyArgs);\n\n    return contacts.map((contact) => {\n      const remoteJid = contact.remoteJid;\n      const isGroup = remoteJid.endsWith('@g.us');\n      const isSaved = !!contact.pushName || !!contact.profilePicUrl;\n      const type = isGroup ? 'group' : isSaved ? 'contact' : 'group_member';\n      return {\n        ...contact,\n        isGroup,\n        isSaved,\n        type,\n      };\n    });\n  }\n\n  public cleanMessageData(message: any) {\n    if (!message) return message;\n    const cleanedMessage = { ...message };\n\n    if (cleanedMessage.message) {\n      const { mediaUrl } = cleanedMessage.message;\n      delete cleanedMessage.message.base64;\n\n      // Limpa imageMessage\n      if (cleanedMessage.message.imageMessage) {\n        cleanedMessage.message.imageMessage = {\n          caption: cleanedMessage.message.imageMessage.caption,\n        };\n      }\n\n      // Limpa videoMessage\n      if (cleanedMessage.message.videoMessage) {\n        cleanedMessage.message.videoMessage = {\n          caption: cleanedMessage.message.videoMessage.caption,\n        };\n      }\n\n      // Limpa audioMessage\n      if (cleanedMessage.message.audioMessage) {\n        cleanedMessage.message.audioMessage = {\n          seconds: cleanedMessage.message.audioMessage.seconds,\n        };\n      }\n\n      // Limpa stickerMessage\n      if (cleanedMessage.message.stickerMessage) {\n        cleanedMessage.message.stickerMessage = {};\n      }\n\n      // Limpa documentMessage\n      if (cleanedMessage.message.documentMessage) {\n        cleanedMessage.message.documentMessage = {\n          caption: cleanedMessage.message.documentMessage.caption,\n          name: cleanedMessage.message.documentMessage.name,\n        };\n      }\n\n      // Limpa documentWithCaptionMessage\n      if (cleanedMessage.message.documentWithCaptionMessage) {\n        cleanedMessage.message.documentWithCaptionMessage = {\n          caption: cleanedMessage.message.documentWithCaptionMessage.caption,\n          name: cleanedMessage.message.documentWithCaptionMessage.name,\n        };\n      }\n\n      if (mediaUrl) cleanedMessage.message.mediaUrl = mediaUrl;\n    }\n\n    return cleanedMessage;\n  }\n\n  public async fetchMessages(query: Query<Message>) {\n    const keyFilters = query?.where?.key as {\n      id?: string;\n      fromMe?: boolean;\n      remoteJid?: string;\n      participants?: string;\n    };\n\n    const timestampFilter = {};\n    if (query?.where?.messageTimestamp) {\n      if (query.where.messageTimestamp['gte'] && query.where.messageTimestamp['lte']) {\n        timestampFilter['messageTimestamp'] = {\n          gte: Math.floor(new Date(query.where.messageTimestamp['gte']).getTime() / 1000),\n          lte: Math.floor(new Date(query.where.messageTimestamp['lte']).getTime() / 1000),\n        };\n      }\n    }\n\n    const count = await this.prismaRepository.message.count({\n      where: {\n        instanceId: this.instanceId,\n        id: query?.where?.id,\n        source: query?.where?.source,\n        messageType: query?.where?.messageType,\n        ...timestampFilter,\n        AND: [\n          keyFilters?.id ? { key: { path: ['id'], equals: keyFilters?.id } } : {},\n          keyFilters?.fromMe ? { key: { path: ['fromMe'], equals: keyFilters?.fromMe } } : {},\n          keyFilters?.remoteJid ? { key: { path: ['remoteJid'], equals: keyFilters?.remoteJid } } : {},\n          keyFilters?.participants ? { key: { path: ['participants'], equals: keyFilters?.participants } } : {},\n        ],\n      },\n    });\n\n    if (!query?.offset) {\n      query.offset = 50;\n    }\n\n    if (!query?.page) {\n      query.page = 1;\n    }\n\n    const messages = await this.prismaRepository.message.findMany({\n      where: {\n        instanceId: this.instanceId,\n        id: query?.where?.id,\n        source: query?.where?.source,\n        messageType: query?.where?.messageType,\n        ...timestampFilter,\n        AND: [\n          keyFilters?.id ? { key: { path: ['id'], equals: keyFilters?.id } } : {},\n          keyFilters?.fromMe ? { key: { path: ['fromMe'], equals: keyFilters?.fromMe } } : {},\n          keyFilters?.remoteJid ? { key: { path: ['remoteJid'], equals: keyFilters?.remoteJid } } : {},\n          keyFilters?.participants ? { key: { path: ['participants'], equals: keyFilters?.participants } } : {},\n        ],\n      },\n      orderBy: {\n        messageTimestamp: 'desc',\n      },\n      skip: query.offset * (query?.page === 1 ? 0 : (query?.page as number) - 1),\n      take: query.offset,\n      select: {\n        id: true,\n        key: true,\n        pushName: true,\n        messageType: true,\n        message: true,\n        messageTimestamp: true,\n        instanceId: true,\n        source: true,\n        contextInfo: true,\n        MessageUpdate: {\n          select: {\n            status: true,\n          },\n        },\n      },\n    });\n\n    return {\n      messages: {\n        total: count,\n        pages: Math.ceil(count / query.offset),\n        currentPage: query.page,\n        records: messages,\n      },\n    };\n  }\n\n  public async fetchStatusMessage(query: any) {\n    if (!query?.offset) {\n      query.offset = 50;\n    }\n\n    if (!query?.page) {\n      query.page = 1;\n    }\n\n    return await this.prismaRepository.messageUpdate.findMany({\n      where: {\n        instanceId: this.instanceId,\n        remoteJid: query.where?.remoteJid,\n        keyId: query.where?.id,\n      },\n      skip: query.offset * (query?.page === 1 ? 0 : (query?.page as number) - 1),\n      take: query.offset,\n    });\n  }\n\n  public async findChatByRemoteJid(remoteJid: string) {\n    if (!remoteJid) return null;\n    return await this.prismaRepository.chat.findFirst({\n      where: {\n        instanceId: this.instanceId,\n        remoteJid: remoteJid,\n      },\n    });\n  }\n\n  public async fetchChats(query: any) {\n    const remoteJid = query?.where?.remoteJid\n      ? query?.where?.remoteJid.includes('@')\n        ? query.where?.remoteJid\n        : createJid(query.where?.remoteJid)\n      : null;\n\n    const where = {\n      instanceId: this.instanceId,\n    };\n\n    if (remoteJid) {\n      where['remoteJid'] = remoteJid;\n    }\n\n    const timestampFilter =\n      query?.where?.messageTimestamp?.gte && query?.where?.messageTimestamp?.lte\n        ? Prisma.sql`\n        AND \"Message\".\"messageTimestamp\" >= ${Math.floor(new Date(query.where.messageTimestamp.gte).getTime() / 1000)}\n        AND \"Message\".\"messageTimestamp\" <= ${Math.floor(new Date(query.where.messageTimestamp.lte).getTime() / 1000)}`\n        : Prisma.sql``;\n\n    const limit = query?.take ? Prisma.sql`LIMIT ${query.take}` : Prisma.sql``;\n    const offset = query?.skip ? Prisma.sql`OFFSET ${query.skip}` : Prisma.sql``;\n\n    const results = await this.prismaRepository.$queryRaw`\n      WITH rankedMessages AS (\n        SELECT DISTINCT ON (\"Message\".\"key\"->>'remoteJid') \n          \"Contact\".\"id\" as \"contactId\",\n          \"Message\".\"key\"->>'remoteJid' as \"remoteJid\",\n          CASE \n            WHEN \"Message\".\"key\"->>'remoteJid' LIKE '%@g.us' THEN COALESCE(\"Chat\".\"name\", \"Contact\".\"pushName\")\n            ELSE COALESCE(\"Contact\".\"pushName\", \"Message\".\"pushName\")\n          END as \"pushName\",\n          \"Contact\".\"profilePicUrl\",\n          COALESCE(\n            to_timestamp(\"Message\".\"messageTimestamp\"::double precision), \n            \"Contact\".\"updatedAt\"\n          ) as \"updatedAt\",\n          \"Chat\".\"name\" as \"pushName\",\n          \"Chat\".\"createdAt\" as \"windowStart\",\n          \"Chat\".\"createdAt\" + INTERVAL '24 hours' as \"windowExpires\",\n          \"Chat\".\"unreadMessages\" as \"unreadMessages\",\n          CASE WHEN \"Chat\".\"createdAt\" + INTERVAL '24 hours' > NOW() THEN true ELSE false END as \"windowActive\",\n          \"Message\".\"id\" AS \"lastMessageId\",\n          \"Message\".\"key\" AS \"lastMessage_key\",\n          CASE\n            WHEN \"Message\".\"key\"->>'fromMe' = 'true' THEN 'Voc'\n            ELSE \"Message\".\"pushName\"\n          END AS \"lastMessagePushName\",\n          \"Message\".\"participant\" AS \"lastMessageParticipant\",\n          \"Message\".\"messageType\" AS \"lastMessageMessageType\",\n          \"Message\".\"message\" AS \"lastMessageMessage\",\n          \"Message\".\"contextInfo\" AS \"lastMessageContextInfo\",\n          \"Message\".\"source\" AS \"lastMessageSource\",\n          \"Message\".\"messageTimestamp\" AS \"lastMessageMessageTimestamp\",\n          \"Message\".\"instanceId\" AS \"lastMessageInstanceId\",\n          \"Message\".\"sessionId\" AS \"lastMessageSessionId\",\n          \"Message\".\"status\" AS \"lastMessageStatus\"\n        FROM \"Message\"\n        LEFT JOIN \"Contact\" ON \"Contact\".\"remoteJid\" = \"Message\".\"key\"->>'remoteJid' AND \"Contact\".\"instanceId\" = \"Message\".\"instanceId\"\n        LEFT JOIN \"Chat\" ON \"Chat\".\"remoteJid\" = \"Message\".\"key\"->>'remoteJid' AND \"Chat\".\"instanceId\" = \"Message\".\"instanceId\"\n        WHERE \"Message\".\"instanceId\" = ${this.instanceId}\n        ${remoteJid ? Prisma.sql`AND \"Message\".\"key\"->>'remoteJid' = ${remoteJid}` : Prisma.sql``}\n        ${timestampFilter}\n        ORDER BY \"Message\".\"key\"->>'remoteJid', \"Message\".\"messageTimestamp\" DESC\n      )\n      SELECT * FROM rankedMessages \n      ORDER BY \"updatedAt\" DESC NULLS LAST\n      ${limit}\n      ${offset};\n    `;\n\n    if (results && isArray(results) && results.length > 0) {\n      const mappedResults = results.map((contact) => {\n        const lastMessage = contact.lastMessageId\n          ? {\n              id: contact.lastMessageId,\n              key: contact.lastMessage_key,\n              pushName: contact.lastMessagePushName,\n              participant: contact.lastMessageParticipant,\n              messageType: contact.lastMessageMessageType,\n              message: contact.lastMessageMessage,\n              contextInfo: contact.lastMessageContextInfo,\n              source: contact.lastMessageSource,\n              messageTimestamp: contact.lastMessageMessageTimestamp,\n              instanceId: contact.lastMessageInstanceId,\n              sessionId: contact.lastMessageSessionId,\n              status: contact.lastMessageStatus,\n            }\n          : undefined;\n\n        return {\n          id: contact.contactId || null,\n          remoteJid: contact.remoteJid,\n          pushName: contact.pushName,\n          profilePicUrl: contact.profilePicUrl,\n          updatedAt: contact.updatedAt,\n          windowStart: contact.windowStart,\n          windowExpires: contact.windowExpires,\n          windowActive: contact.windowActive,\n          lastMessage: lastMessage ? this.cleanMessageData(lastMessage) : undefined,\n          unreadCount: contact.unreadMessages,\n          isSaved: !!contact.contactId,\n        };\n      });\n\n      return mappedResults;\n    }\n\n    return [];\n  }\n\n  public hasValidMediaContent(message: any): boolean {\n    if (!message?.message) return false;\n\n    const msg = message.message;\n\n    // Se s tem messageContextInfo, no  mdia vlida\n    if (Object.keys(msg).length === 1 && Object.prototype.hasOwnProperty.call(msg, 'messageContextInfo')) {\n      return false;\n    }\n\n    // Verifica se tem pelo menos um tipo de mdia vlido\n    const mediaTypes = [\n      'imageMessage',\n      'videoMessage',\n      'stickerMessage',\n      'documentMessage',\n      'documentWithCaptionMessage',\n      'ptvMessage',\n      'audioMessage',\n    ];\n\n    return mediaTypes.some((type) => msg[type] && Object.keys(msg[type]).length > 0);\n  }\n}\n","import { InstanceDto } from '@api/dto/instance.dto';\nimport {\n  MediaMessage,\n  Options,\n  SendAudioDto,\n  SendButtonsDto,\n  SendMediaDto,\n  SendTextDto,\n} from '@api/dto/sendMessage.dto';\nimport * as s3Service from '@api/integrations/storage/s3/libs/minio.server';\nimport { PrismaRepository } from '@api/repository/repository.service';\nimport { chatbotController } from '@api/server.module';\nimport { CacheService } from '@api/services/cache.service';\nimport { ChannelStartupService } from '@api/services/channel.service';\nimport { Events, wa } from '@api/types/wa.types';\nimport { AudioConverter, Chatwoot, ConfigService, Openai, S3 } from '@config/env.config';\nimport { BadRequestException, InternalServerErrorException } from '@exceptions';\nimport { createJid } from '@utils/createJid';\nimport { sendTelemetry } from '@utils/sendTelemetry';\nimport axios from 'axios';\nimport { isBase64, isURL } from 'class-validator';\nimport EventEmitter2 from 'eventemitter2';\nimport FormData from 'form-data';\nimport mimeTypes from 'mime-types';\nimport { join } from 'path';\nimport { v4 } from 'uuid';\n\nexport class EvolutionStartupService extends ChannelStartupService {\n  constructor(\n    public readonly configService: ConfigService,\n    public readonly eventEmitter: EventEmitter2,\n    public readonly prismaRepository: PrismaRepository,\n    public readonly cache: CacheService,\n    public readonly chatwootCache: CacheService,\n  ) {\n    super(configService, eventEmitter, prismaRepository, chatwootCache);\n\n    this.client = null;\n  }\n\n  public client: any;\n\n  public stateConnection: wa.StateConnection = { state: 'open' };\n\n  public phoneNumber: string;\n  public mobile: boolean;\n\n  public get connectionStatus() {\n    return this.stateConnection;\n  }\n\n  public async closeClient() {\n    this.stateConnection = { state: 'close' };\n  }\n\n  public get qrCode(): wa.QrCode {\n    return {\n      pairingCode: this.instance.qrcode?.pairingCode,\n      code: this.instance.qrcode?.code,\n      base64: this.instance.qrcode?.base64,\n      count: this.instance.qrcode?.count,\n    };\n  }\n\n  public async logoutInstance() {\n    await this.closeClient();\n  }\n\n  public setInstance(instance: InstanceDto) {\n    this.logger.setInstance(instance.instanceId);\n\n    this.instance.name = instance.instanceName;\n    this.instance.id = instance.instanceId;\n    this.instance.integration = instance.integration;\n    this.instance.number = instance.number;\n    this.instance.token = instance.token;\n    this.instance.businessId = instance.businessId;\n\n    if (this.configService.get<Chatwoot>('CHATWOOT').ENABLED && this.localChatwoot?.enabled) {\n      this.chatwootService.eventWhatsapp(\n        Events.STATUS_INSTANCE,\n        {\n          instanceName: this.instance.name,\n          instanceId: this.instance.id,\n          integration: instance.integration,\n        },\n        {\n          instance: this.instance.name,\n          status: 'created',\n        },\n      );\n    }\n  }\n\n  public async profilePicture(number: string) {\n    const jid = createJid(number);\n\n    return {\n      wuid: jid,\n      profilePictureUrl: null,\n    };\n  }\n\n  public async getProfileName() {\n    return null;\n  }\n\n  public async profilePictureUrl() {\n    return null;\n  }\n\n  public async getProfileStatus() {\n    return null;\n  }\n\n  public async connectToWhatsapp(data?: any): Promise<any> {\n    if (!data) {\n      this.loadChatwoot();\n      return;\n    }\n\n    try {\n      this.eventHandler(data);\n    } catch (error) {\n      this.logger.error(error);\n      throw new InternalServerErrorException(error?.toString());\n    }\n  }\n\n  protected async eventHandler(received: any) {\n    try {\n      let messageRaw: any;\n\n      if (received.message) {\n        const key = {\n          id: received.key.id || v4(),\n          remoteJid: received.key.remoteJid,\n          fromMe: received.key.fromMe,\n          profilePicUrl: received.profilePicUrl,\n        };\n        messageRaw = {\n          key,\n          pushName: received.pushName,\n          message: received.message,\n          messageType: received.messageType,\n          messageTimestamp: Math.round(new Date().getTime() / 1000),\n          source: 'unknown',\n          instanceId: this.instanceId,\n        };\n\n        const isAudio = received?.message?.audioMessage;\n\n        if (this.configService.get<Openai>('OPENAI').ENABLED && isAudio) {\n          const openAiDefaultSettings = await this.prismaRepository.openaiSetting.findFirst({\n            where: {\n              instanceId: this.instanceId,\n            },\n            include: {\n              OpenaiCreds: true,\n            },\n          });\n\n          if (\n            openAiDefaultSettings &&\n            openAiDefaultSettings.openaiCredsId &&\n            openAiDefaultSettings.speechToText &&\n            received?.message?.audioMessage\n          ) {\n            messageRaw.message.speechToText = `[audio] ${await this.openaiService.speechToText(received, this)}`;\n          }\n        }\n\n        this.logger.log(messageRaw);\n\n        sendTelemetry(`received.message.${messageRaw.messageType ?? 'unknown'}`);\n\n        this.sendDataWebhook(Events.MESSAGES_UPSERT, messageRaw);\n\n        await chatbotController.emit({\n          instance: { instanceName: this.instance.name, instanceId: this.instanceId },\n          remoteJid: messageRaw.key.remoteJid,\n          msg: messageRaw,\n          pushName: messageRaw.pushName,\n        });\n\n        if (this.configService.get<Chatwoot>('CHATWOOT').ENABLED && this.localChatwoot?.enabled) {\n          const chatwootSentMessage = await this.chatwootService.eventWhatsapp(\n            Events.MESSAGES_UPSERT,\n            { instanceName: this.instance.name, instanceId: this.instanceId },\n            messageRaw,\n          );\n\n          if (chatwootSentMessage?.id) {\n            messageRaw.chatwootMessageId = chatwootSentMessage.id;\n            messageRaw.chatwootInboxId = chatwootSentMessage.id;\n            messageRaw.chatwootConversationId = chatwootSentMessage.id;\n          }\n        }\n\n        await this.prismaRepository.message.create({\n          data: messageRaw,\n        });\n\n        await this.updateContact({\n          remoteJid: messageRaw.key.remoteJid,\n          pushName: messageRaw.pushName,\n          profilePicUrl: received.profilePicUrl,\n        });\n      }\n    } catch (error) {\n      this.logger.error(error);\n    }\n  }\n\n  private async updateContact(data: { remoteJid: string; pushName?: string; profilePicUrl?: string }) {\n    const contactRaw: any = {\n      remoteJid: data.remoteJid,\n      pushName: data?.pushName,\n      instanceId: this.instanceId,\n      profilePicUrl: data?.profilePicUrl,\n    };\n\n    const existingContact = await this.prismaRepository.contact.findFirst({\n      where: {\n        remoteJid: data.remoteJid,\n        instanceId: this.instanceId,\n      },\n    });\n\n    if (existingContact) {\n      await this.prismaRepository.contact.updateMany({\n        where: {\n          remoteJid: data.remoteJid,\n          instanceId: this.instanceId,\n        },\n        data: contactRaw,\n      });\n    } else {\n      await this.prismaRepository.contact.create({\n        data: contactRaw,\n      });\n    }\n\n    this.sendDataWebhook(Events.CONTACTS_UPSERT, contactRaw);\n\n    if (this.configService.get<Chatwoot>('CHATWOOT').ENABLED && this.localChatwoot?.enabled) {\n      await this.chatwootService.eventWhatsapp(\n        Events.CONTACTS_UPDATE,\n        {\n          instanceName: this.instance.name,\n          instanceId: this.instanceId,\n          integration: this.instance.integration,\n        },\n        contactRaw,\n      );\n    }\n\n    const chat = await this.prismaRepository.chat.findFirst({\n      where: { instanceId: this.instanceId, remoteJid: data.remoteJid },\n    });\n\n    if (chat) {\n      const chatRaw: any = {\n        remoteJid: data.remoteJid,\n        instanceId: this.instanceId,\n      };\n\n      this.sendDataWebhook(Events.CHATS_UPDATE, chatRaw);\n\n      await this.prismaRepository.chat.updateMany({\n        where: { remoteJid: chat.remoteJid },\n        data: chatRaw,\n      });\n    }\n\n    const chatRaw: any = {\n      remoteJid: data.remoteJid,\n      instanceId: this.instanceId,\n    };\n\n    this.sendDataWebhook(Events.CHATS_UPSERT, chatRaw);\n\n    await this.prismaRepository.chat.create({\n      data: chatRaw,\n    });\n  }\n\n  protected async sendMessageWithTyping(\n    number: string,\n    message: any,\n    options?: Options,\n    file?: any,\n    isIntegration = false,\n  ) {\n    try {\n      let quoted: any;\n      let webhookUrl: any;\n\n      if (options?.quoted) {\n        const m = options?.quoted;\n\n        const msg = m?.key;\n\n        if (!msg) {\n          throw 'Message not found';\n        }\n\n        quoted = msg;\n      }\n\n      if (options.delay) {\n        await new Promise((resolve) => setTimeout(resolve, options.delay));\n      }\n\n      if (options?.webhookUrl) {\n        webhookUrl = options.webhookUrl;\n      }\n\n      let audioFile;\n\n      const messageId = v4();\n\n      let messageRaw: any;\n\n      if (message?.mediaType === 'image') {\n        messageRaw = {\n          key: { fromMe: true, id: messageId, remoteJid: number },\n          message: {\n            base64: isBase64(message.media) ? message.media : null,\n            mediaUrl: isURL(message.media) ? message.media : null,\n            quoted,\n          },\n          messageType: 'imageMessage',\n          messageTimestamp: Math.round(new Date().getTime() / 1000),\n          webhookUrl,\n          source: 'unknown',\n          instanceId: this.instanceId,\n        };\n      } else if (message?.mediaType === 'video') {\n        messageRaw = {\n          key: { fromMe: true, id: messageId, remoteJid: number },\n          message: {\n            base64: isBase64(message.media) ? message.media : null,\n            mediaUrl: isURL(message.media) ? message.media : null,\n            quoted,\n          },\n          messageType: 'videoMessage',\n          messageTimestamp: Math.round(new Date().getTime() / 1000),\n          webhookUrl,\n          source: 'unknown',\n          instanceId: this.instanceId,\n        };\n      } else if (message?.mediaType === 'audio') {\n        messageRaw = {\n          key: { fromMe: true, id: messageId, remoteJid: number },\n          message: {\n            base64: isBase64(message.media) ? message.media : null,\n            mediaUrl: isURL(message.media) ? message.media : null,\n            quoted,\n          },\n          messageType: 'audioMessage',\n          messageTimestamp: Math.round(new Date().getTime() / 1000),\n          webhookUrl,\n          source: 'unknown',\n          instanceId: this.instanceId,\n        };\n\n        const buffer = Buffer.from(message.media, 'base64');\n        audioFile = {\n          buffer,\n          mimetype: 'audio/mp4',\n          originalname: `${messageId}.mp4`,\n        };\n      } else if (message?.mediaType === 'document') {\n        messageRaw = {\n          key: { fromMe: true, id: messageId, remoteJid: number },\n          message: {\n            base64: isBase64(message.media) ? message.media : null,\n            mediaUrl: isURL(message.media) ? message.media : null,\n            quoted,\n          },\n          messageType: 'documentMessage',\n          messageTimestamp: Math.round(new Date().getTime() / 1000),\n          webhookUrl,\n          source: 'unknown',\n          instanceId: this.instanceId,\n        };\n      } else if (message.buttonMessage) {\n        messageRaw = {\n          key: { fromMe: true, id: messageId, remoteJid: number },\n          message: {\n            ...message.buttonMessage,\n            buttons: message.buttonMessage.buttons,\n            footer: message.buttonMessage.footer,\n            body: message.buttonMessage.body,\n            quoted,\n          },\n          messageType: 'buttonMessage',\n          messageTimestamp: Math.round(new Date().getTime() / 1000),\n          webhookUrl,\n          source: 'unknown',\n          instanceId: this.instanceId,\n        };\n      } else if (message.listMessage) {\n        messageRaw = {\n          key: { fromMe: true, id: messageId, remoteJid: number },\n          message: {\n            ...message.listMessage,\n            quoted,\n          },\n          messageType: 'listMessage',\n          messageTimestamp: Math.round(new Date().getTime() / 1000),\n          webhookUrl,\n          source: 'unknown',\n          instanceId: this.instanceId,\n        };\n      } else {\n        messageRaw = {\n          key: { fromMe: true, id: messageId, remoteJid: number },\n          message: {\n            ...message,\n            quoted,\n          },\n          messageType: 'conversation',\n          messageTimestamp: Math.round(new Date().getTime() / 1000),\n          webhookUrl,\n          source: 'unknown',\n          instanceId: this.instanceId,\n        };\n      }\n\n      if (messageRaw.message.contextInfo) {\n        messageRaw.contextInfo = {\n          ...messageRaw.message.contextInfo,\n        };\n      }\n\n      if (messageRaw.contextInfo?.stanzaId) {\n        const key: any = {\n          id: messageRaw.contextInfo.stanzaId,\n        };\n\n        const findMessage = await this.prismaRepository.message.findFirst({\n          where: {\n            instanceId: this.instanceId,\n            key,\n          },\n        });\n\n        if (findMessage) {\n          messageRaw.contextInfo.quotedMessage = findMessage.message;\n        }\n      }\n\n      const { base64 } = messageRaw.message;\n      delete messageRaw.message.base64;\n\n      if (base64 || file || audioFile) {\n        if (this.configService.get<S3>('S3').ENABLE) {\n          try {\n            // Verificao adicional para garantir que h contedo de mdia real\n            const hasRealMedia = this.hasValidMediaContent(messageRaw);\n\n            if (!hasRealMedia) {\n              this.logger.warn('Message detected as media but contains no valid media content');\n            } else {\n              const fileBuffer = audioFile?.buffer || file?.buffer;\n              const buffer = base64 ? Buffer.from(base64, 'base64') : fileBuffer;\n\n              let mediaType: string;\n              let mimetype = audioFile?.mimetype || file.mimetype;\n\n              if (messageRaw.messageType === 'documentMessage') {\n                mediaType = 'document';\n                mimetype = !mimetype ? 'application/pdf' : mimetype;\n              } else if (messageRaw.messageType === 'imageMessage') {\n                mediaType = 'image';\n                mimetype = !mimetype ? 'image/png' : mimetype;\n              } else if (messageRaw.messageType === 'audioMessage') {\n                mediaType = 'audio';\n                mimetype = !mimetype ? 'audio/mp4' : mimetype;\n              } else if (messageRaw.messageType === 'videoMessage') {\n                mediaType = 'video';\n                mimetype = !mimetype ? 'video/mp4' : mimetype;\n              }\n\n              const fileName = `${messageRaw.key.id}.${mimetype.split('/')[1]}`;\n\n              const size = buffer.byteLength;\n\n              const fullName = join(`${this.instance.id}`, messageRaw.key.remoteJid, mediaType, fileName);\n\n              await s3Service.uploadFile(fullName, buffer, size, {\n                'Content-Type': mimetype,\n              });\n\n              const mediaUrl = await s3Service.getObjectUrl(fullName);\n\n              messageRaw.message.mediaUrl = mediaUrl;\n            }\n          } catch (error) {\n            this.logger.error(['Error on upload file to minio', error?.message, error?.stack]);\n          }\n        }\n      }\n\n      this.logger.log(messageRaw);\n\n      this.sendDataWebhook(Events.SEND_MESSAGE, messageRaw);\n\n      if (this.configService.get<Chatwoot>('CHATWOOT').ENABLED && this.localChatwoot?.enabled && !isIntegration) {\n        this.chatwootService.eventWhatsapp(\n          Events.SEND_MESSAGE,\n          { instanceName: this.instance.name, instanceId: this.instanceId },\n          messageRaw,\n        );\n      }\n\n      if (this.configService.get<Chatwoot>('CHATWOOT').ENABLED && this.localChatwoot?.enabled && isIntegration)\n        await chatbotController.emit({\n          instance: { instanceName: this.instance.name, instanceId: this.instanceId },\n          remoteJid: messageRaw.key.remoteJid,\n          msg: messageRaw,\n          pushName: messageRaw.pushName,\n        });\n\n      await this.prismaRepository.message.create({\n        data: messageRaw,\n      });\n\n      return messageRaw;\n    } catch (error) {\n      this.logger.error(error);\n      throw new BadRequestException(error.toString());\n    }\n  }\n\n  public async textMessage(data: SendTextDto, isIntegration = false) {\n    const res = await this.sendMessageWithTyping(\n      data.number,\n      {\n        conversation: data.text,\n      },\n      {\n        delay: data?.delay,\n        presence: 'composing',\n        quoted: data?.quoted,\n        linkPreview: data?.linkPreview,\n        mentionsEveryOne: data?.mentionsEveryOne,\n        mentioned: data?.mentioned,\n      },\n      null,\n      isIntegration,\n    );\n    return res;\n  }\n\n  protected async prepareMediaMessage(mediaMessage: MediaMessage) {\n    try {\n      if (mediaMessage.mediatype === 'document' && !mediaMessage.fileName) {\n        const regex = new RegExp(/.*\\/(.+?)\\./);\n        const arrayMatch = regex.exec(mediaMessage.media);\n        mediaMessage.fileName = arrayMatch[1];\n      }\n\n      if (mediaMessage.mediatype === 'image' && !mediaMessage.fileName) {\n        mediaMessage.fileName = 'image.png';\n      }\n\n      if (mediaMessage.mediatype === 'video' && !mediaMessage.fileName) {\n        mediaMessage.fileName = 'video.mp4';\n      }\n\n      let mimetype: string | false;\n\n      const prepareMedia: any = {\n        caption: mediaMessage?.caption,\n        fileName: mediaMessage.fileName,\n        mediaType: mediaMessage.mediatype,\n        media: mediaMessage.media,\n        gifPlayback: false,\n      };\n\n      if (isURL(mediaMessage.media)) {\n        mimetype = mimeTypes.lookup(mediaMessage.media);\n      } else {\n        mimetype = mimeTypes.lookup(mediaMessage.fileName);\n      }\n\n      prepareMedia.mimetype = mimetype;\n\n      return prepareMedia;\n    } catch (error) {\n      this.logger.error(error);\n      throw new InternalServerErrorException(error?.toString() || error);\n    }\n  }\n\n  public async mediaMessage(data: SendMediaDto, file?: any, isIntegration = false) {\n    const mediaData: SendMediaDto = { ...data };\n\n    if (file) mediaData.media = file.buffer.toString('base64');\n\n    const message = await this.prepareMediaMessage(mediaData);\n\n    const mediaSent = await this.sendMessageWithTyping(\n      data.number,\n      { ...message },\n      {\n        delay: data?.delay,\n        presence: 'composing',\n        quoted: data?.quoted,\n        linkPreview: data?.linkPreview,\n        mentionsEveryOne: data?.mentionsEveryOne,\n        mentioned: data?.mentioned,\n      },\n      file,\n      isIntegration,\n    );\n\n    return mediaSent;\n  }\n\n  public async processAudio(audio: string, number: string, file: any) {\n    number = number.replace(/\\D/g, '');\n    const hash = `${number}-${new Date().getTime()}`;\n\n    const audioConverterConfig = this.configService.get<AudioConverter>('AUDIO_CONVERTER');\n    if (audioConverterConfig.API_URL) {\n      try {\n        this.logger.verbose('Using audio converter API');\n        const formData = new FormData();\n\n        if (file) {\n          formData.append('file', file.buffer, {\n            filename: file.originalname,\n            contentType: file.mimetype,\n          });\n        } else if (isURL(audio)) {\n          formData.append('url', audio);\n        } else {\n          formData.append('base64', audio);\n        }\n\n        formData.append('format', 'mp4');\n\n        const response = await axios.post(audioConverterConfig.API_URL, formData, {\n          headers: {\n            ...formData.getHeaders(),\n            apikey: audioConverterConfig.API_KEY,\n          },\n        });\n\n        if (!response?.data?.audio) {\n          throw new InternalServerErrorException('Failed to convert audio');\n        }\n\n        const prepareMedia: any = {\n          fileName: `${hash}.mp4`,\n          mediaType: 'audio',\n          media: response?.data?.audio,\n          mimetype: 'audio/mpeg',\n        };\n\n        return prepareMedia;\n      } catch (error) {\n        this.logger.error(error?.response?.data || error);\n        throw new InternalServerErrorException(error?.response?.data?.message || error?.toString() || error);\n      }\n    } else {\n      let mimetype: string;\n\n      const prepareMedia: any = {\n        fileName: `${hash}.mp3`,\n        mediaType: 'audio',\n        media: audio,\n        mimetype: 'audio/mpeg',\n      };\n\n      if (isURL(audio)) {\n        mimetype = mimeTypes.lookup(audio).toString();\n      } else {\n        mimetype = mimeTypes.lookup(prepareMedia.fileName).toString();\n      }\n\n      prepareMedia.mimetype = mimetype;\n\n      return prepareMedia;\n    }\n  }\n\n  public async audioWhatsapp(data: SendAudioDto, file?: any, isIntegration = false) {\n    const mediaData: SendAudioDto = { ...data };\n\n    if (file?.buffer) {\n      mediaData.audio = file.buffer.toString('base64');\n    } else {\n      console.error('El archivo o buffer no est definido correctamente.');\n      throw new Error('File or buffer is undefined.');\n    }\n\n    const message = await this.processAudio(mediaData.audio, data.number, file);\n\n    const audioSent = await this.sendMessageWithTyping(\n      data.number,\n      { ...message },\n      {\n        delay: data?.delay,\n        presence: 'composing',\n        quoted: data?.quoted,\n        linkPreview: data?.linkPreview,\n        mentionsEveryOne: data?.mentionsEveryOne,\n        mentioned: data?.mentioned,\n      },\n      file,\n      isIntegration,\n    );\n\n    return audioSent;\n  }\n\n  public async buttonMessage(data: SendButtonsDto, isIntegration = false) {\n    return await this.sendMessageWithTyping(\n      data.number,\n      {\n        buttonMessage: {\n          title: data.title,\n          description: data.description,\n          footer: data.footer,\n          buttons: data.buttons,\n        },\n      },\n      {\n        delay: data?.delay,\n        presence: 'composing',\n        quoted: data?.quoted,\n        mentionsEveryOne: data?.mentionsEveryOne,\n        mentioned: data?.mentioned,\n      },\n      null,\n      isIntegration,\n    );\n  }\n  public async locationMessage() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async listMessage() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async templateMessage() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async contactMessage() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async reactionMessage() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async getBase64FromMediaMessage() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async deleteMessage() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async mediaSticker() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async pollMessage() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async statusMessage() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async reloadConnection() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async whatsappNumber() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async markMessageAsRead() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async archiveChat() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async markChatUnread() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async fetchProfile() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async offerCall() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async sendPresence() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async setPresence() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async fetchPrivacySettings() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async updatePrivacySettings() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async fetchBusinessProfile() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async updateProfileName() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async updateProfileStatus() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async updateProfilePicture() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async removeProfilePicture() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async blockUser() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async updateMessage() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async createGroup() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async updateGroupPicture() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async updateGroupSubject() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async updateGroupDescription() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async findGroup() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async fetchAllGroups() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async inviteCode() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async inviteInfo() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async sendInvite() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async acceptInviteCode() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async revokeInviteCode() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async findParticipants() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async updateGParticipant() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async updateGSetting() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async toggleEphemeral() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async leaveGroup() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async fetchLabels() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async handleLabel() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async receiveMobileCode() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n  public async fakeCall() {\n    throw new BadRequestException('Method not available on Evolution Channel');\n  }\n}\n","import { wa } from '@api/types/wa.types';\n\nexport const status: Record<number, wa.StatusMessage> = {\n  0: 'ERROR',\n  1: 'PENDING',\n  2: 'SERVER_ACK',\n  3: 'DELIVERY_ACK',\n  4: 'READ',\n  5: 'PLAYED',\n};\n","import { NumberBusiness } from '@api/dto/chat.dto';\nimport {\n  ContactMessage,\n  MediaMessage,\n  Options,\n  SendAudioDto,\n  SendButtonsDto,\n  SendContactDto,\n  SendListDto,\n  SendLocationDto,\n  SendMediaDto,\n  SendReactionDto,\n  SendTemplateDto,\n  SendTextDto,\n} from '@api/dto/sendMessage.dto';\nimport * as s3Service from '@api/integrations/storage/s3/libs/minio.server';\nimport { ProviderFiles } from '@api/provider/sessions';\nimport { PrismaRepository } from '@api/repository/repository.service';\nimport { chatbotController } from '@api/server.module';\nimport { CacheService } from '@api/services/cache.service';\nimport { ChannelStartupService } from '@api/services/channel.service';\nimport { Events, wa } from '@api/types/wa.types';\nimport { AudioConverter, Chatwoot, ConfigService, Database, Openai, S3, WaBusiness } from '@config/env.config';\nimport { BadRequestException, InternalServerErrorException } from '@exceptions';\nimport { createJid } from '@utils/createJid';\nimport { status } from '@utils/renderStatus';\nimport { sendTelemetry } from '@utils/sendTelemetry';\nimport axios from 'axios';\nimport { arrayUnique, isURL } from 'class-validator';\nimport EventEmitter2 from 'eventemitter2';\nimport FormData from 'form-data';\nimport mimeTypes from 'mime-types';\nimport { join } from 'path';\n\nexport class BusinessStartupService extends ChannelStartupService {\n  constructor(\n    public readonly configService: ConfigService,\n    public readonly eventEmitter: EventEmitter2,\n    public readonly prismaRepository: PrismaRepository,\n    public readonly cache: CacheService,\n    public readonly chatwootCache: CacheService,\n    public readonly baileysCache: CacheService,\n    private readonly providerFiles: ProviderFiles,\n  ) {\n    super(configService, eventEmitter, prismaRepository, chatwootCache);\n  }\n\n  public stateConnection: wa.StateConnection = { state: 'open' };\n\n  public phoneNumber: string;\n  public mobile: boolean;\n\n  public get connectionStatus() {\n    return this.stateConnection;\n  }\n\n  public async closeClient() {\n    this.stateConnection = { state: 'close' };\n  }\n\n  public get qrCode(): wa.QrCode {\n    return {\n      pairingCode: this.instance.qrcode?.pairingCode,\n      code: this.instance.qrcode?.code,\n      base64: this.instance.qrcode?.base64,\n      count: this.instance.qrcode?.count,\n    };\n  }\n\n  public async logoutInstance() {\n    await this.closeClient();\n  }\n\n  private isMediaMessage(message: any) {\n    return message.document || message.image || message.audio || message.video;\n  }\n\n  private async post(message: any, params: string) {\n    try {\n      let urlServer = this.configService.get<WaBusiness>('WA_BUSINESS').URL;\n      const version = this.configService.get<WaBusiness>('WA_BUSINESS').VERSION;\n      urlServer = `${urlServer}/${version}/${this.number}/${params}`;\n      const headers = { 'Content-Type': 'application/json', Authorization: `Bearer ${this.token}` };\n      const result = await axios.post(urlServer, message, { headers });\n      return result.data;\n    } catch (e) {\n      return e.response?.data?.error;\n    }\n  }\n\n  public async profilePicture(number: string) {\n    const jid = createJid(number);\n\n    return {\n      wuid: jid,\n      profilePictureUrl: null,\n    };\n  }\n\n  public async getProfileName() {\n    return null;\n  }\n\n  public async profilePictureUrl() {\n    return null;\n  }\n\n  public async getProfileStatus() {\n    return null;\n  }\n\n  public async setWhatsappBusinessProfile(data: NumberBusiness): Promise<any> {\n    const content = {\n      messaging_product: 'whatsapp',\n      about: data.about,\n      address: data.address,\n      description: data.description,\n      vertical: data.vertical,\n      email: data.email,\n      websites: data.websites,\n      profile_picture_handle: data.profilehandle,\n    };\n    return await this.post(content, 'whatsapp_business_profile');\n  }\n\n  public async connectToWhatsapp(data?: any): Promise<any> {\n    if (!data) return;\n\n    const content = data.entry[0].changes[0].value;\n\n    try {\n      this.loadChatwoot();\n\n      this.eventHandler(content);\n\n      this.phoneNumber = createJid(content.messages ? content.messages[0].from : content.statuses[0]?.recipient_id);\n    } catch (error) {\n      this.logger.error(error);\n      throw new InternalServerErrorException(error?.toString());\n    }\n  }\n\n  private async downloadMediaMessage(message: any) {\n    try {\n      const id = message[message.type].id;\n      let urlServer = this.configService.get<WaBusiness>('WA_BUSINESS').URL;\n      const version = this.configService.get<WaBusiness>('WA_BUSINESS').VERSION;\n      urlServer = `${urlServer}/${version}/${id}`;\n      const headers = { 'Content-Type': 'application/json', Authorization: `Bearer ${this.token}` };\n\n      // Primeiro, obtenha a URL do arquivo\n      let result = await axios.get(urlServer, { headers });\n\n      // Depois, baixe o arquivo usando a URL retornada\n      result = await axios.get(result.data.url, {\n        headers: { Authorization: `Bearer ${this.token}` }, // Use apenas o token de autorizao para download\n        responseType: 'arraybuffer',\n      });\n\n      return result.data;\n    } catch (e) {\n      this.logger.error(`Error downloading media: ${e}`);\n      throw e;\n    }\n  }\n\n  private messageMediaJson(received: any) {\n    const message = received.messages[0];\n    let content: any = message.type + 'Message';\n    content = { [content]: message[message.type] };\n    if (message.context) {\n      content = { ...content, contextInfo: { stanzaId: message.context.id } };\n    }\n    return content;\n  }\n\n  private messageAudioJson(received: any) {\n    const message = received.messages[0];\n    let content: any = {\n      audioMessage: {\n        ...message.audio,\n        ptt: message.audio.voice || false, // Define se  mensagem de voz\n      },\n    };\n    if (message.context) {\n      content = { ...content, contextInfo: { stanzaId: message.context.id } };\n    }\n    return content;\n  }\n\n  private messageInteractiveJson(received: any) {\n    const message = received.messages[0];\n    let content: any = { conversation: message.interactive[message.interactive.type].title };\n    message.context ? (content = { ...content, contextInfo: { stanzaId: message.context.id } }) : content;\n    return content;\n  }\n\n  private messageButtonJson(received: any) {\n    const message = received.messages[0];\n    let content: any = { conversation: received.messages[0].button?.text };\n    message.context ? (content = { ...content, contextInfo: { stanzaId: message.context.id } }) : content;\n    return content;\n  }\n\n  private messageReactionJson(received: any) {\n    const message = received.messages[0];\n    let content: any = {\n      reactionMessage: {\n        key: {\n          id: message.reaction.message_id,\n        },\n        text: message.reaction.emoji,\n      },\n    };\n    message.context ? (content = { ...content, contextInfo: { stanzaId: message.context.id } }) : content;\n    return content;\n  }\n\n  private messageTextJson(received: any) {\n    // Verificar que received y received.messages existen\n    if (!received || !received.messages || received.messages.length === 0) {\n      this.logger.error('Error: received object or messages array is undefined or empty');\n      return null;\n    }\n\n    const message = received.messages[0];\n    let content: any;\n\n    // Verificar si es un mensaje de tipo sticker, location u otro tipo que no tiene text\n    if (!message.text) {\n      // Si no hay texto, manejamos diferente segn el tipo de mensaje\n      if (message.type === 'sticker') {\n        content = { stickerMessage: {} };\n      } else if (message.type === 'location') {\n        content = {\n          locationMessage: {\n            degreesLatitude: message.location?.latitude,\n            degreesLongitude: message.location?.longitude,\n            name: message.location?.name,\n            address: message.location?.address,\n          },\n        };\n      } else {\n        // Para otros tipos de mensajes sin texto, creamos un contenido genrico\n        this.logger.log(`Mensaje de tipo ${message.type} sin campo text`);\n        content = { [message.type + 'Message']: message[message.type] || {} };\n      }\n\n      // Aadir contexto si existe\n      if (message.context) {\n        content = { ...content, contextInfo: { stanzaId: message.context.id } };\n      }\n\n      return content;\n    }\n\n    // Si el mensaje tiene texto, procesamos normalmente\n    if (!received.metadata || !received.metadata.phone_number_id) {\n      this.logger.error('Error: metadata or phone_number_id is undefined');\n      return null;\n    }\n\n    if (message.from === received.metadata.phone_number_id) {\n      content = {\n        extendedTextMessage: { text: message.text.body },\n      };\n      if (message.context) {\n        content = { ...content, contextInfo: { stanzaId: message.context.id } };\n      }\n    } else {\n      content = { conversation: message.text.body };\n      if (message.context) {\n        content = { ...content, contextInfo: { stanzaId: message.context.id } };\n      }\n    }\n\n    return content;\n  }\n\n  private messageLocationJson(received: any) {\n    const message = received.messages[0];\n    let content: any = {\n      locationMessage: {\n        degreesLatitude: message.location.latitude,\n        degreesLongitude: message.location.longitude,\n        name: message.location?.name,\n        address: message.location?.address,\n      },\n    };\n    message.context ? (content = { ...content, contextInfo: { stanzaId: message.context.id } }) : content;\n    return content;\n  }\n\n  private messageContactsJson(received: any) {\n    const message = received.messages[0];\n    let content: any = {};\n\n    const vcard = (contact: any) => {\n      let result =\n        'BEGIN:VCARD\\n' +\n        'VERSION:3.0\\n' +\n        `N:${contact.name.formatted_name}\\n` +\n        `FN:${contact.name.formatted_name}\\n`;\n\n      if (contact.org) {\n        result += `ORG:${contact.org.company};\\n`;\n      }\n\n      if (contact.emails) {\n        result += `EMAIL:${contact.emails[0].email}\\n`;\n      }\n\n      if (contact.urls) {\n        result += `URL:${contact.urls[0].url}\\n`;\n      }\n\n      if (!contact.phones[0]?.wa_id) {\n        contact.phones[0].wa_id = createJid(contact.phones[0].phone);\n      }\n\n      result +=\n        `item1.TEL;waid=${contact.phones[0]?.wa_id}:${contact.phones[0].phone}\\n` +\n        'item1.X-ABLabel:Celular\\n' +\n        'END:VCARD';\n\n      return result;\n    };\n\n    if (message.contacts.length === 1) {\n      content.contactMessage = {\n        displayName: message.contacts[0].name.formatted_name,\n        vcard: vcard(message.contacts[0]),\n      };\n    } else {\n      content.contactsArrayMessage = {\n        displayName: `${message.length} contacts`,\n        contacts: message.map((contact) => {\n          return {\n            displayName: contact.name.formatted_name,\n            vcard: vcard(contact),\n          };\n        }),\n      };\n    }\n    message.context ? (content = { ...content, contextInfo: { stanzaId: message.context.id } }) : content;\n    return content;\n  }\n\n  private renderMessageType(type: string) {\n    let messageType: string;\n\n    switch (type) {\n      case 'text':\n        messageType = 'conversation';\n        break;\n      case 'image':\n        messageType = 'imageMessage';\n        break;\n      case 'video':\n        messageType = 'videoMessage';\n        break;\n      case 'audio':\n        messageType = 'audioMessage';\n        break;\n      case 'document':\n        messageType = 'documentMessage';\n        break;\n      case 'template':\n        messageType = 'conversation';\n        break;\n      case 'location':\n        messageType = 'locationMessage';\n        break;\n      case 'sticker':\n        messageType = 'stickerMessage';\n        break;\n      default:\n        messageType = 'conversation';\n        break;\n    }\n\n    return messageType;\n  }\n\n  protected async messageHandle(received: any, database: Database, settings: any) {\n    try {\n      let messageRaw: any;\n      let pushName: any;\n\n      if (received.contacts) pushName = received.contacts[0].profile.name;\n\n      if (received.messages) {\n        const message = received.messages[0]; // Aadir esta lnea para definir message\n\n        const key = {\n          id: message.id,\n          remoteJid: this.phoneNumber,\n          fromMe: message.from === received.metadata.phone_number_id,\n        };\n\n        if (message.type === 'sticker') {\n          this.logger.log('Procesando mensaje de tipo sticker');\n          messageRaw = {\n            key,\n            pushName,\n            message: {\n              stickerMessage: message.sticker || {},\n            },\n            messageType: 'stickerMessage',\n            messageTimestamp: parseInt(message.timestamp) as number,\n            source: 'unknown',\n            instanceId: this.instanceId,\n          };\n        } else if (this.isMediaMessage(message)) {\n          const messageContent =\n            message.type === 'audio' ? this.messageAudioJson(received) : this.messageMediaJson(received);\n\n          messageRaw = {\n            key,\n            pushName,\n            message: messageContent,\n            contextInfo: messageContent?.contextInfo,\n            messageType: this.renderMessageType(received.messages[0].type),\n            messageTimestamp: parseInt(received.messages[0].timestamp) as number,\n            source: 'unknown',\n            instanceId: this.instanceId,\n          };\n\n          if (this.configService.get<S3>('S3').ENABLE) {\n            try {\n              const message: any = received;\n\n              // Verificao adicional para garantir que h contedo de mdia real\n              const hasRealMedia = this.hasValidMediaContent(messageRaw);\n\n              if (!hasRealMedia) {\n                this.logger.warn('Message detected as media but contains no valid media content');\n              } else {\n                const id = message.messages[0][message.messages[0].type].id;\n                let urlServer = this.configService.get<WaBusiness>('WA_BUSINESS').URL;\n                const version = this.configService.get<WaBusiness>('WA_BUSINESS').VERSION;\n                urlServer = `${urlServer}/${version}/${id}`;\n                const headers = { 'Content-Type': 'application/json', Authorization: `Bearer ${this.token}` };\n                const result = await axios.get(urlServer, { headers });\n\n                const buffer = await axios.get(result.data.url, {\n                  headers: { Authorization: `Bearer ${this.token}` }, // Use apenas o token de autorizao para download\n                  responseType: 'arraybuffer',\n                });\n\n                let mediaType;\n\n                if (message.messages[0].document) {\n                  mediaType = 'document';\n                } else if (message.messages[0].image) {\n                  mediaType = 'image';\n                } else if (message.messages[0].audio) {\n                  mediaType = 'audio';\n                } else {\n                  mediaType = 'video';\n                }\n\n                if (mediaType == 'video' && !this.configService.get<S3>('S3').SAVE_VIDEO) {\n                  this.logger?.info?.('Video upload attempted but is disabled by configuration.');\n                  return {\n                    success: false,\n                    message:\n                      'Video upload is currently disabled. Please contact support if you need this feature enabled.',\n                  };\n                }\n\n                const mimetype = result.data?.mime_type || result.headers['content-type'];\n\n                const contentDisposition = result.headers['content-disposition'];\n                let fileName = `${message.messages[0].id}.${mimetype.split('/')[1]}`;\n                if (contentDisposition) {\n                  const match = contentDisposition.match(/filename=\"(.+?)\"/);\n                  if (match) {\n                    fileName = match[1];\n                  }\n                }\n\n                // Para udio, garantir extenso correta baseada no mimetype\n                if (mediaType === 'audio') {\n                  if (mimetype.includes('ogg')) {\n                    fileName = `${message.messages[0].id}.ogg`;\n                  } else if (mimetype.includes('mp3')) {\n                    fileName = `${message.messages[0].id}.mp3`;\n                  } else if (mimetype.includes('m4a')) {\n                    fileName = `${message.messages[0].id}.m4a`;\n                  }\n                }\n\n                const size = result.headers['content-length'] || buffer.data.byteLength;\n\n                const fullName = join(`${this.instance.id}`, key.remoteJid, mediaType, fileName);\n\n                await s3Service.uploadFile(fullName, buffer.data, size, {\n                  'Content-Type': mimetype,\n                });\n\n                const createdMessage = await this.prismaRepository.message.create({\n                  data: messageRaw,\n                });\n\n                await this.prismaRepository.media.create({\n                  data: {\n                    messageId: createdMessage.id,\n                    instanceId: this.instanceId,\n                    type: mediaType,\n                    fileName: fullName,\n                    mimetype,\n                  },\n                });\n\n                const mediaUrl = await s3Service.getObjectUrl(fullName);\n\n                messageRaw.message.mediaUrl = mediaUrl;\n                if (this.localWebhook.enabled && this.localWebhook.webhookBase64) {\n                  messageRaw.message.base64 = buffer.data.toString('base64');\n                }\n\n                // Processar OpenAI speech-to-text para udio aps o mediaUrl estar disponvel\n                if (this.configService.get<Openai>('OPENAI').ENABLED && mediaType === 'audio') {\n                  const openAiDefaultSettings = await this.prismaRepository.openaiSetting.findFirst({\n                    where: {\n                      instanceId: this.instanceId,\n                    },\n                    include: {\n                      OpenaiCreds: true,\n                    },\n                  });\n\n                  if (\n                    openAiDefaultSettings &&\n                    openAiDefaultSettings.openaiCredsId &&\n                    openAiDefaultSettings.speechToText\n                  ) {\n                    try {\n                      messageRaw.message.speechToText = `[audio] ${await this.openaiService.speechToText(\n                        openAiDefaultSettings.OpenaiCreds,\n                        {\n                          message: {\n                            mediaUrl: messageRaw.message.mediaUrl,\n                            ...messageRaw,\n                          },\n                        },\n                      )}`;\n                    } catch (speechError) {\n                      this.logger.error(`Error processing speech-to-text: ${speechError}`);\n                    }\n                  }\n                }\n              }\n            } catch (error) {\n              this.logger.error(['Error on upload file to minio', error?.message, error?.stack]);\n            }\n          } else {\n            if (this.localWebhook.enabled && this.localWebhook.webhookBase64) {\n              const buffer = await this.downloadMediaMessage(received?.messages[0]);\n              messageRaw.message.base64 = buffer.toString('base64');\n            }\n\n            // Processar OpenAI speech-to-text para udio mesmo sem S3\n            if (this.configService.get<Openai>('OPENAI').ENABLED && message.type === 'audio') {\n              let openAiBase64 = messageRaw.message.base64;\n              if (!openAiBase64) {\n                const buffer = await this.downloadMediaMessage(received?.messages[0]);\n                openAiBase64 = buffer.toString('base64');\n              }\n\n              const openAiDefaultSettings = await this.prismaRepository.openaiSetting.findFirst({\n                where: {\n                  instanceId: this.instanceId,\n                },\n                include: {\n                  OpenaiCreds: true,\n                },\n              });\n\n              if (openAiDefaultSettings && openAiDefaultSettings.openaiCredsId && openAiDefaultSettings.speechToText) {\n                try {\n                  messageRaw.message.speechToText = `[audio] ${await this.openaiService.speechToText(\n                    openAiDefaultSettings.OpenaiCreds,\n                    {\n                      message: {\n                        base64: openAiBase64,\n                        ...messageRaw,\n                      },\n                    },\n                  )}`;\n                } catch (speechError) {\n                  this.logger.error(`Error processing speech-to-text: ${speechError}`);\n                }\n              }\n            }\n          }\n        } else if (received?.messages[0].interactive) {\n          messageRaw = {\n            key,\n            pushName,\n            message: {\n              ...this.messageInteractiveJson(received),\n            },\n            contextInfo: this.messageInteractiveJson(received)?.contextInfo,\n            messageType: 'interactiveMessage',\n            messageTimestamp: parseInt(received.messages[0].timestamp) as number,\n            source: 'unknown',\n            instanceId: this.instanceId,\n          };\n        } else if (received?.messages[0].button) {\n          messageRaw = {\n            key,\n            pushName,\n            message: {\n              ...this.messageButtonJson(received),\n            },\n            contextInfo: this.messageButtonJson(received)?.contextInfo,\n            messageType: 'buttonMessage',\n            messageTimestamp: parseInt(received.messages[0].timestamp) as number,\n            source: 'unknown',\n            instanceId: this.instanceId,\n          };\n        } else if (received?.messages[0].reaction) {\n          messageRaw = {\n            key,\n            pushName,\n            message: {\n              ...this.messageReactionJson(received),\n            },\n            contextInfo: this.messageReactionJson(received)?.contextInfo,\n            messageType: 'reactionMessage',\n            messageTimestamp: parseInt(received.messages[0].timestamp) as number,\n            source: 'unknown',\n            instanceId: this.instanceId,\n          };\n        } else if (received?.messages[0].contacts) {\n          messageRaw = {\n            key,\n            pushName,\n            message: {\n              ...this.messageContactsJson(received),\n            },\n            contextInfo: this.messageContactsJson(received)?.contextInfo,\n            messageType: 'contactMessage',\n            messageTimestamp: parseInt(received.messages[0].timestamp) as number,\n            source: 'unknown',\n            instanceId: this.instanceId,\n          };\n        } else {\n          messageRaw = {\n            key,\n            pushName,\n            message: this.messageTextJson(received),\n            contextInfo: this.messageTextJson(received)?.contextInfo,\n            messageType: this.renderMessageType(received.messages[0].type),\n            messageTimestamp: parseInt(received.messages[0].timestamp) as number,\n            source: 'unknown',\n            instanceId: this.instanceId,\n          };\n        }\n\n        if (this.localSettings.readMessages) {\n          // await this.client.readMessages([received.key]);\n        }\n\n        this.logger.log(messageRaw);\n\n        sendTelemetry(`received.message.${messageRaw.messageType ?? 'unknown'}`);\n\n        this.sendDataWebhook(Events.MESSAGES_UPSERT, messageRaw);\n\n        await chatbotController.emit({\n          instance: { instanceName: this.instance.name, instanceId: this.instanceId },\n          remoteJid: messageRaw.key.remoteJid,\n          msg: messageRaw,\n          pushName: messageRaw.pushName,\n        });\n\n        if (this.configService.get<Chatwoot>('CHATWOOT').ENABLED && this.localChatwoot?.enabled) {\n          const chatwootSentMessage = await this.chatwootService.eventWhatsapp(\n            Events.MESSAGES_UPSERT,\n            { instanceName: this.instance.name, instanceId: this.instanceId },\n            messageRaw,\n          );\n\n          if (chatwootSentMessage?.id) {\n            messageRaw.chatwootMessageId = chatwootSentMessage.id;\n            messageRaw.chatwootInboxId = chatwootSentMessage.id;\n            messageRaw.chatwootConversationId = chatwootSentMessage.id;\n          }\n        }\n\n        if (!this.isMediaMessage(message) && message.type !== 'sticker') {\n          await this.prismaRepository.message.create({\n            data: messageRaw,\n          });\n        }\n\n        const contact = await this.prismaRepository.contact.findFirst({\n          where: { instanceId: this.instanceId, remoteJid: key.remoteJid },\n        });\n\n        const contactRaw: any = {\n          remoteJid: received.contacts[0].profile.phone,\n          pushName,\n          // profilePicUrl: '',\n          instanceId: this.instanceId,\n        };\n\n        if (contactRaw.remoteJid === 'status@broadcast') {\n          return;\n        }\n\n        if (contact) {\n          const contactRaw: any = {\n            remoteJid: received.contacts[0].profile.phone,\n            pushName,\n            // profilePicUrl: '',\n            instanceId: this.instanceId,\n          };\n\n          this.sendDataWebhook(Events.CONTACTS_UPDATE, contactRaw);\n\n          if (this.configService.get<Chatwoot>('CHATWOOT').ENABLED && this.localChatwoot?.enabled) {\n            await this.chatwootService.eventWhatsapp(\n              Events.CONTACTS_UPDATE,\n              { instanceName: this.instance.name, instanceId: this.instanceId },\n              contactRaw,\n            );\n          }\n\n          await this.prismaRepository.contact.updateMany({\n            where: { remoteJid: contact.remoteJid },\n            data: contactRaw,\n          });\n          return;\n        }\n\n        this.sendDataWebhook(Events.CONTACTS_UPSERT, contactRaw);\n\n        this.prismaRepository.contact.create({\n          data: contactRaw,\n        });\n      }\n      if (received.statuses) {\n        for await (const item of received.statuses) {\n          const key = {\n            id: item.id,\n            remoteJid: this.phoneNumber,\n            fromMe: this.phoneNumber === received.metadata.phone_number_id,\n          };\n          if (settings?.groups_ignore && key.remoteJid.includes('@g.us')) {\n            return;\n          }\n          if (key.remoteJid !== 'status@broadcast' && !key?.remoteJid?.match(/(:\\d+)/)) {\n            const findMessage = await this.prismaRepository.message.findFirst({\n              where: {\n                instanceId: this.instanceId,\n                key: {\n                  path: ['id'],\n                  equals: key.id,\n                },\n              },\n            });\n\n            if (!findMessage) {\n              return;\n            }\n\n            if (item.message === null && item.status === undefined) {\n              this.sendDataWebhook(Events.MESSAGES_DELETE, key);\n\n              const message: any = {\n                messageId: findMessage.id,\n                keyId: key.id,\n                remoteJid: key.remoteJid,\n                fromMe: key.fromMe,\n                participant: key?.remoteJid,\n                status: 'DELETED',\n                instanceId: this.instanceId,\n              };\n\n              await this.prismaRepository.messageUpdate.create({\n                data: message,\n              });\n\n              if (this.configService.get<Chatwoot>('CHATWOOT').ENABLED && this.localChatwoot?.enabled) {\n                this.chatwootService.eventWhatsapp(\n                  Events.MESSAGES_DELETE,\n                  { instanceName: this.instance.name, instanceId: this.instanceId },\n                  { key: key },\n                );\n              }\n\n              return;\n            }\n\n            const message: any = {\n              messageId: findMessage.id,\n              keyId: key.id,\n              remoteJid: key.remoteJid,\n              fromMe: key.fromMe,\n              participant: key?.remoteJid,\n              status: item.status.toUpperCase(),\n              instanceId: this.instanceId,\n            };\n\n            this.sendDataWebhook(Events.MESSAGES_UPDATE, message);\n\n            await this.prismaRepository.messageUpdate.create({\n              data: message,\n            });\n\n            if (findMessage.webhookUrl) {\n              await axios.post(findMessage.webhookUrl, message);\n            }\n          }\n        }\n      }\n    } catch (error) {\n      this.logger.error(error);\n    }\n  }\n\n  private convertMessageToRaw(message: any, content: any) {\n    let convertMessage: any;\n\n    if (message?.conversation) {\n      if (content?.context?.message_id) {\n        convertMessage = {\n          ...message,\n          contextInfo: { stanzaId: content.context.message_id },\n        };\n        return convertMessage;\n      }\n      convertMessage = message;\n      return convertMessage;\n    }\n\n    if (message?.mediaType === 'image') {\n      if (content?.context?.message_id) {\n        convertMessage = {\n          imageMessage: message,\n          contextInfo: { stanzaId: content.context.message_id },\n        };\n        return convertMessage;\n      }\n      return {\n        imageMessage: message,\n      };\n    }\n\n    if (message?.mediaType === 'video') {\n      if (content?.context?.message_id) {\n        convertMessage = {\n          videoMessage: message,\n          contextInfo: { stanzaId: content.context.message_id },\n        };\n        return convertMessage;\n      }\n      return {\n        videoMessage: message,\n      };\n    }\n\n    if (message?.mediaType === 'audio') {\n      if (content?.context?.message_id) {\n        convertMessage = {\n          audioMessage: message,\n          contextInfo: { stanzaId: content.context.message_id },\n        };\n        return convertMessage;\n      }\n      return {\n        audioMessage: message,\n      };\n    }\n\n    if (message?.mediaType === 'document') {\n      if (content?.context?.message_id) {\n        convertMessage = {\n          documentMessage: message,\n          contextInfo: { stanzaId: content.context.message_id },\n        };\n        return convertMessage;\n      }\n      return {\n        documentMessage: message,\n      };\n    }\n\n    return message;\n  }\n\n  protected async eventHandler(content: any) {\n    try {\n      // Registro para depuracin\n      this.logger.log('Contenido recibido en eventHandler:');\n      this.logger.log(JSON.stringify(content, null, 2));\n\n      const database = this.configService.get<Database>('DATABASE');\n      const settings = await this.findSettings();\n\n      // Si hay mensajes, verificar primero el tipo\n      if (content.messages && content.messages.length > 0) {\n        const message = content.messages[0];\n        this.logger.log(`Tipo de mensaje recibido: ${message.type}`);\n\n        // Verificamos el tipo de mensaje antes de procesarlo\n        if (\n          message.type === 'text' ||\n          message.type === 'image' ||\n          message.type === 'video' ||\n          message.type === 'audio' ||\n          message.type === 'document' ||\n          message.type === 'sticker' ||\n          message.type === 'location' ||\n          message.type === 'contacts' ||\n          message.type === 'interactive' ||\n          message.type === 'button' ||\n          message.type === 'reaction'\n        ) {\n          // Procesar el mensaje normalmente\n          this.messageHandle(content, database, settings);\n        } else {\n          this.logger.warn(`Tipo de mensaje no reconocido: ${message.type}`);\n        }\n      } else if (content.statuses) {\n        // Procesar actualizaciones de estado\n        this.messageHandle(content, database, settings);\n      } else {\n        this.logger.warn('No se encontraron mensajes ni estados en el contenido recibido');\n      }\n    } catch (error) {\n      this.logger.error('Error en eventHandler:');\n      this.logger.error(error);\n    }\n  }\n\n  protected async sendMessageWithTyping(number: string, message: any, options?: Options, isIntegration = false) {\n    try {\n      let quoted: any;\n      let webhookUrl: any;\n      if (options?.quoted) {\n        const m = options?.quoted;\n\n        const msg = m?.key;\n\n        if (!msg) {\n          throw 'Message not found';\n        }\n\n        quoted = msg;\n      }\n      if (options?.webhookUrl) {\n        webhookUrl = options.webhookUrl;\n      }\n\n      let content: any;\n      const messageSent = await (async () => {\n        if (message['reactionMessage']) {\n          content = {\n            messaging_product: 'whatsapp',\n            recipient_type: 'individual',\n            type: 'reaction',\n            to: number.replace(/\\D/g, ''),\n            reaction: {\n              message_id: message['reactionMessage']['key']['id'],\n              emoji: message['reactionMessage']['text'],\n            },\n          };\n          quoted ? (content.context = { message_id: quoted.id }) : content;\n          return await this.post(content, 'messages');\n        }\n        if (message['locationMessage']) {\n          content = {\n            messaging_product: 'whatsapp',\n            recipient_type: 'individual',\n            type: 'location',\n            to: number.replace(/\\D/g, ''),\n            location: {\n              longitude: message['locationMessage']['degreesLongitude'],\n              latitude: message['locationMessage']['degreesLatitude'],\n              name: message['locationMessage']['name'],\n              address: message['locationMessage']['address'],\n            },\n          };\n          quoted ? (content.context = { message_id: quoted.id }) : content;\n          return await this.post(content, 'messages');\n        }\n        if (message['contacts']) {\n          content = {\n            messaging_product: 'whatsapp',\n            recipient_type: 'individual',\n            type: 'contacts',\n            to: number.replace(/\\D/g, ''),\n            contacts: message['contacts'],\n          };\n          quoted ? (content.context = { message_id: quoted.id }) : content;\n          message = message['message'];\n          return await this.post(content, 'messages');\n        }\n        if (message['conversation']) {\n          content = {\n            messaging_product: 'whatsapp',\n            recipient_type: 'individual',\n            type: 'text',\n            to: number.replace(/\\D/g, ''),\n            text: {\n              body: message['conversation'],\n              preview_url: Boolean(options?.linkPreview),\n            },\n          };\n          quoted ? (content.context = { message_id: quoted.id }) : content;\n          return await this.post(content, 'messages');\n        }\n        if (message['media']) {\n          const isImage = message['mimetype']?.startsWith('image/');\n\n          content = {\n            messaging_product: 'whatsapp',\n            recipient_type: 'individual',\n            type: message['mediaType'],\n            to: number.replace(/\\D/g, ''),\n            [message['mediaType']]: {\n              [message['type']]: message['id'],\n              ...(message['mediaType'] !== 'audio' &&\n                message['mediaType'] !== 'video' &&\n                message['fileName'] &&\n                !isImage && { filename: message['fileName'] }),\n              ...(message['mediaType'] !== 'audio' && message['caption'] && { caption: message['caption'] }),\n            },\n          };\n          quoted ? (content.context = { message_id: quoted.id }) : content;\n          return await this.post(content, 'messages');\n        }\n        if (message['audio']) {\n          content = {\n            messaging_product: 'whatsapp',\n            recipient_type: 'individual',\n            type: 'audio',\n            to: number.replace(/\\D/g, ''),\n            audio: {\n              [message['type']]: message['id'],\n            },\n          };\n          quoted ? (content.context = { message_id: quoted.id }) : content;\n          return await this.post(content, 'messages');\n        }\n        if (message['buttons']) {\n          content = {\n            messaging_product: 'whatsapp',\n            recipient_type: 'individual',\n            to: number.replace(/\\D/g, ''),\n            type: 'interactive',\n            interactive: {\n              type: 'button',\n              body: {\n                text: message['text'] || 'Select',\n              },\n              action: {\n                buttons: message['buttons'],\n              },\n            },\n          };\n          quoted ? (content.context = { message_id: quoted.id }) : content;\n          let formattedText = '';\n          for (const item of message['buttons']) {\n            formattedText += ` ${item.reply?.title}\\n`;\n          }\n          message = { conversation: `${message['text'] || 'Select'}\\n` + formattedText };\n          return await this.post(content, 'messages');\n        }\n        if (message['listMessage']) {\n          content = {\n            messaging_product: 'whatsapp',\n            recipient_type: 'individual',\n            to: number.replace(/\\D/g, ''),\n            type: 'interactive',\n            interactive: {\n              type: 'list',\n              header: {\n                type: 'text',\n                text: message['listMessage']['title'],\n              },\n              body: {\n                text: message['listMessage']['description'],\n              },\n              footer: {\n                text: message['listMessage']['footerText'],\n              },\n              action: {\n                button: message['listMessage']['buttonText'],\n                sections: message['listMessage']['sections'],\n              },\n            },\n          };\n          quoted ? (content.context = { message_id: quoted.id }) : content;\n          let formattedText = '';\n          for (const section of message['listMessage']['sections']) {\n            formattedText += `${section?.title}\\n`;\n            for (const row of section.rows) {\n              formattedText += `${row?.title}\\n`;\n            }\n          }\n          message = { conversation: `${message['listMessage']['title']}\\n` + formattedText };\n          return await this.post(content, 'messages');\n        }\n        if (message['template']) {\n          content = {\n            messaging_product: 'whatsapp',\n            recipient_type: 'individual',\n            to: number.replace(/\\D/g, ''),\n            type: 'template',\n            template: {\n              name: message['template']['name'],\n              language: {\n                code: message['template']['language'] || 'en_US',\n              },\n              components: message['template']['components'],\n            },\n          };\n          quoted ? (content.context = { message_id: quoted.id }) : content;\n          message = { conversation: `${message['template']['name']}` };\n          return await this.post(content, 'messages');\n        }\n      })();\n\n      if (messageSent?.error_data || messageSent.message) {\n        this.logger.error(messageSent);\n        return messageSent;\n      }\n\n      const messageRaw: any = {\n        key: { fromMe: true, id: messageSent?.messages[0]?.id, remoteJid: createJid(number) },\n        message: this.convertMessageToRaw(message, content),\n        messageType: this.renderMessageType(content.type),\n        messageTimestamp: (messageSent?.messages[0]?.timestamp as number) || Math.round(new Date().getTime() / 1000),\n        instanceId: this.instanceId,\n        webhookUrl,\n        status: status[1],\n        source: 'unknown',\n      };\n\n      this.logger.log(messageRaw);\n\n      this.sendDataWebhook(Events.SEND_MESSAGE, messageRaw);\n\n      if (this.configService.get<Chatwoot>('CHATWOOT').ENABLED && this.localChatwoot?.enabled && !isIntegration) {\n        this.chatwootService.eventWhatsapp(\n          Events.SEND_MESSAGE,\n          { instanceName: this.instance.name, instanceId: this.instanceId },\n          messageRaw,\n        );\n      }\n\n      if (this.configService.get<Chatwoot>('CHATWOOT').ENABLED && this.localChatwoot?.enabled && isIntegration)\n        await chatbotController.emit({\n          instance: { instanceName: this.instance.name, instanceId: this.instanceId },\n          remoteJid: messageRaw.key.remoteJid,\n          msg: messageRaw,\n          pushName: messageRaw.pushName,\n        });\n\n      await this.prismaRepository.message.create({\n        data: messageRaw,\n      });\n\n      return messageRaw;\n    } catch (error) {\n      this.logger.error(error);\n      throw new BadRequestException(error.toString());\n    }\n  }\n\n  // Send Message Controller\n  public async textMessage(data: SendTextDto, isIntegration = false) {\n    const res = await this.sendMessageWithTyping(\n      data.number,\n      {\n        conversation: data.text,\n      },\n      {\n        delay: data?.delay,\n        presence: 'composing',\n        quoted: data?.quoted,\n        linkPreview: data?.linkPreview,\n        mentionsEveryOne: data?.mentionsEveryOne,\n        mentioned: data?.mentioned,\n      },\n      isIntegration,\n    );\n    return res;\n  }\n\n  private async getIdMedia(mediaMessage: any, isFile = false) {\n    try {\n      const formData = new FormData();\n\n      if (isFile === false) {\n        if (isURL(mediaMessage.media)) {\n          const response = await axios.get(mediaMessage.media, { responseType: 'arraybuffer' });\n          const buffer = Buffer.from(response.data, 'base64');\n          formData.append('file', buffer, {\n            filename: mediaMessage.fileName || 'media',\n            contentType: mediaMessage.mimetype,\n          });\n        } else {\n          const buffer = Buffer.from(mediaMessage.media, 'base64');\n          formData.append('file', buffer, {\n            filename: mediaMessage.fileName || 'media',\n            contentType: mediaMessage.mimetype,\n          });\n        }\n      } else {\n        formData.append('file', mediaMessage.media.buffer, {\n          filename: mediaMessage.media.originalname,\n          contentType: mediaMessage.media.mimetype,\n        });\n      }\n\n      const mimetype = mediaMessage.mimetype || mediaMessage.media.mimetype;\n\n      formData.append('typeFile', mimetype);\n      formData.append('messaging_product', 'whatsapp');\n\n      const token = this.token;\n\n      const headers = { Authorization: `Bearer ${token}` };\n      const url = `${this.configService.get<WaBusiness>('WA_BUSINESS').URL}/${\n        this.configService.get<WaBusiness>('WA_BUSINESS').VERSION\n      }/${this.number}/media`;\n\n      const res = await axios.post(url, formData, { headers });\n      return res.data.id;\n    } catch (error) {\n      this.logger.error(error.response.data);\n      throw new InternalServerErrorException(error?.toString() || error);\n    }\n  }\n\n  protected async prepareMediaMessage(mediaMessage: MediaMessage) {\n    try {\n      if (mediaMessage.mediatype === 'document' && !mediaMessage.fileName) {\n        const regex = new RegExp(/.*\\/(.+?)\\./);\n        const arrayMatch = regex.exec(mediaMessage.media);\n        mediaMessage.fileName = arrayMatch[1];\n      }\n\n      if (mediaMessage.mediatype === 'image' && !mediaMessage.fileName) {\n        mediaMessage.fileName = 'image.png';\n      }\n\n      if (mediaMessage.mediatype === 'video' && !mediaMessage.fileName) {\n        mediaMessage.fileName = 'video.mp4';\n      }\n\n      let mimetype: string | false;\n\n      const prepareMedia: any = {\n        caption: mediaMessage?.caption,\n        fileName: mediaMessage.fileName,\n        mediaType: mediaMessage.mediatype,\n        media: mediaMessage.media,\n        gifPlayback: false,\n      };\n\n      if (isURL(mediaMessage.media)) {\n        mimetype = mimeTypes.lookup(mediaMessage.media);\n        prepareMedia.id = mediaMessage.media;\n        prepareMedia.type = 'link';\n      } else {\n        mimetype = mimeTypes.lookup(mediaMessage.fileName);\n        const id = await this.getIdMedia(prepareMedia);\n        prepareMedia.id = id;\n        prepareMedia.type = 'id';\n      }\n\n      prepareMedia.mimetype = mimetype;\n\n      return prepareMedia;\n    } catch (error) {\n      this.logger.error(error);\n      throw new InternalServerErrorException(error?.toString() || error);\n    }\n  }\n\n  public async mediaMessage(data: SendMediaDto, file?: any, isIntegration = false) {\n    const mediaData: SendMediaDto = { ...data };\n\n    if (file) mediaData.media = file.buffer.toString('base64');\n\n    const message = await this.prepareMediaMessage(mediaData);\n\n    const mediaSent = await this.sendMessageWithTyping(\n      data.number,\n      { ...message },\n      {\n        delay: data?.delay,\n        presence: 'composing',\n        quoted: data?.quoted,\n        linkPreview: data?.linkPreview,\n        mentionsEveryOne: data?.mentionsEveryOne,\n        mentioned: data?.mentioned,\n      },\n      isIntegration,\n    );\n\n    return mediaSent;\n  }\n\n  public async processAudio(audio: string, number: string, file: any) {\n    number = number.replace(/\\D/g, '');\n    const hash = `${number}-${new Date().getTime()}`;\n\n    const audioConverterConfig = this.configService.get<AudioConverter>('AUDIO_CONVERTER');\n    if (audioConverterConfig.API_URL) {\n      this.logger.verbose('Using audio converter API');\n      const formData = new FormData();\n\n      if (file) {\n        formData.append('file', file.buffer, {\n          filename: file.originalname,\n          contentType: file.mimetype,\n        });\n      } else if (isURL(audio)) {\n        formData.append('url', audio);\n      } else {\n        formData.append('base64', audio);\n      }\n\n      formData.append('format', 'mp3');\n\n      const response = await axios.post(audioConverterConfig.API_URL, formData, {\n        headers: {\n          ...formData.getHeaders(),\n          apikey: audioConverterConfig.API_KEY,\n        },\n      });\n\n      const audioConverter = response?.data?.audio || response?.data?.url;\n\n      if (!audioConverter) {\n        throw new InternalServerErrorException('Failed to convert audio');\n      }\n\n      const prepareMedia: any = {\n        fileName: `${hash}.mp3`,\n        mediaType: 'audio',\n        media: audioConverter,\n        mimetype: 'audio/mpeg',\n      };\n\n      const id = await this.getIdMedia(prepareMedia);\n      prepareMedia.id = id;\n      prepareMedia.type = 'id';\n\n      this.logger.verbose('Audio converted');\n      return prepareMedia;\n    } else {\n      let mimetype: string | false;\n\n      const prepareMedia: any = {\n        fileName: `${hash}.mp3`,\n        mediaType: 'audio',\n        media: audio,\n      };\n\n      if (isURL(audio)) {\n        mimetype = mimeTypes.lookup(audio);\n        prepareMedia.id = audio;\n        prepareMedia.type = 'link';\n      } else if (audio && !file) {\n        mimetype = mimeTypes.lookup(prepareMedia.fileName);\n        const id = await this.getIdMedia(prepareMedia);\n        prepareMedia.id = id;\n        prepareMedia.type = 'id';\n      } else if (file) {\n        prepareMedia.media = file;\n        const id = await this.getIdMedia(prepareMedia, true);\n        prepareMedia.id = id;\n        prepareMedia.type = 'id';\n        mimetype = file.mimetype;\n      }\n\n      prepareMedia.mimetype = mimetype;\n\n      return prepareMedia;\n    }\n  }\n\n  public async audioWhatsapp(data: SendAudioDto, file?: any, isIntegration = false) {\n    const message = await this.processAudio(data.audio, data.number, file);\n\n    const audioSent = await this.sendMessageWithTyping(\n      data.number,\n      { ...message },\n      {\n        delay: data?.delay,\n        presence: 'composing',\n        quoted: data?.quoted,\n        linkPreview: data?.linkPreview,\n        mentionsEveryOne: data?.mentionsEveryOne,\n        mentioned: data?.mentioned,\n      },\n      isIntegration,\n    );\n\n    return audioSent;\n  }\n\n  public async buttonMessage(data: SendButtonsDto) {\n    const embeddedMedia: any = {};\n\n    const btnItems = {\n      text: data.buttons.map((btn) => btn.displayText),\n      ids: data.buttons.map((btn) => btn.id),\n    };\n\n    if (!arrayUnique(btnItems.text) || !arrayUnique(btnItems.ids)) {\n      throw new BadRequestException('Button texts cannot be repeated', 'Button IDs cannot be repeated.');\n    }\n\n    return await this.sendMessageWithTyping(\n      data.number,\n      {\n        text: !embeddedMedia?.mediaKey ? data.title : undefined,\n        buttons: data.buttons.map((button) => {\n          return {\n            type: 'reply',\n            reply: {\n              title: button.displayText,\n              id: button.id,\n            },\n          };\n        }),\n        [embeddedMedia?.mediaKey]: embeddedMedia?.message,\n      },\n      {\n        delay: data?.delay,\n        presence: 'composing',\n        quoted: data?.quoted,\n        linkPreview: data?.linkPreview,\n        mentionsEveryOne: data?.mentionsEveryOne,\n        mentioned: data?.mentioned,\n      },\n    );\n  }\n\n  public async locationMessage(data: SendLocationDto) {\n    return await this.sendMessageWithTyping(\n      data.number,\n      {\n        locationMessage: {\n          degreesLatitude: data.latitude,\n          degreesLongitude: data.longitude,\n          name: data?.name,\n          address: data?.address,\n        },\n      },\n      {\n        delay: data?.delay,\n        presence: 'composing',\n        quoted: data?.quoted,\n        linkPreview: data?.linkPreview,\n        mentionsEveryOne: data?.mentionsEveryOne,\n        mentioned: data?.mentioned,\n      },\n    );\n  }\n\n  public async listMessage(data: SendListDto) {\n    const sectionsItems = {\n      title: data.sections.map((list) => list.title),\n    };\n\n    if (!arrayUnique(sectionsItems.title)) {\n      throw new BadRequestException('Section tiles cannot be repeated');\n    }\n\n    const sendData: any = {\n      listMessage: {\n        title: data.title,\n        description: data.description,\n        footerText: data?.footerText,\n        buttonText: data?.buttonText,\n        sections: data.sections.map((section) => {\n          return {\n            title: section.title,\n            rows: section.rows.map((row) => {\n              return {\n                title: row.title,\n                description: row.description.substring(0, 72),\n                id: row.rowId,\n              };\n            }),\n          };\n        }),\n      },\n    };\n\n    return await this.sendMessageWithTyping(data.number, sendData, {\n      delay: data?.delay,\n      presence: 'composing',\n      quoted: data?.quoted,\n      linkPreview: data?.linkPreview,\n      mentionsEveryOne: data?.mentionsEveryOne,\n      mentioned: data?.mentioned,\n    });\n  }\n\n  public async templateMessage(data: SendTemplateDto, isIntegration = false) {\n    const res = await this.sendMessageWithTyping(\n      data.number,\n      {\n        template: {\n          name: data.name,\n          language: data.language,\n          components: data.components,\n        },\n      },\n      {\n        delay: data?.delay,\n        presence: 'composing',\n        quoted: data?.quoted,\n        linkPreview: data?.linkPreview,\n        mentionsEveryOne: data?.mentionsEveryOne,\n        mentioned: data?.mentioned,\n        webhookUrl: data?.webhookUrl,\n      },\n      isIntegration,\n    );\n    return res;\n  }\n\n  public async contactMessage(data: SendContactDto) {\n    const message: any = {};\n\n    const vcard = (contact: ContactMessage) => {\n      let result = 'BEGIN:VCARD\\n' + 'VERSION:3.0\\n' + `N:${contact.fullName}\\n` + `FN:${contact.fullName}\\n`;\n\n      if (contact.organization) {\n        result += `ORG:${contact.organization};\\n`;\n      }\n\n      if (contact.email) {\n        result += `EMAIL:${contact.email}\\n`;\n      }\n\n      if (contact.url) {\n        result += `URL:${contact.url}\\n`;\n      }\n\n      if (!contact.wuid) {\n        contact.wuid = createJid(contact.phoneNumber);\n      }\n\n      result += `item1.TEL;waid=${contact.wuid}:${contact.phoneNumber}\\n` + 'item1.X-ABLabel:Celular\\n' + 'END:VCARD';\n\n      return result;\n    };\n\n    if (data.contact.length === 1) {\n      message.contact = {\n        displayName: data.contact[0].fullName,\n        vcard: vcard(data.contact[0]),\n      };\n    } else {\n      message.contactsArrayMessage = {\n        displayName: `${data.contact.length} contacts`,\n        contacts: data.contact.map((contact) => {\n          return {\n            displayName: contact.fullName,\n            vcard: vcard(contact),\n          };\n        }),\n      };\n    }\n    return await this.sendMessageWithTyping(\n      data.number,\n      {\n        contacts: data.contact.map((contact) => {\n          return {\n            name: { formatted_name: contact.fullName, first_name: contact.fullName },\n            phones: [{ phone: contact.phoneNumber }],\n            urls: [{ url: contact.url }],\n            emails: [{ email: contact.email }],\n            org: { company: contact.organization },\n          };\n        }),\n        message,\n      },\n      {\n        delay: data?.delay,\n        presence: 'composing',\n        quoted: data?.quoted,\n        linkPreview: data?.linkPreview,\n        mentionsEveryOne: data?.mentionsEveryOne,\n        mentioned: data?.mentioned,\n      },\n    );\n  }\n\n  public async reactionMessage(data: SendReactionDto) {\n    return await this.sendMessageWithTyping(data.key.remoteJid, {\n      reactionMessage: {\n        key: data.key,\n        text: data.reaction,\n      },\n    });\n  }\n\n  public async getBase64FromMediaMessage(data: any) {\n    try {\n      const msg = data.message;\n      const messageType = msg.messageType.includes('Message') ? msg.messageType : msg.messageType + 'Message';\n      const mediaMessage = msg.message[messageType];\n\n      if (!msg.message?.base64) {\n        const buffer = await this.downloadMediaMessage({ type: messageType, ...msg.message });\n        msg.message.base64 = buffer.toString('base64');\n      }\n\n      return {\n        mediaType: msg.messageType,\n        fileName: mediaMessage?.fileName || mediaMessage?.filename,\n        caption: mediaMessage?.caption,\n        size: {\n          fileLength: mediaMessage?.fileLength,\n          height: mediaMessage?.fileLength,\n          width: mediaMessage?.width,\n        },\n        mimetype: mediaMessage?.mime_type,\n        base64: msg.message.base64,\n      };\n    } catch (error) {\n      this.logger.error(error);\n      throw new BadRequestException(error.toString());\n    }\n  }\n\n  public async deleteMessage() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n\n  // methods not available on WhatsApp Business API\n  public async mediaSticker() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async pollMessage() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async statusMessage() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async reloadConnection() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async whatsappNumber() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async markMessageAsRead() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async archiveChat() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async markChatUnread() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async fetchProfile() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async offerCall() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async sendPresence() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async setPresence() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async fetchPrivacySettings() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async updatePrivacySettings() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async fetchBusinessProfile() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async updateProfileName() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async updateProfileStatus() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async updateProfilePicture() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async removeProfilePicture() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async blockUser() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async updateMessage() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async createGroup() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async updateGroupPicture() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async updateGroupSubject() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async updateGroupDescription() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async findGroup() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async fetchAllGroups() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async inviteCode() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async inviteInfo() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async sendInvite() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async acceptInviteCode() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async revokeInviteCode() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async findParticipants() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async updateGParticipant() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async updateGSetting() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async toggleEphemeral() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async leaveGroup() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async fetchLabels() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async handleLabel() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async receiveMobileCode() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n  public async fakeCall() {\n    throw new BadRequestException('Method not available on WhatsApp Business API');\n  }\n}\n","import {\n  proto,\n  WAPresence,\n  WAPrivacyGroupAddValue,\n  WAPrivacyOnlineValue,\n  WAPrivacyValue,\n  WAReadReceiptsValue,\n} from 'baileys';\n\nexport class OnWhatsAppDto {\n  constructor(\n    public readonly jid: string,\n    public readonly exists: boolean,\n    public readonly number: string,\n    public readonly name?: string,\n    public readonly lid?: string,\n  ) {}\n}\n\nexport class getBase64FromMediaMessageDto {\n  message: proto.WebMessageInfo;\n  convertToMp4?: boolean;\n}\n\nexport class WhatsAppNumberDto {\n  numbers: string[];\n}\n\nexport class NumberDto {\n  number: string;\n}\n\nexport class NumberBusiness {\n  wid?: string;\n  jid?: string;\n  exists?: boolean;\n  isBusiness: boolean;\n  name?: string;\n  message?: string;\n  description?: string;\n  email?: string;\n  websites?: string[];\n  website?: string[];\n  address?: string;\n  about?: string;\n  vertical?: string;\n  profilehandle?: string;\n}\n\nexport class ProfileNameDto {\n  name: string;\n}\n\nexport class ProfileStatusDto {\n  status: string;\n}\n\nexport class ProfilePictureDto {\n  number?: string;\n  // url or base64\n  picture?: string;\n}\n\nclass Key {\n  id: string;\n  fromMe: boolean;\n  remoteJid: string;\n}\nexport class ReadMessageDto {\n  readMessages: Key[];\n}\n\nexport class LastMessage {\n  key: Key;\n  messageTimestamp?: number;\n}\n\nexport class ArchiveChatDto {\n  lastMessage?: LastMessage;\n  chat?: string;\n  archive: boolean;\n}\n\nexport class MarkChatUnreadDto {\n  lastMessage?: LastMessage;\n  chat?: string;\n}\n\nexport class PrivacySettingDto {\n  readreceipts: WAReadReceiptsValue;\n  profile: WAPrivacyValue;\n  status: WAPrivacyValue;\n  online: WAPrivacyOnlineValue;\n  last: WAPrivacyValue;\n  groupadd: WAPrivacyGroupAddValue;\n}\n\nexport class DeleteMessage {\n  id: string;\n  fromMe: boolean;\n  remoteJid: string;\n  participant?: string;\n}\nexport class Options {\n  delay?: number;\n  presence?: WAPresence;\n}\nclass OptionsMessage {\n  options: Options;\n}\nexport class Metadata extends OptionsMessage {\n  number: string;\n}\n\nexport class SendPresenceDto extends Metadata {\n  presence: WAPresence;\n  delay: number;\n}\n\nexport class UpdateMessageDto extends Metadata {\n  number: string;\n  key: proto.IMessageKey;\n  text: string;\n}\n\nexport class BlockUserDto {\n  number: string;\n  status: 'block' | 'unblock';\n}\n","import { ICache } from '@api/abstract/abstract.cache';\nimport { Logger } from '@config/logger.config';\nimport { BufferJSON } from 'baileys';\n\nexport class CacheService {\n  private readonly logger = new Logger('CacheService');\n\n  constructor(private readonly cache: ICache) {\n    if (cache) {\n      this.logger.verbose(`cacheservice created using cache engine: ${cache.constructor?.name}`);\n    } else {\n      this.logger.verbose(`cacheservice disabled`);\n    }\n  }\n\n  async get(key: string): Promise<any> {\n    if (!this.cache) {\n      return;\n    }\n    return this.cache.get(key);\n  }\n\n  public async hGet(key: string, field: string) {\n    if (!this.cache) {\n      return null;\n    }\n    try {\n      const data = await this.cache.hGet(key, field);\n\n      if (data) {\n        return JSON.parse(data, BufferJSON.reviver);\n      }\n\n      return null;\n    } catch (error) {\n      this.logger.error(error);\n      return null;\n    }\n  }\n\n  async set(key: string, value: any, ttl?: number) {\n    if (!this.cache) {\n      return;\n    }\n    this.cache.set(key, value, ttl);\n  }\n\n  public async hSet(key: string, field: string, value: any) {\n    if (!this.cache) {\n      return;\n    }\n    try {\n      const json = JSON.stringify(value, BufferJSON.replacer);\n\n      await this.cache.hSet(key, field, json);\n    } catch (error) {\n      this.logger.error(error);\n    }\n  }\n\n  async has(key: string) {\n    if (!this.cache) {\n      return;\n    }\n    return this.cache.has(key);\n  }\n\n  async delete(key: string) {\n    if (!this.cache) {\n      return;\n    }\n    return this.cache.delete(key);\n  }\n\n  async hDelete(key: string, field: string) {\n    if (!this.cache) {\n      return false;\n    }\n    try {\n      await this.cache.hDelete(key, field);\n      return true;\n    } catch (error) {\n      this.logger.error(error);\n      return false;\n    }\n  }\n\n  async deleteAll(appendCriteria?: string) {\n    if (!this.cache) {\n      return;\n    }\n    return this.cache.deleteAll(appendCriteria);\n  }\n\n  async keys(appendCriteria?: string) {\n    if (!this.cache) {\n      return;\n    }\n    return this.cache.keys(appendCriteria);\n  }\n}\n","import axios, { AxiosRequestConfig } from 'axios';\nimport { fetchLatestBaileysVersion, WAVersion } from 'baileys';\n\nexport const fetchLatestWaWebVersion = async (options: AxiosRequestConfig<{}>) => {\n  try {\n    const { data } = await axios.get('https://web.whatsapp.com/sw.js', {\n      ...options,\n      responseType: 'json',\n    });\n\n    const regex = /\\\\?\"client_revision\\\\?\":\\s*(\\d+)/;\n    const match = data.match(regex);\n\n    if (!match?.[1]) {\n      return {\n        version: (await fetchLatestBaileysVersion()).version as WAVersion,\n        isLatest: false,\n        error: {\n          message: 'Could not find client revision in the fetched content',\n        },\n      };\n    }\n\n    const clientRevision = match[1];\n\n    return {\n      version: [2, 3000, +clientRevision] as WAVersion,\n      isLatest: true,\n    };\n  } catch (error) {\n    return {\n      version: (await fetchLatestBaileysVersion()).version as WAVersion,\n      isLatest: false,\n      error,\n    };\n  }\n};\n","import { prismaRepository } from '@api/server.module';\nimport { configService, Database } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\nimport dayjs from 'dayjs';\n\nconst logger = new Logger('OnWhatsappCache');\n\nfunction getAvailableNumbers(remoteJid: string) {\n  const numbersAvailable: string[] = [];\n\n  if (remoteJid.startsWith('+')) {\n    remoteJid = remoteJid.slice(1);\n  }\n\n  const [number, domain] = remoteJid.split('@');\n\n  // TODO: Se j for @lid, retornar apenas ele mesmo SEM adicionar @domain novamente\n  if (domain === 'lid' || domain === 'g.us') {\n    return [remoteJid]; // Retorna direto para @lid e @g.us\n  }\n\n  // Brazilian numbers\n  if (remoteJid.startsWith('55')) {\n    const numberWithDigit =\n      number.slice(4, 5) === '9' && number.length === 13 ? number : `${number.slice(0, 4)}9${number.slice(4)}`;\n    const numberWithoutDigit = number.length === 12 ? number : number.slice(0, 4) + number.slice(5);\n\n    numbersAvailable.push(numberWithDigit);\n    numbersAvailable.push(numberWithoutDigit);\n  }\n\n  // Mexican/Argentina numbers\n  // Ref: https://faq.whatsapp.com/1294841057948784\n  else if (number.startsWith('52') || number.startsWith('54')) {\n    let prefix = '';\n    if (number.startsWith('52')) {\n      prefix = '1';\n    }\n    if (number.startsWith('54')) {\n      prefix = '9';\n    }\n\n    const numberWithDigit =\n      number.slice(2, 3) === prefix && number.length === 13\n        ? number\n        : `${number.slice(0, 2)}${prefix}${number.slice(2)}`;\n    const numberWithoutDigit = number.length === 12 ? number : number.slice(0, 2) + number.slice(3);\n\n    numbersAvailable.push(numberWithDigit);\n    numbersAvailable.push(numberWithoutDigit);\n  }\n\n  // Other countries\n  else {\n    numbersAvailable.push(remoteJid);\n  }\n\n  // TODO: Adiciona @domain apenas para nmeros que no so @lid\n  return numbersAvailable.map((number) => `${number}@${domain}`);\n}\n\ninterface ISaveOnWhatsappCacheParams {\n  remoteJid: string;\n  remoteJidAlt?: string;\n  lid?: 'lid' | undefined;\n}\n\nfunction normalizeJid(jid: string | null | undefined): string | null {\n  if (!jid) return null;\n  return jid.startsWith('+') ? jid.slice(1) : jid;\n}\n\nexport async function saveOnWhatsappCache(data: ISaveOnWhatsappCacheParams[]) {\n  if (!configService.get<Database>('DATABASE').SAVE_DATA.IS_ON_WHATSAPP) {\n    return;\n  }\n\n  // Processa todos os itens em paralelo para melhor performance\n  const processingPromises = data.map(async (item) => {\n    try {\n      const remoteJid = normalizeJid(item.remoteJid);\n      if (!remoteJid) {\n        logger.warn('[saveOnWhatsappCache] Item skipped, missing remoteJid.');\n        return;\n      }\n\n      const altJidNormalized = normalizeJid(item.remoteJidAlt);\n      const lidAltJid = altJidNormalized && altJidNormalized.includes('@lid') ? altJidNormalized : null;\n\n      const baseJids = [remoteJid]; // Garante que o remoteJid esteja na lista inicial\n      if (lidAltJid) {\n        baseJids.push(lidAltJid);\n      }\n\n      const expandedJids = baseJids.flatMap((jid) => getAvailableNumbers(jid));\n\n      // 1. Busca entrada por jidOptions e tambm remoteJid\n      // s vezes acontece do remoteJid atual NO ESTAR no jidOptions ainda, ocasionando o erro:\n      // 'Unique constraint failed on the fields: (`remoteJid`)'\n      // Isso acontece principalmente em grupos que possuem o nmero do criador no ID (ex.: '559911223345-1234567890@g.us')\n      const existingRecord = await prismaRepository.isOnWhatsapp.findFirst({\n        where: {\n          OR: [\n            ...expandedJids.map((jid) => ({ jidOptions: { contains: jid } })),\n            { remoteJid: remoteJid }, // TODO: Descobrir o motivo que causa o remoteJid no estar (s vezes) incluso na lista de jidOptions\n          ],\n        },\n      });\n\n      logger.verbose(\n        `[saveOnWhatsappCache] Register exists for [${expandedJids.join(',')}]? => ${existingRecord ? existingRecord.remoteJid : 'Not found'}`,\n      );\n\n      // 2. Unifica todos os JIDs usando um Set para garantir valores nicos\n      const finalJidOptions = new Set(expandedJids);\n\n      if (lidAltJid) {\n        finalJidOptions.add(lidAltJid);\n      }\n\n      if (existingRecord?.jidOptions) {\n        existingRecord.jidOptions.split(',').forEach((jid) => finalJidOptions.add(jid));\n      }\n\n      // 3. Prepara o payload final\n      // Ordena os JIDs para garantir consistncia na string final\n      const sortedJidOptions = [...finalJidOptions].sort();\n      const newJidOptionsString = sortedJidOptions.join(',');\n      const newLid = item.lid === 'lid' || item.remoteJid?.includes('@lid') ? 'lid' : null;\n\n      const dataPayload = {\n        remoteJid: remoteJid,\n        jidOptions: newJidOptionsString,\n        lid: newLid,\n      };\n\n      // 4. Decide entre Criar ou Atualizar\n      if (existingRecord) {\n        // Compara a string de JIDs ordenada existente com a nova\n        const existingJidOptionsString = existingRecord.jidOptions\n          ? existingRecord.jidOptions.split(',').sort().join(',')\n          : '';\n\n        const isDataSame =\n          existingRecord.remoteJid === dataPayload.remoteJid &&\n          existingJidOptionsString === dataPayload.jidOptions &&\n          existingRecord.lid === dataPayload.lid;\n\n        if (isDataSame) {\n          logger.verbose(`[saveOnWhatsappCache] Data for ${remoteJid} is already up-to-date. Skipping update.`);\n          return; // Pula para o prximo item\n        }\n\n        // Os dados so diferentes, ento atualiza\n        logger.verbose(\n          `[saveOnWhatsappCache] Register exists, updating: remoteJid=${remoteJid}, jidOptions=${dataPayload.jidOptions}, lid=${dataPayload.lid}`,\n        );\n        await prismaRepository.isOnWhatsapp.update({\n          where: { id: existingRecord.id },\n          data: dataPayload,\n        });\n      } else {\n        // Cria nova entrada\n        logger.verbose(\n          `[saveOnWhatsappCache] Register does not exist, creating: remoteJid=${remoteJid}, jidOptions=${dataPayload.jidOptions}, lid=${dataPayload.lid}`,\n        );\n        await prismaRepository.isOnWhatsapp.create({\n          data: dataPayload,\n        });\n      }\n    } catch (e) {\n      // Loga o erro mas no para a execuo dos outros promises\n      logger.error(`[saveOnWhatsappCache] Error processing item for ${item.remoteJid}: `);\n      logger.error(e);\n    }\n  });\n\n  // Espera todas as operaes paralelas terminarem\n  await Promise.allSettled(processingPromises);\n}\n\nexport async function getOnWhatsappCache(remoteJids: string[]) {\n  let results: {\n    remoteJid: string;\n    number: string;\n    jidOptions: string[];\n    lid?: string;\n  }[] = [];\n\n  if (configService.get<Database>('DATABASE').SAVE_DATA.IS_ON_WHATSAPP) {\n    const remoteJidsWithoutPlus = remoteJids.map((remoteJid) => getAvailableNumbers(remoteJid)).flat();\n\n    const onWhatsappCache = await prismaRepository.isOnWhatsapp.findMany({\n      where: {\n        OR: remoteJidsWithoutPlus.map((remoteJid) => ({ jidOptions: { contains: remoteJid } })),\n        updatedAt: {\n          gte: dayjs().subtract(configService.get<Database>('DATABASE').SAVE_DATA.IS_ON_WHATSAPP_DAYS, 'days').toDate(),\n        },\n      },\n    });\n\n    results = onWhatsappCache.map((item) => ({\n      remoteJid: item.remoteJid,\n      number: item.remoteJid.split('@')[0],\n      jidOptions: item.jidOptions.split(','),\n      lid: item.lid,\n    }));\n  }\n\n  return results;\n}\n","import { join } from 'path';\n\nexport const ROOT_DIR = process.cwd();\nexport const INSTANCE_DIR = join(ROOT_DIR, 'instances');\nexport const SRC_DIR = join(ROOT_DIR, 'src');\nexport const AUTH_DIR = join(ROOT_DIR, 'store', 'auth');\nexport const STORE_DIR = join(ROOT_DIR, 'store');\n","import { prismaRepository } from '@api/server.module';\nimport { CacheService } from '@api/services/cache.service';\nimport { CacheConf, configService } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\nimport { INSTANCE_DIR } from '@config/path.config';\nimport { AuthenticationState, BufferJSON, initAuthCreds, WAProto as proto } from 'baileys';\nimport fs from 'fs/promises';\nimport path from 'path';\n\nconst fixFileName = (file: string): string | undefined => {\n  if (!file) {\n    return undefined;\n  }\n  const replacedSlash = file.replace(/\\//g, '__');\n  const replacedColon = replacedSlash.replace(/:/g, '-');\n  return replacedColon;\n};\n\nexport async function keyExists(sessionId: string): Promise<any> {\n  try {\n    const key = await prismaRepository.session.findUnique({ where: { sessionId: sessionId } });\n    return !!key;\n  } catch {\n    return false;\n  }\n}\n\nexport async function saveKey(sessionId: string, keyJson: any): Promise<any> {\n  const exists = await keyExists(sessionId);\n  try {\n    if (!exists)\n      return await prismaRepository.session.create({\n        data: {\n          sessionId: sessionId,\n          creds: JSON.stringify(keyJson),\n        },\n      });\n    await prismaRepository.session.update({\n      where: { sessionId: sessionId },\n      data: { creds: JSON.stringify(keyJson) },\n    });\n  } catch {\n    return null;\n  }\n}\n\nexport async function getAuthKey(sessionId: string): Promise<any> {\n  try {\n    const register = await keyExists(sessionId);\n    if (!register) return null;\n    const auth = await prismaRepository.session.findUnique({ where: { sessionId: sessionId } });\n    return JSON.parse(auth?.creds);\n  } catch {\n    return null;\n  }\n}\n\nasync function deleteAuthKey(sessionId: string): Promise<any> {\n  try {\n    const register = await keyExists(sessionId);\n    if (!register) return;\n    await prismaRepository.session.delete({ where: { sessionId: sessionId } });\n  } catch {\n    return;\n  }\n}\n\nasync function fileExists(file: string): Promise<any> {\n  try {\n    const stat = await fs.stat(file);\n    if (stat.isFile()) return true;\n  } catch {\n    return;\n  }\n}\n\nconst logger = new Logger('useMultiFileAuthStatePrisma');\n\nexport default async function useMultiFileAuthStatePrisma(\n  sessionId: string,\n  cache: CacheService,\n): Promise<{\n  state: AuthenticationState;\n  saveCreds: () => Promise<void>;\n  removeCreds: () => Promise<void>;\n}> {\n  const localFolder = path.join(INSTANCE_DIR, sessionId);\n  const localFile = (key: string) => path.join(localFolder, fixFileName(key) + '.json');\n  await fs.mkdir(localFolder, { recursive: true });\n\n  async function writeData(data: any, key: string): Promise<any> {\n    const dataString = JSON.stringify(data, BufferJSON.replacer);\n    const cacheConfig = configService.get<CacheConf>('CACHE');\n\n    if (key != 'creds') {\n      if (cacheConfig.REDIS.ENABLED) {\n        return await cache.hSet(sessionId, key, data);\n      } else {\n        await fs.writeFile(localFile(key), dataString);\n        return;\n      }\n    }\n    await saveKey(sessionId, dataString);\n    return;\n  }\n\n  async function readData(key: string): Promise<any> {\n    try {\n      let rawData;\n      const cacheConfig = configService.get<CacheConf>('CACHE');\n\n      if (key != 'creds') {\n        if (cacheConfig.REDIS.ENABLED) {\n          return await cache.hGet(sessionId, key);\n        } else {\n          if (!(await fileExists(localFile(key)))) return null;\n          rawData = await fs.readFile(localFile(key), { encoding: 'utf-8' });\n          return JSON.parse(rawData, BufferJSON.reviver);\n        }\n      } else {\n        rawData = await getAuthKey(sessionId);\n      }\n\n      const parsedData = JSON.parse(rawData, BufferJSON.reviver);\n      return parsedData;\n    } catch {\n      return null;\n    }\n  }\n\n  async function removeData(key: string): Promise<any> {\n    try {\n      const cacheConfig = configService.get<CacheConf>('CACHE');\n\n      if (key != 'creds') {\n        if (cacheConfig.REDIS.ENABLED) {\n          return await cache.hDelete(sessionId, key);\n        } else {\n          await fs.unlink(localFile(key));\n        }\n      } else {\n        await deleteAuthKey(sessionId);\n      }\n    } catch {\n      return;\n    }\n  }\n\n  async function removeCreds(): Promise<any> {\n    const cacheConfig = configService.get<CacheConf>('CACHE');\n\n    // Redis\n    try {\n      if (cacheConfig.REDIS.ENABLED) {\n        await cache.delete(sessionId);\n        logger.info({ action: 'redis.delete', sessionId });\n\n        return;\n      }\n    } catch (err) {\n      logger.warn({ action: 'redis.delete', sessionId, err });\n    }\n\n    logger.info({ action: 'auth.key.delete', sessionId });\n\n    await deleteAuthKey(sessionId);\n  }\n\n  let creds = await readData('creds');\n  if (!creds) {\n    creds = initAuthCreds();\n    await writeData(creds, 'creds');\n  }\n\n  return {\n    state: {\n      creds,\n      keys: {\n        get: async (type, ids) => {\n          const data = {};\n          await Promise.all(\n            ids.map(async (id) => {\n              let value = await readData(`${type}-${id}`);\n              if (type === 'app-state-sync-key' && value) {\n                value = proto.Message.AppStateSyncKeyData.create(value);\n              }\n\n              data[id] = value;\n            }),\n          );\n          return data;\n        },\n        set: async (data) => {\n          const tasks = [];\n          for (const category in data) {\n            for (const id in data[category]) {\n              const value = data[category][id];\n              const key = `${category}-${id}`;\n\n              tasks.push(value ? writeData(value, key) : removeData(key));\n            }\n          }\n          await Promise.all(tasks);\n        },\n      },\n    },\n    saveCreds: () => {\n      return writeData(creds, 'creds');\n    },\n\n    removeCreds,\n  };\n}\n","/**\n * \n *  @author jrCleber                                                             \n *  @filename use-multi-file-auth-state-provider-files.ts                              \n *  Developed by: Cleber Wilson                                                  \n *  Creation date: May 31, 2024                                                 \n *  Contact: contato@codechat.dev                                                \n * \n *  @copyright  Cleber Wilson 2023. All rights reserved.                        \n *  Licensed under the Apache License, Version 2.0                               \n *                                                                               \n *   @license \"https://github.com/code-chat-br/whatsapp-api/blob/main/LICENSE\"   \n *                                                                               \n *  You may not use this file except in compliance with the License.             \n *  You may obtain a copy of the License at                                      \n *                                                                               \n *     http://www.apache.org/licenses/LICENSE-2.0                                \n *                                                                               \n *  Unless required by applicable law or agreed to in writing, software          \n *  distributed under the License is distributed on an \"AS IS\" BASIS,            \n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.     \n *                                                                               \n *  See the License for the specific language governing permissions and          \n *  limitations under the License.                                               \n *                                                                               \n *  @type {AuthState}                                                            \n *  @function useMultiFileAuthStateRedisDb                                       \n *  @returns {Promise<AuthState>}                                                \n * \n *  @important                                                                   \n *  For any future changes to the code in this file, it is recommended to        \n *  contain, together with the modification, the information of the developer    \n *  who changed it and the date of modification.                                 \n * \n */\n\nimport { ProviderFiles } from '@api/provider/sessions';\nimport { Logger } from '@config/logger.config';\nimport { AuthenticationCreds, AuthenticationState, BufferJSON, initAuthCreds, proto, SignalDataTypeMap } from 'baileys';\nimport { isNotEmpty } from 'class-validator';\n\nexport type AuthState = {\n  state: AuthenticationState;\n  saveCreds: () => Promise<void>;\n  removeCreds: () => Promise<void>;\n};\n\nexport class AuthStateProvider {\n  constructor(private readonly providerFiles: ProviderFiles) {}\n\n  private readonly logger = new Logger('AuthStateProvider');\n\n  public async authStateProvider(instance: string): Promise<AuthState> {\n    const [, error] = await this.providerFiles.create(instance);\n    if (error) {\n      this.logger.error(['Failed to create folder on file server', error?.message, error?.stack]);\n      return;\n    }\n\n    const writeData = async (data: any, key: string): Promise<any> => {\n      const json = JSON.stringify(data, BufferJSON.replacer);\n      const [response, error] = await this.providerFiles.write(instance, key, {\n        data: json,\n      });\n      if (error) {\n        // this.logger.error(['writeData', error?.message, error?.stack]);\n        return;\n      }\n      return response;\n    };\n\n    const readData = async (key: string): Promise<any> => {\n      const [response, error] = await this.providerFiles.read(instance, key);\n      if (error) {\n        // this.logger.error(['readData', error?.message, error?.stack]);\n        return;\n      }\n      if (isNotEmpty(response?.data)) {\n        return JSON.parse(JSON.stringify(response.data), BufferJSON.reviver);\n      }\n    };\n\n    const removeData = async (key: string) => {\n      const [response, error] = await this.providerFiles.delete(instance, key);\n      if (error) {\n        // this.logger.error(['removeData', error?.message, error?.stack]);\n        return;\n      }\n\n      return response;\n    };\n\n    const removeCreds = async () => {\n      const [response, error] = await this.providerFiles.removeSession(instance);\n      if (error) {\n        // this.logger.error(['removeData', error?.message, error?.stack]);\n        return;\n      }\n\n      logger.info({ action: 'remove.session', instance, response });\n\n      return;\n    };\n\n    const creds: AuthenticationCreds = (await readData('creds')) || initAuthCreds();\n\n    return {\n      state: {\n        creds,\n        keys: {\n          get: async (type, ids: string[]) => {\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            const data: { [_: string]: SignalDataTypeMap[type] } = {};\n            await Promise.all(\n              ids.map(async (id) => {\n                let value = await readData(`${type}-${id}`);\n                if (type === 'app-state-sync-key' && value) {\n                  value = proto.Message.AppStateSyncKeyData.create(value);\n                }\n\n                data[id] = value;\n              }),\n            );\n\n            return data;\n          },\n          set: async (data: any) => {\n            const tasks: Promise<void>[] = [];\n            for (const category in data) {\n              for (const id in data[category]) {\n                const value = data[category][id];\n                const key = `${category}-${id}`;\n                tasks.push(value ? await writeData(value, key) : await removeData(key));\n              }\n            }\n\n            await Promise.all(tasks);\n          },\n        },\n      },\n      saveCreds: async () => {\n        return await writeData(creds, 'creds');\n      },\n\n      removeCreds,\n    };\n  }\n}\n\nconst logger = new Logger('useMultiFileAuthStatePrisma');\n","import { CacheService } from '@api/services/cache.service';\nimport { Logger } from '@config/logger.config';\nimport { AuthenticationCreds, AuthenticationState, initAuthCreds, proto, SignalDataTypeMap } from 'baileys';\n\nexport async function useMultiFileAuthStateRedisDb(\n  instanceName: string,\n  cache: CacheService,\n): Promise<{\n  state: AuthenticationState;\n  saveCreds: () => Promise<void>;\n  removeCreds: () => Promise<void>;\n}> {\n  const logger = new Logger('useMultiFileAuthStateRedisDb');\n\n  const writeData = async (data: any, key: string): Promise<any> => {\n    try {\n      return await cache.hSet(instanceName, key, data);\n    } catch (error) {\n      return logger.error({ localError: 'writeData', error });\n    }\n  };\n\n  const readData = async (key: string): Promise<any> => {\n    try {\n      return await cache.hGet(instanceName, key);\n    } catch (error) {\n      logger.error({ localError: 'readData', error });\n      return;\n    }\n  };\n\n  const removeData = async (key: string) => {\n    try {\n      return await cache.hDelete(instanceName, key);\n    } catch (error) {\n      logger.error({ readData: 'removeData', error });\n    }\n  };\n\n  async function removeCreds(): Promise<any> {\n    try {\n      logger.warn({ action: 'redis.delete', instanceName });\n\n      return await cache.delete(instanceName);\n    } catch {\n      return;\n    }\n  }\n\n  const creds: AuthenticationCreds = (await readData('creds')) || initAuthCreds();\n\n  return {\n    state: {\n      creds,\n      keys: {\n        get: async (type, ids: string[]) => {\n          // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n          // @ts-ignore\n          const data: { [_: string]: SignalDataTypeMap[type] } = {};\n          await Promise.all(\n            ids.map(async (id) => {\n              let value = await readData(`${type}-${id}`);\n              if (type === 'app-state-sync-key' && value) {\n                value = proto.Message.AppStateSyncKeyData.create(value);\n              }\n\n              data[id] = value;\n            }),\n          );\n\n          return data;\n        },\n        set: async (data: any) => {\n          const tasks: Promise<void>[] = [];\n          for (const category in data) {\n            for (const id in data[category]) {\n              const value = data[category][id];\n              const key = `${category}-${id}`;\n              tasks.push(value ? await writeData(value, key) : await removeData(key));\n            }\n          }\n\n          await Promise.all(tasks);\n        },\n      },\n    },\n    saveCreds: async () => {\n      return await writeData(creds, 'creds');\n    },\n\n    removeCreds,\n  };\n}\n","import { Logger } from '@config/logger.config';\nimport { BaileysEventMap, MessageUpsertType, WAMessage } from 'baileys';\nimport { catchError, concatMap, delay, EMPTY, from, retryWhen, Subject, Subscription, take, tap } from 'rxjs';\n\ntype MessageUpsertPayload = BaileysEventMap['messages.upsert'];\ntype MountProps = {\n  onMessageReceive: (payload: MessageUpsertPayload, settings: any) => Promise<void>;\n};\n\nexport class BaileysMessageProcessor {\n  private processorLogs = new Logger('BaileysMessageProcessor');\n  private subscription?: Subscription;\n\n  protected messageSubject = new Subject<{\n    messages: WAMessage[];\n    type: MessageUpsertType;\n    requestId?: string;\n    settings: any;\n  }>();\n\n  mount({ onMessageReceive }: MountProps) {\n    // Se j existe subscription, fazer cleanup primeiro\n    if (this.subscription && !this.subscription.closed) {\n      this.subscription.unsubscribe();\n    }\n\n    // Se o Subject foi completado, recriar\n    if (this.messageSubject.closed) {\n      this.processorLogs.warn('MessageSubject was closed, recreating...');\n      this.messageSubject = new Subject<{\n        messages: WAMessage[];\n        type: MessageUpsertType;\n        requestId?: string;\n        settings: any;\n      }>();\n    }\n\n    this.subscription = this.messageSubject\n      .pipe(\n        tap(({ messages }) => {\n          this.processorLogs.log(`Processing batch of ${messages.length} messages`);\n        }),\n        concatMap(({ messages, type, requestId, settings }) =>\n          from(onMessageReceive({ messages, type, requestId }, settings)).pipe(\n            retryWhen((errors) =>\n              errors.pipe(\n                tap((error) => this.processorLogs.warn(`Retrying message batch due to error: ${error.message}`)),\n                delay(1000), // 1 segundo de delay\n                take(3), // Mximo 3 tentativas\n              ),\n            ),\n          ),\n        ),\n        catchError((error) => {\n          this.processorLogs.error(`Error processing message batch: ${error}`);\n          return EMPTY;\n        }),\n      )\n      .subscribe({\n        error: (error) => {\n          this.processorLogs.error(`Message stream error: ${error}`);\n        },\n      });\n  }\n\n  processMessage(payload: MessageUpsertPayload, settings: any) {\n    const { messages, type, requestId } = payload;\n    this.messageSubject.next({ messages, type, requestId, settings });\n  }\n\n  onDestroy() {\n    this.subscription?.unsubscribe();\n    this.messageSubject.complete();\n  }\n}\n","import { ConnectionState, WAConnectionState, WASocket } from 'baileys';\nimport { io, Socket } from 'socket.io-client';\n\nimport { ClientToServerEvents, ServerToClientEvents } from './transport.type';\n\nlet baileys_connection_state: WAConnectionState = 'close';\n\nexport const useVoiceCallsBaileys = async (\n  wavoip_token: string,\n  baileys_sock: WASocket,\n  status?: WAConnectionState,\n  logger?: boolean,\n) => {\n  baileys_connection_state = status ?? 'close';\n\n  const socket: Socket<ServerToClientEvents, ClientToServerEvents> = io('https://devices.wavoip.com/baileys', {\n    transports: ['websocket'],\n    path: `/${wavoip_token}/websocket`,\n  });\n\n  socket.on('connect', () => {\n    if (logger) console.log('[*] - Wavoip connected', socket.id);\n\n    socket.emit(\n      'init',\n      baileys_sock.authState.creds.me,\n      baileys_sock.authState.creds.account,\n      baileys_connection_state,\n    );\n  });\n\n  socket.on('disconnect', () => {\n    if (logger) console.log('[*] - Wavoip disconnect');\n  });\n\n  socket.on('connect_error', (error) => {\n    if (socket.active) {\n      if (logger)\n        console.log(\n          '[*] - Wavoip connection error temporary failure, the socket will automatically try to reconnect',\n          error,\n        );\n    } else {\n      if (logger) console.log('[*] - Wavoip connection error', error.message);\n    }\n  });\n\n  socket.on('onWhatsApp', async (jid, callback) => {\n    try {\n      const response: any = await baileys_sock.onWhatsApp(jid);\n\n      callback(response);\n\n      if (logger) console.log('[*] Success on call onWhatsApp function', response, jid);\n    } catch (error) {\n      if (logger) console.error('[*] Error on call onWhatsApp function', error);\n    }\n  });\n\n  socket.on('profilePictureUrl', async (jid, type, timeoutMs, callback) => {\n    try {\n      const response = await baileys_sock.profilePictureUrl(jid, type, timeoutMs);\n\n      callback(response);\n\n      if (logger) console.log('[*] Success on call profilePictureUrl function', response);\n    } catch (error) {\n      if (logger) console.error('[*] Error on call profilePictureUrl function', error);\n    }\n  });\n\n  socket.on('assertSessions', async (jids, force, callback) => {\n    try {\n      const response = await baileys_sock.assertSessions(jids);\n\n      callback(response);\n\n      if (logger) console.log('[*] Success on call assertSessions function', response);\n    } catch (error) {\n      if (logger) console.error('[*] Error on call assertSessions function', error);\n    }\n  });\n\n  socket.on('createParticipantNodes', async (jids, message, extraAttrs, callback) => {\n    try {\n      const response = await baileys_sock.createParticipantNodes(jids, message, extraAttrs);\n\n      callback(response, true);\n\n      if (logger) console.log('[*] Success on call createParticipantNodes function', response);\n    } catch (error) {\n      if (logger) console.error('[*] Error on call createParticipantNodes function', error);\n    }\n  });\n\n  socket.on('getUSyncDevices', async (jids, useCache, ignoreZeroDevices, callback) => {\n    try {\n      const response = await baileys_sock.getUSyncDevices(jids, useCache, ignoreZeroDevices);\n\n      callback(response);\n\n      if (logger) console.log('[*] Success on call getUSyncDevices function', response);\n    } catch (error) {\n      if (logger) console.error('[*] Error on call getUSyncDevices function', error);\n    }\n  });\n\n  socket.on('generateMessageTag', async (callback) => {\n    try {\n      const response = await baileys_sock.generateMessageTag();\n\n      callback(response);\n\n      if (logger) console.log('[*] Success on call generateMessageTag function', response);\n    } catch (error) {\n      if (logger) console.error('[*] Error on call generateMessageTag function', error);\n    }\n  });\n\n  socket.on('sendNode', async (stanza, callback) => {\n    try {\n      console.log('sendNode', JSON.stringify(stanza));\n      const response = await baileys_sock.sendNode(stanza);\n\n      callback(true);\n\n      if (logger) console.log('[*] Success on call sendNode function', response);\n    } catch (error) {\n      if (logger) console.error('[*] Error on call sendNode function', error);\n    }\n  });\n\n  socket.on('signalRepository:decryptMessage', async (jid, type, ciphertext, callback) => {\n    try {\n      const response = await baileys_sock.signalRepository.decryptMessage({\n        jid: jid,\n        type: type,\n        ciphertext: ciphertext,\n      });\n\n      callback(response);\n\n      if (logger) console.log('[*] Success on call signalRepository:decryptMessage function', response);\n    } catch (error) {\n      if (logger) console.error('[*] Error on call signalRepository:decryptMessage function', error);\n    }\n  });\n\n  // we only use this connection data to inform the webphone that the device is connected and creeds account to generate e2e whatsapp key for make call packets\n  baileys_sock.ev.on('connection.update', (update: Partial<ConnectionState>) => {\n    const { connection } = update;\n\n    if (connection) {\n      baileys_connection_state = connection;\n      socket\n        .timeout(1000)\n        .emit(\n          'connection.update:status',\n          baileys_sock.authState.creds.me,\n          baileys_sock.authState.creds.account,\n          connection,\n        );\n    }\n\n    if (update.qr) {\n      socket.timeout(1000).emit('connection.update:qr', update.qr);\n    }\n  });\n\n  baileys_sock.ws.on('CB:call', (packet) => {\n    if (logger) console.log('[*] Signling received');\n    socket.volatile.timeout(1000).emit('CB:call', packet);\n  });\n\n  baileys_sock.ws.on('CB:ack,class:call', (packet) => {\n    if (logger) console.log('[*] Signling ack received');\n    socket.volatile.timeout(1000).emit('CB:ack,class:call', packet);\n  });\n\n  return socket;\n};\n","import { getCollectionsDto } from '@api/dto/business.dto';\nimport { OfferCallDto } from '@api/dto/call.dto';\nimport {\n  ArchiveChatDto,\n  BlockUserDto,\n  DeleteMessage,\n  getBase64FromMediaMessageDto,\n  LastMessage,\n  MarkChatUnreadDto,\n  NumberBusiness,\n  OnWhatsAppDto,\n  PrivacySettingDto,\n  ReadMessageDto,\n  SendPresenceDto,\n  UpdateMessageDto,\n  WhatsAppNumberDto,\n} from '@api/dto/chat.dto';\nimport {\n  AcceptGroupInvite,\n  CreateGroupDto,\n  GetParticipant,\n  GroupDescriptionDto,\n  GroupInvite,\n  GroupJid,\n  GroupPictureDto,\n  GroupSendInvite,\n  GroupSubjectDto,\n  GroupToggleEphemeralDto,\n  GroupUpdateParticipantDto,\n  GroupUpdateSettingDto,\n} from '@api/dto/group.dto';\nimport { InstanceDto, SetPresenceDto } from '@api/dto/instance.dto';\nimport { HandleLabelDto, LabelDto } from '@api/dto/label.dto';\nimport {\n  Button,\n  ContactMessage,\n  KeyType,\n  MediaMessage,\n  Options,\n  SendAudioDto,\n  SendButtonsDto,\n  SendContactDto,\n  SendListDto,\n  SendLocationDto,\n  SendMediaDto,\n  SendPollDto,\n  SendPtvDto,\n  SendReactionDto,\n  SendStatusDto,\n  SendStickerDto,\n  SendTextDto,\n  StatusMessage,\n  TypeButton,\n} from '@api/dto/sendMessage.dto';\nimport { chatwootImport } from '@api/integrations/chatbot/chatwoot/utils/chatwoot-import-helper';\nimport * as s3Service from '@api/integrations/storage/s3/libs/minio.server';\nimport { ProviderFiles } from '@api/provider/sessions';\nimport { PrismaRepository, Query } from '@api/repository/repository.service';\nimport { chatbotController, waMonitor } from '@api/server.module';\nimport { CacheService } from '@api/services/cache.service';\nimport { ChannelStartupService } from '@api/services/channel.service';\nimport { Events, MessageSubtype, TypeMediaMessage, wa } from '@api/types/wa.types';\nimport { CacheEngine } from '@cache/cacheengine';\nimport {\n  AudioConverter,\n  CacheConf,\n  Chatwoot,\n  ConfigService,\n  configService,\n  ConfigSessionPhone,\n  Database,\n  Log,\n  Openai,\n  ProviderSession,\n  QrCode,\n  S3,\n} from '@config/env.config';\nimport { BadRequestException, InternalServerErrorException, NotFoundException } from '@exceptions';\nimport ffmpegPath from '@ffmpeg-installer/ffmpeg';\nimport { Boom } from '@hapi/boom';\nimport { createId as cuid } from '@paralleldrive/cuid2';\nimport { Instance, Message } from '@prisma/client';\nimport { createJid } from '@utils/createJid';\nimport { fetchLatestWaWebVersion } from '@utils/fetchLatestWaWebVersion';\nimport { makeProxyAgent, makeProxyAgentUndici } from '@utils/makeProxyAgent';\nimport { getOnWhatsappCache, saveOnWhatsappCache } from '@utils/onWhatsappCache';\nimport { status } from '@utils/renderStatus';\nimport { sendTelemetry } from '@utils/sendTelemetry';\nimport useMultiFileAuthStatePrisma from '@utils/use-multi-file-auth-state-prisma';\nimport { AuthStateProvider } from '@utils/use-multi-file-auth-state-provider-files';\nimport { useMultiFileAuthStateRedisDb } from '@utils/use-multi-file-auth-state-redis-db';\nimport axios from 'axios';\nimport makeWASocket, {\n  AnyMessageContent,\n  BufferedEventData,\n  BufferJSON,\n  CacheStore,\n  CatalogCollection,\n  Chat,\n  ConnectionState,\n  Contact,\n  decryptPollVote,\n  delay,\n  DisconnectReason,\n  downloadContentFromMessage,\n  downloadMediaMessage,\n  generateWAMessageFromContent,\n  getAggregateVotesInPollMessage,\n  GetCatalogOptions,\n  getContentType,\n  getDevice,\n  GroupMetadata,\n  isJidBroadcast,\n  isJidGroup,\n  isJidNewsletter,\n  isPnUser,\n  jidNormalizedUser,\n  makeCacheableSignalKeyStore,\n  MessageUpsertType,\n  MessageUserReceiptUpdate,\n  MiscMessageGenerationOptions,\n  ParticipantAction,\n  prepareWAMessageMedia,\n  Product,\n  proto,\n  UserFacingSocketConfig,\n  WABrowserDescription,\n  WAMediaUpload,\n  WAMessage,\n  WAMessageKey,\n  WAPresence,\n  WASocket,\n} from 'baileys';\nimport { Label } from 'baileys/lib/Types/Label';\nimport { LabelAssociation } from 'baileys/lib/Types/LabelAssociation';\nimport { spawn } from 'child_process';\nimport { isArray, isBase64, isURL } from 'class-validator';\nimport { createHash } from 'crypto';\nimport EventEmitter2 from 'eventemitter2';\nimport ffmpeg from 'fluent-ffmpeg';\nimport FormData from 'form-data';\nimport Long from 'long';\nimport mimeTypes from 'mime-types';\nimport NodeCache from 'node-cache';\nimport cron from 'node-cron';\nimport { release } from 'os';\nimport { join } from 'path';\nimport P from 'pino';\nimport qrcode, { QRCodeToDataURLOptions } from 'qrcode';\nimport qrcodeTerminal from 'qrcode-terminal';\nimport sharp from 'sharp';\nimport { PassThrough, Readable } from 'stream';\nimport { v4 } from 'uuid';\n\nimport { BaileysMessageProcessor } from './baileysMessage.processor';\nimport { useVoiceCallsBaileys } from './voiceCalls/useVoiceCallsBaileys';\n\nexport interface ExtendedIMessageKey extends proto.IMessageKey {\n  remoteJidAlt?: string;\n  participantAlt?: string;\n  server_id?: string;\n  isViewOnce?: boolean;\n}\n\nconst groupMetadataCache = new CacheService(new CacheEngine(configService, 'groups').getEngine());\n\n// Adicione a funo getVideoDuration no incio do arquivo\nasync function getVideoDuration(input: Buffer | string | Readable): Promise<number> {\n  const MediaInfoFactory = (await import('mediainfo.js')).default;\n  const mediainfo = await MediaInfoFactory({ format: 'JSON' });\n\n  let fileSize: number;\n  let readChunk: (size: number, offset: number) => Promise<Buffer>;\n\n  if (Buffer.isBuffer(input)) {\n    fileSize = input.length;\n    readChunk = async (size: number, offset: number): Promise<Buffer> => {\n      return input.slice(offset, offset + size);\n    };\n  } else if (typeof input === 'string') {\n    const fs = await import('fs');\n    const stat = await fs.promises.stat(input);\n    fileSize = stat.size;\n    const fd = await fs.promises.open(input, 'r');\n\n    readChunk = async (size: number, offset: number): Promise<Buffer> => {\n      const buffer = Buffer.alloc(size);\n      await fd.read(buffer, 0, size, offset);\n      return buffer;\n    };\n\n    try {\n      const result = await mediainfo.analyzeData(() => fileSize, readChunk);\n      const jsonResult = JSON.parse(result);\n\n      const generalTrack = jsonResult.media.track.find((t: any) => t['@type'] === 'General');\n      const duration = generalTrack.Duration;\n\n      return Math.round(parseFloat(duration));\n    } finally {\n      await fd.close();\n    }\n  } else if (input instanceof Readable) {\n    const chunks: Buffer[] = [];\n    for await (const chunk of input) {\n      chunks.push(chunk);\n    }\n    const data = Buffer.concat(chunks);\n    fileSize = data.length;\n\n    readChunk = async (size: number, offset: number): Promise<Buffer> => {\n      return data.slice(offset, offset + size);\n    };\n  } else {\n    throw new Error('Tipo de entrada no suportado');\n  }\n\n  const result = await mediainfo.analyzeData(() => fileSize, readChunk);\n  const jsonResult = JSON.parse(result);\n\n  const generalTrack = jsonResult.media.track.find((t: any) => t['@type'] === 'General');\n  const duration = generalTrack.Duration;\n\n  return Math.round(parseFloat(duration));\n}\n\nexport class BaileysStartupService extends ChannelStartupService {\n  private messageProcessor = new BaileysMessageProcessor();\n\n  constructor(\n    public readonly configService: ConfigService,\n    public readonly eventEmitter: EventEmitter2,\n    public readonly prismaRepository: PrismaRepository,\n    public readonly cache: CacheService,\n    public readonly chatwootCache: CacheService,\n    public readonly baileysCache: CacheService,\n    private readonly providerFiles: ProviderFiles,\n  ) {\n    super(configService, eventEmitter, prismaRepository, chatwootCache);\n    this.instance.qrcode = { count: 0 };\n    this.messageProcessor.mount({\n      onMessageReceive: this.messageHandle['messages.upsert'].bind(this), // Bind the method to the current context\n    });\n\n    this.authStateProvider = new AuthStateProvider(this.providerFiles);\n    this.logBaileys = this.configService.get<Log>('LOG').BAILEYS;\n  }\n\n  private authStateProvider: AuthStateProvider;\n  private readonly msgRetryCounterCache: CacheStore = new NodeCache();\n  private readonly userDevicesCache: CacheStore = new NodeCache({ stdTTL: 300000, useClones: false });\n  private endSession = false;\n  private logBaileys: any;\n  private eventProcessingQueue: Promise<void> = Promise.resolve();\n\n  // Cache TTL constants (in seconds)\n  private readonly MESSAGE_CACHE_TTL_SECONDS = 5 * 60; // 5 minutes - avoid duplicate message processing\n  private readonly UPDATE_CACHE_TTL_SECONDS = 30 * 60; // 30 minutes - avoid duplicate status updates\n\n  public stateConnection: wa.StateConnection = { state: 'close' };\n\n  public phoneNumber: string;\n\n  public get connectionStatus() {\n    return this.stateConnection;\n  }\n\n  public async logoutInstance() {\n    this.messageProcessor.onDestroy();\n    await this.client?.logout('Log out instance: ' + this.instanceName);\n\n    this.client?.ws?.close();\n\n    const db = this.configService.get<Database>('DATABASE');\n    const cache = this.configService.get<CacheConf>('CACHE');\n    const provider = this.configService.get<ProviderSession>('PROVIDER');\n\n    if (provider?.ENABLED) {\n      const authState = await this.authStateProvider.authStateProvider(this.instance.id);\n\n      await authState.removeCreds();\n    }\n\n    if (cache?.REDIS.ENABLED && cache?.REDIS.SAVE_INSTANCES) {\n      const authState = await useMultiFileAuthStateRedisDb(this.instance.id, this.cache);\n\n      await authState.removeCreds();\n    }\n\n    if (db.SAVE_DATA.INSTANCE) {\n      const authState = await useMultiFileAuthStatePrisma(this.instance.id, this.cache);\n\n      await authState.removeCreds();\n    }\n\n    const sessionExists = await this.prismaRepository.session.findFirst({ where: { sessionId: this.instanceId } });\n    if (sessionExists) {\n      await this.prismaRepository.session.delete({ where: { sessionId: this.instanceId } });\n    }\n  }\n\n  public async getProfileName() {\n    let profileName = this.client.user?.name ?? this.client.user?.verifiedName;\n    if (!profileName) {\n      const data = await this.prismaRepository.session.findUnique({ where: { sessionId: this.instanceId } });\n\n      if (data) {\n        const creds = JSON.parse(JSON.stringify(data.creds), BufferJSON.reviver);\n        profileName = creds.me?.name || creds.me?.verifiedName;\n      }\n    }\n\n    return profileName;\n  }\n\n  public async getProfileStatus() {\n    const status = await this.client.fetchStatus(this.instance.wuid);\n\n    return status[0]?.status;\n  }\n\n  public get profilePictureUrl() {\n    return this.instance.profilePictureUrl;\n  }\n\n  public get qrCode(): wa.QrCode {\n    return {\n      pairingCode: this.instance.qrcode?.pairingCode,\n      code: this.instance.qrcode?.code,\n      base64: this.instance.qrcode?.base64,\n      count: this.instance.qrcode?.count,\n    };\n  }\n\n  private async connectionUpdate({ qr, connection, lastDisconnect }: Partial<ConnectionState>) {\n    if (qr) {\n      if (this.instance.qrcode.count === this.configService.get<QrCode>('QRCODE').LIMIT) {\n        this.sendDataWebhook(Events.QRCODE_UPDATED, {\n          message: 'QR code limit reached, please login again',\n          statusCode: DisconnectReason.badSession,\n        });\n\n        if (this.configService.get<Chatwoot>('CHATWOOT').ENABLED && this.localChatwoot?.enabled) {\n          this.chatwootService.eventWhatsapp(\n            Events.QRCODE_UPDATED,\n            { instanceName: this.instance.name, instanceId: this.instanceId },\n            { message: 'QR code limit reached, please login again', statusCode: DisconnectReason.badSession },\n          );\n        }\n\n        this.sendDataWebhook(Events.CONNECTION_UPDATE, {\n          instance: this.instance.name,\n          state: 'refused',\n          statusReason: DisconnectReason.connectionClosed,\n          wuid: this.instance.wuid,\n          profileName: await this.getProfileName(),\n          profilePictureUrl: this.instance.profilePictureUrl,\n        });\n\n        this.endSession = true;\n\n        return this.eventEmitter.emit('no.connection', this.instance.name);\n      }\n\n      this.instance.qrcode.count++;\n\n      const color = this.configService.get<QrCode>('QRCODE').COLOR;\n\n      const optsQrcode: QRCodeToDataURLOptions = {\n        margin: 3,\n        scale: 4,\n        errorCorrectionLevel: 'H',\n        color: { light: '#ffffff', dark: color },\n      };\n\n      if (this.phoneNumber) {\n        await delay(1000);\n        this.instance.qrcode.pairingCode = await this.client.requestPairingCode(this.phoneNumber);\n      } else {\n        this.instance.qrcode.pairingCode = null;\n      }\n\n      qrcode.toDataURL(qr, optsQrcode, (error, base64) => {\n        if (error) {\n          this.logger.error('Qrcode generate failed:' + error.toString());\n          return;\n        }\n\n        this.instance.qrcode.base64 = base64;\n        this.instance.qrcode.code = qr;\n\n        this.sendDataWebhook(Events.QRCODE_UPDATED, {\n          qrcode: { instance: this.instance.name, pairingCode: this.instance.qrcode.pairingCode, code: qr, base64 },\n        });\n\n        if (this.configService.get<Chatwoot>('CHATWOOT').ENABLED && this.localChatwoot?.enabled) {\n          this.chatwootService.eventWhatsapp(\n            Events.QRCODE_UPDATED,\n            { instanceName: this.instance.name, instanceId: this.instanceId },\n            {\n              qrcode: { instance: this.instance.name, pairingCode: this.instance.qrcode.pairingCode, code: qr, base64 },\n            },\n          );\n        }\n      });\n\n      qrcodeTerminal.generate(qr, { small: true }, (qrcode) =>\n        this.logger.log(\n          `\\n{ instance: ${this.instance.name} pairingCode: ${this.instance.qrcode.pairingCode}, qrcodeCount: ${this.instance.qrcode.count} }\\n` +\n            qrcode,\n        ),\n      );\n\n      await this.prismaRepository.instance.update({\n        where: { id: this.instanceId },\n        data: { connectionStatus: 'connecting' },\n      });\n    }\n\n    if (connection) {\n      this.stateConnection = {\n        state: connection,\n        statusReason: (lastDisconnect?.error as Boom)?.output?.statusCode ?? 200,\n      };\n    }\n\n    if (connection === 'close') {\n      const statusCode = (lastDisconnect?.error as Boom)?.output?.statusCode;\n      const codesToNotReconnect = [DisconnectReason.loggedOut, DisconnectReason.forbidden, 402, 406];\n      const shouldReconnect = !codesToNotReconnect.includes(statusCode);\n      if (shouldReconnect) {\n        await this.connectToWhatsapp(this.phoneNumber);\n      } else {\n        this.sendDataWebhook(Events.STATUS_INSTANCE, {\n          instance: this.instance.name,\n          status: 'closed',\n          disconnectionAt: new Date(),\n          disconnectionReasonCode: statusCode,\n          disconnectionObject: JSON.stringify(lastDisconnect),\n        });\n\n        await this.prismaRepository.instance.update({\n          where: { id: this.instanceId },\n          data: {\n            connectionStatus: 'close',\n            disconnectionAt: new Date(),\n            disconnectionReasonCode: statusCode,\n            disconnectionObject: JSON.stringify(lastDisconnect),\n          },\n        });\n\n        if (this.configService.get<Chatwoot>('CHATWOOT').ENABLED && this.localChatwoot?.enabled) {\n          this.chatwootService.eventWhatsapp(\n            Events.STATUS_INSTANCE,\n            { instanceName: this.instance.name, instanceId: this.instanceId },\n            { instance: this.instance.name, status: 'closed' },\n          );\n        }\n\n        this.eventEmitter.emit('logout.instance', this.instance.name, 'inner');\n        this.client?.ws?.close();\n        this.client.end(new Error('Close connection'));\n\n        this.sendDataWebhook(Events.CONNECTION_UPDATE, { instance: this.instance.name, ...this.stateConnection });\n      }\n    }\n\n    if (connection === 'open') {\n      this.instance.wuid = this.client.user.id.replace(/:\\d+/, '');\n      try {\n        const profilePic = await this.profilePicture(this.instance.wuid);\n        this.instance.profilePictureUrl = profilePic.profilePictureUrl;\n      } catch {\n        this.instance.profilePictureUrl = null;\n      }\n      const formattedWuid = this.instance.wuid.split('@')[0].padEnd(30, ' ');\n      const formattedName = this.instance.name;\n      this.logger.info(\n        `\n        \n            CONNECTED TO WHATSAPP     \n        `.replace(/^ +/gm, '  '),\n      );\n      this.logger.info(\n        `\n        wuid: ${formattedWuid}\n        name: ${formattedName}\n      `,\n      );\n\n      await this.prismaRepository.instance.update({\n        where: { id: this.instanceId },\n        data: {\n          ownerJid: this.instance.wuid,\n          profileName: (await this.getProfileName()) as string,\n          profilePicUrl: this.instance.profilePictureUrl,\n          connectionStatus: 'open',\n        },\n      });\n\n      if (this.configService.get<Chatwoot>('CHATWOOT').ENABLED && this.localChatwoot?.enabled) {\n        this.chatwootService.eventWhatsapp(\n          Events.CONNECTION_UPDATE,\n          { instanceName: this.instance.name, instanceId: this.instanceId },\n          { instance: this.instance.name, status: 'open' },\n        );\n        this.syncChatwootLostMessages();\n      }\n\n      this.sendDataWebhook(Events.CONNECTION_UPDATE, {\n        instance: this.instance.name,\n        wuid: this.instance.wuid,\n        profileName: await this.getProfileName(),\n        profilePictureUrl: this.instance.profilePictureUrl,\n        ...this.stateConnection,\n      });\n    }\n\n    if (connection === 'connecting') {\n      this.sendDataWebhook(Events.CONNECTION_UPDATE, { instance: this.instance.name, ...this.stateConnection });\n    }\n  }\n\n  private async getMessage(key: proto.IMessageKey, full = false) {\n    try {\n      // Use raw SQL to avoid JSON path issues\n      const webMessageInfo = (await this.prismaRepository.$queryRaw`\n        SELECT * FROM \"Message\"\n        WHERE \"instanceId\" = ${this.instanceId}\n        AND \"key\"->>'id' = ${key.id}\n      `) as proto.IWebMessageInfo[];\n\n      if (full) {\n        return webMessageInfo[0];\n      }\n      if (webMessageInfo[0].message?.pollCreationMessage) {\n        const messageSecretBase64 = webMessageInfo[0].message?.messageContextInfo?.messageSecret;\n\n        if (typeof messageSecretBase64 === 'string') {\n          const messageSecret = Buffer.from(messageSecretBase64, 'base64');\n\n          const msg = {\n            messageContextInfo: { messageSecret },\n            pollCreationMessage: webMessageInfo[0].message?.pollCreationMessage,\n          };\n\n          return msg;\n        }\n      }\n\n      return webMessageInfo[0].message;\n    } catch {\n      return { conversation: '' };\n    }\n  }\n\n  private async defineAuthState() {\n    const db = this.configService.get<Database>('DATABASE');\n    const cache = this.configService.get<CacheConf>('CACHE');\n\n    const provider = this.configService.get<ProviderSession>('PROVIDER');\n\n    if (provider?.ENABLED) {\n      return await this.authStateProvider.authStateProvider(this.instance.id);\n    }\n\n    if (cache?.REDIS.ENABLED && cache?.REDIS.SAVE_INSTANCES) {\n      this.logger.info('Redis enabled');\n      return await useMultiFileAuthStateRedisDb(this.instance.id, this.cache);\n    }\n\n    if (db.SAVE_DATA.INSTANCE) {\n      return await useMultiFileAuthStatePrisma(this.instance.id, this.cache);\n    }\n  }\n\n  private async createClient(number?: string): Promise<WASocket> {\n    this.instance.authState = await this.defineAuthState();\n\n    const session = this.configService.get<ConfigSessionPhone>('CONFIG_SESSION_PHONE');\n\n    let browserOptions = {};\n\n    if (number || this.phoneNumber) {\n      this.phoneNumber = number;\n\n      this.logger.info(`Phone number: ${number}`);\n    } else {\n      const browser: WABrowserDescription = [session.CLIENT, session.NAME, release()];\n      browserOptions = { browser };\n\n      this.logger.info(`Browser: ${browser}`);\n    }\n\n    const baileysVersion = await fetchLatestWaWebVersion({});\n    const version = baileysVersion.version;\n    const log = `Baileys version: ${version.join('.')}`;\n\n    this.logger.info(log);\n\n    this.logger.info(`Group Ignore: ${this.localSettings.groupsIgnore}`);\n\n    let options;\n\n    if (this.localProxy?.enabled) {\n      this.logger.info('Proxy enabled: ' + this.localProxy?.host);\n\n      if (this.localProxy?.host?.includes('proxyscrape')) {\n        try {\n          const response = await axios.get(this.localProxy?.host);\n          const text = response.data;\n          const proxyUrls = text.split('\\r\\n');\n          const rand = Math.floor(Math.random() * Math.floor(proxyUrls.length));\n          const proxyUrl = 'http://' + proxyUrls[rand];\n          options = { agent: makeProxyAgent(proxyUrl), fetchAgent: makeProxyAgentUndici(proxyUrl) };\n        } catch {\n          this.localProxy.enabled = false;\n        }\n      } else {\n        options = {\n          agent: makeProxyAgent({\n            host: this.localProxy.host,\n            port: this.localProxy.port,\n            protocol: this.localProxy.protocol,\n            username: this.localProxy.username,\n            password: this.localProxy.password,\n          }),\n          fetchAgent: makeProxyAgentUndici({\n            host: this.localProxy.host,\n            port: this.localProxy.port,\n            protocol: this.localProxy.protocol,\n            username: this.localProxy.username,\n            password: this.localProxy.password,\n          }),\n        };\n      }\n    }\n\n    const socketConfig: UserFacingSocketConfig = {\n      ...options,\n      version,\n      logger: P({ level: this.logBaileys }),\n      printQRInTerminal: false,\n      auth: {\n        creds: this.instance.authState.state.creds,\n        keys: makeCacheableSignalKeyStore(this.instance.authState.state.keys, P({ level: 'error' }) as any),\n      },\n      msgRetryCounterCache: this.msgRetryCounterCache,\n      generateHighQualityLinkPreview: true,\n      getMessage: async (key) => (await this.getMessage(key)) as Promise<proto.IMessage>,\n      ...browserOptions,\n      markOnlineOnConnect: this.localSettings.alwaysOnline,\n      retryRequestDelayMs: 350,\n      maxMsgRetryCount: 4,\n      fireInitQueries: true,\n      connectTimeoutMs: 30_000,\n      keepAliveIntervalMs: 30_000,\n      qrTimeout: 45_000,\n      emitOwnEvents: false,\n      shouldIgnoreJid: (jid) => {\n        if (this.localSettings.syncFullHistory && isJidGroup(jid)) {\n          return false;\n        }\n\n        const isGroupJid = this.localSettings.groupsIgnore && isJidGroup(jid);\n        const isBroadcast = !this.localSettings.readStatus && isJidBroadcast(jid);\n        const isNewsletter = isJidNewsletter(jid);\n\n        return isGroupJid || isBroadcast || isNewsletter;\n      },\n      syncFullHistory: this.localSettings.syncFullHistory,\n      shouldSyncHistoryMessage: (msg: proto.Message.IHistorySyncNotification) => {\n        return this.historySyncNotification(msg);\n      },\n      cachedGroupMetadata: this.getGroupMetadataCache,\n      userDevicesCache: this.userDevicesCache,\n      transactionOpts: { maxCommitRetries: 10, delayBetweenTriesMs: 3000 },\n      patchMessageBeforeSending(message) {\n        if (\n          message.deviceSentMessage?.message?.listMessage?.listType === proto.Message.ListMessage.ListType.PRODUCT_LIST\n        ) {\n          message = JSON.parse(JSON.stringify(message));\n\n          message.deviceSentMessage.message.listMessage.listType = proto.Message.ListMessage.ListType.SINGLE_SELECT;\n        }\n\n        if (message.listMessage?.listType == proto.Message.ListMessage.ListType.PRODUCT_LIST) {\n          message = JSON.parse(JSON.stringify(message));\n\n          message.listMessage.listType = proto.Message.ListMessage.ListType.SINGLE_SELECT;\n        }\n\n        return message;\n      },\n    };\n\n    this.endSession = false;\n\n    this.client = makeWASocket(socketConfig);\n\n    if (this.localSettings.wavoipToken && this.localSettings.wavoipToken.length > 0) {\n      useVoiceCallsBaileys(this.localSettings.wavoipToken, this.client, this.connectionStatus.state as any, true);\n    }\n\n    this.eventHandler();\n\n    this.client.ws.on('CB:call', (packet) => {\n      console.log('CB:call', packet);\n      const payload = { event: 'CB:call', packet: packet };\n      this.sendDataWebhook(Events.CALL, payload, true, ['websocket']);\n    });\n\n    this.client.ws.on('CB:ack,class:call', (packet) => {\n      console.log('CB:ack,class:call', packet);\n      const payload = { event: 'CB:ack,class:call', packet: packet };\n      this.sendDataWebhook(Events.CALL, payload, true, ['websocket']);\n    });\n\n    this.phoneNumber = number;\n\n    return this.client;\n  }\n\n  public async connectToWhatsapp(number?: string): Promise<WASocket> {\n    try {\n      this.loadChatwoot();\n      this.loadSettings();\n      this.loadWebhook();\n      this.loadProxy();\n\n      // Remontar o messageProcessor para garantir que est funcionando aps reconexo\n      this.messageProcessor.mount({\n        onMessageReceive: this.messageHandle['messages.upsert'].bind(this),\n      });\n\n      return await this.createClient(number);\n    } catch (error) {\n      this.logger.error(error);\n      throw new InternalServerErrorException(error?.toString());\n    }\n  }\n\n  public async reloadConnection(): Promise<WASocket> {\n    try {\n      return await this.createClient(this.phoneNumber);\n    } catch (error) {\n      this.logger.error(error);\n      throw new InternalServerErrorException(error?.toString());\n    }\n  }\n\n  private readonly chatHandle = {\n    'chats.upsert': async (chats: Chat[]) => {\n      const existingChatIds = await this.prismaRepository.chat.findMany({\n        where: { instanceId: this.instanceId },\n        select: { remoteJid: true },\n      });\n\n      const existingChatIdSet = new Set(existingChatIds.map((chat) => chat.remoteJid));\n\n      const chatsToInsert = chats\n        .filter((chat) => !existingChatIdSet?.has(chat.id))\n        .map((chat) => ({\n          remoteJid: chat.id,\n          instanceId: this.instanceId,\n          name: chat.name,\n          unreadMessages: chat.unreadCount !== undefined ? chat.unreadCount : 0,\n        }));\n\n      this.sendDataWebhook(Events.CHATS_UPSERT, chatsToInsert);\n\n      if (chatsToInsert.length > 0) {\n        if (this.configService.get<Database>('DATABASE').SAVE_DATA.CHATS)\n          await this.prismaRepository.chat.createMany({ data: chatsToInsert, skipDuplicates: true });\n      }\n    },\n\n    'chats.update': async (\n      chats: Partial<\n        proto.IConversation & { lastMessageRecvTimestamp?: number } & {\n          conditional: (bufferedData: BufferedEventData) => boolean;\n        }\n      >[],\n    ) => {\n      const chatsRaw = chats.map((chat) => {\n        return { remoteJid: chat.id, instanceId: this.instanceId };\n      });\n\n      this.sendDataWebhook(Events.CHATS_UPDATE, chatsRaw);\n\n      for (const chat of chats) {\n        await this.prismaRepository.chat.updateMany({\n          where: { instanceId: this.instanceId, remoteJid: chat.id, name: chat.name },\n          data: { remoteJid: chat.id },\n        });\n      }\n    },\n\n    'chats.delete': async (chats: string[]) => {\n      chats.forEach(\n        async (chat) =>\n          await this.prismaRepository.chat.deleteMany({ where: { instanceId: this.instanceId, remoteJid: chat } }),\n      );\n\n      this.sendDataWebhook(Events.CHATS_DELETE, [...chats]);\n    },\n  };\n\n  private readonly contactHandle = {\n    'contacts.upsert': async (contacts: Contact[]) => {\n      try {\n        const contactsRaw: any = contacts.map((contact) => ({\n          remoteJid: contact.id,\n          pushName: contact?.name || contact?.verifiedName || contact.id.split('@')[0],\n          profilePicUrl: null,\n          instanceId: this.instanceId,\n        }));\n\n        if (contactsRaw.length > 0) {\n          this.sendDataWebhook(Events.CONTACTS_UPSERT, contactsRaw);\n\n          if (this.configService.get<Database>('DATABASE').SAVE_DATA.CONTACTS)\n            await this.prismaRepository.contact.createMany({ data: contactsRaw, skipDuplicates: true });\n\n          const usersContacts = contactsRaw.filter((c) => c.remoteJid.includes('@s.whatsapp'));\n          if (usersContacts) {\n            await saveOnWhatsappCache(usersContacts.map((c) => ({ remoteJid: c.remoteJid })));\n          }\n        }\n\n        if (\n          this.configService.get<Chatwoot>('CHATWOOT').ENABLED &&\n          this.localChatwoot?.enabled &&\n          this.localChatwoot.importContacts &&\n          contactsRaw.length\n        ) {\n          this.chatwootService.addHistoryContacts(\n            { instanceName: this.instance.name, instanceId: this.instance.id },\n            contactsRaw,\n          );\n          chatwootImport.importHistoryContacts(\n            { instanceName: this.instance.name, instanceId: this.instance.id },\n            this.localChatwoot,\n          );\n        }\n\n        const updatedContacts = await Promise.all(\n          contacts.map(async (contact) => ({\n            remoteJid: contact.id,\n            pushName: contact?.name || contact?.verifiedName || contact.id.split('@')[0],\n            profilePicUrl: (await this.profilePicture(contact.id)).profilePictureUrl,\n            instanceId: this.instanceId,\n          })),\n        );\n\n        if (updatedContacts.length > 0) {\n          const usersContacts = updatedContacts.filter((c) => c.remoteJid.includes('@s.whatsapp'));\n          if (usersContacts) {\n            await saveOnWhatsappCache(usersContacts.map((c) => ({ remoteJid: c.remoteJid })));\n          }\n\n          this.sendDataWebhook(Events.CONTACTS_UPDATE, updatedContacts);\n          await Promise.all(\n            updatedContacts.map(async (contact) => {\n              if (this.configService.get<Database>('DATABASE').SAVE_DATA.CONTACTS) {\n                await this.prismaRepository.contact.updateMany({\n                  where: { remoteJid: contact.remoteJid, instanceId: this.instanceId },\n                  data: { profilePicUrl: contact.profilePicUrl },\n                });\n              }\n\n              if (this.configService.get<Chatwoot>('CHATWOOT').ENABLED && this.localChatwoot?.enabled) {\n                const instance = { instanceName: this.instance.name, instanceId: this.instance.id };\n\n                const findParticipant = await this.chatwootService.findContact(\n                  instance,\n                  contact.remoteJid.split('@')[0],\n                );\n\n                if (!findParticipant) {\n                  return;\n                }\n\n                this.chatwootService.updateContact(instance, findParticipant.id, {\n                  name: contact.pushName,\n                  avatar_url: contact.profilePicUrl,\n                });\n              }\n            }),\n          );\n        }\n      } catch (error) {\n        console.error(error);\n        this.logger.error(`Error: ${error.message}`);\n      }\n    },\n\n    'contacts.update': async (contacts: Partial<Contact>[]) => {\n      const contactsRaw: { remoteJid: string; pushName?: string; profilePicUrl?: string; instanceId: string }[] = [];\n      for await (const contact of contacts) {\n        this.logger.debug(`Updating contact: ${JSON.stringify(contact, null, 2)}`);\n        contactsRaw.push({\n          remoteJid: contact.id,\n          pushName: contact?.name ?? contact?.verifiedName,\n          profilePicUrl: (await this.profilePicture(contact.id)).profilePictureUrl,\n          instanceId: this.instanceId,\n        });\n      }\n\n      this.sendDataWebhook(Events.CONTACTS_UPDATE, contactsRaw);\n\n      if (this.configService.get<Database>('DATABASE').SAVE_DATA.CONTACTS) {\n        const updateTransactions = contactsRaw.map((contact) =>\n          this.prismaRepository.contact.upsert({\n            where: { remoteJid_instanceId: { remoteJid: contact.remoteJid, instanceId: contact.instanceId } },\n            create: contact,\n            update: contact,\n          }),\n        );\n        await this.prismaRepository.$transaction(updateTransactions);\n      }\n\n      //const usersContacts = contactsRaw.filter((c) => c.remoteJid.includes('@s.whatsapp'));\n    },\n  };\n\n  private readonly messageHandle = {\n    'messaging-history.set': async ({\n      messages,\n      chats,\n      contacts,\n      isLatest,\n      progress,\n      syncType,\n    }: {\n      chats: Chat[];\n      contacts: Contact[];\n      messages: WAMessage[];\n      isLatest?: boolean;\n      progress?: number;\n      syncType?: proto.HistorySync.HistorySyncType;\n    }) => {\n      try {\n        if (syncType === proto.HistorySync.HistorySyncType.ON_DEMAND) {\n          console.log('received on-demand history sync, messages=', messages);\n        }\n        console.log(\n          `recv ${chats.length} chats, ${contacts.length} contacts, ${messages.length} msgs (is latest: ${isLatest}, progress: ${progress}%), type: ${syncType}`,\n        );\n\n        const instance: InstanceDto = { instanceName: this.instance.name };\n\n        let timestampLimitToImport = null;\n\n        if (this.configService.get<Chatwoot>('CHATWOOT').ENABLED) {\n          const daysLimitToImport = this.localChatwoot?.enabled ? this.localChatwoot.daysLimitImportMessages : 1000;\n\n          const date = new Date();\n          timestampLimitToImport = new Date(date.setDate(date.getDate() - daysLimitToImport)).getTime() / 1000;\n\n          const maxBatchTimestamp = Math.max(...messages.map((message) => message.messageTimestamp as number));\n\n          const processBatch = maxBatchTimestamp >= timestampLimitToImport;\n\n          if (!processBatch) {\n            return;\n          }\n        }\n\n        const contactsMap = new Map();\n\n        for (const contact of contacts) {\n          if (contact.id && (contact.notify || contact.name)) {\n            contactsMap.set(contact.id, { name: contact.name ?? contact.notify, jid: contact.id });\n          }\n        }\n\n        const chatsRaw: { remoteJid: string; instanceId: string; name?: string }[] = [];\n        const chatsRepository = new Set(\n          (await this.prismaRepository.chat.findMany({ where: { instanceId: this.instanceId } })).map(\n            (chat) => chat.remoteJid,\n          ),\n        );\n\n        for (const chat of chats) {\n          if (chatsRepository?.has(chat.id)) {\n            continue;\n          }\n\n          chatsRaw.push({ remoteJid: chat.id, instanceId: this.instanceId, name: chat.name });\n        }\n\n        this.sendDataWebhook(Events.CHATS_SET, chatsRaw);\n\n        if (this.configService.get<Database>('DATABASE').SAVE_DATA.HISTORIC) {\n          await this.prismaRepository.chat.createMany({ data: chatsRaw, skipDuplicates: true });\n        }\n\n        const messagesRaw: any[] = [];\n\n        const messagesRepository: Set<string> = new Set(\n          chatwootImport.getRepositoryMessagesCache(instance) ??\n            (\n              await this.prismaRepository.message.findMany({\n                select: { key: true },\n                where: { instanceId: this.instanceId },\n              })\n            ).map((message) => {\n              const key = message.key as { id: string };\n\n              return key.id;\n            }),\n        );\n\n        if (chatwootImport.getRepositoryMessagesCache(instance) === null) {\n          chatwootImport.setRepositoryMessagesCache(instance, messagesRepository);\n        }\n\n        for (const m of messages) {\n          if (!m.message || !m.key || !m.messageTimestamp) {\n            continue;\n          }\n\n          if (Long.isLong(m?.messageTimestamp)) {\n            m.messageTimestamp = m.messageTimestamp?.toNumber();\n          }\n\n          if (this.configService.get<Chatwoot>('CHATWOOT').ENABLED) {\n            if (m.messageTimestamp <= timestampLimitToImport) {\n              continue;\n            }\n          }\n\n          if (messagesRepository?.has(m.key.id)) {\n            continue;\n          }\n\n          if (!m.pushName && !m.key.fromMe) {\n            const participantJid = m.participant || m.key.participant || m.key.remoteJid;\n            if (participantJid && contactsMap.has(participantJid)) {\n              m.pushName = contactsMap.get(participantJid).name;\n            } else if (participantJid) {\n              m.pushName = participantJid.split('@')[0];\n            }\n          }\n\n          messagesRaw.push(this.prepareMessage(m));\n        }\n\n        this.sendDataWebhook(Events.MESSAGES_SET, [...messagesRaw], true, undefined, {\n          isLatest,\n          progress,\n        });\n\n        if (this.configService.get<Database>('DATABASE').SAVE_DATA.HISTORIC) {\n          await this.prismaRepository.message.createMany({ data: messagesRaw, skipDuplicates: true });\n        }\n\n        if (\n          this.configService.get<Chatwoot>('CHATWOOT').ENABLED &&\n          this.localChatwoot?.enabled &&\n          this.localChatwoot.importMessages &&\n          messagesRaw.length > 0\n        ) {\n          this.chatwootService.addHistoryMessages(\n            instance,\n            messagesRaw.filter((msg) => !chatwootImport.isIgnorePhoneNumber(msg.key?.remoteJid)),\n          );\n        }\n\n        await this.contactHandle['contacts.upsert'](\n          contacts.filter((c) => !!c.notify || !!c.name).map((c) => ({ id: c.id, name: c.name ?? c.notify })),\n        );\n\n        contacts = undefined;\n        messages = undefined;\n        chats = undefined;\n      } catch (error) {\n        this.logger.error(error);\n      }\n    },\n\n    'messages.upsert': async (\n      { messages, type, requestId }: { messages: WAMessage[]; type: MessageUpsertType; requestId?: string },\n      settings: any,\n    ) => {\n      try {\n        for (const received of messages) {\n          if (\n            received?.messageStubParameters?.some?.((param) =>\n              [\n                'No matching sessions found for message',\n                'Bad MAC',\n                'failed to decrypt message',\n                'SessionError',\n                'Invalid PreKey ID',\n                'No session record',\n                'No session found to decrypt message',\n                'Message absent from node',\n              ].some((err) => param?.includes?.(err)),\n            )\n          ) {\n            this.logger.warn(`Message ignored with messageStubParameters: ${JSON.stringify(received, null, 2)}`);\n            continue;\n          }\n          if (received.message?.conversation || received.message?.extendedTextMessage?.text) {\n            const text = received.message?.conversation || received.message?.extendedTextMessage?.text;\n\n            if (text == 'requestPlaceholder' && !requestId) {\n              const messageId = await this.client.requestPlaceholderResend(received.key);\n\n              console.log('requested placeholder resync, id=', messageId);\n            } else if (requestId) {\n              console.log('Message received from phone, id=', requestId, received);\n            }\n\n            if (text == 'onDemandHistSync') {\n              const messageId = await this.client.fetchMessageHistory(50, received.key, received.messageTimestamp!);\n              console.log('requested on-demand sync, id=', messageId);\n            }\n          }\n\n          const editedMessage =\n            received?.message?.protocolMessage || received?.message?.editedMessage?.message?.protocolMessage;\n\n          if (editedMessage) {\n            if (this.configService.get<Chatwoot>('CHATWOOT').ENABLED && this.localChatwoot?.enabled)\n              this.chatwootService.eventWhatsapp(\n                'messages.edit',\n                { instanceName: this.instance.name, instanceId: this.instance.id },\n                editedMessage,\n              );\n\n            await this.sendDataWebhook(Events.MESSAGES_EDITED, editedMessage);\n\n            if (received.key?.id && editedMessage.key?.id) {\n              await this.baileysCache.set(`protocol_${received.key.id}`, editedMessage.key.id, 60 * 60 * 24);\n            }\n\n            const oldMessage = await this.getMessage(editedMessage.key, true);\n            if ((oldMessage as any)?.id) {\n              const editedMessageTimestamp = Long.isLong(received?.messageTimestamp)\n                ? Math.floor(received?.messageTimestamp.toNumber())\n                : Math.floor(received?.messageTimestamp as number);\n\n              await this.prismaRepository.message.update({\n                where: { id: (oldMessage as any).id },\n                data: {\n                  message: editedMessage.editedMessage as any,\n                  messageTimestamp: editedMessageTimestamp,\n                  status: 'EDITED',\n                },\n              });\n              await this.prismaRepository.messageUpdate.create({\n                data: {\n                  fromMe: editedMessage.key.fromMe,\n                  keyId: editedMessage.key.id,\n                  remoteJid: editedMessage.key.remoteJid,\n                  status: 'EDITED',\n                  instanceId: this.instanceId,\n                  messageId: (oldMessage as any).id,\n                },\n              });\n            }\n          }\n\n          if ((type !== 'notify' && type !== 'append') || editedMessage || !received?.message) {\n            continue;\n          }\n\n          if (Long.isLong(received.messageTimestamp)) {\n            received.messageTimestamp = received.messageTimestamp?.toNumber();\n          }\n\n          if (settings?.groupsIgnore && received.key.remoteJid.includes('@g.us')) {\n            continue;\n          }\n\n          const existingChat = await this.prismaRepository.chat.findFirst({\n            where: { instanceId: this.instanceId, remoteJid: received.key.remoteJid },\n            select: { id: true, name: true },\n          });\n\n          if (\n            existingChat &&\n            received.pushName &&\n            existingChat.name !== received.pushName &&\n            received.pushName.trim().length > 0 &&\n            !received.key.fromMe &&\n            !received.key.remoteJid.includes('@g.us')\n          ) {\n            this.sendDataWebhook(Events.CHATS_UPSERT, [{ ...existingChat, name: received.pushName }]);\n            if (this.configService.get<Database>('DATABASE').SAVE_DATA.CHATS) {\n              try {\n                await this.prismaRepository.chat.update({\n                  where: { id: existingChat.id },\n                  data: { name: received.pushName },\n                });\n              } catch {\n                console.log(`Chat insert record ignored: ${received.key.remoteJid} - ${this.instanceId}`);\n              }\n            }\n          }\n\n          const messageRaw = this.prepareMessage(received);\n\n          if (messageRaw.messageType === 'pollUpdateMessage') {\n            const pollCreationKey = messageRaw.message.pollUpdateMessage.pollCreationMessageKey;\n            const pollMessage = (await this.getMessage(pollCreationKey, true)) as proto.IWebMessageInfo;\n            const pollMessageSecret = (await this.getMessage(pollCreationKey)) as any;\n\n            if (pollMessage) {\n              const pollOptions =\n                (pollMessage.message as any).pollCreationMessage?.options ||\n                (pollMessage.message as any).pollCreationMessageV3?.options ||\n                [];\n              const pollVote = messageRaw.message.pollUpdateMessage.vote;\n\n              const voterJid = received.key.fromMe\n                ? this.instance.wuid\n                : received.key.participant || received.key.remoteJid;\n\n              let pollEncKey = pollMessageSecret?.messageContextInfo?.messageSecret;\n\n              let successfulVoterJid = voterJid;\n\n              if (typeof pollEncKey === 'string') {\n                pollEncKey = Buffer.from(pollEncKey, 'base64');\n              } else if (pollEncKey?.type === 'Buffer' && Array.isArray(pollEncKey.data)) {\n                pollEncKey = Buffer.from(pollEncKey.data);\n              }\n\n              if (Buffer.isBuffer(pollEncKey) && pollEncKey.length === 44) {\n                pollEncKey = Buffer.from(pollEncKey.toString('utf8'), 'base64');\n              }\n\n              if (pollVote.encPayload && pollEncKey) {\n                const creatorCandidates = [\n                  this.instance.wuid,\n                  this.client.user?.lid,\n                  pollMessage.key.participant,\n                  (pollMessage.key as any).participantAlt,\n                  pollMessage.key.remoteJid,\n                ];\n\n                const key = received.key as any;\n                const voterCandidates = [\n                  this.instance.wuid,\n                  this.client.user?.lid,\n                  key.participant,\n                  key.participantAlt,\n                  key.remoteJidAlt,\n                  key.remoteJid,\n                ];\n\n                const uniqueCreators = [\n                  ...new Set(creatorCandidates.filter(Boolean).map((id) => jidNormalizedUser(id))),\n                ];\n                const uniqueVoters = [...new Set(voterCandidates.filter(Boolean).map((id) => jidNormalizedUser(id)))];\n\n                let decryptedVote;\n\n                for (const creator of uniqueCreators) {\n                  for (const voter of uniqueVoters) {\n                    try {\n                      decryptedVote = decryptPollVote(pollVote, {\n                        pollCreatorJid: creator,\n                        pollMsgId: pollMessage.key.id,\n                        pollEncKey,\n                        voterJid: voter,\n                      } as any);\n                      if (decryptedVote) {\n                        successfulVoterJid = voter;\n                        break;\n                      }\n                    } catch {\n                      // Continue trying\n                    }\n                  }\n                  if (decryptedVote) break;\n                }\n\n                if (decryptedVote) {\n                  Object.assign(pollVote, decryptedVote);\n                }\n              }\n\n              const selectedOptions = pollVote?.selectedOptions || [];\n\n              const selectedOptionNames = pollOptions\n                .filter((option) => {\n                  const hash = createHash('sha256').update(option.optionName).digest();\n                  return selectedOptions.some((selected) => Buffer.compare(selected, hash) === 0);\n                })\n                .map((option) => option.optionName);\n\n              messageRaw.message.pollUpdateMessage.vote.selectedOptions = selectedOptionNames;\n\n              const pollUpdates = pollOptions.map((option) => ({\n                name: option.optionName,\n                voters: selectedOptionNames.includes(option.optionName) ? [successfulVoterJid] : [],\n              }));\n\n              messageRaw.pollUpdates = pollUpdates;\n            }\n          }\n\n          const isMedia =\n            received?.message?.imageMessage ||\n            received?.message?.videoMessage ||\n            received?.message?.stickerMessage ||\n            received?.message?.documentMessage ||\n            received?.message?.documentWithCaptionMessage ||\n            received?.message?.ptvMessage ||\n            received?.message?.audioMessage;\n\n          const isVideo = received?.message?.videoMessage;\n\n          if (this.localSettings.readMessages && received.key.id !== 'status@broadcast') {\n            await this.client.readMessages([received.key]);\n          }\n\n          if (this.localSettings.readStatus && received.key.id === 'status@broadcast') {\n            await this.client.readMessages([received.key]);\n          }\n\n          if (\n            this.configService.get<Chatwoot>('CHATWOOT').ENABLED &&\n            this.localChatwoot?.enabled &&\n            !received.key.id.includes('@broadcast')\n          ) {\n            const chatwootSentMessage = await this.chatwootService.eventWhatsapp(\n              Events.MESSAGES_UPSERT,\n              { instanceName: this.instance.name, instanceId: this.instanceId },\n              messageRaw,\n            );\n\n            if (chatwootSentMessage?.id) {\n              messageRaw.chatwootMessageId = chatwootSentMessage.id;\n              messageRaw.chatwootInboxId = chatwootSentMessage.inbox_id;\n              messageRaw.chatwootConversationId = chatwootSentMessage.conversation_id;\n            }\n          }\n\n          if (this.configService.get<Openai>('OPENAI').ENABLED && received?.message?.audioMessage) {\n            const openAiDefaultSettings = await this.prismaRepository.openaiSetting.findFirst({\n              where: { instanceId: this.instanceId },\n              include: { OpenaiCreds: true },\n            });\n\n            if (openAiDefaultSettings && openAiDefaultSettings.openaiCredsId && openAiDefaultSettings.speechToText) {\n              messageRaw.message.speechToText = `[audio] ${await this.openaiService.speechToText(received, this)}`;\n            }\n          }\n\n          if (this.configService.get<Database>('DATABASE').SAVE_DATA.NEW_MESSAGE) {\n            // eslint-disable-next-line @typescript-eslint/no-unused-vars\n            const { pollUpdates, ...messageData } = messageRaw;\n            const msg = await this.prismaRepository.message.create({ data: messageData });\n\n            const { remoteJid } = received.key;\n            const timestamp = msg.messageTimestamp;\n            const fromMe = received.key.fromMe.toString();\n            const messageKey = `${remoteJid}_${timestamp}_${fromMe}`;\n\n            const cachedTimestamp = await this.baileysCache.get(messageKey);\n\n            if (!cachedTimestamp) {\n              if (!received.key.fromMe) {\n                if (msg.status === status[3]) {\n                  this.logger.log(`Update not read messages ${remoteJid}`);\n                  await this.updateChatUnreadMessages(remoteJid);\n                } else if (msg.status === status[4]) {\n                  this.logger.log(`Update readed messages ${remoteJid} - ${timestamp}`);\n                  await this.updateMessagesReadedByTimestamp(remoteJid, timestamp);\n                }\n              } else {\n                // is send message by me\n                this.logger.log(`Update readed messages ${remoteJid} - ${timestamp}`);\n                await this.updateMessagesReadedByTimestamp(remoteJid, timestamp);\n              }\n\n              await this.baileysCache.set(messageKey, true, this.MESSAGE_CACHE_TTL_SECONDS);\n            } else {\n              this.logger.info(`Update readed messages duplicated ignored [avoid deadlock]: ${messageKey}`);\n            }\n\n            if (isMedia) {\n              if (this.configService.get<S3>('S3').ENABLE) {\n                try {\n                  if (isVideo && !this.configService.get<S3>('S3').SAVE_VIDEO) {\n                    this.logger.warn('Video upload is disabled. Skipping video upload.');\n                    // Skip video upload by returning early from this block\n                    return;\n                  }\n\n                  const message: any = received;\n\n                  // Verificao adicional para garantir que h contedo de mdia real\n                  const hasRealMedia = this.hasValidMediaContent(message);\n\n                  if (!hasRealMedia) {\n                    this.logger.warn('Message detected as media but contains no valid media content');\n                  } else {\n                    const media = await this.getBase64FromMediaMessage({ message }, true);\n\n                    if (!media) {\n                      this.logger.verbose('No valid media to upload (messageContextInfo only), skipping MinIO');\n                      return;\n                    }\n\n                    const { buffer, mediaType, fileName, size } = media;\n                    const mimetype = mimeTypes.lookup(fileName).toString();\n                    const fullName = join(\n                      `${this.instance.id}`,\n                      received.key.remoteJid,\n                      mediaType,\n                      `${Date.now()}_${fileName}`,\n                    );\n                    await s3Service.uploadFile(fullName, buffer, size.fileLength?.low, { 'Content-Type': mimetype });\n\n                    await this.prismaRepository.media.create({\n                      data: {\n                        messageId: msg.id,\n                        instanceId: this.instanceId,\n                        type: mediaType,\n                        fileName: fullName,\n                        mimetype,\n                      },\n                    });\n\n                    const mediaUrl = await s3Service.getObjectUrl(fullName);\n\n                    messageRaw.message.mediaUrl = mediaUrl;\n\n                    await this.prismaRepository.message.update({ where: { id: msg.id }, data: messageRaw });\n                  }\n                } catch (error) {\n                  this.logger.error(['Error on upload file to minio', error?.message, error?.stack]);\n                }\n              }\n            }\n          }\n\n          if (this.localWebhook.enabled) {\n            if (isMedia && this.localWebhook.webhookBase64) {\n              try {\n                const buffer = await downloadMediaMessage(\n                  { key: received.key, message: received?.message },\n                  'buffer',\n                  {},\n                  { logger: P({ level: 'error' }) as any, reuploadRequest: this.client.updateMediaMessage },\n                );\n\n                if (buffer) {\n                  messageRaw.message.base64 = buffer.toString('base64');\n                } else {\n                  // retry to download media\n                  const buffer = await downloadMediaMessage(\n                    { key: received.key, message: received?.message },\n                    'buffer',\n                    {},\n                    { logger: P({ level: 'error' }) as any, reuploadRequest: this.client.updateMediaMessage },\n                  );\n\n                  if (buffer) {\n                    messageRaw.message.base64 = buffer.toString('base64');\n                  }\n                }\n              } catch (error) {\n                this.logger.error(['Error converting media to base64', error?.message]);\n              }\n            }\n          }\n\n          this.logger.verbose(messageRaw);\n\n          sendTelemetry(`received.message.${messageRaw.messageType ?? 'unknown'}`);\n          if (messageRaw.key.remoteJid?.includes('@lid') && messageRaw.key.remoteJidAlt) {\n            messageRaw.key.remoteJid = messageRaw.key.remoteJidAlt;\n          }\n          console.log(messageRaw);\n\n          this.sendDataWebhook(Events.MESSAGES_UPSERT, messageRaw);\n\n          await chatbotController.emit({\n            instance: { instanceName: this.instance.name, instanceId: this.instanceId },\n            remoteJid: messageRaw.key.remoteJid,\n            msg: messageRaw,\n            pushName: messageRaw.pushName,\n          });\n\n          const contact = await this.prismaRepository.contact.findFirst({\n            where: { remoteJid: received.key.remoteJid, instanceId: this.instanceId },\n          });\n\n          const contactRaw: {\n            remoteJid: string;\n            pushName: string;\n            profilePicUrl?: string;\n            instanceId: string;\n          } = {\n            remoteJid: received.key.remoteJid,\n            pushName: received.key.fromMe ? '' : received.key.fromMe == null ? '' : received.pushName,\n            profilePicUrl: (await this.profilePicture(received.key.remoteJid)).profilePictureUrl,\n            instanceId: this.instanceId,\n          };\n\n          if (contactRaw.remoteJid === 'status@broadcast') {\n            continue;\n          }\n\n          if (contactRaw.remoteJid.includes('@s.whatsapp') || contactRaw.remoteJid.includes('@lid')) {\n            await saveOnWhatsappCache([\n              {\n                remoteJid:\n                  messageRaw.key.addressingMode === 'lid' ? messageRaw.key.remoteJidAlt : messageRaw.key.remoteJid,\n                remoteJidAlt: messageRaw.key.remoteJidAlt,\n                lid: messageRaw.key.addressingMode === 'lid' ? 'lid' : null,\n              },\n            ]);\n          }\n\n          if (contact) {\n            this.sendDataWebhook(Events.CONTACTS_UPDATE, contactRaw);\n\n            if (this.configService.get<Chatwoot>('CHATWOOT').ENABLED && this.localChatwoot?.enabled) {\n              await this.chatwootService.eventWhatsapp(\n                Events.CONTACTS_UPDATE,\n                { instanceName: this.instance.name, instanceId: this.instanceId },\n                contactRaw,\n              );\n            }\n\n            if (this.configService.get<Database>('DATABASE').SAVE_DATA.CONTACTS)\n              await this.prismaRepository.contact.upsert({\n                where: { remoteJid_instanceId: { remoteJid: contactRaw.remoteJid, instanceId: contactRaw.instanceId } },\n                create: contactRaw,\n                update: contactRaw,\n              });\n\n            continue;\n          }\n\n          this.sendDataWebhook(Events.CONTACTS_UPSERT, contactRaw);\n\n          if (this.configService.get<Database>('DATABASE').SAVE_DATA.CONTACTS)\n            await this.prismaRepository.contact.upsert({\n              where: { remoteJid_instanceId: { remoteJid: contactRaw.remoteJid, instanceId: contactRaw.instanceId } },\n              update: contactRaw,\n              create: contactRaw,\n            });\n        }\n      } catch (error) {\n        this.logger.error(error);\n      }\n    },\n\n    'messages.update': async (args: { update: Partial<WAMessage>; key: WAMessageKey }[], settings: any) => {\n      this.logger.verbose(`Update messages ${JSON.stringify(args, undefined, 2)}`);\n\n      const readChatToUpdate: Record<string, true> = {}; // {remoteJid: true}\n\n      for await (const { key, update } of args) {\n        if (settings?.groupsIgnore && key.remoteJid?.includes('@g.us')) {\n          continue;\n        }\n\n        const updateKey = `${this.instance.id}_${key.id}_${update.status}`;\n\n        const cached = await this.baileysCache.get(updateKey);\n\n        const secondsSinceEpoch = Math.floor(Date.now() / 1000);\n        console.log('CACHE:', { cached, updateKey, messageTimestamp: update.messageTimestamp, secondsSinceEpoch });\n\n        if (\n          (update.messageTimestamp && update.messageTimestamp === cached) ||\n          (!update.messageTimestamp && secondsSinceEpoch === cached)\n        ) {\n          this.logger.info(`Update Message duplicated ignored [avoid deadlock]: ${updateKey}`);\n          continue;\n        }\n\n        if (update.messageTimestamp) {\n          await this.baileysCache.set(updateKey, update.messageTimestamp, 30 * 60);\n        } else {\n          await this.baileysCache.set(updateKey, secondsSinceEpoch, 30 * 60);\n        }\n\n        if (status[update.status] === 'READ' && key.fromMe) {\n          if (this.configService.get<Chatwoot>('CHATWOOT').ENABLED && this.localChatwoot?.enabled) {\n            this.chatwootService.eventWhatsapp(\n              'messages.read',\n              { instanceName: this.instance.name, instanceId: this.instanceId },\n              { key: key },\n            );\n          }\n        }\n\n        if (key.remoteJid !== 'status@broadcast' && key.id !== undefined) {\n          let pollUpdates: any;\n\n          if (update.pollUpdates) {\n            const pollCreation = await this.getMessage(key);\n\n            if (pollCreation) {\n              pollUpdates = getAggregateVotesInPollMessage({\n                message: pollCreation as proto.IMessage,\n                pollUpdates: update.pollUpdates,\n              });\n            }\n          }\n\n          const message: any = {\n            keyId: key.id,\n            remoteJid: key?.remoteJid,\n            fromMe: key.fromMe,\n            participant: key?.participant,\n            status: status[update.status] ?? 'SERVER_ACK',\n            pollUpdates,\n            instanceId: this.instanceId,\n          };\n\n          if (update.message) {\n            message.message = update.message;\n          }\n\n          let findMessage: any;\n          const configDatabaseData = this.configService.get<Database>('DATABASE').SAVE_DATA;\n          if (configDatabaseData.HISTORIC || configDatabaseData.NEW_MESSAGE) {\n            // Use raw SQL to avoid JSON path issues\n            const protocolMapKey = `protocol_${key.id}`;\n            const originalMessageId = (await this.baileysCache.get(protocolMapKey)) as string;\n\n            if (originalMessageId) {\n              message.keyId = originalMessageId;\n            }\n\n            const searchId = originalMessageId || key.id;\n\n            const messages = (await this.prismaRepository.$queryRaw`\n              SELECT * FROM \"Message\"\n              WHERE \"instanceId\" = ${this.instanceId}\n              AND \"key\"->>'id' = ${searchId}\n              LIMIT 1\n            `) as any[];\n            findMessage = messages[0] || null;\n\n            if (!findMessage?.id) {\n              this.logger.warn(`Original message not found for update. Skipping. Key: ${JSON.stringify(key)}`);\n              continue;\n            }\n            message.messageId = findMessage.id;\n          }\n\n          if (update.message === null && update.status === undefined) {\n            this.sendDataWebhook(Events.MESSAGES_DELETE, { ...key, status: 'DELETED' });\n\n            if (this.configService.get<Database>('DATABASE').SAVE_DATA.MESSAGE_UPDATE)\n              await this.prismaRepository.messageUpdate.create({ data: message });\n\n            if (this.configService.get<Chatwoot>('CHATWOOT').ENABLED && this.localChatwoot?.enabled) {\n              this.chatwootService.eventWhatsapp(\n                Events.MESSAGES_DELETE,\n                { instanceName: this.instance.name, instanceId: this.instanceId },\n                { key: key },\n              );\n            }\n\n            continue;\n          }\n\n          if (findMessage && update.status !== undefined && status[update.status] !== findMessage.status) {\n            if (!key.fromMe && key.remoteJid) {\n              readChatToUpdate[key.remoteJid] = true;\n\n              const { remoteJid } = key;\n              const timestamp = findMessage.messageTimestamp;\n              const fromMe = key.fromMe.toString();\n              const messageKey = `${remoteJid}_${timestamp}_${fromMe}`;\n\n              const cachedTimestamp = await this.baileysCache.get(messageKey);\n\n              if (!cachedTimestamp) {\n                if (status[update.status] === status[4]) {\n                  this.logger.log(`Update as read in message.update ${remoteJid} - ${timestamp}`);\n                  await this.updateMessagesReadedByTimestamp(remoteJid, timestamp);\n                  await this.baileysCache.set(messageKey, true, this.MESSAGE_CACHE_TTL_SECONDS);\n                }\n\n                await this.prismaRepository.message.update({\n                  where: { id: findMessage.id },\n                  data: { status: status[update.status] },\n                });\n              } else {\n                this.logger.info(\n                  `Update readed messages duplicated ignored in message.update [avoid deadlock]: ${messageKey}`,\n                );\n              }\n            }\n          }\n\n          this.sendDataWebhook(Events.MESSAGES_UPDATE, message);\n\n          if (this.configService.get<Database>('DATABASE').SAVE_DATA.MESSAGE_UPDATE) {\n            // eslint-disable-next-line @typescript-eslint/no-unused-vars\n            const { message: _msg, ...messageData } = message;\n            await this.prismaRepository.messageUpdate.create({ data: messageData });\n          }\n\n          const existingChat = await this.prismaRepository.chat.findFirst({\n            where: { instanceId: this.instanceId, remoteJid: message.remoteJid },\n          });\n\n          if (existingChat) {\n            const chatToInsert = { remoteJid: message.remoteJid, instanceId: this.instanceId, unreadMessages: 0 };\n\n            this.sendDataWebhook(Events.CHATS_UPSERT, [chatToInsert]);\n            if (this.configService.get<Database>('DATABASE').SAVE_DATA.CHATS) {\n              try {\n                await this.prismaRepository.chat.update({ where: { id: existingChat.id }, data: chatToInsert });\n              } catch {\n                console.log(`Chat insert record ignored: ${chatToInsert.remoteJid} - ${chatToInsert.instanceId}`);\n              }\n            }\n          }\n        }\n      }\n\n      await Promise.all(Object.keys(readChatToUpdate).map((remoteJid) => this.updateChatUnreadMessages(remoteJid)));\n    },\n  };\n\n  private readonly groupHandler = {\n    'groups.upsert': (groupMetadata: GroupMetadata[]) => {\n      this.sendDataWebhook(Events.GROUPS_UPSERT, groupMetadata);\n    },\n\n    'groups.update': (groupMetadataUpdate: Partial<GroupMetadata>[]) => {\n      this.sendDataWebhook(Events.GROUPS_UPDATE, groupMetadataUpdate);\n\n      groupMetadataUpdate.forEach((group) => {\n        if (isJidGroup(group.id)) {\n          this.updateGroupMetadataCache(group.id);\n        }\n      });\n    },\n\n    'group-participants.update': async (participantsUpdate: {\n      id: string;\n      participants: string[];\n      action: ParticipantAction;\n    }) => {\n      // ENHANCEMENT: Adds participantsData field while maintaining backward compatibility\n      // MAINTAINS: participants: string[] (original JID strings)\n      // ADDS: participantsData: { jid: string, phoneNumber: string, name?: string, imgUrl?: string }[]\n      // This enables LID to phoneNumber conversion without breaking existing webhook consumers\n\n      // Helper to normalize participantId as phone number\n      const normalizePhoneNumber = (id: string | null | undefined): string => {\n        // Remove @lid, @s.whatsapp.net suffixes and extract just the number part\n        return String(id || '').split('@')[0];\n      };\n\n      try {\n        // Usa o mesmo mtodo que o endpoint /group/participants\n        const groupParticipants = await this.findParticipants({ groupJid: participantsUpdate.id });\n\n        // Validao para garantir que temos dados vlidos\n        if (!groupParticipants?.participants || !Array.isArray(groupParticipants.participants)) {\n          throw new Error('Invalid participant data received from findParticipants');\n        }\n\n        // Filtra apenas os participantes que esto no evento\n        const resolvedParticipants = participantsUpdate.participants.map((participantId) => {\n          const participantData = groupParticipants.participants.find((p) => p.id === participantId);\n\n          let phoneNumber: string;\n          if (participantData?.phoneNumber) {\n            phoneNumber = participantData.phoneNumber;\n          } else {\n            phoneNumber = normalizePhoneNumber(participantId);\n          }\n\n          return {\n            jid: participantId,\n            phoneNumber,\n            name: participantData?.name,\n            imgUrl: participantData?.imgUrl,\n          };\n        });\n\n        // Mantm formato original + adiciona dados resolvidos\n        const enhancedParticipantsUpdate = {\n          ...participantsUpdate,\n          participants: participantsUpdate.participants, // Mantm array original de strings\n          // Adiciona dados resolvidos em campo separado\n          participantsData: resolvedParticipants,\n        };\n\n        this.sendDataWebhook(Events.GROUP_PARTICIPANTS_UPDATE, enhancedParticipantsUpdate);\n      } catch (error) {\n        this.logger.error(\n          `Failed to resolve participant data for GROUP_PARTICIPANTS_UPDATE webhook: ${error.message} | Group: ${participantsUpdate.id} | Participants: ${participantsUpdate.participants.length}`,\n        );\n        // Fallback - envia sem converso\n        this.sendDataWebhook(Events.GROUP_PARTICIPANTS_UPDATE, participantsUpdate);\n      }\n\n      this.updateGroupMetadataCache(participantsUpdate.id);\n    },\n  };\n\n  private readonly labelHandle = {\n    [Events.LABELS_EDIT]: async (label: Label) => {\n      this.sendDataWebhook(Events.LABELS_EDIT, { ...label, instance: this.instance.name });\n\n      const labelsRepository = await this.prismaRepository.label.findMany({ where: { instanceId: this.instanceId } });\n\n      const savedLabel = labelsRepository.find((l) => l.labelId === label.id);\n      if (label.deleted && savedLabel) {\n        await this.prismaRepository.label.delete({\n          where: { labelId_instanceId: { instanceId: this.instanceId, labelId: label.id } },\n        });\n        this.sendDataWebhook(Events.LABELS_EDIT, { ...label, instance: this.instance.name });\n        return;\n      }\n\n      const labelName = label.name.replace(/[^\\x20-\\x7E]/g, '');\n      if (!savedLabel || savedLabel.color !== `${label.color}` || savedLabel.name !== labelName) {\n        if (this.configService.get<Database>('DATABASE').SAVE_DATA.LABELS) {\n          const labelData = {\n            color: `${label.color}`,\n            name: labelName,\n            labelId: label.id,\n            predefinedId: label.predefinedId,\n            instanceId: this.instanceId,\n          };\n          await this.prismaRepository.label.upsert({\n            where: { labelId_instanceId: { instanceId: labelData.instanceId, labelId: labelData.labelId } },\n            update: labelData,\n            create: labelData,\n          });\n        }\n      }\n    },\n\n    [Events.LABELS_ASSOCIATION]: async (\n      data: { association: LabelAssociation; type: 'remove' | 'add' },\n      database: Database,\n    ) => {\n      this.logger.info(\n        `labels association - ${data?.association?.chatId} (${data.type}-${data?.association?.type}): ${data?.association?.labelId}`,\n      );\n      if (database.SAVE_DATA.CHATS) {\n        const instanceId = this.instanceId;\n        const chatId = data.association.chatId;\n        const labelId = data.association.labelId;\n\n        if (data.type === 'add') {\n          await this.addLabel(labelId, instanceId, chatId);\n        } else if (data.type === 'remove') {\n          await this.removeLabel(labelId, instanceId, chatId);\n        }\n      }\n\n      this.sendDataWebhook(Events.LABELS_ASSOCIATION, {\n        instance: this.instance.name,\n        type: data.type,\n        chatId: data.association.chatId,\n        labelId: data.association.labelId,\n      });\n    },\n  };\n\n  private eventHandler() {\n    this.client.ev.process(async (events) => {\n      this.eventProcessingQueue = this.eventProcessingQueue.then(async () => {\n        try {\n          if (!this.endSession) {\n            const database = this.configService.get<Database>('DATABASE');\n            const settings = await this.findSettings();\n\n            if (events.call) {\n              const call = events.call[0];\n\n              if (settings?.rejectCall && call.status == 'offer') {\n                this.client.rejectCall(call.id, call.from);\n              }\n\n              if (settings?.msgCall?.trim().length > 0 && call.status == 'offer') {\n                if (call.from.endsWith('@lid')) {\n                  call.from = await this.client.signalRepository.lidMapping.getPNForLID(call.from as string);\n                }\n                const msg = await this.client.sendMessage(call.from, { text: settings.msgCall });\n\n                this.client.ev.emit('messages.upsert', { messages: [msg], type: 'notify' });\n              }\n\n              this.sendDataWebhook(Events.CALL, call);\n            }\n\n            if (events['connection.update']) {\n              this.connectionUpdate(events['connection.update']);\n            }\n\n            if (events['creds.update']) {\n              this.instance.authState.saveCreds();\n            }\n\n            if (events['messaging-history.set']) {\n              const payload = events['messaging-history.set'];\n              await this.messageHandle['messaging-history.set'](payload);\n            }\n\n            if (events['messages.upsert']) {\n              const payload = events['messages.upsert'];\n\n              // this.messageProcessor.processMessage(payload, settings);\n              await this.messageHandle['messages.upsert'](payload, settings);\n            }\n\n            if (events['messages.update']) {\n              const payload = events['messages.update'];\n              await this.messageHandle['messages.update'](payload, settings);\n            }\n\n            if (events['message-receipt.update']) {\n              const payload = events['message-receipt.update'] as MessageUserReceiptUpdate[];\n              const remotesJidMap: Record<string, number> = {};\n\n              for (const event of payload) {\n                if (typeof event.key.remoteJid === 'string' && typeof event.receipt.readTimestamp === 'number') {\n                  remotesJidMap[event.key.remoteJid] = event.receipt.readTimestamp;\n                }\n              }\n\n              await Promise.all(\n                Object.keys(remotesJidMap).map(async (remoteJid) =>\n                  this.updateMessagesReadedByTimestamp(remoteJid, remotesJidMap[remoteJid]),\n                ),\n              );\n            }\n\n            if (events['presence.update']) {\n              const payload = events['presence.update'];\n\n              if (settings?.groupsIgnore && payload.id.includes('@g.us')) {\n                return;\n              }\n\n              this.sendDataWebhook(Events.PRESENCE_UPDATE, payload);\n            }\n\n            if (!settings?.groupsIgnore) {\n              if (events['groups.upsert']) {\n                const payload = events['groups.upsert'];\n                this.groupHandler['groups.upsert'](payload);\n              }\n\n              if (events['groups.update']) {\n                const payload = events['groups.update'];\n                this.groupHandler['groups.update'](payload);\n              }\n\n              if (events['group-participants.update']) {\n                const payload = events['group-participants.update'] as any;\n                this.groupHandler['group-participants.update'](payload);\n              }\n            }\n\n            if (events['chats.upsert']) {\n              const payload = events['chats.upsert'];\n              this.chatHandle['chats.upsert'](payload);\n            }\n\n            if (events['chats.update']) {\n              const payload = events['chats.update'];\n              this.chatHandle['chats.update'](payload);\n            }\n\n            if (events['chats.delete']) {\n              const payload = events['chats.delete'];\n              this.chatHandle['chats.delete'](payload);\n            }\n\n            if (events['contacts.upsert']) {\n              const payload = events['contacts.upsert'];\n              this.contactHandle['contacts.upsert'](payload);\n            }\n\n            if (events['contacts.update']) {\n              const payload = events['contacts.update'];\n              this.contactHandle['contacts.update'](payload);\n            }\n\n            if (events[Events.LABELS_ASSOCIATION]) {\n              const payload = events[Events.LABELS_ASSOCIATION];\n              this.labelHandle[Events.LABELS_ASSOCIATION](payload, database);\n              return;\n            }\n\n            if (events[Events.LABELS_EDIT]) {\n              const payload = events[Events.LABELS_EDIT];\n              this.labelHandle[Events.LABELS_EDIT](payload);\n              return;\n            }\n          }\n        } catch (error) {\n          this.logger.error(error);\n        }\n      });\n    });\n  }\n\n  private historySyncNotification(msg: proto.Message.IHistorySyncNotification) {\n    const instance: InstanceDto = { instanceName: this.instance.name };\n\n    if (\n      this.configService.get<Chatwoot>('CHATWOOT').ENABLED &&\n      this.localChatwoot?.enabled &&\n      this.localChatwoot.importMessages &&\n      this.isSyncNotificationFromUsedSyncType(msg)\n    ) {\n      if (msg.chunkOrder === 1) {\n        this.chatwootService.startImportHistoryMessages(instance);\n      }\n\n      if (msg.progress === 100) {\n        setTimeout(() => {\n          this.chatwootService.importHistoryMessages(instance);\n        }, 10000);\n      }\n    }\n\n    return true;\n  }\n\n  private isSyncNotificationFromUsedSyncType(msg: proto.Message.IHistorySyncNotification) {\n    return (\n      (this.localSettings.syncFullHistory && msg?.syncType === 2) ||\n      (!this.localSettings.syncFullHistory && msg?.syncType === 3)\n    );\n  }\n\n  public async profilePicture(number: string) {\n    const jid = createJid(number);\n\n    try {\n      const profilePictureUrl = await this.client.profilePictureUrl(jid, 'image');\n\n      return { wuid: jid, profilePictureUrl };\n    } catch {\n      return { wuid: jid, profilePictureUrl: null };\n    }\n  }\n\n  public async getStatus(number: string) {\n    const jid = createJid(number);\n\n    try {\n      return { wuid: jid, status: (await this.client.fetchStatus(jid))[0]?.status };\n    } catch {\n      return { wuid: jid, status: null };\n    }\n  }\n\n  public async fetchProfile(instanceName: string, number?: string) {\n    const jid = number ? createJid(number) : this.client?.user?.id;\n\n    const onWhatsapp = (await this.whatsappNumber({ numbers: [jid] }))?.shift();\n\n    if (!onWhatsapp.exists) {\n      throw new BadRequestException(onWhatsapp);\n    }\n\n    try {\n      if (number) {\n        const info = (await this.whatsappNumber({ numbers: [jid] }))?.shift();\n        const picture = await this.profilePicture(info?.jid);\n        const status = await this.getStatus(info?.jid);\n        const business = await this.fetchBusinessProfile(info?.jid);\n\n        return {\n          wuid: info?.jid || jid,\n          name: info?.name,\n          numberExists: info?.exists,\n          picture: picture?.profilePictureUrl,\n          status: status?.status,\n          isBusiness: business.isBusiness,\n          email: business?.email,\n          description: business?.description,\n          website: business?.website?.shift(),\n        };\n      } else {\n        const instanceNames = instanceName ? [instanceName] : null;\n        const info: Instance = await waMonitor.instanceInfo(instanceNames);\n        const business = await this.fetchBusinessProfile(jid);\n\n        return {\n          wuid: jid,\n          name: info?.profileName,\n          numberExists: true,\n          picture: info?.profilePicUrl,\n          status: info?.connectionStatus,\n          isBusiness: business.isBusiness,\n          email: business?.email,\n          description: business?.description,\n          website: business?.website?.shift(),\n        };\n      }\n    } catch {\n      return { wuid: jid, name: null, picture: null, status: null, os: null, isBusiness: false };\n    }\n  }\n\n  public async offerCall({ number, isVideo, callDuration }: OfferCallDto) {\n    const jid = createJid(number);\n\n    try {\n      // const call = await this.client.offerCall(jid, isVideo);\n      // setTimeout(() => this.client.terminateCall(call.id, call.to), callDuration * 1000);\n\n      // return call;\n      return { id: '123', jid, isVideo, callDuration };\n    } catch (error) {\n      return error;\n    }\n  }\n\n  private async sendMessage(\n    sender: string,\n    message: any,\n    mentions: any,\n    linkPreview: any,\n    quoted: any,\n    messageId?: string,\n    ephemeralExpiration?: number,\n    contextInfo?: any,\n    // participants?: GroupParticipant[],\n  ) {\n    sender = sender.toLowerCase();\n\n    const option: any = { quoted };\n\n    if (isJidGroup(sender)) {\n      option.useCachedGroupMetadata = true;\n      // if (participants)\n      //   option.cachedGroupMetadata = async () => {\n      //     return { participants: participants as GroupParticipant[] };\n      //   };\n    }\n\n    if (ephemeralExpiration) option.ephemeralExpiration = ephemeralExpiration;\n\n    // NOTE: NO DEVEMOS GERAR O messageId AQUI, SOMENTE SE VIER INFORMADO POR PARAMETRO. A GERAO ANTERIOR IMPEDE O WZAP DE IDENTIFICAR A SOURCE.\n    if (messageId) option.messageId = messageId;\n\n    if (message['viewOnceMessage']) {\n      const m = generateWAMessageFromContent(sender, message, {\n        timestamp: new Date(),\n        userJid: this.instance.wuid,\n        messageId,\n        quoted,\n      });\n      const id = await this.client.relayMessage(sender, message, { messageId });\n      m.key = { id: id, remoteJid: sender, participant: isPnUser(sender) ? sender : undefined, fromMe: true };\n      for (const [key, value] of Object.entries(m)) {\n        if (!value || (isArray(value) && value.length) === 0) {\n          delete m[key];\n        }\n      }\n      return m;\n    }\n\n    if (\n      !message['audio'] &&\n      !message['poll'] &&\n      !message['sticker'] &&\n      !message['conversation'] &&\n      sender !== 'status@broadcast'\n    ) {\n      if (message['reactionMessage']) {\n        return await this.client.sendMessage(\n          sender,\n          {\n            react: { text: message['reactionMessage']['text'], key: message['reactionMessage']['key'] },\n          } as unknown as AnyMessageContent,\n          option as unknown as MiscMessageGenerationOptions,\n        );\n      }\n    }\n\n    if (contextInfo) {\n      message['contextInfo'] = contextInfo;\n    }\n\n    if (message['conversation']) {\n      return await this.client.sendMessage(\n        sender,\n        {\n          text: message['conversation'],\n          mentions,\n          linkPreview: linkPreview,\n          contextInfo: message['contextInfo'],\n        } as unknown as AnyMessageContent,\n        option as unknown as MiscMessageGenerationOptions,\n      );\n    }\n\n    if (!message['audio'] && !message['poll'] && !message['sticker'] && sender != 'status@broadcast') {\n      return await this.client.sendMessage(\n        sender,\n        {\n          forward: { key: { remoteJid: this.instance.wuid, fromMe: true }, message },\n          mentions,\n          contextInfo: message['contextInfo'],\n        },\n        option as unknown as MiscMessageGenerationOptions,\n      );\n    }\n\n    if (sender === 'status@broadcast') {\n      let jidList;\n      if (message['status'].option.allContacts) {\n        const contacts = await this.prismaRepository.contact.findMany({\n          where: { instanceId: this.instanceId, remoteJid: { not: { endsWith: '@g.us' } } },\n        });\n\n        jidList = contacts.map((contact) => contact.remoteJid);\n      } else {\n        jidList = message['status'].option.statusJidList;\n      }\n\n      const batchSize = 10;\n\n      const batches = Array.from({ length: Math.ceil(jidList.length / batchSize) }, (_, i) =>\n        jidList.slice(i * batchSize, i * batchSize + batchSize),\n      );\n\n      let msgId: string | null = null;\n\n      let firstMessage: WAMessage;\n\n      const firstBatch = batches.shift();\n\n      if (firstBatch) {\n        firstMessage = await this.client.sendMessage(\n          sender,\n          message['status'].content as unknown as AnyMessageContent,\n          {\n            backgroundColor: message['status'].option.backgroundColor,\n            font: message['status'].option.font,\n            statusJidList: firstBatch,\n          } as unknown as MiscMessageGenerationOptions,\n        );\n\n        msgId = firstMessage.key.id;\n      }\n\n      if (batches.length === 0) return firstMessage;\n\n      await Promise.allSettled(\n        batches.map(async (batch) => {\n          const messageSent = await this.client.sendMessage(\n            sender,\n            message['status'].content as unknown as AnyMessageContent,\n            {\n              backgroundColor: message['status'].option.backgroundColor,\n              font: message['status'].option.font,\n              statusJidList: batch,\n              messageId: msgId,\n            } as unknown as MiscMessageGenerationOptions,\n          );\n\n          return messageSent;\n        }),\n      );\n\n      return firstMessage;\n    }\n\n    return await this.client.sendMessage(\n      sender,\n      message as unknown as AnyMessageContent,\n      option as unknown as MiscMessageGenerationOptions,\n    );\n  }\n\n  private async sendMessageWithTyping<T = proto.IMessage>(\n    number: string,\n    message: T,\n    options?: Options,\n    isIntegration = false,\n  ) {\n    const isWA = (await this.whatsappNumber({ numbers: [number] }))?.shift();\n\n    if (!isWA.exists && !isJidGroup(isWA.jid) && !isWA.jid.includes('@broadcast')) {\n      throw new BadRequestException(isWA);\n    }\n\n    const sender = isWA.jid.toLowerCase();\n\n    this.logger.verbose(`Sending message to ${sender}`);\n\n    try {\n      if (options?.delay) {\n        this.logger.verbose(`Typing for ${options.delay}ms to ${sender}`);\n        if (options.delay > 20000) {\n          let remainingDelay = options.delay;\n          while (remainingDelay > 20000) {\n            await this.client.presenceSubscribe(sender);\n\n            await this.client.sendPresenceUpdate((options.presence as WAPresence) ?? 'composing', sender);\n\n            await delay(20000);\n\n            await this.client.sendPresenceUpdate('paused', sender);\n\n            remainingDelay -= 20000;\n          }\n          if (remainingDelay > 0) {\n            await this.client.presenceSubscribe(sender);\n\n            await this.client.sendPresenceUpdate((options.presence as WAPresence) ?? 'composing', sender);\n\n            await delay(remainingDelay);\n\n            await this.client.sendPresenceUpdate('paused', sender);\n          }\n        } else {\n          await this.client.presenceSubscribe(sender);\n\n          await this.client.sendPresenceUpdate((options.presence as WAPresence) ?? 'composing', sender);\n\n          await delay(options.delay);\n\n          await this.client.sendPresenceUpdate('paused', sender);\n        }\n      }\n\n      const linkPreview = options?.linkPreview != false ? undefined : false;\n\n      let quoted: WAMessage;\n\n      if (options?.quoted) {\n        const m = options?.quoted;\n\n        const msg = m?.message ? m : ((await this.getMessage(m.key, true)) as WAMessage);\n\n        if (msg) {\n          quoted = msg;\n        }\n      }\n\n      let messageSent: WAMessage;\n\n      let mentions: string[];\n      let contextInfo: any;\n\n      if (isJidGroup(sender)) {\n        let group;\n        try {\n          const cache = this.configService.get<CacheConf>('CACHE');\n          if (!cache.REDIS.ENABLED && !cache.LOCAL.ENABLED) group = await this.findGroup({ groupJid: sender }, 'inner');\n          else group = await this.getGroupMetadataCache(sender);\n          // group = await this.findGroup({ groupJid: sender }, 'inner');\n        } catch {\n          throw new NotFoundException('Group not found');\n        }\n\n        if (!group) {\n          throw new NotFoundException('Group not found');\n        }\n\n        if (options?.mentionsEveryOne) {\n          mentions = group.participants.map((participant) => participant.id);\n        } else if (options?.mentioned?.length) {\n          mentions = options.mentioned.map((mention) => {\n            const jid = createJid(mention);\n            if (isJidGroup(jid)) {\n              return null;\n            }\n            return jid;\n          });\n        }\n\n        messageSent = await this.sendMessage(\n          sender,\n          message,\n          mentions,\n          linkPreview,\n          quoted,\n          null,\n          group?.ephemeralDuration,\n          // group?.participants,\n        );\n      } else {\n        contextInfo = {\n          mentionedJid: [],\n          groupMentions: [],\n          //expiration: 7776000,\n          ephemeralSettingTimestamp: {\n            low: Math.floor(Date.now() / 1000) - 172800,\n            high: 0,\n            unsigned: false,\n          },\n          disappearingMode: { initiator: 0 },\n        };\n        messageSent = await this.sendMessage(\n          sender,\n          message,\n          mentions,\n          linkPreview,\n          quoted,\n          null,\n          undefined,\n          contextInfo,\n        );\n      }\n\n      if (Long.isLong(messageSent?.messageTimestamp)) {\n        messageSent.messageTimestamp = messageSent.messageTimestamp?.toNumber();\n      }\n\n      const messageRaw = this.prepareMessage(messageSent);\n\n      const isMedia =\n        messageSent?.message?.imageMessage ||\n        messageSent?.message?.videoMessage ||\n        messageSent?.message?.stickerMessage ||\n        messageSent?.message?.ptvMessage ||\n        messageSent?.message?.documentMessage ||\n        messageSent?.message?.documentWithCaptionMessage ||\n        messageSent?.message?.ptvMessage ||\n        messageSent?.message?.audioMessage;\n\n      const isVideo = messageSent?.message?.videoMessage;\n\n      if (this.configService.get<Chatwoot>('CHATWOOT').ENABLED && this.localChatwoot?.enabled && !isIntegration) {\n        this.chatwootService.eventWhatsapp(\n          Events.SEND_MESSAGE,\n          { instanceName: this.instance.name, instanceId: this.instanceId },\n          messageRaw,\n        );\n      }\n\n      if (this.configService.get<Openai>('OPENAI').ENABLED && messageRaw?.message?.audioMessage) {\n        const openAiDefaultSettings = await this.prismaRepository.openaiSetting.findFirst({\n          where: { instanceId: this.instanceId },\n          include: { OpenaiCreds: true },\n        });\n\n        if (openAiDefaultSettings && openAiDefaultSettings.openaiCredsId && openAiDefaultSettings.speechToText) {\n          messageRaw.message.speechToText = `[audio] ${await this.openaiService.speechToText(messageRaw, this)}`;\n        }\n      }\n\n      if (this.configService.get<Database>('DATABASE').SAVE_DATA.NEW_MESSAGE) {\n        const msg = await this.prismaRepository.message.create({ data: messageRaw });\n\n        if (isMedia && this.configService.get<S3>('S3').ENABLE) {\n          try {\n            if (isVideo && !this.configService.get<S3>('S3').SAVE_VIDEO) {\n              throw new Error('Video upload is disabled.');\n            }\n\n            const message: any = messageRaw;\n\n            // Verificao adicional para garantir que h contedo de mdia real\n            const hasRealMedia = this.hasValidMediaContent(message);\n\n            if (!hasRealMedia) {\n              this.logger.warn('Message detected as media but contains no valid media content');\n            } else {\n              const media = await this.getBase64FromMediaMessage({ message }, true);\n\n              if (!media) {\n                this.logger.verbose('No valid media to upload (messageContextInfo only), skipping MinIO');\n                return;\n              }\n\n              const { buffer, mediaType, fileName, size } = media;\n\n              const mimetype = mimeTypes.lookup(fileName).toString();\n\n              const fullName = join(\n                `${this.instance.id}`,\n                messageRaw.key.remoteJid,\n                `${messageRaw.key.id}`,\n                mediaType,\n                fileName,\n              );\n\n              await s3Service.uploadFile(fullName, buffer, size.fileLength?.low, { 'Content-Type': mimetype });\n\n              await this.prismaRepository.media.create({\n                data: { messageId: msg.id, instanceId: this.instanceId, type: mediaType, fileName: fullName, mimetype },\n              });\n\n              const mediaUrl = await s3Service.getObjectUrl(fullName);\n\n              messageRaw.message.mediaUrl = mediaUrl;\n\n              await this.prismaRepository.message.update({ where: { id: msg.id }, data: messageRaw });\n            }\n          } catch (error) {\n            this.logger.error(['Error on upload file to minio', error?.message, error?.stack]);\n          }\n        }\n      }\n\n      if (this.localWebhook.enabled) {\n        if (isMedia && this.localWebhook.webhookBase64) {\n          try {\n            const buffer = await downloadMediaMessage(\n              { key: messageRaw.key, message: messageRaw?.message },\n              'buffer',\n              {},\n              { logger: P({ level: 'error' }) as any, reuploadRequest: this.client.updateMediaMessage },\n            );\n\n            if (buffer) {\n              messageRaw.message.base64 = buffer.toString('base64');\n            } else {\n              // retry to download media\n              const buffer = await downloadMediaMessage(\n                { key: messageRaw.key, message: messageRaw?.message },\n                'buffer',\n                {},\n                { logger: P({ level: 'error' }) as any, reuploadRequest: this.client.updateMediaMessage },\n              );\n\n              if (buffer) {\n                messageRaw.message.base64 = buffer.toString('base64');\n              }\n            }\n          } catch (error) {\n            this.logger.error(['Error converting media to base64', error?.message]);\n          }\n        }\n      }\n\n      this.logger.verbose(messageSent);\n\n      this.sendDataWebhook(Events.SEND_MESSAGE, messageRaw);\n\n      if (this.configService.get<Chatwoot>('CHATWOOT').ENABLED && this.localChatwoot?.enabled && isIntegration) {\n        await chatbotController.emit({\n          instance: { instanceName: this.instance.name, instanceId: this.instanceId },\n          remoteJid: messageRaw.key.remoteJid,\n          msg: messageRaw,\n          pushName: messageRaw.pushName,\n          isIntegration,\n        });\n      }\n\n      return messageRaw;\n    } catch (error) {\n      this.logger.error(error);\n      throw new BadRequestException(error.toString());\n    }\n  }\n\n  // Instance Controller\n  public async sendPresence(data: SendPresenceDto) {\n    try {\n      const { number } = data;\n\n      const isWA = (await this.whatsappNumber({ numbers: [number] }))?.shift();\n\n      if (!isWA.exists && !isJidGroup(isWA.jid) && !isWA.jid.includes('@broadcast')) {\n        throw new BadRequestException(isWA);\n      }\n\n      const sender = isWA.jid;\n\n      if (data?.delay && data?.delay > 20000) {\n        let remainingDelay = data?.delay;\n        while (remainingDelay > 20000) {\n          await this.client.presenceSubscribe(sender);\n\n          await this.client.sendPresenceUpdate((data?.presence as WAPresence) ?? 'composing', sender);\n\n          await delay(20000);\n\n          await this.client.sendPresenceUpdate('paused', sender);\n\n          remainingDelay -= 20000;\n        }\n        if (remainingDelay > 0) {\n          await this.client.presenceSubscribe(sender);\n\n          await this.client.sendPresenceUpdate((data?.presence as WAPresence) ?? 'composing', sender);\n\n          await delay(remainingDelay);\n\n          await this.client.sendPresenceUpdate('paused', sender);\n        }\n      } else {\n        await this.client.presenceSubscribe(sender);\n\n        await this.client.sendPresenceUpdate((data?.presence as WAPresence) ?? 'composing', sender);\n\n        await delay(data?.delay);\n\n        await this.client.sendPresenceUpdate('paused', sender);\n      }\n\n      return { presence: data.presence };\n    } catch (error) {\n      this.logger.error(error);\n      throw new BadRequestException(error.toString());\n    }\n  }\n\n  // Presence Controller\n  public async setPresence(data: SetPresenceDto) {\n    try {\n      await this.client.sendPresenceUpdate(data.presence);\n\n      return { presence: data.presence };\n    } catch (error) {\n      this.logger.error(error);\n      throw new BadRequestException(error.toString());\n    }\n  }\n\n  // Send Message Controller\n  public async textMessage(data: SendTextDto, isIntegration = false) {\n    const text = data.text;\n\n    if (!text || text.trim().length === 0) {\n      throw new BadRequestException('Text is required');\n    }\n\n    return await this.sendMessageWithTyping(\n      data.number,\n      { conversation: data.text },\n      {\n        delay: data?.delay,\n        presence: 'composing',\n        quoted: data?.quoted,\n        linkPreview: data?.linkPreview,\n        mentionsEveryOne: data?.mentionsEveryOne,\n        mentioned: data?.mentioned,\n      },\n      isIntegration,\n    );\n  }\n\n  public async pollMessage(data: SendPollDto) {\n    return await this.sendMessageWithTyping(\n      data.number,\n      { poll: { name: data.name, selectableCount: data.selectableCount, values: data.values } },\n      {\n        delay: data?.delay,\n        presence: 'composing',\n        quoted: data?.quoted,\n        linkPreview: data?.linkPreview,\n        mentionsEveryOne: data?.mentionsEveryOne,\n        mentioned: data?.mentioned,\n      },\n    );\n  }\n\n  private async formatStatusMessage(status: StatusMessage) {\n    if (!status.type) {\n      throw new BadRequestException('Type is required');\n    }\n\n    if (!status.content) {\n      throw new BadRequestException('Content is required');\n    }\n\n    if (status.allContacts) {\n      const contacts = await this.prismaRepository.contact.findMany({ where: { instanceId: this.instanceId } });\n\n      if (!contacts.length) {\n        throw new BadRequestException('Contacts not found');\n      }\n\n      status.statusJidList = contacts.filter((contact) => contact.pushName).map((contact) => contact.remoteJid);\n    }\n\n    if (!status.statusJidList?.length && !status.allContacts) {\n      throw new BadRequestException('StatusJidList is required');\n    }\n\n    if (status.type === 'text') {\n      if (!status.backgroundColor) {\n        throw new BadRequestException('Background color is required');\n      }\n\n      if (!status.font) {\n        throw new BadRequestException('Font is required');\n      }\n\n      return {\n        content: { text: status.content },\n        option: { backgroundColor: status.backgroundColor, font: status.font, statusJidList: status.statusJidList },\n      };\n    }\n    if (status.type === 'image') {\n      return {\n        content: { image: { url: status.content }, caption: status.caption },\n        option: { statusJidList: status.statusJidList },\n      };\n    }\n\n    if (status.type === 'video') {\n      return {\n        content: { video: { url: status.content }, caption: status.caption },\n        option: { statusJidList: status.statusJidList },\n      };\n    }\n\n    if (status.type === 'audio') {\n      const convert = await this.processAudioMp4(status.content);\n      if (Buffer.isBuffer(convert)) {\n        const result = {\n          content: { audio: convert, ptt: true, mimetype: 'audio/ogg; codecs=opus' },\n          option: { statusJidList: status.statusJidList },\n        };\n\n        return result;\n      } else {\n        throw new InternalServerErrorException(convert);\n      }\n    }\n\n    throw new BadRequestException('Type not found');\n  }\n\n  public async statusMessage(data: SendStatusDto, file?: any) {\n    const mediaData: SendStatusDto = { ...data };\n\n    if (file) mediaData.content = file.buffer.toString('base64');\n\n    const status = await this.formatStatusMessage(mediaData);\n\n    const statusSent = await this.sendMessageWithTyping('status@broadcast', { status });\n\n    return statusSent;\n  }\n\n  private async prepareMediaMessage(mediaMessage: MediaMessage) {\n    try {\n      const type = mediaMessage.mediatype === 'ptv' ? 'video' : mediaMessage.mediatype;\n\n      let mediaInput: any;\n      if (mediaMessage.mediatype === 'image') {\n        let imageBuffer: Buffer;\n        if (isURL(mediaMessage.media)) {\n          let config: any = { responseType: 'arraybuffer' };\n\n          if (this.localProxy?.enabled) {\n            config = {\n              ...config,\n              httpsAgent: makeProxyAgent({\n                host: this.localProxy.host,\n                port: this.localProxy.port,\n                protocol: this.localProxy.protocol,\n                username: this.localProxy.username,\n                password: this.localProxy.password,\n              }),\n            };\n          }\n\n          const response = await axios.get(mediaMessage.media, config);\n          imageBuffer = Buffer.from(response.data, 'binary');\n        } else {\n          imageBuffer = Buffer.from(mediaMessage.media, 'base64');\n        }\n\n        mediaInput = await sharp(imageBuffer).jpeg().toBuffer();\n        mediaMessage.fileName ??= 'image.jpg';\n        mediaMessage.mimetype = 'image/jpeg';\n      } else {\n        mediaInput = isURL(mediaMessage.media)\n          ? { url: mediaMessage.media }\n          : Buffer.from(mediaMessage.media, 'base64');\n      }\n\n      const prepareMedia = await prepareWAMessageMedia(\n        {\n          [type]: mediaInput,\n        } as any,\n        { upload: this.client.waUploadToServer },\n      );\n\n      const mediaType = mediaMessage.mediatype + 'Message';\n\n      if (mediaMessage.mediatype === 'document' && !mediaMessage.fileName) {\n        const regex = new RegExp(/.*\\/(.+?)\\./);\n        const arrayMatch = regex.exec(mediaMessage.media);\n        mediaMessage.fileName = arrayMatch[1];\n      }\n\n      if (mediaMessage.mediatype === 'image' && !mediaMessage.fileName) {\n        mediaMessage.fileName = 'image.jpg';\n      }\n\n      if (mediaMessage.mediatype === 'video' && !mediaMessage.fileName) {\n        mediaMessage.fileName = 'video.mp4';\n      }\n\n      let mimetype: string | false;\n\n      if (mediaMessage.mimetype) {\n        mimetype = mediaMessage.mimetype;\n      } else {\n        mimetype = mimeTypes.lookup(mediaMessage.fileName);\n\n        if (!mimetype && isURL(mediaMessage.media)) {\n          let config: any = { responseType: 'arraybuffer' };\n\n          if (this.localProxy?.enabled) {\n            config = {\n              ...config,\n              httpsAgent: makeProxyAgent({\n                host: this.localProxy.host,\n                port: this.localProxy.port,\n                protocol: this.localProxy.protocol,\n                username: this.localProxy.username,\n                password: this.localProxy.password,\n              }),\n            };\n          }\n\n          const response = await axios.get(mediaMessage.media, config);\n\n          mimetype = response.headers['content-type'];\n        }\n      }\n\n      if (mediaMessage.mediatype === 'ptv') {\n        prepareMedia[mediaType] = prepareMedia[type + 'Message'];\n        mimetype = 'video/mp4';\n\n        if (!prepareMedia[mediaType]) {\n          throw new Error('Failed to prepare video message');\n        }\n\n        try {\n          let mediaInput;\n          if (isURL(mediaMessage.media)) {\n            mediaInput = mediaMessage.media;\n          } else {\n            const mediaBuffer = Buffer.from(mediaMessage.media, 'base64');\n            if (!mediaBuffer || mediaBuffer.length === 0) {\n              throw new Error('Invalid media buffer');\n            }\n            mediaInput = mediaBuffer;\n          }\n\n          const duration = await getVideoDuration(mediaInput);\n          if (!duration || duration <= 0) {\n            throw new Error('Invalid media duration');\n          }\n\n          this.logger.verbose(`Video duration: ${duration} seconds`);\n          prepareMedia[mediaType].seconds = duration;\n        } catch (error) {\n          this.logger.error('Error getting video duration:');\n          this.logger.error(error);\n          throw new Error(`Failed to get video duration: ${error.message}`);\n        }\n      }\n\n      if (mediaMessage?.fileName) {\n        mimetype = mimeTypes.lookup(mediaMessage.fileName).toString();\n        if (mimetype === 'application/mp4') {\n          mimetype = 'video/mp4';\n        }\n      }\n\n      prepareMedia[mediaType].caption = mediaMessage?.caption;\n      prepareMedia[mediaType].mimetype = mimetype;\n      prepareMedia[mediaType].fileName = mediaMessage.fileName;\n\n      if (mediaMessage.mediatype === 'video') {\n        prepareMedia[mediaType].gifPlayback = false;\n      }\n\n      return generateWAMessageFromContent(\n        '',\n        { [mediaType]: { ...prepareMedia[mediaType] } },\n        { userJid: this.instance.wuid },\n      );\n    } catch (error) {\n      this.logger.error(error);\n      throw new InternalServerErrorException(error?.toString() || error);\n    }\n  }\n\n  private async convertToWebP(image: string): Promise<Buffer> {\n    try {\n      let imageBuffer: Buffer;\n\n      if (isBase64(image)) {\n        const base64Data = image.replace(/^data:image\\/(jpeg|png|gif);base64,/, '');\n        imageBuffer = Buffer.from(base64Data, 'base64');\n      } else {\n        const timestamp = new Date().getTime();\n        const parsedURL = new URL(image);\n        parsedURL.searchParams.set('timestamp', timestamp.toString());\n        const url = parsedURL.toString();\n\n        let config: any = { responseType: 'arraybuffer' };\n\n        if (this.localProxy?.enabled) {\n          config = {\n            ...config,\n            httpsAgent: makeProxyAgent({\n              host: this.localProxy.host,\n              port: this.localProxy.port,\n              protocol: this.localProxy.protocol,\n              username: this.localProxy.username,\n              password: this.localProxy.password,\n            }),\n          };\n        }\n\n        const response = await axios.get(url, config);\n        imageBuffer = Buffer.from(response.data, 'binary');\n      }\n\n      const isAnimated = this.isAnimated(image, imageBuffer);\n\n      if (isAnimated) {\n        return await sharp(imageBuffer, { animated: true }).webp({ quality: 80 }).toBuffer();\n      } else {\n        return await sharp(imageBuffer).webp().toBuffer();\n      }\n    } catch (error) {\n      console.error('Erro ao converter a imagem para WebP:', error);\n      throw error;\n    }\n  }\n\n  private isAnimatedWebp(buffer: Buffer): boolean {\n    if (buffer.length < 12) return false;\n\n    return buffer.indexOf(Buffer.from('ANIM')) !== -1;\n  }\n\n  private isAnimated(image: string, buffer: Buffer): boolean {\n    const lowerCaseImage = image.toLowerCase();\n\n    if (lowerCaseImage.includes('.gif')) return true;\n\n    if (lowerCaseImage.includes('.webp')) return this.isAnimatedWebp(buffer);\n\n    return false;\n  }\n\n  public async mediaSticker(data: SendStickerDto, file?: any) {\n    const mediaData: SendStickerDto = { ...data };\n\n    if (file) mediaData.sticker = file.buffer.toString('base64');\n\n    const convert = data?.notConvertSticker\n      ? Buffer.from(data.sticker, 'base64')\n      : await this.convertToWebP(data.sticker);\n    const gifPlayback = data.sticker.includes('.gif');\n    const result = await this.sendMessageWithTyping(\n      data.number,\n      { sticker: convert, gifPlayback },\n      {\n        delay: data?.delay,\n        presence: 'composing',\n        quoted: data?.quoted,\n        mentionsEveryOne: data?.mentionsEveryOne,\n        mentioned: data?.mentioned,\n      },\n    );\n\n    return result;\n  }\n\n  public async mediaMessage(data: SendMediaDto, file?: any, isIntegration = false) {\n    const mediaData: SendMediaDto = { ...data };\n\n    if (file) mediaData.media = file.buffer.toString('base64');\n\n    const generate = await this.prepareMediaMessage(mediaData);\n\n    const mediaSent = await this.sendMessageWithTyping(\n      data.number,\n      { ...generate.message },\n      {\n        delay: data?.delay,\n        presence: 'composing',\n        quoted: data?.quoted,\n        mentionsEveryOne: data?.mentionsEveryOne,\n        mentioned: data?.mentioned,\n      },\n      isIntegration,\n    );\n\n    return mediaSent;\n  }\n\n  public async ptvMessage(data: SendPtvDto, file?: any, isIntegration = false) {\n    const mediaData: SendMediaDto = {\n      number: data.number,\n      media: data.video,\n      mediatype: 'ptv',\n      delay: data?.delay,\n      quoted: data?.quoted,\n      mentionsEveryOne: data?.mentionsEveryOne,\n      mentioned: data?.mentioned,\n    };\n\n    if (file) mediaData.media = file.buffer.toString('base64');\n\n    const generate = await this.prepareMediaMessage(mediaData);\n\n    const mediaSent = await this.sendMessageWithTyping(\n      data.number,\n      { ...generate.message },\n      {\n        delay: data?.delay,\n        presence: 'composing',\n        quoted: data?.quoted,\n        mentionsEveryOne: data?.mentionsEveryOne,\n        mentioned: data?.mentioned,\n      },\n      isIntegration,\n    );\n\n    return mediaSent;\n  }\n\n  public async processAudioMp4(audio: string) {\n    let inputStream: PassThrough;\n\n    if (isURL(audio)) {\n      const response = await axios.get(audio, { responseType: 'stream' });\n      inputStream = response.data;\n    } else {\n      const audioBuffer = Buffer.from(audio, 'base64');\n      inputStream = new PassThrough();\n      inputStream.end(audioBuffer);\n    }\n\n    return new Promise<Buffer>((resolve, reject) => {\n      const ffmpegProcess = spawn(ffmpegPath.path, [\n        '-i',\n        'pipe:0',\n        '-vn',\n        '-ab',\n        '128k',\n        '-ar',\n        '44100',\n        '-f',\n        'mp4',\n        '-movflags',\n        'frag_keyframe+empty_moov',\n        'pipe:1',\n      ]);\n\n      const outputChunks: Buffer[] = [];\n      let stderrData = '';\n\n      ffmpegProcess.stdout.on('data', (chunk) => {\n        outputChunks.push(chunk);\n      });\n\n      ffmpegProcess.stderr.on('data', (data) => {\n        stderrData += data.toString();\n        this.logger.verbose(`ffmpeg stderr: ${data}`);\n      });\n\n      ffmpegProcess.on('error', (error) => {\n        console.error('Error in ffmpeg process', error);\n        reject(error);\n      });\n\n      ffmpegProcess.on('close', (code) => {\n        if (code === 0) {\n          this.logger.verbose('Audio converted to mp4');\n          const outputBuffer = Buffer.concat(outputChunks);\n          resolve(outputBuffer);\n        } else {\n          this.logger.error(`ffmpeg exited with code ${code}`);\n          this.logger.error(`ffmpeg stderr: ${stderrData}`);\n          reject(new Error(`ffmpeg exited with code ${code}: ${stderrData}`));\n        }\n      });\n\n      inputStream.pipe(ffmpegProcess.stdin);\n\n      inputStream.on('error', (err) => {\n        console.error('Error in inputStream', err);\n        ffmpegProcess.stdin.end();\n        reject(err);\n      });\n    });\n  }\n\n  public async processAudio(audio: string): Promise<Buffer> {\n    const audioConverterConfig = this.configService.get<AudioConverter>('AUDIO_CONVERTER');\n    if (audioConverterConfig.API_URL) {\n      this.logger.verbose('Using audio converter API');\n      const formData = new FormData();\n\n      if (isURL(audio)) {\n        formData.append('url', audio);\n      } else {\n        formData.append('base64', audio);\n      }\n\n      const { data } = await axios.post(audioConverterConfig.API_URL, formData, {\n        headers: { ...formData.getHeaders(), apikey: audioConverterConfig.API_KEY },\n      });\n\n      if (!data.audio) {\n        throw new InternalServerErrorException('Failed to convert audio');\n      }\n\n      this.logger.verbose('Audio converted');\n      return Buffer.from(data.audio, 'base64');\n    } else {\n      let inputAudioStream: PassThrough;\n\n      if (isURL(audio)) {\n        const timestamp = new Date().getTime();\n        const parsedURL = new URL(audio);\n        parsedURL.searchParams.set('timestamp', timestamp.toString());\n        const url = parsedURL.toString();\n\n        const config: any = { responseType: 'stream' };\n\n        const response = await axios.get(url, config);\n        inputAudioStream = response.data.pipe(new PassThrough());\n      } else {\n        const audioBuffer = Buffer.from(audio, 'base64');\n        inputAudioStream = new PassThrough();\n        inputAudioStream.end(audioBuffer);\n      }\n\n      const isLpcm = isURL(audio) && /\\.lpcm($|\\?)/i.test(audio);\n\n      return new Promise((resolve, reject) => {\n        const outputAudioStream = new PassThrough();\n        const chunks: Buffer[] = [];\n\n        outputAudioStream.on('data', (chunk) => chunks.push(chunk));\n        outputAudioStream.on('end', () => {\n          const outputBuffer = Buffer.concat(chunks);\n          resolve(outputBuffer);\n        });\n\n        outputAudioStream.on('error', (error) => {\n          console.log('error', error);\n          reject(error);\n        });\n\n        ffmpeg.setFfmpegPath(ffmpegPath.path);\n\n        let command = ffmpeg(inputAudioStream);\n\n        if (isLpcm) {\n          this.logger.verbose('Detected LPCM input  applying raw PCM settings');\n          command = command.inputFormat('s16le').inputOptions(['-ar', '24000', '-ac', '1']);\n        }\n\n        command\n          .outputFormat('ogg')\n          .noVideo()\n          .audioCodec('libopus')\n          .addOutputOptions('-avoid_negative_ts make_zero')\n          .audioBitrate('128k')\n          .audioFrequency(48000)\n          .audioChannels(1)\n          .outputOptions([\n            '-write_xing',\n            '0',\n            '-compression_level',\n            '10',\n            '-application',\n            'voip',\n            '-fflags',\n            '+bitexact',\n            '-flags',\n            '+bitexact',\n            '-id3v2_version',\n            '0',\n            '-map_metadata',\n            '-1',\n            '-map_chapters',\n            '-1',\n            '-write_bext',\n            '0',\n          ])\n          .pipe(outputAudioStream, { end: true })\n          .on('error', function (error) {\n            console.log('error', error);\n            reject(error);\n          });\n      });\n    }\n  }\n\n  public async audioWhatsapp(data: SendAudioDto, file?: any, isIntegration = false) {\n    const mediaData: SendAudioDto = { ...data };\n\n    if (file?.buffer) {\n      mediaData.audio = file.buffer.toString('base64');\n    } else if (!isURL(data.audio) && !isBase64(data.audio)) {\n      console.error('Invalid file or audio source');\n      throw new BadRequestException('File buffer, URL, or base64 audio is required');\n    }\n\n    if (!data?.encoding && data?.encoding !== false) {\n      data.encoding = true;\n    }\n\n    if (data?.encoding) {\n      const convert = await this.processAudio(mediaData.audio);\n\n      if (Buffer.isBuffer(convert)) {\n        const result = this.sendMessageWithTyping<AnyMessageContent>(\n          data.number,\n          { audio: convert, ptt: true, mimetype: 'audio/ogg; codecs=opus' },\n          { presence: 'recording', delay: data?.delay },\n          isIntegration,\n        );\n\n        return result;\n      } else {\n        throw new InternalServerErrorException('Failed to convert audio');\n      }\n    }\n\n    return await this.sendMessageWithTyping<AnyMessageContent>(\n      data.number,\n      {\n        audio: isURL(data.audio) ? { url: data.audio } : Buffer.from(data.audio, 'base64'),\n        ptt: true,\n        mimetype: 'audio/ogg; codecs=opus',\n      },\n      { presence: 'recording', delay: data?.delay },\n      isIntegration,\n    );\n  }\n\n  private generateRandomId(length = 11) {\n    const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\n    let result = '';\n    for (let i = 0; i < length; i++) {\n      result += characters.charAt(Math.floor(Math.random() * characters.length));\n    }\n    return result;\n  }\n\n  private toJSONString(button: Button): string {\n    const toString = (obj: any) => JSON.stringify(obj);\n\n    const json = {\n      call: () => toString({ display_text: button.displayText, phone_number: button.phoneNumber }),\n      reply: () => toString({ display_text: button.displayText, id: button.id }),\n      copy: () => toString({ display_text: button.displayText, copy_code: button.copyCode }),\n      url: () => toString({ display_text: button.displayText, url: button.url, merchant_url: button.url }),\n      pix: () =>\n        toString({\n          currency: button.currency,\n          total_amount: { value: 0, offset: 100 },\n          reference_id: this.generateRandomId(),\n          type: 'physical-goods',\n          order: {\n            status: 'pending',\n            subtotal: { value: 0, offset: 100 },\n            order_type: 'ORDER',\n            items: [\n              { name: '', amount: { value: 0, offset: 100 }, quantity: 0, sale_amount: { value: 0, offset: 100 } },\n            ],\n          },\n          payment_settings: [\n            {\n              type: 'pix_static_code',\n              pix_static_code: {\n                merchant_name: button.name,\n                key: button.key,\n                key_type: this.mapKeyType.get(button.keyType),\n              },\n            },\n          ],\n          share_payment_status: false,\n        }),\n    };\n\n    return json[button.type]?.() || '';\n  }\n\n  private readonly mapType = new Map<TypeButton, string>([\n    ['reply', 'quick_reply'],\n    ['copy', 'cta_copy'],\n    ['url', 'cta_url'],\n    ['call', 'cta_call'],\n    ['pix', 'payment_info'],\n  ]);\n\n  private readonly mapKeyType = new Map<KeyType, string>([\n    ['phone', 'PHONE'],\n    ['email', 'EMAIL'],\n    ['cpf', 'CPF'],\n    ['cnpj', 'CNPJ'],\n    ['random', 'EVP'],\n  ]);\n\n  public async buttonMessage(data: SendButtonsDto) {\n    if (data.buttons.length === 0) {\n      throw new BadRequestException('At least one button is required');\n    }\n\n    const hasReplyButtons = data.buttons.some((btn) => btn.type === 'reply');\n\n    const hasPixButton = data.buttons.some((btn) => btn.type === 'pix');\n\n    const hasOtherButtons = data.buttons.some((btn) => btn.type !== 'reply' && btn.type !== 'pix');\n\n    if (hasReplyButtons) {\n      if (data.buttons.length > 3) {\n        throw new BadRequestException('Maximum of 3 reply buttons allowed');\n      }\n      if (hasOtherButtons) {\n        throw new BadRequestException('Reply buttons cannot be mixed with other button types');\n      }\n    }\n\n    if (hasPixButton) {\n      if (data.buttons.length > 1) {\n        throw new BadRequestException('Only one PIX button is allowed');\n      }\n      if (hasOtherButtons) {\n        throw new BadRequestException('PIX button cannot be mixed with other button types');\n      }\n\n      const message: proto.IMessage = {\n        viewOnceMessage: {\n          message: {\n            interactiveMessage: {\n              nativeFlowMessage: {\n                buttons: [{ name: this.mapType.get('pix'), buttonParamsJson: this.toJSONString(data.buttons[0]) }],\n                messageParamsJson: JSON.stringify({ from: 'api', templateId: v4() }),\n              },\n            },\n          },\n        },\n      };\n\n      return await this.sendMessageWithTyping(data.number, message, {\n        delay: data?.delay,\n        presence: 'composing',\n        quoted: data?.quoted,\n        mentionsEveryOne: data?.mentionsEveryOne,\n        mentioned: data?.mentioned,\n      });\n    }\n\n    const generate = await (async () => {\n      if (data?.thumbnailUrl) {\n        return await this.prepareMediaMessage({ mediatype: 'image', media: data.thumbnailUrl });\n      }\n    })();\n\n    const buttons = data.buttons.map((value) => {\n      return { name: this.mapType.get(value.type), buttonParamsJson: this.toJSONString(value) };\n    });\n\n    const message: proto.IMessage = {\n      viewOnceMessage: {\n        message: {\n          interactiveMessage: {\n            body: {\n              text: (() => {\n                let t = '*' + data.title + '*';\n                if (data?.description) {\n                  t += '\\n\\n';\n                  t += data.description;\n                  t += '\\n';\n                }\n                return t;\n              })(),\n            },\n            footer: { text: data?.footer },\n            header: (() => {\n              if (generate?.message?.imageMessage) {\n                return {\n                  hasMediaAttachment: !!generate.message.imageMessage,\n                  imageMessage: generate.message.imageMessage,\n                };\n              }\n            })(),\n            nativeFlowMessage: {\n              buttons: buttons,\n              messageParamsJson: JSON.stringify({ from: 'api', templateId: v4() }),\n            },\n          },\n        },\n      },\n    };\n\n    return await this.sendMessageWithTyping(data.number, message, {\n      delay: data?.delay,\n      presence: 'composing',\n      quoted: data?.quoted,\n      mentionsEveryOne: data?.mentionsEveryOne,\n      mentioned: data?.mentioned,\n    });\n  }\n\n  public async locationMessage(data: SendLocationDto) {\n    return await this.sendMessageWithTyping(\n      data.number,\n      {\n        locationMessage: {\n          degreesLatitude: data.latitude,\n          degreesLongitude: data.longitude,\n          name: data?.name,\n          address: data?.address,\n        },\n      },\n      {\n        delay: data?.delay,\n        presence: 'composing',\n        quoted: data?.quoted,\n        mentionsEveryOne: data?.mentionsEveryOne,\n        mentioned: data?.mentioned,\n      },\n    );\n  }\n\n  public async listMessage(data: SendListDto) {\n    return await this.sendMessageWithTyping(\n      data.number,\n      {\n        listMessage: {\n          title: data.title,\n          description: data.description,\n          buttonText: data?.buttonText,\n          footerText: data?.footerText,\n          sections: data.sections,\n          listType: 2,\n        },\n      },\n      {\n        delay: data?.delay,\n        presence: 'composing',\n        quoted: data?.quoted,\n        mentionsEveryOne: data?.mentionsEveryOne,\n        mentioned: data?.mentioned,\n      },\n    );\n  }\n\n  public async contactMessage(data: SendContactDto) {\n    const message: proto.IMessage = {};\n\n    const vcard = (contact: ContactMessage) => {\n      let result = 'BEGIN:VCARD\\n' + 'VERSION:3.0\\n' + `N:${contact.fullName}\\n` + `FN:${contact.fullName}\\n`;\n\n      if (contact.organization) {\n        result += `ORG:${contact.organization};\\n`;\n      }\n\n      if (contact.email) {\n        result += `EMAIL:${contact.email}\\n`;\n      }\n\n      if (contact.url) {\n        result += `URL:${contact.url}\\n`;\n      }\n\n      if (!contact.wuid) {\n        contact.wuid = createJid(contact.phoneNumber);\n      }\n\n      result += `item1.TEL;waid=${contact.wuid}:${contact.phoneNumber}\\n` + 'item1.X-ABLabel:Celular\\n' + 'END:VCARD';\n\n      return result;\n    };\n\n    if (data.contact.length === 1) {\n      message.contactMessage = { displayName: data.contact[0].fullName, vcard: vcard(data.contact[0]) };\n    } else {\n      message.contactsArrayMessage = {\n        displayName: `${data.contact.length} contacts`,\n        contacts: data.contact.map((contact) => {\n          return { displayName: contact.fullName, vcard: vcard(contact) };\n        }),\n      };\n    }\n\n    return await this.sendMessageWithTyping(data.number, { ...message }, {});\n  }\n\n  public async reactionMessage(data: SendReactionDto) {\n    return await this.sendMessageWithTyping(data.key.remoteJid, {\n      reactionMessage: { key: data.key, text: data.reaction },\n    });\n  }\n\n  // Chat Controller\n  public async whatsappNumber(data: WhatsAppNumberDto) {\n    const jids: {\n      groups: { number: string; jid: string }[];\n      broadcast: { number: string; jid: string }[];\n      users: { number: string; jid: string; name?: string }[];\n    } = { groups: [], broadcast: [], users: [] };\n\n    data.numbers.forEach((number) => {\n      const jid = createJid(number);\n\n      if (isJidGroup(jid)) {\n        jids.groups.push({ number, jid });\n      } else if (jid === 'status@broadcast') {\n        jids.broadcast.push({ number, jid });\n      } else {\n        jids.users.push({ number, jid });\n      }\n    });\n\n    const onWhatsapp: OnWhatsAppDto[] = [];\n\n    // BROADCAST\n    onWhatsapp.push(...jids.broadcast.map(({ jid, number }) => new OnWhatsAppDto(jid, false, number)));\n\n    // GROUPS\n    const groups = await Promise.all(\n      jids.groups.map(async ({ jid, number }) => {\n        const group = await this.findGroup({ groupJid: jid }, 'inner');\n\n        if (!group) {\n          return new OnWhatsAppDto(jid, false, number);\n        }\n\n        return new OnWhatsAppDto(group.id, true, number, group?.subject);\n      }),\n    );\n    onWhatsapp.push(...groups);\n\n    // USERS\n    const contacts: any[] = await this.prismaRepository.contact.findMany({\n      where: { instanceId: this.instanceId, remoteJid: { in: jids.users.map(({ jid }) => jid) } },\n    });\n\n    // Unified cache verification for all numbers (normal and LID)\n    const numbersToVerify = jids.users.map(({ jid }) => jid.replace('+', ''));\n\n    // Get all numbers from cache\n    const cachedNumbers = await getOnWhatsappCache(numbersToVerify);\n\n    // Separate numbers that are and are not in cache\n    const cachedJids = new Set(cachedNumbers.flatMap((cached) => cached.jidOptions));\n    const numbersNotInCache = numbersToVerify.filter((jid) => !cachedJids.has(jid));\n\n    // Only call Baileys for normal numbers (@s.whatsapp.net) that are not in cache\n    let verify: { jid: string; exists: boolean }[] = [];\n    const normalNumbersNotInCache = numbersNotInCache.filter((jid) => !jid.includes('@lid'));\n\n    if (normalNumbersNotInCache.length > 0) {\n      this.logger.verbose(`Checking ${normalNumbersNotInCache.length} numbers via Baileys (not found in cache)`);\n      verify = await this.client.onWhatsApp(...normalNumbersNotInCache);\n    }\n\n    const verifiedUsers = await Promise.all(\n      jids.users.map(async (user) => {\n        // Try to get from cache first (works for all: normal and LID)\n        const cached = cachedNumbers.find((cached) => cached.jidOptions.includes(user.jid.replace('+', '')));\n\n        if (cached) {\n          this.logger.verbose(`Number ${user.number} found in cache`);\n          return new OnWhatsAppDto(\n            cached.remoteJid,\n            true,\n            user.number,\n            contacts.find((c) => c.remoteJid === cached.remoteJid)?.pushName,\n            cached.lid || (cached.remoteJid.includes('@lid') ? 'lid' : undefined),\n          );\n        }\n\n        // If it's a LID number and not in cache, consider it valid\n        if (user.jid.includes('@lid')) {\n          return new OnWhatsAppDto(\n            user.jid,\n            true,\n            user.number,\n            contacts.find((c) => c.remoteJid === user.jid)?.pushName,\n            'lid',\n          );\n        }\n\n        // If not in cache and is a normal number, use Baileys verification\n        let numberVerified: (typeof verify)[0] | null = null;\n\n        // Brazilian numbers\n        if (user.number.startsWith('55')) {\n          const numberWithDigit =\n            user.number.slice(4, 5) === '9' && user.number.length === 13\n              ? user.number\n              : `${user.number.slice(0, 4)}9${user.number.slice(4)}`;\n          const numberWithoutDigit =\n            user.number.length === 12 ? user.number : user.number.slice(0, 4) + user.number.slice(5);\n\n          numberVerified = verify.find(\n            (v) => v.jid === `${numberWithDigit}@s.whatsapp.net` || v.jid === `${numberWithoutDigit}@s.whatsapp.net`,\n          );\n        }\n\n        // Mexican/Argentina numbers\n        // Ref: https://faq.whatsapp.com/1294841057948784\n        if (!numberVerified && (user.number.startsWith('52') || user.number.startsWith('54'))) {\n          let prefix = '';\n          if (user.number.startsWith('52')) {\n            prefix = '1';\n          }\n          if (user.number.startsWith('54')) {\n            prefix = '9';\n          }\n\n          const numberWithDigit =\n            user.number.slice(2, 3) === prefix && user.number.length === 13\n              ? user.number\n              : `${user.number.slice(0, 2)}${prefix}${user.number.slice(2)}`;\n          const numberWithoutDigit =\n            user.number.length === 12 ? user.number : user.number.slice(0, 2) + user.number.slice(3);\n\n          numberVerified = verify.find(\n            (v) => v.jid === `${numberWithDigit}@s.whatsapp.net` || v.jid === `${numberWithoutDigit}@s.whatsapp.net`,\n          );\n        }\n\n        if (!numberVerified) {\n          numberVerified = verify.find((v) => v.jid === user.jid);\n        }\n\n        const numberJid = numberVerified?.jid || user.jid;\n\n        return new OnWhatsAppDto(\n          numberJid,\n          !!numberVerified?.exists,\n          user.number,\n          contacts.find((c) => c.remoteJid === numberJid)?.pushName,\n          undefined,\n        );\n      }),\n    );\n\n    // Combine results\n    onWhatsapp.push(...verifiedUsers);\n\n    // TODO: Salvar no cache apenas nmeros que NO estavam no cache\n    const numbersToCache = onWhatsapp.filter((user) => {\n      if (!user.exists) return false;\n      // Verifica se estava no cache usando jidOptions\n      const cached = cachedNumbers?.find((cached) => cached.jidOptions.includes(user.jid.replace('+', '')));\n      return !cached;\n    });\n\n    if (numbersToCache.length > 0) {\n      this.logger.verbose(`Salvando ${numbersToCache.length} nmeros no cache`);\n      await saveOnWhatsappCache(\n        numbersToCache.map((user) => ({\n          remoteJid: user.jid,\n          lid: user.lid === 'lid' ? 'lid' : undefined,\n        })),\n      );\n    }\n\n    return onWhatsapp;\n  }\n\n  public async markMessageAsRead(data: ReadMessageDto) {\n    try {\n      const keys: proto.IMessageKey[] = [];\n      data.readMessages.forEach((read) => {\n        if (isJidGroup(read.remoteJid) || isPnUser(read.remoteJid)) {\n          keys.push({ remoteJid: read.remoteJid, fromMe: read.fromMe, id: read.id });\n        }\n      });\n      await this.client.readMessages(keys);\n      return { message: 'Read messages', read: 'success' };\n    } catch (error) {\n      throw new InternalServerErrorException('Read messages fail', error.toString());\n    }\n  }\n\n  public async getLastMessage(number: string) {\n    const where: any = { key: { remoteJid: number }, instanceId: this.instance.id };\n\n    const messages = await this.prismaRepository.message.findMany({\n      where,\n      orderBy: { messageTimestamp: 'desc' },\n      take: 1,\n    });\n\n    if (messages.length === 0) {\n      throw new NotFoundException('Messages not found');\n    }\n\n    let lastMessage = messages.pop();\n\n    for (const message of messages) {\n      if (message.messageTimestamp >= lastMessage.messageTimestamp) {\n        lastMessage = message;\n      }\n    }\n\n    return lastMessage as unknown as LastMessage;\n  }\n\n  public async archiveChat(data: ArchiveChatDto) {\n    try {\n      let last_message = data.lastMessage;\n      let number = data.chat;\n\n      if (!last_message && number) {\n        last_message = await this.getLastMessage(number);\n      } else {\n        last_message = data.lastMessage;\n        last_message.messageTimestamp = last_message?.messageTimestamp ?? Date.now();\n        number = last_message?.key?.remoteJid;\n      }\n\n      if (!last_message || Object.keys(last_message).length === 0) {\n        throw new NotFoundException('Last message not found');\n      }\n\n      await this.client.chatModify({ archive: data.archive, lastMessages: [last_message] }, createJid(number));\n\n      return { chatId: number, archived: true };\n    } catch (error) {\n      throw new InternalServerErrorException({\n        archived: false,\n        message: ['An error occurred while archiving the chat. Open a calling.', error.toString()],\n      });\n    }\n  }\n\n  public async markChatUnread(data: MarkChatUnreadDto) {\n    try {\n      let last_message = data.lastMessage;\n      let number = data.chat;\n\n      if (!last_message && number) {\n        last_message = await this.getLastMessage(number);\n      } else {\n        last_message = data.lastMessage;\n        last_message.messageTimestamp = last_message?.messageTimestamp ?? Date.now();\n        number = last_message?.key?.remoteJid;\n      }\n\n      if (!last_message || Object.keys(last_message).length === 0) {\n        throw new NotFoundException('Last message not found');\n      }\n\n      await this.client.chatModify({ markRead: false, lastMessages: [last_message] }, createJid(number));\n\n      return { chatId: number, markedChatUnread: true };\n    } catch (error) {\n      throw new InternalServerErrorException({\n        markedChatUnread: false,\n        message: ['An error occurred while marked unread the chat. Open a calling.', error.toString()],\n      });\n    }\n  }\n\n  public async deleteMessage(del: DeleteMessage) {\n    try {\n      const response = await this.client.sendMessage(del.remoteJid, { delete: del });\n      if (response) {\n        const messageId = response.message?.protocolMessage?.key?.id;\n        if (messageId) {\n          const isLogicalDeleted = configService.get<Database>('DATABASE').DELETE_DATA.LOGICAL_MESSAGE_DELETE;\n          let message = await this.prismaRepository.message.findFirst({\n            where: { key: { path: ['id'], equals: messageId } },\n          });\n          if (isLogicalDeleted) {\n            if (!message) return response;\n            const existingKey = typeof message?.key === 'object' && message.key !== null ? message.key : {};\n            message = await this.prismaRepository.message.update({\n              where: { id: message.id },\n              data: { key: { ...existingKey, deleted: true }, status: 'DELETED' },\n            });\n            if (this.configService.get<Database>('DATABASE').SAVE_DATA.MESSAGE_UPDATE) {\n              const messageUpdate: any = {\n                messageId: message.id,\n                keyId: messageId,\n                remoteJid: response.key.remoteJid,\n                fromMe: response.key.fromMe,\n                participant: response.key?.participant,\n                status: 'DELETED',\n                instanceId: this.instanceId,\n              };\n              await this.prismaRepository.messageUpdate.create({ data: messageUpdate });\n            }\n          } else {\n            if (!message) return response;\n            await this.prismaRepository.message.deleteMany({ where: { id: message.id } });\n          }\n          this.sendDataWebhook(Events.MESSAGES_DELETE, {\n            id: message.id,\n            instanceId: message.instanceId,\n            key: message.key,\n            messageType: message.messageType,\n            status: 'DELETED',\n            source: message.source,\n            messageTimestamp: message.messageTimestamp,\n            pushName: message.pushName,\n            participant: message.participant,\n            message: message.message,\n          });\n        }\n      }\n\n      return response;\n    } catch (error) {\n      throw new InternalServerErrorException('Error while deleting message for everyone', error?.toString());\n    }\n  }\n\n  public async mapMediaType(mediaType) {\n    const map = {\n      imageMessage: 'image',\n      videoMessage: 'video',\n      documentMessage: 'document',\n      stickerMessage: 'sticker',\n      audioMessage: 'audio',\n      ptvMessage: 'video',\n    };\n    return map[mediaType] || null;\n  }\n\n  public async getBase64FromMediaMessage(data: getBase64FromMediaMessageDto, getBuffer = false) {\n    try {\n      const m = data?.message;\n      const convertToMp4 = data?.convertToMp4 ?? false;\n\n      const msg = m?.message ? m : ((await this.getMessage(m.key, true)) as proto.IWebMessageInfo);\n\n      if (!msg) {\n        throw 'Message not found';\n      }\n\n      for (const subtype of MessageSubtype) {\n        if (msg.message[subtype]) {\n          msg.message = msg.message[subtype].message;\n        }\n      }\n\n      if ('messageContextInfo' in msg.message && Object.keys(msg.message).length === 1) {\n        this.logger.verbose('Message contains only messageContextInfo, skipping media processing');\n        return null;\n      }\n\n      let mediaMessage: any;\n      let mediaType: string;\n\n      if (msg.message?.templateMessage) {\n        const template =\n          msg.message.templateMessage.hydratedTemplate || msg.message.templateMessage.hydratedFourRowTemplate;\n\n        for (const type of TypeMediaMessage) {\n          if (template[type]) {\n            mediaMessage = template[type];\n            mediaType = type;\n            msg.message = { [type]: { ...template[type], url: template[type].staticUrl } };\n            break;\n          }\n        }\n\n        if (!mediaMessage) {\n          throw 'Template message does not contain a supported media type';\n        }\n      } else {\n        for (const type of TypeMediaMessage) {\n          mediaMessage = msg.message[type];\n          if (mediaMessage) {\n            mediaType = type;\n            break;\n          }\n        }\n\n        if (!mediaMessage) {\n          throw 'The message is not of the media type';\n        }\n      }\n\n      if (typeof mediaMessage['mediaKey'] === 'object') {\n        msg.message[mediaType].mediaKey = Uint8Array.from(Object.values(mediaMessage['mediaKey']));\n      }\n\n      let buffer: Buffer;\n\n      try {\n        buffer = await downloadMediaMessage(\n          { key: msg?.key, message: msg?.message },\n          'buffer',\n          {},\n          { logger: P({ level: 'error' }) as any, reuploadRequest: this.client.updateMediaMessage },\n        );\n      } catch {\n        this.logger.error('Download Media failed, trying to retry in 5 seconds...');\n        await new Promise((resolve) => setTimeout(resolve, 5000));\n        const mediaType = Object.keys(msg.message).find((key) => key.endsWith('Message'));\n        if (!mediaType) throw new Error('Could not determine mediaType for fallback');\n\n        try {\n          const media = await downloadContentFromMessage(\n            {\n              mediaKey: msg.message?.[mediaType]?.mediaKey,\n              directPath: msg.message?.[mediaType]?.directPath,\n              url: `https://mmg.whatsapp.net${msg?.message?.[mediaType]?.directPath}`,\n            },\n            await this.mapMediaType(mediaType),\n            {},\n          );\n          const chunks = [];\n          for await (const chunk of media) {\n            chunks.push(chunk);\n          }\n          buffer = Buffer.concat(chunks);\n          this.logger.info('Download Media with downloadContentFromMessage was successful!');\n        } catch (fallbackErr) {\n          this.logger.error('Download Media with downloadContentFromMessage also failed!');\n          throw fallbackErr;\n        }\n      }\n      const typeMessage = getContentType(msg.message);\n\n      const ext = mimeTypes.extension(mediaMessage?.['mimetype']);\n      const fileName = mediaMessage?.['fileName'] || `${msg.key.id}.${ext}` || `${v4()}.${ext}`;\n\n      if (convertToMp4 && typeMessage === 'audioMessage') {\n        try {\n          const convert = await this.processAudioMp4(buffer.toString('base64'));\n\n          if (Buffer.isBuffer(convert)) {\n            const result = {\n              mediaType,\n              fileName,\n              caption: mediaMessage['caption'],\n              size: {\n                fileLength: mediaMessage['fileLength'],\n                height: mediaMessage['height'],\n                width: mediaMessage['width'],\n              },\n              mimetype: 'audio/mp4',\n              base64: convert.toString('base64'),\n              buffer: getBuffer ? convert : null,\n            };\n\n            return result;\n          }\n        } catch (error) {\n          this.logger.error('Error converting audio to mp4:');\n          this.logger.error(error);\n          throw new BadRequestException('Failed to convert audio to MP4');\n        }\n      }\n\n      return {\n        mediaType,\n        fileName,\n        caption: mediaMessage['caption'],\n        size: { fileLength: mediaMessage['fileLength'], height: mediaMessage['height'], width: mediaMessage['width'] },\n        mimetype: mediaMessage['mimetype'],\n        base64: buffer.toString('base64'),\n        buffer: getBuffer ? buffer : null,\n      };\n    } catch (error) {\n      this.logger.error('Error processing media message:');\n      this.logger.error(error);\n      throw new BadRequestException(error.toString());\n    }\n  }\n\n  public async fetchPrivacySettings() {\n    const privacy = await this.client.fetchPrivacySettings();\n\n    return {\n      readreceipts: privacy.readreceipts,\n      profile: privacy.profile,\n      status: privacy.status,\n      online: privacy.online,\n      last: privacy.last,\n      groupadd: privacy.groupadd,\n    };\n  }\n\n  public async updatePrivacySettings(settings: PrivacySettingDto) {\n    try {\n      await this.client.updateReadReceiptsPrivacy(settings.readreceipts);\n      await this.client.updateProfilePicturePrivacy(settings.profile);\n      await this.client.updateStatusPrivacy(settings.status);\n      await this.client.updateOnlinePrivacy(settings.online);\n      await this.client.updateLastSeenPrivacy(settings.last);\n      await this.client.updateGroupsAddPrivacy(settings.groupadd);\n\n      this.reloadConnection();\n\n      return {\n        update: 'success',\n        data: {\n          readreceipts: settings.readreceipts,\n          profile: settings.profile,\n          status: settings.status,\n          online: settings.online,\n          last: settings.last,\n          groupadd: settings.groupadd,\n        },\n      };\n    } catch (error) {\n      throw new InternalServerErrorException('Error updating privacy settings', error.toString());\n    }\n  }\n\n  public async fetchBusinessProfile(number: string): Promise<NumberBusiness> {\n    try {\n      const jid = number ? createJid(number) : this.instance.wuid;\n\n      const profile = await this.client.getBusinessProfile(jid);\n\n      if (!profile) {\n        const info = await this.whatsappNumber({ numbers: [jid] });\n\n        return { isBusiness: false, message: 'Not is business profile', ...info?.shift() };\n      }\n\n      return { isBusiness: true, ...profile };\n    } catch (error) {\n      throw new InternalServerErrorException('Error updating profile name', error.toString());\n    }\n  }\n\n  public async updateProfileName(name: string) {\n    try {\n      await this.client.updateProfileName(name);\n\n      return { update: 'success' };\n    } catch (error) {\n      throw new InternalServerErrorException('Error updating profile name', error.toString());\n    }\n  }\n\n  public async updateProfileStatus(status: string) {\n    try {\n      await this.client.updateProfileStatus(status);\n\n      return { update: 'success' };\n    } catch (error) {\n      throw new InternalServerErrorException('Error updating profile status', error.toString());\n    }\n  }\n\n  public async updateProfilePicture(picture: string) {\n    try {\n      let pic: WAMediaUpload;\n      if (isURL(picture)) {\n        const timestamp = new Date().getTime();\n        const parsedURL = new URL(picture);\n        parsedURL.searchParams.set('timestamp', timestamp.toString());\n        const url = parsedURL.toString();\n\n        let config: any = { responseType: 'arraybuffer' };\n\n        if (this.localProxy?.enabled) {\n          config = {\n            ...config,\n            httpsAgent: makeProxyAgent({\n              host: this.localProxy.host,\n              port: this.localProxy.port,\n              protocol: this.localProxy.protocol,\n              username: this.localProxy.username,\n              password: this.localProxy.password,\n            }),\n          };\n        }\n\n        pic = (await axios.get(url, config)).data;\n      } else if (isBase64(picture)) {\n        pic = Buffer.from(picture, 'base64');\n      } else {\n        throw new BadRequestException('\"profilePicture\" must be a url or a base64');\n      }\n\n      await this.client.updateProfilePicture(this.instance.wuid, pic);\n\n      this.reloadConnection();\n\n      return { update: 'success' };\n    } catch (error) {\n      throw new InternalServerErrorException('Error updating profile picture', error.toString());\n    }\n  }\n\n  public async removeProfilePicture() {\n    try {\n      await this.client.removeProfilePicture(this.instance.wuid);\n\n      this.reloadConnection();\n\n      return { update: 'success' };\n    } catch (error) {\n      throw new InternalServerErrorException('Error removing profile picture', error.toString());\n    }\n  }\n\n  public async blockUser(data: BlockUserDto) {\n    try {\n      const { number } = data;\n\n      const isWA = (await this.whatsappNumber({ numbers: [number] }))?.shift();\n\n      if (!isWA.exists && !isJidGroup(isWA.jid) && !isWA.jid.includes('@broadcast')) {\n        throw new BadRequestException(isWA);\n      }\n\n      const sender = isWA.jid;\n\n      await this.client.updateBlockStatus(sender, data.status);\n\n      return { block: 'success' };\n    } catch (error) {\n      throw new InternalServerErrorException('Error blocking user', error.toString());\n    }\n  }\n\n  private async formatUpdateMessage(data: UpdateMessageDto) {\n    try {\n      if (!this.configService.get<Database>('DATABASE').SAVE_DATA.NEW_MESSAGE) {\n        return data;\n      }\n\n      const msg: any = await this.getMessage(data.key, true);\n\n      if (msg?.messageType === 'conversation' || msg?.messageType === 'extendedTextMessage') {\n        return { text: data.text };\n      }\n\n      if (msg?.messageType === 'imageMessage') {\n        return { image: msg?.message?.imageMessage, caption: data.text };\n      }\n\n      if (msg?.messageType === 'videoMessage') {\n        return { video: msg?.message?.videoMessage, caption: data.text };\n      }\n\n      return null;\n    } catch (error) {\n      this.logger.error(error);\n      throw new BadRequestException(error.toString());\n    }\n  }\n\n  public async updateMessage(data: UpdateMessageDto) {\n    const jid = createJid(data.number);\n\n    const options = await this.formatUpdateMessage(data);\n\n    if (!options) {\n      this.logger.error('Message not compatible');\n      throw new BadRequestException('Message not compatible');\n    }\n\n    try {\n      const oldMessage: any = await this.getMessage(data.key, true);\n      if (this.configService.get<Database>('DATABASE').SAVE_DATA.NEW_MESSAGE) {\n        if (!oldMessage) throw new NotFoundException('Message not found');\n        if (oldMessage?.key?.remoteJid !== jid) {\n          throw new BadRequestException('RemoteJid does not match');\n        }\n        if (oldMessage?.messageTimestamp > Date.now() + 900000) {\n          // 15 minutes in milliseconds\n          throw new BadRequestException('Message is older than 15 minutes');\n        }\n      }\n\n      const messageSent = await this.client.sendMessage(jid, { ...(options as any), edit: data.key });\n      if (messageSent) {\n        const editedMessage =\n          messageSent?.message?.protocolMessage || messageSent?.message?.editedMessage?.message?.protocolMessage;\n\n        if (editedMessage) {\n          this.sendDataWebhook(Events.SEND_MESSAGE_UPDATE, editedMessage);\n          if (this.configService.get<Chatwoot>('CHATWOOT').ENABLED && this.localChatwoot?.enabled)\n            this.chatwootService.eventWhatsapp(\n              'send.message.update',\n              { instanceName: this.instance.name, instanceId: this.instance.id },\n              editedMessage,\n            );\n\n          const messageId = messageSent.message?.protocolMessage?.key?.id;\n          if (messageId && this.configService.get<Database>('DATABASE').SAVE_DATA.NEW_MESSAGE) {\n            let message = await this.prismaRepository.message.findFirst({\n              where: { key: { path: ['id'], equals: messageId } },\n            });\n            if (!message) throw new NotFoundException('Message not found');\n\n            if (!(message.key.valueOf() as any).fromMe) {\n              new BadRequestException('You cannot edit others messages');\n            }\n            if ((message.key.valueOf() as any)?.deleted) {\n              new BadRequestException('You cannot edit deleted messages');\n            }\n\n            if (oldMessage.messageType === 'conversation' || oldMessage.messageType === 'extendedTextMessage') {\n              oldMessage.message.conversation = data.text;\n            } else {\n              oldMessage.message[oldMessage.messageType].caption = data.text;\n            }\n            message = await this.prismaRepository.message.update({\n              where: { id: message.id },\n              data: {\n                message: oldMessage.message,\n                status: 'EDITED',\n                messageTimestamp: Math.floor(Date.now() / 1000), // Convert to int32 by dividing by 1000 to get seconds\n              },\n            });\n\n            if (this.configService.get<Database>('DATABASE').SAVE_DATA.MESSAGE_UPDATE) {\n              const messageUpdate: any = {\n                messageId: message.id,\n                keyId: messageId,\n                remoteJid: messageSent.key.remoteJid,\n                fromMe: messageSent.key.fromMe,\n                participant: messageSent.key?.participant,\n                status: 'EDITED',\n                instanceId: this.instanceId,\n              };\n              await this.prismaRepository.messageUpdate.create({ data: messageUpdate });\n            }\n          }\n        }\n      }\n\n      return messageSent;\n    } catch (error) {\n      this.logger.error(error);\n      throw error;\n    }\n  }\n\n  public async fetchLabels(): Promise<LabelDto[]> {\n    const labels = await this.prismaRepository.label.findMany({ where: { instanceId: this.instanceId } });\n\n    return labels.map((label) => ({\n      color: label.color,\n      name: label.name,\n      id: label.labelId,\n      predefinedId: label.predefinedId,\n    }));\n  }\n\n  public async handleLabel(data: HandleLabelDto) {\n    const whatsappContact = await this.whatsappNumber({ numbers: [data.number] });\n    if (whatsappContact.length === 0) {\n      throw new NotFoundException('Number not found');\n    }\n    const contact = whatsappContact[0];\n    if (!contact.exists) {\n      throw new NotFoundException('Number is not on WhatsApp');\n    }\n\n    try {\n      if (data.action === 'add') {\n        await this.client.addChatLabel(contact.jid, data.labelId);\n        await this.addLabel(data.labelId, this.instanceId, contact.jid);\n\n        return { numberJid: contact.jid, labelId: data.labelId, add: true };\n      }\n      if (data.action === 'remove') {\n        await this.client.removeChatLabel(contact.jid, data.labelId);\n        await this.removeLabel(data.labelId, this.instanceId, contact.jid);\n\n        return { numberJid: contact.jid, labelId: data.labelId, remove: true };\n      }\n    } catch (error) {\n      throw new BadRequestException(`Unable to ${data.action} label to chat`, error.toString());\n    }\n  }\n\n  // Group\n  private async updateGroupMetadataCache(groupJid: string) {\n    try {\n      const meta = await this.client.groupMetadata(groupJid);\n\n      const cacheConf = this.configService.get<CacheConf>('CACHE');\n\n      if ((cacheConf?.REDIS?.ENABLED && cacheConf?.REDIS?.URI !== '') || cacheConf?.LOCAL?.ENABLED) {\n        this.logger.verbose(`Updating cache for group: ${groupJid}`);\n        await groupMetadataCache.set(groupJid, { timestamp: Date.now(), data: meta });\n      }\n\n      return meta;\n    } catch (error) {\n      this.logger.error(error);\n      return null;\n    }\n  }\n\n  private getGroupMetadataCache = async (groupJid: string) => {\n    if (!isJidGroup(groupJid)) return null;\n\n    const cacheConf = this.configService.get<CacheConf>('CACHE');\n\n    if ((cacheConf?.REDIS?.ENABLED && cacheConf?.REDIS?.URI !== '') || cacheConf?.LOCAL?.ENABLED) {\n      if (await groupMetadataCache?.has(groupJid)) {\n        console.log(`Cache request for group: ${groupJid}`);\n        const meta = await groupMetadataCache.get(groupJid);\n\n        if (Date.now() - meta.timestamp > 3600000) {\n          await this.updateGroupMetadataCache(groupJid);\n        }\n\n        return meta.data;\n      }\n\n      console.log(`Cache request for group: ${groupJid} - not found`);\n      return await this.updateGroupMetadataCache(groupJid);\n    }\n\n    return await this.findGroup({ groupJid }, 'inner');\n  };\n\n  public async createGroup(create: CreateGroupDto) {\n    try {\n      const participants = (await this.whatsappNumber({ numbers: create.participants }))\n        .filter((participant) => participant.exists)\n        .map((participant) => participant.jid);\n      const { id } = await this.client.groupCreate(create.subject, participants);\n\n      if (create?.description) {\n        await this.client.groupUpdateDescription(id, create.description);\n      }\n\n      if (create?.promoteParticipants) {\n        await this.updateGParticipant({ groupJid: id, action: 'promote', participants: participants });\n      }\n\n      const group = await this.client.groupMetadata(id);\n\n      return group;\n    } catch (error) {\n      this.logger.error(error);\n      throw new InternalServerErrorException('Error creating group', error.toString());\n    }\n  }\n\n  public async updateGroupPicture(picture: GroupPictureDto) {\n    try {\n      let pic: WAMediaUpload;\n      if (isURL(picture.image)) {\n        const timestamp = new Date().getTime();\n        const parsedURL = new URL(picture.image);\n        parsedURL.searchParams.set('timestamp', timestamp.toString());\n        const url = parsedURL.toString();\n\n        let config: any = { responseType: 'arraybuffer' };\n\n        if (this.localProxy?.enabled) {\n          config = {\n            ...config,\n            httpsAgent: makeProxyAgent({\n              host: this.localProxy.host,\n              port: this.localProxy.port,\n              protocol: this.localProxy.protocol,\n              username: this.localProxy.username,\n              password: this.localProxy.password,\n            }),\n          };\n        }\n\n        pic = (await axios.get(url, config)).data;\n      } else if (isBase64(picture.image)) {\n        pic = Buffer.from(picture.image, 'base64');\n      } else {\n        throw new BadRequestException('\"profilePicture\" must be a url or a base64');\n      }\n      await this.client.updateProfilePicture(picture.groupJid, pic);\n\n      return { update: 'success' };\n    } catch (error) {\n      throw new InternalServerErrorException('Error update group picture', error.toString());\n    }\n  }\n\n  public async updateGroupSubject(data: GroupSubjectDto) {\n    try {\n      await this.client.groupUpdateSubject(data.groupJid, data.subject);\n\n      return { update: 'success' };\n    } catch (error) {\n      throw new InternalServerErrorException('Error updating group subject', error.toString());\n    }\n  }\n\n  public async updateGroupDescription(data: GroupDescriptionDto) {\n    try {\n      await this.client.groupUpdateDescription(data.groupJid, data.description);\n\n      return { update: 'success' };\n    } catch (error) {\n      throw new InternalServerErrorException('Error updating group description', error.toString());\n    }\n  }\n\n  public async findGroup(id: GroupJid, reply: 'inner' | 'out' = 'out') {\n    try {\n      const group = await this.client.groupMetadata(id.groupJid);\n\n      if (!group) {\n        this.logger.error('Group not found');\n        return null;\n      }\n\n      const picture = await this.profilePicture(group.id);\n\n      return {\n        id: group.id,\n        subject: group.subject,\n        subjectOwner: group.subjectOwner,\n        subjectTime: group.subjectTime,\n        pictureUrl: picture.profilePictureUrl,\n        size: group.participants.length,\n        creation: group.creation,\n        owner: group.owner,\n        desc: group.desc,\n        descId: group.descId,\n        restrict: group.restrict,\n        announce: group.announce,\n        participants: group.participants,\n        isCommunity: group.isCommunity,\n        isCommunityAnnounce: group.isCommunityAnnounce,\n        linkedParent: group.linkedParent,\n      };\n    } catch (error) {\n      if (reply === 'inner') {\n        return;\n      }\n      throw new NotFoundException('Error fetching group', error.toString());\n    }\n  }\n\n  public async fetchAllGroups(getParticipants: GetParticipant) {\n    const fetch = Object.values(await this?.client?.groupFetchAllParticipating());\n\n    let groups = [];\n    for (const group of fetch) {\n      const picture = await this.profilePicture(group.id);\n\n      const result = {\n        id: group.id,\n        subject: group.subject,\n        subjectOwner: group.subjectOwner,\n        subjectTime: group.subjectTime,\n        pictureUrl: picture?.profilePictureUrl,\n        size: group.participants.length,\n        creation: group.creation,\n        owner: group.owner,\n        desc: group.desc,\n        descId: group.descId,\n        restrict: group.restrict,\n        announce: group.announce,\n        isCommunity: group.isCommunity,\n        isCommunityAnnounce: group.isCommunityAnnounce,\n        linkedParent: group.linkedParent,\n      };\n\n      if (getParticipants.getParticipants == 'true') {\n        result['participants'] = group.participants;\n      }\n\n      groups = [...groups, result];\n    }\n\n    return groups;\n  }\n\n  public async inviteCode(id: GroupJid) {\n    try {\n      const code = await this.client.groupInviteCode(id.groupJid);\n      return { inviteUrl: `https://chat.whatsapp.com/${code}`, inviteCode: code };\n    } catch (error) {\n      throw new NotFoundException('No invite code', error.toString());\n    }\n  }\n\n  public async inviteInfo(id: GroupInvite) {\n    try {\n      return await this.client.groupGetInviteInfo(id.inviteCode);\n    } catch {\n      throw new NotFoundException('No invite info', id.inviteCode);\n    }\n  }\n\n  public async sendInvite(id: GroupSendInvite) {\n    try {\n      const inviteCode = await this.inviteCode({ groupJid: id.groupJid });\n\n      const inviteUrl = inviteCode.inviteUrl;\n\n      const numbers = id.numbers.map((number) => createJid(number));\n      const description = id.description ?? '';\n\n      const msg = `${description}\\n\\n${inviteUrl}`;\n\n      const message = { conversation: msg };\n\n      for await (const number of numbers) {\n        await this.sendMessageWithTyping(number, message);\n      }\n\n      return { send: true, inviteUrl };\n    } catch {\n      throw new NotFoundException('No send invite');\n    }\n  }\n\n  public async acceptInviteCode(id: AcceptGroupInvite) {\n    try {\n      const groupJid = await this.client.groupAcceptInvite(id.inviteCode);\n      return { accepted: true, groupJid: groupJid };\n    } catch (error) {\n      throw new NotFoundException('Accept invite error', error.toString());\n    }\n  }\n\n  public async revokeInviteCode(id: GroupJid) {\n    try {\n      const inviteCode = await this.client.groupRevokeInvite(id.groupJid);\n      return { revoked: true, inviteCode };\n    } catch (error) {\n      throw new NotFoundException('Revoke error', error.toString());\n    }\n  }\n\n  public async findParticipants(id: GroupJid) {\n    try {\n      const participants = (await this.client.groupMetadata(id.groupJid)).participants;\n      const contacts = await this.prismaRepository.contact.findMany({\n        where: { instanceId: this.instanceId, remoteJid: { in: participants.map((p) => p.id) } },\n      });\n      const parsedParticipants = participants.map((participant) => {\n        const contact = contacts.find((c) => c.remoteJid === participant.id);\n        return {\n          ...participant,\n          name: participant.name ?? contact?.pushName,\n          imgUrl: participant.imgUrl ?? contact?.profilePicUrl,\n        };\n      });\n\n      const usersContacts = parsedParticipants.filter((c) => c.id.includes('@s.whatsapp'));\n      if (usersContacts) {\n        await saveOnWhatsappCache(usersContacts.map((c) => ({ remoteJid: c.id })));\n      }\n\n      return { participants: parsedParticipants };\n    } catch (error) {\n      console.error(error);\n      throw new NotFoundException('No participants', error.toString());\n    }\n  }\n\n  public async updateGParticipant(update: GroupUpdateParticipantDto) {\n    try {\n      const participants = update.participants.map((p) => createJid(p));\n      const updateParticipants = await this.client.groupParticipantsUpdate(\n        update.groupJid,\n        participants,\n        update.action,\n      );\n      return { updateParticipants: updateParticipants };\n    } catch (error) {\n      throw new BadRequestException('Error updating participants', error.toString());\n    }\n  }\n\n  public async updateGSetting(update: GroupUpdateSettingDto) {\n    try {\n      const updateSetting = await this.client.groupSettingUpdate(update.groupJid, update.action);\n      return { updateSetting: updateSetting };\n    } catch (error) {\n      throw new BadRequestException('Error updating setting', error.toString());\n    }\n  }\n\n  public async toggleEphemeral(update: GroupToggleEphemeralDto) {\n    try {\n      await this.client.groupToggleEphemeral(update.groupJid, update.expiration);\n      return { success: true };\n    } catch (error) {\n      throw new BadRequestException('Error updating setting', error.toString());\n    }\n  }\n\n  public async leaveGroup(id: GroupJid) {\n    try {\n      await this.client.groupLeave(id.groupJid);\n      return { groupJid: id.groupJid, leave: true };\n    } catch (error) {\n      throw new BadRequestException('Unable to leave the group', error.toString());\n    }\n  }\n\n  public async templateMessage() {\n    throw new Error('Method not available in the Baileys service');\n  }\n\n  private deserializeMessageBuffers(obj: any): any {\n    if (obj === null || obj === undefined) {\n      return obj;\n    }\n\n    if (typeof obj === 'object' && !Array.isArray(obj) && !Buffer.isBuffer(obj)) {\n      const keys = Object.keys(obj);\n      const isIndexedObject = keys.every((key) => !isNaN(Number(key)));\n\n      if (isIndexedObject && keys.length > 0) {\n        const values = keys.sort((a, b) => Number(a) - Number(b)).map((key) => obj[key]);\n        return new Uint8Array(values);\n      }\n    }\n\n    // Is Buffer?, converter to Uint8Array\n    if (Buffer.isBuffer(obj)) {\n      return new Uint8Array(obj);\n    }\n\n    // Process arrays recursively\n    if (Array.isArray(obj)) {\n      return obj.map((item) => this.deserializeMessageBuffers(item));\n    }\n\n    // Process objects recursively\n    if (typeof obj === 'object') {\n      const converted: any = {};\n      for (const key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\n          converted[key] = this.deserializeMessageBuffers(obj[key]);\n        }\n      }\n      return converted;\n    }\n\n    return obj;\n  }\n\n  private prepareMessage(message: proto.IWebMessageInfo): any {\n    const contentType = getContentType(message.message);\n    const contentMsg = message?.message[contentType] as any;\n\n    const messageRaw = {\n      key: message.key, // Save key exactly as it comes from Baileys\n      pushName:\n        message.pushName ||\n        (message.key.fromMe\n          ? 'Voc'\n          : message?.participant || (message.key?.participant ? message.key.participant.split('@')[0] : null)),\n      status: status[message.status],\n      message: this.deserializeMessageBuffers({ ...message.message }),\n      contextInfo: this.deserializeMessageBuffers(contentMsg?.contextInfo),\n      messageType: contentType || 'unknown',\n      messageTimestamp: Long.isLong(message.messageTimestamp)\n        ? message.messageTimestamp.toNumber()\n        : (message.messageTimestamp as number),\n      instanceId: this.instanceId,\n      source: getDevice(message.key.id),\n    };\n\n    if (!messageRaw.status && message.key.fromMe === false) {\n      messageRaw.status = status[3]; // DELIVERED MESSAGE\n    }\n\n    if (messageRaw.message.extendedTextMessage) {\n      messageRaw.messageType = 'conversation';\n      messageRaw.message.conversation = messageRaw.message.extendedTextMessage.text;\n      delete messageRaw.message.extendedTextMessage;\n    }\n\n    if (messageRaw.message.documentWithCaptionMessage) {\n      messageRaw.messageType = 'documentMessage';\n      messageRaw.message.documentMessage = messageRaw.message.documentWithCaptionMessage.message.documentMessage;\n      delete messageRaw.message.documentWithCaptionMessage;\n    }\n\n    const quotedMessage = messageRaw?.contextInfo?.quotedMessage;\n    if (quotedMessage) {\n      if (quotedMessage.extendedTextMessage) {\n        quotedMessage.conversation = quotedMessage.extendedTextMessage.text;\n        delete quotedMessage.extendedTextMessage;\n      }\n\n      if (quotedMessage.documentWithCaptionMessage) {\n        quotedMessage.documentMessage = quotedMessage.documentWithCaptionMessage.message.documentMessage;\n        delete quotedMessage.documentWithCaptionMessage;\n      }\n    }\n\n    return messageRaw;\n  }\n\n  private async syncChatwootLostMessages() {\n    if (this.configService.get<Chatwoot>('CHATWOOT').ENABLED && this.localChatwoot?.enabled) {\n      const chatwootConfig = await this.findChatwoot();\n      const prepare = (message: any) => this.prepareMessage(message);\n      this.chatwootService.syncLostMessages({ instanceName: this.instance.name }, chatwootConfig, prepare);\n\n      // Generate ID for this cron task and store in cache\n      const cronId = cuid();\n      const cronKey = `chatwoot:syncLostMessages`;\n      await this.chatwootService.getCache()?.hSet(cronKey, this.instance.name, cronId);\n\n      const task = cron.schedule('0,30 * * * *', async () => {\n        // Check ID before executing (only if cache is available)\n        const cache = this.chatwootService.getCache();\n        if (cache) {\n          const storedId = await cache.hGet(cronKey, this.instance.name);\n          if (storedId && storedId !== cronId) {\n            this.logger.info(`Stopping syncChatwootLostMessages cron - ID mismatch: ${cronId} vs ${storedId}`);\n            task.stop();\n            return;\n          }\n        }\n        this.chatwootService.syncLostMessages({ instanceName: this.instance.name }, chatwootConfig, prepare);\n      });\n      task.start();\n    }\n  }\n\n  private async updateMessagesReadedByTimestamp(remoteJid: string, timestamp?: number): Promise<number> {\n    if (timestamp === undefined || timestamp === null) return 0;\n\n    // Use raw SQL to avoid JSON path issues\n    const result = await this.prismaRepository.$executeRaw`\n      UPDATE \"Message\"\n      SET \"status\" = ${status[4]}\n      WHERE \"instanceId\" = ${this.instanceId}\n      AND \"key\"->>'remoteJid' = ${remoteJid}\n      AND (\"key\"->>'fromMe')::boolean = false\n      AND \"messageTimestamp\" <= ${timestamp}\n      AND (\"status\" IS NULL OR \"status\" = ${status[3]})\n    `;\n\n    if (result) {\n      if (result > 0) {\n        this.updateChatUnreadMessages(remoteJid);\n      }\n\n      return result;\n    }\n\n    return 0;\n  }\n\n  private async updateChatUnreadMessages(remoteJid: string): Promise<number> {\n    const [chat, unreadMessages] = await Promise.all([\n      this.prismaRepository.chat.findFirst({ where: { remoteJid } }),\n      // Use raw SQL to avoid JSON path issues\n      this.prismaRepository.$queryRaw`\n        SELECT COUNT(*)::int as count FROM \"Message\"\n        WHERE \"instanceId\" = ${this.instanceId}\n        AND \"key\"->>'remoteJid' = ${remoteJid}\n        AND (\"key\"->>'fromMe')::boolean = false\n        AND \"status\" = ${status[3]}\n      `.then((result: any[]) => result[0]?.count || 0),\n    ]);\n\n    if (chat && chat.unreadMessages !== unreadMessages) {\n      await this.prismaRepository.chat.update({ where: { id: chat.id }, data: { unreadMessages } });\n    }\n\n    return unreadMessages;\n  }\n\n  private async addLabel(labelId: string, instanceId: string, chatId: string) {\n    const id = cuid();\n\n    await this.prismaRepository.$executeRawUnsafe(\n      `INSERT INTO \"Chat\" (\"id\", \"instanceId\", \"remoteJid\", \"labels\", \"createdAt\", \"updatedAt\")\n       VALUES ($4, $2, $3, to_jsonb(ARRAY[$1]::text[]), NOW(), NOW()) ON CONFLICT (\"instanceId\", \"remoteJid\")\n     DO\n      UPDATE\n          SET \"labels\" = (\n          SELECT to_jsonb(array_agg(DISTINCT elem))\n          FROM (\n          SELECT jsonb_array_elements_text(\"Chat\".\"labels\") AS elem\n          UNION\n          SELECT $1::text AS elem\n          ) sub\n          ),\n          \"updatedAt\" = NOW();`,\n      labelId,\n      instanceId,\n      chatId,\n      id,\n    );\n  }\n\n  private async removeLabel(labelId: string, instanceId: string, chatId: string) {\n    const id = cuid();\n\n    await this.prismaRepository.$executeRawUnsafe(\n      `INSERT INTO \"Chat\" (\"id\", \"instanceId\", \"remoteJid\", \"labels\", \"createdAt\", \"updatedAt\")\n       VALUES ($4, $2, $3, '[]'::jsonb, NOW(), NOW()) ON CONFLICT (\"instanceId\", \"remoteJid\")\n     DO\n      UPDATE\n          SET \"labels\" = COALESCE (\n          (\n          SELECT jsonb_agg(elem)\n          FROM jsonb_array_elements_text(\"Chat\".\"labels\") AS elem\n          WHERE elem <> $1\n          ),\n          '[]'::jsonb\n          ),\n          \"updatedAt\" = NOW();`,\n      labelId,\n      instanceId,\n      chatId,\n      id,\n    );\n  }\n\n  public async baileysOnWhatsapp(jid: string) {\n    const response = await this.client.onWhatsApp(jid);\n\n    return response;\n  }\n\n  public async baileysProfilePictureUrl(jid: string, type: 'image' | 'preview', timeoutMs: number) {\n    const response = await this.client.profilePictureUrl(jid, type, timeoutMs);\n\n    return response;\n  }\n\n  public async baileysAssertSessions(jids: string[]) {\n    const response = await this.client.assertSessions(jids);\n\n    return response;\n  }\n\n  public async baileysCreateParticipantNodes(jids: string[], message: proto.IMessage, extraAttrs: any) {\n    const response = await this.client.createParticipantNodes(jids, message, extraAttrs);\n\n    const convertedResponse = {\n      ...response,\n      nodes: response.nodes.map((node: any) => ({\n        ...node,\n        content: node.content?.map((c: any) => ({\n          ...c,\n          content: c.content instanceof Uint8Array ? Buffer.from(c.content).toString('base64') : c.content,\n        })),\n      })),\n    };\n\n    return convertedResponse;\n  }\n\n  public async baileysSendNode(stanza: any) {\n    console.log('stanza', JSON.stringify(stanza));\n    const response = await this.client.sendNode(stanza);\n\n    return response;\n  }\n\n  public async baileysGetUSyncDevices(jids: string[], useCache: boolean, ignoreZeroDevices: boolean) {\n    const response = await this.client.getUSyncDevices(jids, useCache, ignoreZeroDevices);\n\n    return response;\n  }\n\n  public async baileysGenerateMessageTag() {\n    const response = await this.client.generateMessageTag();\n\n    return response;\n  }\n\n  public async baileysSignalRepositoryDecryptMessage(jid: string, type: 'pkmsg' | 'msg', ciphertext: string) {\n    try {\n      const ciphertextBuffer = Buffer.from(ciphertext, 'base64');\n\n      const response = await this.client.signalRepository.decryptMessage({ jid, type, ciphertext: ciphertextBuffer });\n\n      return response instanceof Uint8Array ? Buffer.from(response).toString('base64') : response;\n    } catch (error) {\n      this.logger.error('Error decrypting message:');\n      this.logger.error(error);\n      throw error;\n    }\n  }\n\n  public async baileysGetAuthState() {\n    const response = { me: this.client.authState.creds.me, account: this.client.authState.creds.account };\n\n    return response;\n  }\n\n  //Business Controller\n  public async fetchCatalog(instanceName: string, data: getCollectionsDto) {\n    const jid = data.number ? createJid(data.number) : this.client?.user?.id;\n    const limit = data.limit || 10;\n    const cursor = null;\n\n    const onWhatsapp = (await this.whatsappNumber({ numbers: [jid] }))?.shift();\n\n    if (!onWhatsapp.exists) {\n      throw new BadRequestException(onWhatsapp);\n    }\n\n    try {\n      const info = (await this.whatsappNumber({ numbers: [jid] }))?.shift();\n      const business = await this.fetchBusinessProfile(info?.jid);\n\n      let catalog = await this.getCatalog({ jid: info?.jid, limit, cursor });\n      let nextPageCursor = catalog.nextPageCursor;\n      let nextPageCursorJson = nextPageCursor ? JSON.parse(atob(nextPageCursor)) : null;\n      let pagination = nextPageCursorJson?.pagination_cursor\n        ? JSON.parse(atob(nextPageCursorJson.pagination_cursor))\n        : null;\n      let fetcherHasMore = pagination?.fetcher_has_more === true ? true : false;\n\n      let productsCatalog = catalog.products || [];\n      let countLoops = 0;\n      while (fetcherHasMore && countLoops < 4) {\n        catalog = await this.getCatalog({ jid: info?.jid, limit, cursor: nextPageCursor });\n        nextPageCursor = catalog.nextPageCursor;\n        nextPageCursorJson = nextPageCursor ? JSON.parse(atob(nextPageCursor)) : null;\n        pagination = nextPageCursorJson?.pagination_cursor\n          ? JSON.parse(atob(nextPageCursorJson.pagination_cursor))\n          : null;\n        fetcherHasMore = pagination?.fetcher_has_more === true ? true : false;\n        productsCatalog = [...productsCatalog, ...catalog.products];\n        countLoops++;\n      }\n\n      return {\n        wuid: info?.jid || jid,\n        numberExists: info?.exists,\n        isBusiness: business.isBusiness,\n        catalogLength: productsCatalog.length,\n        catalog: productsCatalog,\n      };\n    } catch (error) {\n      console.log(error);\n      return { wuid: jid, name: null, isBusiness: false };\n    }\n  }\n\n  public async getCatalog({\n    jid,\n    limit,\n    cursor,\n  }: GetCatalogOptions): Promise<{ products: Product[]; nextPageCursor: string | undefined }> {\n    try {\n      jid = jid ? createJid(jid) : this.instance.wuid;\n\n      const catalog = await this.client.getCatalog({ jid, limit: limit, cursor: cursor });\n\n      if (!catalog) {\n        return { products: undefined, nextPageCursor: undefined };\n      }\n\n      return catalog;\n    } catch (error) {\n      throw new InternalServerErrorException('Error getCatalog', error.toString());\n    }\n  }\n\n  public async fetchCollections(instanceName: string, data: getCollectionsDto) {\n    const jid = data.number ? createJid(data.number) : this.client?.user?.id;\n    const limit = data.limit <= 20 ? data.limit : 20; //(tem esse limite, no sei porque)\n\n    const onWhatsapp = (await this.whatsappNumber({ numbers: [jid] }))?.shift();\n\n    if (!onWhatsapp.exists) {\n      throw new BadRequestException(onWhatsapp);\n    }\n\n    try {\n      const info = (await this.whatsappNumber({ numbers: [jid] }))?.shift();\n      const business = await this.fetchBusinessProfile(info?.jid);\n      const collections = await this.getCollections(info?.jid, limit);\n\n      return {\n        wuid: info?.jid || jid,\n        name: info?.name,\n        numberExists: info?.exists,\n        isBusiness: business.isBusiness,\n        collectionsLength: collections?.length,\n        collections: collections,\n      };\n    } catch {\n      return { wuid: jid, name: null, isBusiness: false };\n    }\n  }\n\n  public async getCollections(jid?: string | undefined, limit?: number): Promise<CatalogCollection[]> {\n    try {\n      jid = jid ? createJid(jid) : this.instance.wuid;\n\n      const result = await this.client.getCollections(jid, limit);\n\n      if (!result) {\n        return [{ id: undefined, name: undefined, products: [], status: undefined }];\n      }\n\n      return result.collections;\n    } catch (error) {\n      throw new InternalServerErrorException('Error getCatalog', error.toString());\n    }\n  }\n\n  public async fetchMessages(query: Query<Message>) {\n    const keyFilters = query?.where?.key as ExtendedIMessageKey;\n\n    const timestampFilter = {};\n    if (query?.where?.messageTimestamp) {\n      if (query.where.messageTimestamp['gte'] && query.where.messageTimestamp['lte']) {\n        timestampFilter['messageTimestamp'] = {\n          gte: Math.floor(new Date(query.where.messageTimestamp['gte']).getTime() / 1000),\n          lte: Math.floor(new Date(query.where.messageTimestamp['lte']).getTime() / 1000),\n        };\n      }\n    }\n\n    const count = await this.prismaRepository.message.count({\n      where: {\n        instanceId: this.instanceId,\n        id: query?.where?.id,\n        source: query?.where?.source,\n        messageType: query?.where?.messageType,\n        ...timestampFilter,\n        AND: [\n          keyFilters?.id ? { key: { path: ['id'], equals: keyFilters?.id } } : {},\n          keyFilters?.fromMe ? { key: { path: ['fromMe'], equals: keyFilters?.fromMe } } : {},\n          keyFilters?.participant ? { key: { path: ['participant'], equals: keyFilters?.participant } } : {},\n          {\n            OR: [\n              keyFilters?.remoteJid ? { key: { path: ['remoteJid'], equals: keyFilters?.remoteJid } } : {},\n              keyFilters?.remoteJidAlt ? { key: { path: ['remoteJidAlt'], equals: keyFilters?.remoteJidAlt } } : {},\n            ],\n          },\n        ],\n      },\n    });\n\n    if (!query?.offset) {\n      query.offset = 50;\n    }\n\n    if (!query?.page) {\n      query.page = 1;\n    }\n\n    const messages = await this.prismaRepository.message.findMany({\n      where: {\n        instanceId: this.instanceId,\n        id: query?.where?.id,\n        source: query?.where?.source,\n        messageType: query?.where?.messageType,\n        ...timestampFilter,\n        AND: [\n          keyFilters?.id ? { key: { path: ['id'], equals: keyFilters?.id } } : {},\n          keyFilters?.fromMe ? { key: { path: ['fromMe'], equals: keyFilters?.fromMe } } : {},\n          keyFilters?.participant ? { key: { path: ['participant'], equals: keyFilters?.participant } } : {},\n          {\n            OR: [\n              keyFilters?.remoteJid ? { key: { path: ['remoteJid'], equals: keyFilters?.remoteJid } } : {},\n              keyFilters?.remoteJidAlt ? { key: { path: ['remoteJidAlt'], equals: keyFilters?.remoteJidAlt } } : {},\n            ],\n          },\n        ],\n      },\n      orderBy: { messageTimestamp: 'desc' },\n      skip: query.offset * (query?.page === 1 ? 0 : (query?.page as number) - 1),\n      take: query.offset,\n      select: {\n        id: true,\n        key: true,\n        pushName: true,\n        messageType: true,\n        message: true,\n        messageTimestamp: true,\n        instanceId: true,\n        source: true,\n        contextInfo: true,\n        MessageUpdate: { select: { status: true } },\n      },\n    });\n\n    const formattedMessages = messages.map((message) => {\n      const messageKey = message.key as { fromMe: boolean; remoteJid: string; id: string; participant?: string };\n\n      if (!message.pushName) {\n        if (messageKey.fromMe) {\n          message.pushName = 'Voc';\n        } else if (message.contextInfo) {\n          const contextInfo = message.contextInfo as { participant?: string };\n          if (contextInfo.participant) {\n            message.pushName = contextInfo.participant.split('@')[0];\n          } else if (messageKey.participant) {\n            message.pushName = messageKey.participant.split('@')[0];\n          }\n        }\n      }\n\n      return message;\n    });\n\n    return {\n      messages: {\n        total: count,\n        pages: Math.ceil(count / query.offset),\n        currentPage: query.page,\n        records: formattedMessages,\n      },\n    };\n  }\n}\n","import { InstanceDto } from '@api/dto/instance.dto';\nimport { ProviderFiles } from '@api/provider/sessions';\nimport { PrismaRepository } from '@api/repository/repository.service';\nimport { CacheService } from '@api/services/cache.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { Integration } from '@api/types/wa.types';\nimport { ConfigService } from '@config/env.config';\nimport { BadRequestException } from '@exceptions';\nimport EventEmitter2 from 'eventemitter2';\n\nimport { EvolutionStartupService } from './evolution/evolution.channel.service';\nimport { BusinessStartupService } from './meta/whatsapp.business.service';\nimport { BaileysStartupService } from './whatsapp/whatsapp.baileys.service';\n\ntype ChannelDataType = {\n  configService: ConfigService;\n  eventEmitter: EventEmitter2;\n  prismaRepository: PrismaRepository;\n  cache: CacheService;\n  chatwootCache: CacheService;\n  baileysCache: CacheService;\n  providerFiles: ProviderFiles;\n};\n\nexport interface ChannelControllerInterface {\n  receiveWebhook(data: any): Promise<any>;\n}\n\nexport class ChannelController {\n  public prismaRepository: PrismaRepository;\n  public waMonitor: WAMonitoringService;\n\n  constructor(prismaRepository: PrismaRepository, waMonitor: WAMonitoringService) {\n    this.prisma = prismaRepository;\n    this.monitor = waMonitor;\n  }\n\n  public set prisma(prisma: PrismaRepository) {\n    this.prismaRepository = prisma;\n  }\n\n  public get prisma() {\n    return this.prismaRepository;\n  }\n\n  public set monitor(waMonitor: WAMonitoringService) {\n    this.waMonitor = waMonitor;\n  }\n\n  public get monitor() {\n    return this.waMonitor;\n  }\n\n  public init(instanceData: InstanceDto, data: ChannelDataType) {\n    if (!instanceData.token && instanceData.integration === Integration.WHATSAPP_BUSINESS) {\n      throw new BadRequestException('token is required');\n    }\n\n    if (instanceData.integration === Integration.WHATSAPP_BUSINESS) {\n      return new BusinessStartupService(\n        data.configService,\n        data.eventEmitter,\n        data.prismaRepository,\n        data.cache,\n        data.chatwootCache,\n        data.baileysCache,\n        data.providerFiles,\n      );\n    }\n\n    if (instanceData.integration === Integration.EVOLUTION) {\n      return new EvolutionStartupService(\n        data.configService,\n        data.eventEmitter,\n        data.prismaRepository,\n        data.cache,\n        data.chatwootCache,\n      );\n    }\n\n    if (instanceData.integration === Integration.WHATSAPP_BAILEYS) {\n      return new BaileysStartupService(\n        data.configService,\n        data.eventEmitter,\n        data.prismaRepository,\n        data.cache,\n        data.chatwootCache,\n        data.baileysCache,\n        data.providerFiles,\n      );\n    }\n\n    return null;\n  }\n}\n","import { PrismaRepository } from '@api/repository/repository.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { Logger } from '@config/logger.config';\n\nimport { ChannelController, ChannelControllerInterface } from '../channel.controller';\n\nexport class EvolutionController extends ChannelController implements ChannelControllerInterface {\n  private readonly logger = new Logger('EvolutionController');\n\n  constructor(prismaRepository: PrismaRepository, waMonitor: WAMonitoringService) {\n    super(prismaRepository, waMonitor);\n  }\n\n  integrationEnabled: boolean;\n\n  public async receiveWebhook(data: any) {\n    const numberId = data.numberId;\n\n    if (!numberId) {\n      this.logger.error('WebhookService -> receiveWebhookEvolution -> numberId not found');\n      return;\n    }\n\n    const instance = await this.prismaRepository.instance.findFirst({\n      where: { number: numberId },\n    });\n\n    if (!instance) {\n      this.logger.error('WebhookService -> receiveWebhook -> instance not found');\n      return;\n    }\n\n    await this.waMonitor.waInstances[instance.name].connectToWhatsapp(data);\n\n    return {\n      status: 'success',\n    };\n  }\n}\n","import { PrismaRepository } from '@api/repository/repository.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { Logger } from '@config/logger.config';\nimport axios from 'axios';\n\nimport { ChannelController, ChannelControllerInterface } from '../channel.controller';\n\nexport class MetaController extends ChannelController implements ChannelControllerInterface {\n  private readonly logger = new Logger('MetaController');\n\n  constructor(prismaRepository: PrismaRepository, waMonitor: WAMonitoringService) {\n    super(prismaRepository, waMonitor);\n  }\n\n  integrationEnabled: boolean;\n\n  public async receiveWebhook(data: any) {\n    if (data.object === 'whatsapp_business_account') {\n      if (data.entry[0]?.changes[0]?.field === 'message_template_status_update') {\n        const template = await this.prismaRepository.template.findFirst({\n          where: { templateId: `${data.entry[0].changes[0].value.message_template_id}` },\n        });\n\n        if (!template) {\n          console.log('template not found');\n          return;\n        }\n\n        const { webhookUrl } = template;\n\n        await axios.post(webhookUrl, data.entry[0].changes[0].value, {\n          headers: {\n            'Content-Type': 'application/json',\n          },\n        });\n        return;\n      }\n\n      data.entry?.forEach(async (entry: any) => {\n        const numberId = entry.changes[0].value.metadata.phone_number_id;\n\n        if (!numberId) {\n          this.logger.error('WebhookService -> receiveWebhookMeta -> numberId not found');\n          return {\n            status: 'success',\n          };\n        }\n\n        const instance = await this.prismaRepository.instance.findFirst({\n          where: { number: numberId },\n        });\n\n        if (!instance) {\n          this.logger.error('WebhookService -> receiveWebhookMeta -> instance not found');\n          return {\n            status: 'success',\n          };\n        }\n\n        await this.waMonitor.waInstances[instance.name].connectToWhatsapp(data);\n\n        return {\n          status: 'success',\n        };\n      });\n    }\n\n    return {\n      status: 'success',\n    };\n  }\n}\n","import { InstanceDto } from '@api/dto/instance.dto';\nimport { WAMonitoringService } from '@api/services/monitor.service';\n\nexport class BaileysController {\n  constructor(private readonly waMonitor: WAMonitoringService) {}\n\n  public async onWhatsapp({ instanceName }: InstanceDto, body: any) {\n    const instance = this.waMonitor.waInstances[instanceName];\n\n    return instance.baileysOnWhatsapp(body?.jid);\n  }\n\n  public async profilePictureUrl({ instanceName }: InstanceDto, body: any) {\n    const instance = this.waMonitor.waInstances[instanceName];\n\n    return instance.baileysProfilePictureUrl(body?.jid, body?.type, body?.timeoutMs);\n  }\n\n  public async assertSessions({ instanceName }: InstanceDto, body: any) {\n    const instance = this.waMonitor.waInstances[instanceName];\n\n    return instance.baileysAssertSessions(body?.jids, body?.force);\n  }\n\n  public async createParticipantNodes({ instanceName }: InstanceDto, body: any) {\n    const instance = this.waMonitor.waInstances[instanceName];\n\n    return instance.baileysCreateParticipantNodes(body?.jids, body?.message, body?.extraAttrs);\n  }\n\n  public async getUSyncDevices({ instanceName }: InstanceDto, body: any) {\n    const instance = this.waMonitor.waInstances[instanceName];\n\n    return instance.baileysGetUSyncDevices(body?.jids, body?.useCache, body?.ignoreZeroDevices);\n  }\n\n  public async generateMessageTag({ instanceName }: InstanceDto) {\n    const instance = this.waMonitor.waInstances[instanceName];\n\n    return instance.baileysGenerateMessageTag();\n  }\n\n  public async sendNode({ instanceName }: InstanceDto, body: any) {\n    const instance = this.waMonitor.waInstances[instanceName];\n\n    return instance.baileysSendNode(body?.stanza);\n  }\n\n  public async signalRepositoryDecryptMessage({ instanceName }: InstanceDto, body: any) {\n    const instance = this.waMonitor.waInstances[instanceName];\n\n    return instance.baileysSignalRepositoryDecryptMessage(body?.jid, body?.type, body?.ciphertext);\n  }\n\n  public async getAuthState({ instanceName }: InstanceDto) {\n    const instance = this.waMonitor.waInstances[instanceName];\n\n    return instance.baileysGetAuthState();\n  }\n}\n","function normalizeString(str: string): string {\n  return str\n    .normalize('NFD')\n    .replace(/[\\u0300-\\u036f]/g, '')\n    .toLowerCase();\n}\n\nexport function advancedOperatorsSearch(data: string, query: string): boolean {\n  const filters = query.split(' ').reduce((acc: Record<string, string[]>, filter) => {\n    const [operator, ...values] = filter.split(':');\n    const value = values.join(':');\n\n    if (!acc[operator]) {\n      acc[operator] = [];\n    }\n    acc[operator].push(value);\n    return acc;\n  }, {});\n\n  const normalizedItem = normalizeString(data);\n\n  return Object.entries(filters).every(([operator, values]) => {\n    return values.some((val) => {\n      const subValues = val.split(',');\n      return subValues.every((subVal) => {\n        const normalizedSubVal = normalizeString(subVal);\n\n        switch (operator.toLowerCase()) {\n          case 'contains':\n            return normalizedItem.includes(normalizedSubVal);\n          case 'notcontains':\n            return !normalizedItem.includes(normalizedSubVal);\n          case 'startswith':\n            return normalizedItem.startsWith(normalizedSubVal);\n          case 'endswith':\n            return normalizedItem.endsWith(normalizedSubVal);\n          case 'exact':\n            return normalizedItem === normalizedSubVal;\n          default:\n            return false;\n        }\n      });\n    });\n  });\n}\n","import { advancedOperatorsSearch } from './advancedOperatorsSearch';\n\nexport const findBotByTrigger = async (botRepository: any, content: string, instanceId: string) => {\n  // Check for triggerType 'all' or 'none' (both should match any message)\n  const findTriggerAllOrNone = await botRepository.findFirst({\n    where: {\n      enabled: true,\n      triggerType: {\n        in: ['all', 'none'],\n      },\n      instanceId: instanceId,\n    },\n  });\n\n  if (findTriggerAllOrNone) {\n    return findTriggerAllOrNone;\n  }\n\n  const findTriggerAdvanced = await botRepository.findMany({\n    where: {\n      enabled: true,\n      triggerType: 'advanced',\n      instanceId: instanceId,\n    },\n  });\n  for (const advanced of findTriggerAdvanced) {\n    if (advancedOperatorsSearch(content, advanced.triggerValue)) {\n      return advanced;\n    }\n  }\n\n  // Check for exact match\n  const findTriggerEquals = await botRepository.findFirst({\n    where: {\n      enabled: true,\n      triggerType: 'keyword',\n      triggerOperator: 'equals',\n      triggerValue: content,\n      instanceId: instanceId,\n    },\n  });\n\n  if (findTriggerEquals) {\n    return findTriggerEquals;\n  }\n\n  // Check for regex match\n  const findRegex = await botRepository.findMany({\n    where: {\n      enabled: true,\n      triggerType: 'keyword',\n      triggerOperator: 'regex',\n      instanceId: instanceId,\n    },\n  });\n\n  let findTriggerRegex = null;\n\n  for (const regex of findRegex) {\n    const regexValue = new RegExp(regex.triggerValue);\n\n    if (regexValue.test(content)) {\n      findTriggerRegex = regex;\n      break;\n    }\n  }\n\n  if (findTriggerRegex) return findTriggerRegex;\n\n  // Check for startsWith match\n  const findStartsWith = await botRepository.findMany({\n    where: {\n      enabled: true,\n      triggerType: 'keyword',\n      triggerOperator: 'startsWith',\n      instanceId: instanceId,\n    },\n  });\n\n  let findTriggerStartsWith = null;\n\n  for (const startsWith of findStartsWith) {\n    if (content.startsWith(startsWith.triggerValue)) {\n      findTriggerStartsWith = startsWith;\n      break;\n    }\n  }\n\n  if (findTriggerStartsWith) return findTriggerStartsWith;\n\n  // Check for endsWith match\n  const findEndsWith = await botRepository.findMany({\n    where: {\n      enabled: true,\n      triggerType: 'keyword',\n      triggerOperator: 'endsWith',\n      instanceId: instanceId,\n    },\n  });\n\n  let findTriggerEndsWith = null;\n\n  for (const endsWith of findEndsWith) {\n    if (content.endsWith(endsWith.triggerValue)) {\n      findTriggerEndsWith = endsWith;\n      break;\n    }\n  }\n\n  if (findTriggerEndsWith) return findTriggerEndsWith;\n\n  // Check for contains match\n  const findContains = await botRepository.findMany({\n    where: {\n      enabled: true,\n      triggerType: 'keyword',\n      triggerOperator: 'contains',\n      instanceId: instanceId,\n    },\n  });\n\n  let findTriggerContains = null;\n\n  for (const contains of findContains) {\n    if (content.includes(contains.triggerValue)) {\n      findTriggerContains = contains;\n      break;\n    }\n  }\n\n  if (findTriggerContains) return findTriggerContains;\n\n  return null;\n};\n","import { InstanceDto } from '@api/dto/instance.dto';\nimport { PrismaRepository } from '@api/repository/repository.service';\nimport {\n  difyController,\n  evoaiController,\n  evolutionBotController,\n  flowiseController,\n  n8nController,\n  openaiController,\n  typebotController,\n} from '@api/server.module';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { Logger } from '@config/logger.config';\nimport { IntegrationSession } from '@prisma/client';\nimport { findBotByTrigger } from '@utils/findBotByTrigger';\n\nexport type EmitData = {\n  instance: InstanceDto;\n  remoteJid: string;\n  msg: any;\n  pushName?: string;\n};\n\nexport interface ChatbotControllerInterface {\n  integrationEnabled: boolean;\n  botRepository: any;\n  settingsRepository: any;\n  sessionRepository: any;\n  userMessageDebounce: { [key: string]: { message: string; timeoutId: NodeJS.Timeout } };\n\n  createBot(instance: InstanceDto, data: any): Promise<any>;\n  findBot(instance: InstanceDto): Promise<any>;\n  fetchBot(instance: InstanceDto, botId: string): Promise<any>;\n  updateBot(instance: InstanceDto, botId: string, data: any): Promise<any>;\n  deleteBot(instance: InstanceDto, botId: string): Promise<any>;\n\n  settings(instance: InstanceDto, data: any): Promise<any>;\n  fetchSettings(instance: InstanceDto): Promise<any>;\n\n  changeStatus(instance: InstanceDto, botId: string, status: string): Promise<any>;\n  fetchSessions(instance: InstanceDto, botId: string, remoteJid?: string): Promise<any>;\n  ignoreJid(instance: InstanceDto, data: any): Promise<any>;\n\n  emit(data: EmitData): Promise<void>;\n}\n\nexport class ChatbotController {\n  public prismaRepository: PrismaRepository;\n  public waMonitor: WAMonitoringService;\n\n  public readonly logger = new Logger('ChatbotController');\n\n  constructor(prismaRepository: PrismaRepository, waMonitor: WAMonitoringService) {\n    this.prisma = prismaRepository;\n    this.monitor = waMonitor;\n  }\n\n  public set prisma(prisma: PrismaRepository) {\n    this.prismaRepository = prisma;\n  }\n\n  public get prisma() {\n    return this.prismaRepository;\n  }\n\n  public set monitor(waMonitor: WAMonitoringService) {\n    this.waMonitor = waMonitor;\n  }\n\n  public get monitor() {\n    return this.waMonitor;\n  }\n\n  public async emit({\n    instance,\n    remoteJid,\n    msg,\n    pushName,\n    isIntegration = false,\n  }: {\n    instance: InstanceDto;\n    remoteJid: string;\n    msg: any;\n    pushName?: string;\n    isIntegration?: boolean;\n  }): Promise<void> {\n    const emitData = {\n      instance,\n      remoteJid,\n      msg,\n      pushName,\n      isIntegration,\n    };\n    evolutionBotController.emit(emitData);\n\n    typebotController.emit(emitData);\n\n    openaiController.emit(emitData);\n\n    difyController.emit(emitData);\n\n    n8nController.emit(emitData);\n\n    evoaiController.emit(emitData);\n\n    flowiseController.emit(emitData);\n  }\n\n  public processDebounce(\n    userMessageDebounce: any,\n    content: string,\n    remoteJid: string,\n    debounceTime: number,\n    callback: any,\n  ) {\n    if (userMessageDebounce[remoteJid]) {\n      userMessageDebounce[remoteJid].message += `\\n${content}`;\n      this.logger.log('message debounced: ' + userMessageDebounce[remoteJid].message);\n      clearTimeout(userMessageDebounce[remoteJid].timeoutId);\n    } else {\n      userMessageDebounce[remoteJid] = {\n        message: content,\n        timeoutId: null,\n      };\n    }\n\n    userMessageDebounce[remoteJid].timeoutId = setTimeout(() => {\n      const myQuestion = userMessageDebounce[remoteJid].message;\n      this.logger.log('Debounce complete. Processing message: ' + myQuestion);\n\n      delete userMessageDebounce[remoteJid];\n      callback(myQuestion);\n    }, debounceTime * 1000);\n  }\n\n  public checkIgnoreJids(ignoreJids: any, remoteJid: string) {\n    if (ignoreJids && ignoreJids.length > 0) {\n      let ignoreGroups = false;\n      let ignoreContacts = false;\n\n      if (ignoreJids.includes('@g.us')) {\n        ignoreGroups = true;\n      }\n\n      if (ignoreJids.includes('@s.whatsapp.net')) {\n        ignoreContacts = true;\n      }\n\n      if (ignoreGroups && remoteJid.endsWith('@g.us')) {\n        this.logger.warn('Ignoring message from group: ' + remoteJid);\n        return true;\n      }\n\n      if (ignoreContacts && remoteJid.endsWith('@s.whatsapp.net')) {\n        this.logger.warn('Ignoring message from contact: ' + remoteJid);\n        return true;\n      }\n\n      if (ignoreJids.includes(remoteJid)) {\n        this.logger.warn('Ignoring message from jid: ' + remoteJid);\n        return true;\n      }\n\n      return false;\n    }\n\n    return false;\n  }\n\n  public async getSession(remoteJid: string, instance: InstanceDto) {\n    let session = await this.prismaRepository.integrationSession.findFirst({\n      where: {\n        remoteJid: remoteJid,\n        instanceId: instance.instanceId,\n      },\n      orderBy: { createdAt: 'desc' },\n    });\n\n    if (session) {\n      if (session.status !== 'closed' && !session.botId) {\n        this.logger.warn('Session is already opened in another integration');\n        return null;\n      } else if (!session.botId) {\n        session = null;\n      }\n    }\n\n    return session;\n  }\n\n  public async findBotTrigger(\n    botRepository: any,\n    content: string,\n    instance: InstanceDto,\n    session?: IntegrationSession,\n  ) {\n    let findBot: any = null;\n\n    if (!session) {\n      findBot = await findBotByTrigger(botRepository, content, instance.instanceId);\n\n      if (!findBot) {\n        return null;\n      }\n    } else {\n      findBot = await botRepository.findFirst({\n        where: {\n          id: session.botId,\n        },\n      });\n    }\n\n    return findBot;\n  }\n}\n","import { InstanceDto } from '@api/dto/instance.dto';\nimport { ChatwootDto } from '@api/integrations/chatbot/chatwoot/dto/chatwoot.dto';\nimport { ChatwootService } from '@api/integrations/chatbot/chatwoot/services/chatwoot.service';\nimport { Chatwoot, ConfigService, HttpServer } from '@config/env.config';\nimport { BadRequestException } from '@exceptions';\nimport { isURL } from 'class-validator';\n\nexport class ChatwootController {\n  constructor(\n    private readonly chatwootService: ChatwootService,\n    private readonly configService: ConfigService,\n  ) {}\n\n  public async createChatwoot(instance: InstanceDto, data: ChatwootDto) {\n    if (!this.configService.get<Chatwoot>('CHATWOOT').ENABLED) throw new BadRequestException('Chatwoot is disabled');\n\n    if (data?.enabled) {\n      if (!isURL(data.url, { require_tld: false })) {\n        throw new BadRequestException('url is not valid');\n      }\n\n      if (!data.accountId) {\n        throw new BadRequestException('accountId is required');\n      }\n\n      if (!data.token) {\n        throw new BadRequestException('token is required');\n      }\n\n      if (data.signMsg !== true && data.signMsg !== false) {\n        throw new BadRequestException('signMsg is required');\n      }\n      if (data.signMsg === false) data.signDelimiter = null;\n    }\n\n    if (!data.nameInbox || data.nameInbox === '') {\n      data.nameInbox = instance.instanceName;\n    }\n\n    const result = await this.chatwootService.create(instance, data);\n\n    const urlServer = this.configService.get<HttpServer>('SERVER').URL;\n\n    const response = {\n      ...result,\n      webhook_url: `${urlServer}/chatwoot/webhook/${encodeURIComponent(instance.instanceName)}`,\n    };\n\n    return response;\n  }\n\n  public async findChatwoot(instance: InstanceDto): Promise<ChatwootDto & { webhook_url: string }> {\n    if (!this.configService.get<Chatwoot>('CHATWOOT').ENABLED) throw new BadRequestException('Chatwoot is disabled');\n\n    const result = await this.chatwootService.find(instance);\n\n    const urlServer = this.configService.get<HttpServer>('SERVER').URL;\n\n    if (Object.keys(result || {}).length === 0) {\n      return {\n        enabled: false,\n        url: '',\n        accountId: '',\n        token: '',\n        signMsg: false,\n        nameInbox: '',\n        webhook_url: '',\n      };\n    }\n\n    const response = {\n      ...result,\n      webhook_url: `${urlServer}/chatwoot/webhook/${encodeURIComponent(instance.instanceName)}`,\n    };\n\n    return response;\n  }\n\n  public async receiveWebhook(instance: InstanceDto, data: any) {\n    if (!this.configService.get<Chatwoot>('CHATWOOT').ENABLED) throw new BadRequestException('Chatwoot is disabled');\n\n    return this.chatwootService.receiveWebhook(instance, data);\n  }\n}\n","import { IgnoreJidDto } from '@api/dto/chatbot.dto';\nimport { InstanceDto } from '@api/dto/instance.dto';\nimport { PrismaRepository } from '@api/repository/repository.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { Events } from '@api/types/wa.types';\nimport { Logger } from '@config/logger.config';\nimport { BadRequestException } from '@exceptions';\nimport { TriggerOperator, TriggerType } from '@prisma/client';\nimport { getConversationMessage } from '@utils/getConversationMessage';\n\nimport { BaseChatbotDto } from './base-chatbot.dto';\nimport { ChatbotController, ChatbotControllerInterface, EmitData } from './chatbot.controller';\n\n// Common settings interface for all chatbot integrations\nexport interface ChatbotSettings {\n  expire: number;\n  keywordFinish: string;\n  delayMessage: number;\n  unknownMessage: string;\n  listeningFromMe: boolean;\n  stopBotFromMe: boolean;\n  keepOpen: boolean;\n  debounceTime: number;\n  ignoreJids: string[];\n  splitMessages: boolean;\n  timePerChar: number;\n  [key: string]: any;\n}\n\n// Common bot properties for all chatbot integrations\nexport interface BaseBotData {\n  enabled?: boolean;\n  description: string;\n  expire?: number;\n  keywordFinish?: string;\n  delayMessage?: number;\n  unknownMessage?: string;\n  listeningFromMe?: boolean;\n  stopBotFromMe?: boolean;\n  keepOpen?: boolean;\n  debounceTime?: number;\n  triggerType: string | TriggerType;\n  triggerOperator?: string | TriggerOperator;\n  triggerValue?: string;\n  ignoreJids?: string[];\n  splitMessages?: boolean;\n  timePerChar?: number;\n  [key: string]: any;\n}\n\nexport abstract class BaseChatbotController<BotType = any, BotData extends BaseChatbotDto = BaseChatbotDto>\n  extends ChatbotController\n  implements ChatbotControllerInterface\n{\n  public readonly logger: Logger;\n\n  integrationEnabled: boolean;\n  botRepository: any;\n  settingsRepository: any;\n  sessionRepository: any;\n  userMessageDebounce: { [key: string]: { message: string; timeoutId: NodeJS.Timeout } } = {};\n\n  // Name of the integration, to be set by the derived class\n  protected abstract readonly integrationName: string;\n\n  // Method to process bot-specific logic\n  protected abstract processBot(\n    waInstance: any,\n    remoteJid: string,\n    bot: BotType,\n    session: any,\n    settings: ChatbotSettings,\n    content: string,\n    pushName?: string,\n    msg?: any,\n  ): Promise<void>;\n\n  // Method to get the fallback bot ID from settings\n  protected abstract getFallbackBotId(settings: any): string | undefined;\n\n  constructor(prismaRepository: PrismaRepository, waMonitor: WAMonitoringService) {\n    super(prismaRepository, waMonitor);\n\n    this.sessionRepository = this.prismaRepository.integrationSession;\n  }\n\n  // Base create bot implementation\n  public async createBot(instance: InstanceDto, data: BotData) {\n    if (!this.integrationEnabled) throw new BadRequestException(`${this.integrationName} is disabled`);\n\n    const instanceId = await this.prismaRepository.instance\n      .findFirst({\n        where: {\n          name: instance.instanceName,\n        },\n      })\n      .then((instance) => instance.id);\n\n    // Set default settings if not provided\n    if (\n      !data.expire ||\n      !data.keywordFinish ||\n      !data.delayMessage ||\n      !data.unknownMessage ||\n      !data.listeningFromMe ||\n      !data.stopBotFromMe ||\n      !data.keepOpen ||\n      !data.debounceTime ||\n      !data.ignoreJids ||\n      !data.splitMessages ||\n      !data.timePerChar\n    ) {\n      const defaultSettingCheck = await this.settingsRepository.findFirst({\n        where: {\n          instanceId: instanceId,\n        },\n      });\n\n      if (data.expire === undefined || data.expire === null) data.expire = defaultSettingCheck?.expire;\n      if (data.keywordFinish === undefined || data.keywordFinish === null)\n        data.keywordFinish = defaultSettingCheck?.keywordFinish;\n      if (data.delayMessage === undefined || data.delayMessage === null)\n        data.delayMessage = defaultSettingCheck?.delayMessage;\n      if (data.unknownMessage === undefined || data.unknownMessage === null)\n        data.unknownMessage = defaultSettingCheck?.unknownMessage;\n      if (data.listeningFromMe === undefined || data.listeningFromMe === null)\n        data.listeningFromMe = defaultSettingCheck?.listeningFromMe;\n      if (data.stopBotFromMe === undefined || data.stopBotFromMe === null)\n        data.stopBotFromMe = defaultSettingCheck?.stopBotFromMe;\n      if (data.keepOpen === undefined || data.keepOpen === null) data.keepOpen = defaultSettingCheck?.keepOpen;\n      if (data.debounceTime === undefined || data.debounceTime === null)\n        data.debounceTime = defaultSettingCheck?.debounceTime;\n      if (data.ignoreJids === undefined || data.ignoreJids === null) data.ignoreJids = defaultSettingCheck?.ignoreJids;\n      if (data.splitMessages === undefined || data.splitMessages === null)\n        data.splitMessages = defaultSettingCheck?.splitMessages ?? false;\n      if (data.timePerChar === undefined || data.timePerChar === null)\n        data.timePerChar = defaultSettingCheck?.timePerChar ?? 0;\n\n      if (!defaultSettingCheck) {\n        await this.settings(instance, {\n          expire: data.expire,\n          keywordFinish: data.keywordFinish,\n          delayMessage: data.delayMessage,\n          unknownMessage: data.unknownMessage,\n          listeningFromMe: data.listeningFromMe,\n          stopBotFromMe: data.stopBotFromMe,\n          keepOpen: data.keepOpen,\n          debounceTime: data.debounceTime,\n          ignoreJids: data.ignoreJids,\n          splitMessages: data.splitMessages,\n          timePerChar: data.timePerChar,\n        });\n      }\n    }\n\n    const checkTriggerAll = await this.botRepository.findFirst({\n      where: {\n        enabled: true,\n        triggerType: 'all',\n        instanceId: instanceId,\n      },\n    });\n\n    if (checkTriggerAll && data.triggerType === 'all') {\n      throw new Error(\n        `You already have a ${this.integrationName} with an \"All\" trigger, you cannot have more bots while it is active`,\n      );\n    }\n\n    // Check for trigger keyword duplicates\n    if (data.triggerType === 'keyword') {\n      if (!data.triggerOperator || !data.triggerValue) {\n        throw new Error('Trigger operator and value are required');\n      }\n\n      const checkDuplicate = await this.botRepository.findFirst({\n        where: {\n          triggerOperator: data.triggerOperator,\n          triggerValue: data.triggerValue,\n          instanceId: instanceId,\n        },\n      });\n\n      if (checkDuplicate) {\n        throw new Error('Trigger already exists');\n      }\n    }\n\n    // Check for trigger advanced duplicates\n    if (data.triggerType === 'advanced') {\n      if (!data.triggerValue) {\n        throw new Error('Trigger value is required');\n      }\n\n      const checkDuplicate = await this.botRepository.findFirst({\n        where: {\n          triggerValue: data.triggerValue,\n          instanceId: instanceId,\n        },\n      });\n\n      if (checkDuplicate) {\n        throw new Error('Trigger already exists');\n      }\n    }\n\n    // Derived classes should implement the specific duplicate checking before calling this method\n    // and add bot-specific fields to the data object\n\n    try {\n      const botData = {\n        enabled: data?.enabled,\n        description: data.description,\n        expire: data.expire,\n        keywordFinish: data.keywordFinish,\n        delayMessage: data.delayMessage,\n        unknownMessage: data.unknownMessage,\n        listeningFromMe: data.listeningFromMe,\n        stopBotFromMe: data.stopBotFromMe,\n        keepOpen: data.keepOpen,\n        debounceTime: data.debounceTime,\n        instanceId: instanceId,\n        triggerType: data.triggerType,\n        triggerOperator: data.triggerOperator,\n        triggerValue: data.triggerValue,\n        ignoreJids: data.ignoreJids,\n        splitMessages: data.splitMessages,\n        timePerChar: data.timePerChar,\n        ...this.getAdditionalBotData(data),\n      };\n\n      const bot = await this.botRepository.create({\n        data: botData,\n      });\n\n      return bot;\n    } catch (error) {\n      this.logger.error(error);\n      throw new Error(`Error creating ${this.integrationName}`);\n    }\n  }\n\n  // Additional fields needed for specific bot types\n  protected abstract getAdditionalBotData(data: BotData): Record<string, any>;\n\n  // Common implementation for findBot\n  public async findBot(instance: InstanceDto) {\n    if (!this.integrationEnabled) throw new BadRequestException(`${this.integrationName} is disabled`);\n\n    const instanceId = await this.prismaRepository.instance\n      .findFirst({\n        where: {\n          name: instance.instanceName,\n        },\n      })\n      .then((instance) => instance.id);\n\n    try {\n      const bots = await this.botRepository.findMany({\n        where: {\n          instanceId: instanceId,\n        },\n      });\n\n      return bots;\n    } catch (error) {\n      this.logger.error(error);\n      throw new Error(`Error finding ${this.integrationName}`);\n    }\n  }\n\n  // Common implementation for fetchBot\n  public async fetchBot(instance: InstanceDto, botId: string) {\n    if (!this.integrationEnabled) throw new BadRequestException(`${this.integrationName} is disabled`);\n\n    try {\n      const bot = await this.botRepository.findUnique({\n        where: {\n          id: botId,\n        },\n      });\n\n      if (!bot) {\n        return null;\n      }\n\n      return bot;\n    } catch (error) {\n      this.logger.error(error);\n      throw new Error(`Error fetching ${this.integrationName}`);\n    }\n  }\n\n  // Common implementation for settings\n  public async settings(instance: InstanceDto, data: any) {\n    if (!this.integrationEnabled) throw new BadRequestException(`${this.integrationName} is disabled`);\n\n    try {\n      const instanceId = await this.prismaRepository.instance\n        .findFirst({\n          where: {\n            name: instance.instanceName,\n          },\n        })\n        .then((instance) => instance.id);\n\n      const existingSettings = await this.settingsRepository.findFirst({\n        where: {\n          instanceId: instanceId,\n        },\n      });\n\n      // Get the name of the fallback field for this integration type\n      const fallbackFieldName = this.getFallbackFieldName();\n\n      const settingsData = {\n        expire: data.expire,\n        keywordFinish: data.keywordFinish,\n        delayMessage: data.delayMessage,\n        unknownMessage: data.unknownMessage,\n        listeningFromMe: data.listeningFromMe,\n        stopBotFromMe: data.stopBotFromMe,\n        keepOpen: data.keepOpen,\n        debounceTime: data.debounceTime,\n        ignoreJids: data.ignoreJids,\n        splitMessages: data.splitMessages,\n        timePerChar: data.timePerChar,\n        [fallbackFieldName]: data.fallbackId, // Use the correct field name dynamically\n      };\n\n      if (existingSettings) {\n        const settings = await this.settingsRepository.update({\n          where: {\n            id: existingSettings.id,\n          },\n          data: settingsData,\n        });\n\n        // Map the specific fallback field to a generic 'fallbackId' in the response\n        return {\n          ...settings,\n          fallbackId: settings[fallbackFieldName],\n        };\n      } else {\n        const settings = await this.settingsRepository.create({\n          data: {\n            ...settingsData,\n            Instance: {\n              connect: {\n                id: instanceId,\n              },\n            },\n          },\n        });\n\n        // Map the specific fallback field to a generic 'fallbackId' in the response\n        return {\n          ...settings,\n          fallbackId: settings[fallbackFieldName],\n        };\n      }\n    } catch (error) {\n      this.logger.error(error);\n      throw new Error('Error setting default settings');\n    }\n  }\n\n  // Abstract method to get the field name for the fallback ID\n  protected abstract getFallbackFieldName(): string;\n\n  // Abstract method to get the integration type (dify, n8n, evoai, etc.)\n  protected abstract getIntegrationType(): string;\n\n  // Common implementation for fetchSettings\n  public async fetchSettings(instance: InstanceDto) {\n    if (!this.integrationEnabled) throw new BadRequestException(`${this.integrationName} is disabled`);\n\n    try {\n      const instanceId = await this.prismaRepository.instance\n        .findFirst({\n          where: {\n            name: instance.instanceName,\n          },\n        })\n        .then((instance) => instance.id);\n\n      const settings = await this.settingsRepository.findFirst({\n        where: {\n          instanceId: instanceId,\n        },\n        include: {\n          Fallback: true,\n        },\n      });\n\n      // Get the name of the fallback field for this integration type\n      const fallbackFieldName = this.getFallbackFieldName();\n\n      if (!settings) {\n        return {\n          expire: 300,\n          keywordFinish: 'bye',\n          delayMessage: 1000,\n          unknownMessage: 'Sorry, I dont understand',\n          listeningFromMe: true,\n          stopBotFromMe: true,\n          keepOpen: false,\n          debounceTime: 1,\n          ignoreJids: [],\n          splitMessages: false,\n          timePerChar: 0,\n          fallbackId: '',\n          fallback: null,\n        };\n      }\n\n      // Return with standardized fallbackId field\n      return {\n        ...settings,\n        fallbackId: settings[fallbackFieldName],\n        fallback: settings.Fallback,\n      };\n    } catch (error) {\n      this.logger.error(error);\n      throw new Error('Error fetching settings');\n    }\n  }\n\n  // Common implementation for changeStatus\n  public async changeStatus(instance: InstanceDto, data: any) {\n    if (!this.integrationEnabled) throw new BadRequestException(`${this.integrationName} is disabled`);\n\n    try {\n      const instanceId = await this.prismaRepository.instance\n        .findFirst({\n          where: {\n            name: instance.instanceName,\n          },\n        })\n        .then((instance) => instance.id);\n\n      const defaultSettingCheck = await this.settingsRepository.findFirst({\n        where: {\n          instanceId,\n        },\n      });\n\n      const remoteJid = data.remoteJid;\n      const status = data.status;\n      const session = await this.getSession(remoteJid, instance);\n\n      if (this.integrationName === 'Typebot') {\n        const typebotData = {\n          remoteJid: remoteJid,\n          status: status,\n          session,\n        };\n        this.waMonitor.waInstances[instance.instanceName].sendDataWebhook(Events.TYPEBOT_CHANGE_STATUS, typebotData);\n      }\n\n      if (status === 'delete') {\n        await this.sessionRepository.deleteMany({\n          where: {\n            remoteJid: remoteJid,\n            botId: { not: null },\n          },\n        });\n\n        return { bot: { remoteJid: remoteJid, status: status } };\n      }\n\n      if (status === 'closed') {\n        if (defaultSettingCheck?.keepOpen) {\n          await this.sessionRepository.updateMany({\n            where: {\n              remoteJid: remoteJid,\n              botId: { not: null },\n            },\n            data: {\n              status: 'closed',\n            },\n          });\n        } else {\n          await this.sessionRepository.deleteMany({\n            where: {\n              remoteJid: remoteJid,\n              botId: { not: null },\n            },\n          });\n        }\n\n        return { bot: { ...instance, bot: { remoteJid: remoteJid, status: status } } };\n      } else {\n        const session = await this.sessionRepository.updateMany({\n          where: {\n            instanceId: instanceId,\n            remoteJid: remoteJid,\n            botId: { not: null },\n          },\n          data: {\n            status: status,\n          },\n        });\n\n        const botData = {\n          remoteJid: remoteJid,\n          status: status,\n          session,\n        };\n\n        return { bot: { ...instance, bot: botData } };\n      }\n    } catch (error) {\n      this.logger.error(error);\n      throw new Error(`Error changing ${this.integrationName} status`);\n    }\n  }\n\n  // Common implementation for fetchSessions\n  public async fetchSessions(instance: InstanceDto, botId: string, remoteJid?: string) {\n    if (!this.integrationEnabled) throw new BadRequestException(`${this.integrationName} is disabled`);\n\n    try {\n      const instanceId = await this.prismaRepository.instance\n        .findFirst({\n          where: {\n            name: instance.instanceName,\n          },\n        })\n        .then((instance) => instance.id);\n\n      const bot = await this.botRepository.findFirst({\n        where: {\n          id: botId,\n        },\n      });\n\n      if (bot && bot.instanceId !== instanceId) {\n        throw new Error(`${this.integrationName} not found`);\n      }\n\n      // Get the integration type (dify, n8n, evoai, etc.)\n      const integrationType = this.getIntegrationType();\n\n      return await this.sessionRepository.findMany({\n        where: {\n          instanceId: instanceId,\n          remoteJid,\n          botId: bot ? botId : { not: null },\n          type: integrationType,\n        },\n      });\n    } catch (error) {\n      this.logger.error(error);\n      throw new Error('Error fetching sessions');\n    }\n  }\n\n  // Common implementation for ignoreJid\n  public async ignoreJid(instance: InstanceDto, data: IgnoreJidDto) {\n    if (!this.integrationEnabled) throw new BadRequestException(`${this.integrationName} is disabled`);\n\n    try {\n      const instanceId = await this.prismaRepository.instance\n        .findFirst({\n          where: {\n            name: instance.instanceName,\n          },\n        })\n        .then((instance) => instance.id);\n\n      const settings = await this.settingsRepository.findFirst({\n        where: {\n          instanceId: instanceId,\n        },\n      });\n\n      if (!settings) {\n        throw new Error('Settings not found');\n      }\n\n      let ignoreJids: any = settings?.ignoreJids || [];\n\n      if (data.action === 'add') {\n        if (ignoreJids.includes(data.remoteJid)) return { ignoreJids: ignoreJids };\n\n        ignoreJids.push(data.remoteJid);\n      } else {\n        ignoreJids = ignoreJids.filter((jid) => jid !== data.remoteJid);\n      }\n\n      const updateSettings = await this.settingsRepository.update({\n        where: {\n          id: settings.id,\n        },\n        data: {\n          ignoreJids: ignoreJids,\n        },\n      });\n\n      return {\n        ignoreJids: updateSettings.ignoreJids,\n      };\n    } catch (error) {\n      this.logger.error(error);\n      throw new Error('Error setting default settings');\n    }\n  }\n\n  // Base implementation for updateBot\n  public async updateBot(instance: InstanceDto, botId: string, data: BotData) {\n    if (!this.integrationEnabled) throw new BadRequestException(`${this.integrationName} is disabled`);\n\n    try {\n      const instanceId = await this.prismaRepository.instance\n        .findFirst({\n          where: {\n            name: instance.instanceName,\n          },\n        })\n        .then((instance) => instance.id);\n\n      const bot = await this.botRepository.findFirst({\n        where: {\n          id: botId,\n        },\n      });\n\n      if (!bot) {\n        throw new Error(`${this.integrationName} not found`);\n      }\n\n      if (bot.instanceId !== instanceId) {\n        throw new Error(`${this.integrationName} not found`);\n      }\n\n      // Check for \"all\" trigger type conflicts\n      if (data.triggerType === 'all') {\n        const checkTriggerAll = await this.botRepository.findFirst({\n          where: {\n            enabled: true,\n            triggerType: 'all',\n            id: {\n              not: botId,\n            },\n            instanceId: instanceId,\n          },\n        });\n\n        if (checkTriggerAll) {\n          throw new Error(\n            `You already have a ${this.integrationName} with an \"All\" trigger, you cannot have more bots while it is active`,\n          );\n        }\n      }\n\n      // Let subclasses check for integration-specific duplicates\n      await this.validateNoDuplicatesOnUpdate(botId, instanceId, data);\n\n      // Check for keyword trigger duplicates\n      if (data.triggerType === 'keyword') {\n        if (!data.triggerOperator || !data.triggerValue) {\n          throw new Error('Trigger operator and value are required');\n        }\n\n        const checkDuplicate = await this.botRepository.findFirst({\n          where: {\n            triggerOperator: data.triggerOperator,\n            triggerValue: data.triggerValue,\n            id: { not: botId },\n            instanceId: instanceId,\n          },\n        });\n\n        if (checkDuplicate) {\n          throw new Error('Trigger already exists');\n        }\n      }\n\n      // Check for advanced trigger duplicates\n      if (data.triggerType === 'advanced') {\n        if (!data.triggerValue) {\n          throw new Error('Trigger value is required');\n        }\n\n        const checkDuplicate = await this.botRepository.findFirst({\n          where: {\n            triggerValue: data.triggerValue,\n            id: { not: botId },\n            instanceId: instanceId,\n          },\n        });\n\n        if (checkDuplicate) {\n          throw new Error('Trigger already exists');\n        }\n      }\n\n      // Combine common fields with bot-specific fields\n      const updateData = {\n        enabled: data?.enabled,\n        description: data.description,\n        expire: data.expire,\n        keywordFinish: data.keywordFinish,\n        delayMessage: data.delayMessage,\n        unknownMessage: data.unknownMessage,\n        listeningFromMe: data.listeningFromMe,\n        stopBotFromMe: data.stopBotFromMe,\n        keepOpen: data.keepOpen,\n        debounceTime: data.debounceTime,\n        instanceId: instanceId,\n        triggerType: data.triggerType,\n        triggerOperator: data.triggerOperator,\n        triggerValue: data.triggerValue,\n        ignoreJids: data.ignoreJids,\n        splitMessages: data.splitMessages,\n        timePerChar: data.timePerChar,\n        ...this.getAdditionalUpdateFields(data),\n      };\n\n      const updatedBot = await this.botRepository.update({\n        where: {\n          id: botId,\n        },\n        data: updateData,\n      });\n\n      return updatedBot;\n    } catch (error) {\n      this.logger.error(error);\n      throw new Error(`Error updating ${this.integrationName}`);\n    }\n  }\n\n  // Abstract method for validating bot-specific duplicates on update\n  protected abstract validateNoDuplicatesOnUpdate(botId: string, instanceId: string, data: BotData): Promise<void>;\n\n  // Abstract method for getting additional fields for update\n  protected abstract getAdditionalUpdateFields(data: BotData): Record<string, any>;\n\n  // Base implementation for deleteBot\n  public async deleteBot(instance: InstanceDto, botId: string) {\n    if (!this.integrationEnabled) throw new BadRequestException(`${this.integrationName} is disabled`);\n\n    try {\n      const instanceId = await this.prismaRepository.instance\n        .findFirst({\n          where: {\n            name: instance.instanceName,\n          },\n        })\n        .then((instance) => instance.id);\n\n      const bot = await this.botRepository.findFirst({\n        where: {\n          id: botId,\n        },\n      });\n\n      if (!bot) {\n        throw new Error(`${this.integrationName} not found`);\n      }\n\n      if (bot.instanceId !== instanceId) {\n        throw new Error(`${this.integrationName} not found`);\n      }\n\n      await this.prismaRepository.integrationSession.deleteMany({\n        where: {\n          botId: botId,\n        },\n      });\n\n      await this.botRepository.delete({\n        where: {\n          id: botId,\n        },\n      });\n\n      return { bot: { id: botId } };\n    } catch (error) {\n      this.logger.error(error);\n      throw new Error(`Error deleting ${this.integrationName} bot`);\n    }\n  }\n\n  // Base implementation for emit\n  public async emit({ instance, remoteJid, msg }: EmitData) {\n    if (!this.integrationEnabled) return;\n\n    try {\n      const settings = await this.settingsRepository.findFirst({\n        where: {\n          instanceId: instance.instanceId,\n        },\n      });\n\n      if (this.checkIgnoreJids(settings?.ignoreJids, remoteJid)) return;\n\n      const session = await this.getSession(remoteJid, instance);\n\n      const content = getConversationMessage(msg);\n\n      // Get integration type\n      // const integrationType = this.getIntegrationType();\n\n      // Find a bot for this message\n      let findBot: any = await this.findBotTrigger(this.botRepository, content, instance, session);\n\n      // If no bot is found, try to use fallback\n      if (!findBot) {\n        const fallback = await this.settingsRepository.findFirst({\n          where: {\n            instanceId: instance.instanceId,\n          },\n        });\n\n        // Get the fallback ID for this integration type\n        const fallbackId = this.getFallbackBotId(fallback);\n\n        if (fallbackId) {\n          const findFallback = await this.botRepository.findFirst({\n            where: {\n              id: fallbackId,\n            },\n          });\n\n          findBot = findFallback;\n        } else {\n          return;\n        }\n      }\n\n      // If we still don't have a bot, return\n      if (!findBot) {\n        return;\n      }\n\n      // Collect settings with fallbacks to default settings\n      let expire = findBot.expire;\n      let keywordFinish = findBot.keywordFinish;\n      let delayMessage = findBot.delayMessage;\n      let unknownMessage = findBot.unknownMessage;\n      let listeningFromMe = findBot.listeningFromMe;\n      let stopBotFromMe = findBot.stopBotFromMe;\n      let keepOpen = findBot.keepOpen;\n      let debounceTime = findBot.debounceTime;\n      let ignoreJids = findBot.ignoreJids;\n      let splitMessages = findBot.splitMessages;\n      let timePerChar = findBot.timePerChar;\n\n      if (expire === undefined || expire === null) expire = settings.expire;\n      if (keywordFinish === undefined || keywordFinish === null) keywordFinish = settings.keywordFinish;\n      if (delayMessage === undefined || delayMessage === null) delayMessage = settings.delayMessage;\n      if (unknownMessage === undefined || unknownMessage === null) unknownMessage = settings.unknownMessage;\n      if (listeningFromMe === undefined || listeningFromMe === null) listeningFromMe = settings.listeningFromMe;\n      if (stopBotFromMe === undefined || stopBotFromMe === null) stopBotFromMe = settings.stopBotFromMe;\n      if (keepOpen === undefined || keepOpen === null) keepOpen = settings.keepOpen;\n      if (debounceTime === undefined || debounceTime === null) debounceTime = settings.debounceTime;\n      if (ignoreJids === undefined || ignoreJids === null) ignoreJids = settings.ignoreJids;\n      if (splitMessages === undefined || splitMessages === null) splitMessages = settings?.splitMessages ?? false;\n      if (timePerChar === undefined || timePerChar === null) timePerChar = settings?.timePerChar ?? 0;\n\n      const key = msg.key as {\n        id: string;\n        remoteJid: string;\n        fromMe: boolean;\n        participant: string;\n      };\n\n      // Handle stopping the bot if message is from me\n      if (stopBotFromMe && key.fromMe && session) {\n        await this.prismaRepository.integrationSession.update({\n          where: {\n            id: session.id,\n          },\n          data: {\n            status: 'paused',\n          },\n        });\n\n        if (this.integrationName === 'Typebot') {\n          const typebotData = {\n            remoteJid: remoteJid,\n            status: 'paused',\n            session,\n          };\n          this.waMonitor.waInstances[instance.instanceName].sendDataWebhook(Events.TYPEBOT_CHANGE_STATUS, typebotData);\n        }\n\n        return;\n      }\n\n      // Skip if not listening to messages from me\n      if (!listeningFromMe && key.fromMe) {\n        return;\n      }\n\n      // Skip if session exists but not awaiting user input\n      if (session && session.status === 'closed') {\n        return;\n      }\n\n      // Merged settings\n      const mergedSettings = {\n        ...settings,\n        expire,\n        keywordFinish,\n        delayMessage,\n        unknownMessage,\n        listeningFromMe,\n        stopBotFromMe,\n        keepOpen,\n        debounceTime,\n        ignoreJids,\n        splitMessages,\n        timePerChar,\n      };\n\n      // Process with debounce if needed\n      if (debounceTime && debounceTime > 0) {\n        this.processDebounce(this.userMessageDebounce, content, remoteJid, debounceTime, async (debouncedContent) => {\n          await this.processBot(\n            this.waMonitor.waInstances[instance.instanceName],\n            remoteJid,\n            findBot,\n            session,\n            mergedSettings,\n            debouncedContent,\n            msg?.pushName,\n            msg,\n          );\n        });\n      } else {\n        await this.processBot(\n          this.waMonitor.waInstances[instance.instanceName],\n          remoteJid,\n          findBot,\n          session,\n          mergedSettings,\n          content,\n          msg?.pushName,\n          msg,\n        );\n      }\n    } catch (error) {\n      this.logger.error(error);\n    }\n  }\n}\n","import { InstanceDto } from '@api/dto/instance.dto';\nimport { DifyDto } from '@api/integrations/chatbot/dify/dto/dify.dto';\nimport { DifyService } from '@api/integrations/chatbot/dify/services/dify.service';\nimport { PrismaRepository } from '@api/repository/repository.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { configService, Dify } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\nimport { BadRequestException } from '@exceptions';\nimport { Dify as DifyModel, IntegrationSession } from '@prisma/client';\n\nimport { BaseChatbotController } from '../../base-chatbot.controller';\n\nexport class DifyController extends BaseChatbotController<DifyModel, DifyDto> {\n  constructor(\n    private readonly difyService: DifyService,\n    prismaRepository: PrismaRepository,\n    waMonitor: WAMonitoringService,\n  ) {\n    super(prismaRepository, waMonitor);\n\n    this.botRepository = this.prismaRepository.dify;\n    this.settingsRepository = this.prismaRepository.difySetting;\n    this.sessionRepository = this.prismaRepository.integrationSession;\n  }\n\n  public readonly logger = new Logger('DifyController');\n  protected readonly integrationName = 'Dify';\n\n  integrationEnabled = configService.get<Dify>('DIFY').ENABLED;\n  botRepository: any;\n  settingsRepository: any;\n  sessionRepository: any;\n  userMessageDebounce: { [key: string]: { message: string; timeoutId: NodeJS.Timeout } } = {};\n\n  protected getFallbackBotId(settings: any): string | undefined {\n    return settings?.fallbackId;\n  }\n\n  protected getFallbackFieldName(): string {\n    return 'difyIdFallback';\n  }\n\n  protected getIntegrationType(): string {\n    return 'dify';\n  }\n\n  protected getAdditionalBotData(data: DifyDto): Record<string, any> {\n    return {\n      botType: data.botType,\n      apiUrl: data.apiUrl,\n      apiKey: data.apiKey,\n    };\n  }\n\n  // Implementation for bot-specific updates\n  protected getAdditionalUpdateFields(data: DifyDto): Record<string, any> {\n    return {\n      botType: data.botType,\n      apiUrl: data.apiUrl,\n      apiKey: data.apiKey,\n    };\n  }\n\n  // Implementation for bot-specific duplicate validation on update\n  protected async validateNoDuplicatesOnUpdate(botId: string, instanceId: string, data: DifyDto): Promise<void> {\n    const checkDuplicate = await this.botRepository.findFirst({\n      where: {\n        id: {\n          not: botId,\n        },\n        instanceId: instanceId,\n        botType: data.botType,\n        apiUrl: data.apiUrl,\n        apiKey: data.apiKey,\n      },\n    });\n\n    if (checkDuplicate) {\n      throw new Error('Dify already exists');\n    }\n  }\n\n  // Override createBot to add Dify-specific validation\n  public async createBot(instance: InstanceDto, data: DifyDto) {\n    if (!this.integrationEnabled) throw new BadRequestException('Dify is disabled');\n\n    const instanceId = await this.prismaRepository.instance\n      .findFirst({\n        where: {\n          name: instance.instanceName,\n        },\n      })\n      .then((instance) => instance.id);\n\n    // Dify-specific duplicate check\n    const checkDuplicate = await this.botRepository.findFirst({\n      where: {\n        instanceId: instanceId,\n        botType: data.botType,\n        apiUrl: data.apiUrl,\n        apiKey: data.apiKey,\n      },\n    });\n\n    if (checkDuplicate) {\n      throw new Error('Dify already exists');\n    }\n\n    // Let the base class handle the rest\n    return super.createBot(instance, data);\n  }\n\n  // Process Dify-specific bot logic\n  protected async processBot(\n    instance: any,\n    remoteJid: string,\n    bot: DifyModel,\n    session: IntegrationSession,\n    settings: any,\n    content: string,\n    pushName?: string,\n    msg?: any,\n  ) {\n    await this.difyService.process(instance, remoteJid, bot, session, settings, content, pushName, msg);\n  }\n}\n","import { InstanceDto } from '@api/dto/instance.dto';\nimport { EvoaiDto } from '@api/integrations/chatbot/evoai/dto/evoai.dto';\nimport { EvoaiService } from '@api/integrations/chatbot/evoai/services/evoai.service';\nimport { PrismaRepository } from '@api/repository/repository.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { configService, Evoai } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\nimport { BadRequestException } from '@exceptions';\nimport { Evoai as EvoaiModel, IntegrationSession } from '@prisma/client';\n\nimport { BaseChatbotController } from '../../base-chatbot.controller';\n\nexport class EvoaiController extends BaseChatbotController<EvoaiModel, EvoaiDto> {\n  constructor(\n    private readonly evoaiService: EvoaiService,\n    prismaRepository: PrismaRepository,\n    waMonitor: WAMonitoringService,\n  ) {\n    super(prismaRepository, waMonitor);\n\n    this.botRepository = this.prismaRepository.evoai;\n    this.settingsRepository = this.prismaRepository.evoaiSetting;\n    this.sessionRepository = this.prismaRepository.integrationSession;\n  }\n\n  public readonly logger = new Logger('EvoaiController');\n  protected readonly integrationName = 'Evoai';\n\n  integrationEnabled = configService.get<Evoai>('EVOAI').ENABLED;\n  botRepository: any;\n  settingsRepository: any;\n  sessionRepository: any;\n  userMessageDebounce: { [key: string]: { message: string; timeoutId: NodeJS.Timeout } } = {};\n\n  protected getFallbackBotId(settings: any): string | undefined {\n    return settings?.evoaiIdFallback;\n  }\n\n  protected getFallbackFieldName(): string {\n    return 'evoaiIdFallback';\n  }\n\n  protected getIntegrationType(): string {\n    return 'evoai';\n  }\n\n  protected getAdditionalBotData(data: EvoaiDto): Record<string, any> {\n    return {\n      agentUrl: data.agentUrl,\n      apiKey: data.apiKey,\n    };\n  }\n\n  // Implementation for bot-specific updates\n  protected getAdditionalUpdateFields(data: EvoaiDto): Record<string, any> {\n    return {\n      agentUrl: data.agentUrl,\n      apiKey: data.apiKey,\n    };\n  }\n\n  // Implementation for bot-specific duplicate validation on update\n  protected async validateNoDuplicatesOnUpdate(botId: string, instanceId: string, data: EvoaiDto): Promise<void> {\n    const checkDuplicate = await this.botRepository.findFirst({\n      where: {\n        id: {\n          not: botId,\n        },\n        instanceId: instanceId,\n        agentUrl: data.agentUrl,\n        apiKey: data.apiKey,\n      },\n    });\n\n    if (checkDuplicate) {\n      throw new Error('Evoai already exists');\n    }\n  }\n\n  // Override createBot to add EvoAI-specific validation\n  public async createBot(instance: InstanceDto, data: EvoaiDto) {\n    if (!this.integrationEnabled) throw new BadRequestException('Evoai is disabled');\n\n    const instanceId = await this.prismaRepository.instance\n      .findFirst({\n        where: {\n          name: instance.instanceName,\n        },\n      })\n      .then((instance) => instance.id);\n\n    // EvoAI-specific duplicate check\n    const checkDuplicate = await this.botRepository.findFirst({\n      where: {\n        instanceId: instanceId,\n        agentUrl: data.agentUrl,\n        apiKey: data.apiKey,\n      },\n    });\n\n    if (checkDuplicate) {\n      throw new Error('Evoai already exists');\n    }\n\n    // Let the base class handle the rest\n    return super.createBot(instance, data);\n  }\n\n  // Process Evoai-specific bot logic\n  protected async processBot(\n    instance: any,\n    remoteJid: string,\n    bot: EvoaiModel,\n    session: IntegrationSession,\n    settings: any,\n    content: string,\n    pushName?: string,\n    msg?: any,\n  ) {\n    await this.evoaiService.process(instance, remoteJid, bot, session, settings, content, pushName, msg);\n  }\n}\n","import { PrismaRepository } from '@api/repository/repository.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { Integration } from '@api/types/wa.types';\nimport { ConfigService, HttpServer } from '@config/env.config';\nimport { Evoai, EvoaiSetting, IntegrationSession } from '@prisma/client';\nimport axios from 'axios';\nimport { downloadMediaMessage } from 'baileys';\nimport { isURL } from 'class-validator';\nimport { v4 as uuidv4 } from 'uuid';\n\nimport { BaseChatbotService } from '../../base-chatbot.service';\nimport { OpenaiService } from '../../openai/services/openai.service';\n\nexport class EvoaiService extends BaseChatbotService<Evoai, EvoaiSetting> {\n  private openaiService: OpenaiService;\n\n  constructor(\n    waMonitor: WAMonitoringService,\n    prismaRepository: PrismaRepository,\n    configService: ConfigService,\n    openaiService: OpenaiService,\n  ) {\n    super(waMonitor, prismaRepository, 'EvoaiService', configService);\n    this.openaiService = openaiService;\n  }\n\n  /**\n   * Return the bot type for EvoAI\n   */\n  protected getBotType(): string {\n    return 'evoai';\n  }\n\n  /**\n   * Implement the abstract method to send message to EvoAI API\n   * Handles audio transcription, image processing, and complex JSON-RPC payload\n   */\n  protected async sendMessageToBot(\n    instance: any,\n    session: IntegrationSession,\n    settings: EvoaiSetting,\n    evoai: Evoai,\n    remoteJid: string,\n    pushName: string,\n    content: string,\n    msg?: any,\n  ): Promise<void> {\n    try {\n      this.logger.debug(`[EvoAI] Sending message to bot with content: ${content}`);\n\n      let processedContent = content;\n\n      // Handle audio messages - transcribe using OpenAI Whisper\n      if (this.isAudioMessage(content) && msg) {\n        try {\n          this.logger.debug(`[EvoAI] Downloading audio for Whisper transcription`);\n          const transcription = await this.openaiService.speechToText(msg, instance);\n          if (transcription) {\n            processedContent = `[audio] ${transcription}`;\n          }\n        } catch (err) {\n          this.logger.error(`[EvoAI] Failed to transcribe audio: ${err}`);\n        }\n      }\n\n      const endpoint: string = evoai.agentUrl;\n\n      if (!endpoint) {\n        this.logger.error('No EvoAI endpoint defined');\n        return;\n      }\n\n      const callId = `req-${uuidv4().substring(0, 8)}`;\n      const messageId = remoteJid.split('@')[0] || uuidv4(); // Use phone number as messageId\n\n      // Prepare message parts\n      const parts = [\n        {\n          type: 'text',\n          text: processedContent,\n        },\n      ];\n\n      // Handle image message if present\n      if (this.isImageMessage(content) && msg) {\n        const media = content.split('|');\n        parts[0].text = media[2] || content;\n\n        try {\n          if (msg.message.mediaUrl || msg.message.base64) {\n            let mediaBase64 = msg.message.base64 || null;\n\n            if (msg.message.mediaUrl && isURL(msg.message.mediaUrl)) {\n              const result = await axios.get(msg.message.mediaUrl, { responseType: 'arraybuffer' });\n              mediaBase64 = Buffer.from(result.data).toString('base64');\n            }\n\n            if (mediaBase64) {\n              parts.push({\n                type: 'file',\n                file: {\n                  name: msg.key.id + '.jpeg',\n                  mimeType: 'image/jpeg',\n                  bytes: mediaBase64,\n                },\n              } as any);\n            }\n          } else {\n            // Download the image\n            const mediaBuffer = await downloadMediaMessage(msg, 'buffer', {});\n            const fileContent = Buffer.from(mediaBuffer).toString('base64');\n            const fileName = media[2] || `${msg.key?.id || 'image'}.jpg`;\n\n            parts.push({\n              type: 'file',\n              file: {\n                name: fileName,\n                mimeType: 'image/jpeg',\n                bytes: fileContent,\n              },\n            } as any);\n          }\n        } catch (fileErr) {\n          this.logger.error(`[EvoAI] Failed to process image: ${fileErr}`);\n        }\n      }\n\n      const payload = {\n        jsonrpc: '2.0',\n        id: callId,\n        method: 'message/send',\n        params: {\n          contextId: session.sessionId,\n          message: {\n            role: 'user',\n            parts,\n            messageId: messageId,\n            metadata: {\n              messageKey: msg?.key,\n            },\n          },\n          metadata: {\n            remoteJid: remoteJid,\n            pushName: pushName,\n            fromMe: msg?.key?.fromMe,\n            instanceName: instance.instanceName,\n            serverUrl: this.configService.get<HttpServer>('SERVER').URL,\n            apiKey: instance.token,\n          },\n        },\n      };\n\n      this.logger.debug(`[EvoAI] Sending request to: ${endpoint}`);\n      // Redact base64 file bytes from payload log\n      const redactedPayload = JSON.parse(JSON.stringify(payload));\n      if (redactedPayload?.params?.message?.parts) {\n        redactedPayload.params.message.parts = redactedPayload.params.message.parts.map((part) => {\n          if (part.type === 'file' && part.file && part.file.bytes) {\n            return { ...part, file: { ...part.file, bytes: '[base64 omitted]' } };\n          }\n          return part;\n        });\n      }\n      this.logger.debug(`[EvoAI] Payload: ${JSON.stringify(redactedPayload)}`);\n\n      if (instance.integration === Integration.WHATSAPP_BAILEYS) {\n        await instance.client.presenceSubscribe(remoteJid);\n        await instance.client.sendPresenceUpdate('composing', remoteJid);\n      }\n\n      const response = await axios.post(endpoint, payload, {\n        headers: {\n          'x-api-key': evoai.apiKey,\n          'Content-Type': 'application/json',\n        },\n      });\n\n      this.logger.debug(`[EvoAI] Response: ${JSON.stringify(response.data)}`);\n\n      if (instance.integration === Integration.WHATSAPP_BAILEYS)\n        await instance.client.sendPresenceUpdate('paused', remoteJid);\n\n      let message = undefined;\n      const result = response?.data?.result;\n\n      // Extract message from artifacts array\n      if (result?.artifacts && Array.isArray(result.artifacts) && result.artifacts.length > 0) {\n        const artifact = result.artifacts[0];\n        if (artifact?.parts && Array.isArray(artifact.parts)) {\n          const textPart = artifact.parts.find((p) => p.type === 'text' && p.text);\n          if (textPart) message = textPart.text;\n        }\n      }\n\n      this.logger.debug(`[EvoAI] Extracted message to send: ${message}`);\n\n      if (message) {\n        await this.sendMessageWhatsApp(instance, remoteJid, message, settings, true);\n      }\n    } catch (error) {\n      this.logger.error(\n        `[EvoAI] Error sending message: ${error?.response?.data ? JSON.stringify(error.response.data) : error}`,\n      );\n      return;\n    }\n  }\n}\n","import { PrismaRepository } from '@api/repository/repository.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { Logger } from '@config/logger.config';\nimport { EvolutionBot, IntegrationSession } from '@prisma/client';\n\nimport { BaseChatbotController } from '../../base-chatbot.controller';\nimport { EvolutionBotDto } from '../dto/evolutionBot.dto';\nimport { EvolutionBotService } from '../services/evolutionBot.service';\n\nexport class EvolutionBotController extends BaseChatbotController<EvolutionBot, EvolutionBotDto> {\n  constructor(\n    private readonly evolutionBotService: EvolutionBotService,\n    prismaRepository: PrismaRepository,\n    waMonitor: WAMonitoringService,\n  ) {\n    super(prismaRepository, waMonitor);\n\n    this.botRepository = this.prismaRepository.evolutionBot;\n    this.settingsRepository = this.prismaRepository.evolutionBotSetting;\n    this.sessionRepository = this.prismaRepository.integrationSession;\n  }\n\n  public readonly logger = new Logger('EvolutionBotController');\n  protected readonly integrationName = 'EvolutionBot';\n\n  integrationEnabled = true; // Set to true by default or use config value if available\n  botRepository: any;\n  settingsRepository: any;\n  sessionRepository: any;\n  userMessageDebounce: { [key: string]: { message: string; timeoutId: NodeJS.Timeout } } = {};\n\n  // Implementation of abstract methods required by BaseChatbotController\n\n  protected getFallbackBotId(settings: any): string | undefined {\n    return settings?.botIdFallback;\n  }\n\n  protected getFallbackFieldName(): string {\n    return 'botIdFallback';\n  }\n\n  protected getIntegrationType(): string {\n    return 'evolution';\n  }\n\n  protected getAdditionalBotData(data: EvolutionBotDto): Record<string, any> {\n    return {\n      apiUrl: data.apiUrl,\n      apiKey: data.apiKey,\n    };\n  }\n\n  // Implementation for bot-specific updates\n  protected getAdditionalUpdateFields(data: EvolutionBotDto): Record<string, any> {\n    return {\n      apiUrl: data.apiUrl,\n      apiKey: data.apiKey,\n    };\n  }\n\n  // Implementation for bot-specific duplicate validation on update\n  protected async validateNoDuplicatesOnUpdate(\n    botId: string,\n    instanceId: string,\n    data: EvolutionBotDto,\n  ): Promise<void> {\n    const checkDuplicate = await this.botRepository.findFirst({\n      where: {\n        id: {\n          not: botId,\n        },\n        instanceId: instanceId,\n        apiUrl: data.apiUrl,\n        apiKey: data.apiKey,\n      },\n    });\n\n    if (checkDuplicate) {\n      throw new Error('Evolution Bot already exists');\n    }\n  }\n\n  // Process bot-specific logic\n  protected async processBot(\n    instance: any,\n    remoteJid: string,\n    bot: EvolutionBot,\n    session: IntegrationSession,\n    settings: any,\n    content: string,\n    pushName?: string,\n    msg?: any,\n  ) {\n    await this.evolutionBotService.process(instance, remoteJid, bot, session, settings, content, pushName, msg);\n  }\n}\n","/* eslint-disable @typescript-eslint/no-unused-vars */\nimport { PrismaRepository } from '@api/repository/repository.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { Integration } from '@api/types/wa.types';\nimport { ConfigService, HttpServer } from '@config/env.config';\nimport { EvolutionBot, EvolutionBotSetting, IntegrationSession } from '@prisma/client';\nimport { sendTelemetry } from '@utils/sendTelemetry';\nimport axios from 'axios';\nimport { isURL } from 'class-validator';\n\nimport { BaseChatbotService } from '../../base-chatbot.service';\nimport { OpenaiService } from '../../openai/services/openai.service';\n\nexport class EvolutionBotService extends BaseChatbotService<EvolutionBot, EvolutionBotSetting> {\n  private openaiService: OpenaiService;\n\n  constructor(\n    waMonitor: WAMonitoringService,\n    prismaRepository: PrismaRepository,\n    configService: ConfigService,\n    openaiService: OpenaiService,\n  ) {\n    super(waMonitor, prismaRepository, 'EvolutionBotService', configService);\n    this.openaiService = openaiService;\n  }\n\n  /**\n   * Get the bot type identifier\n   */\n  protected getBotType(): string {\n    return 'evolution';\n  }\n\n  /**\n   * Send a message to the Evolution Bot API\n   */\n  protected async sendMessageToBot(\n    instance: any,\n    session: IntegrationSession,\n    settings: EvolutionBotSetting,\n    bot: EvolutionBot,\n    remoteJid: string,\n    pushName: string,\n    content: string,\n    msg?: any,\n  ): Promise<void> {\n    try {\n      const payload: any = {\n        inputs: {\n          sessionId: session.id,\n          remoteJid: remoteJid,\n          pushName: pushName,\n          fromMe: msg?.key?.fromMe,\n          instanceName: instance.instanceName,\n          serverUrl: this.configService.get<HttpServer>('SERVER').URL,\n          apiKey: instance.token,\n        },\n        query: content,\n        conversation_id: session.sessionId === remoteJid ? undefined : session.sessionId,\n        user: remoteJid,\n      };\n\n      if (this.isAudioMessage(content) && msg) {\n        try {\n          this.logger.debug(`[EvolutionBot] Downloading audio for Whisper transcription`);\n          const transcription = await this.openaiService.speechToText(msg, instance);\n          if (transcription) {\n            payload.query = `[audio] ${transcription}`;\n          }\n        } catch (err) {\n          this.logger.error(`[EvolutionBot] Failed to transcribe audio: ${err}`);\n        }\n      }\n\n      if (this.isImageMessage(content) && msg) {\n        const media = content.split('|');\n\n        if (msg.message.mediaUrl || msg.message.base64) {\n          payload.files = [\n            {\n              type: 'image',\n              url: msg.message.base64 || msg.message.mediaUrl,\n            },\n          ];\n        } else {\n          payload.files = [\n            {\n              type: 'image',\n              url: media[1].split('?')[0],\n            },\n          ];\n        }\n\n        payload.query = media[2] || content;\n      }\n\n      if (instance.integration === Integration.WHATSAPP_BAILEYS) {\n        await instance.client.presenceSubscribe(remoteJid);\n        await instance.client.sendPresenceUpdate('composing', remoteJid);\n      }\n\n      const endpoint = bot.apiUrl;\n\n      if (!endpoint) {\n        this.logger.error('No Evolution Bot endpoint defined');\n        return;\n      }\n\n      let headers: any = {\n        'Content-Type': 'application/json',\n      };\n\n      if (bot.apiKey) {\n        headers = {\n          ...headers,\n          Authorization: `Bearer ${bot.apiKey}`,\n        };\n      }\n\n      // Sanitize payload for logging (remove sensitive data)\n      const sanitizedPayload = {\n        ...payload,\n        inputs: {\n          ...payload.inputs,\n          apiKey: payload.inputs.apiKey ? '[REDACTED]' : undefined,\n        },\n      };\n\n      const response = await axios.post(endpoint, payload, {\n        headers,\n      });\n\n      if (instance.integration === Integration.WHATSAPP_BAILEYS) {\n        await instance.client.sendPresenceUpdate('paused', remoteJid);\n      }\n\n      let message = response?.data?.message;\n      const rawLinkPreview = response?.data?.linkPreview;\n\n      // Validate linkPreview is boolean and default to true for backward compatibility\n      const linkPreview = typeof rawLinkPreview === 'boolean' ? rawLinkPreview : true;\n\n      if (message && typeof message === 'string' && message.startsWith(\"'\") && message.endsWith(\"'\")) {\n        const innerContent = message.slice(1, -1);\n        if (!innerContent.includes(\"'\")) {\n          message = innerContent;\n        }\n      }\n\n      if (message) {\n        // Use the base class method that handles splitMessages functionality\n        await this.sendMessageWhatsApp(instance, remoteJid, message, settings, linkPreview);\n      } else {\n        this.logger.warn(`[EvolutionBot] No message content received from bot response`);\n      }\n\n      // Send telemetry\n      sendTelemetry('/message/sendText');\n    } catch (error) {\n      this.logger.error(`Error in sendMessageToBot: ${error.message || JSON.stringify(error)}`);\n      return;\n    }\n  }\n}\n","import { InstanceDto } from '@api/dto/instance.dto';\nimport { PrismaRepository } from '@api/repository/repository.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { configService, Flowise } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\nimport { BadRequestException } from '@exceptions';\nimport { Flowise as FlowiseModel, IntegrationSession } from '@prisma/client';\n\nimport { BaseChatbotController } from '../../base-chatbot.controller';\nimport { FlowiseDto } from '../dto/flowise.dto';\nimport { FlowiseService } from '../services/flowise.service';\n\nexport class FlowiseController extends BaseChatbotController<FlowiseModel, FlowiseDto> {\n  constructor(\n    private readonly flowiseService: FlowiseService,\n    prismaRepository: PrismaRepository,\n    waMonitor: WAMonitoringService,\n  ) {\n    super(prismaRepository, waMonitor);\n\n    this.botRepository = this.prismaRepository.flowise;\n    this.settingsRepository = this.prismaRepository.flowiseSetting;\n    this.sessionRepository = this.prismaRepository.integrationSession;\n  }\n\n  public readonly logger = new Logger('FlowiseController');\n  protected readonly integrationName = 'Flowise';\n\n  integrationEnabled = configService.get<Flowise>('FLOWISE').ENABLED;\n  botRepository: any;\n  settingsRepository: any;\n  sessionRepository: any;\n  userMessageDebounce: { [key: string]: { message: string; timeoutId: NodeJS.Timeout } } = {};\n\n  protected getFallbackBotId(settings: any): string | undefined {\n    return settings?.flowiseIdFallback;\n  }\n\n  protected getFallbackFieldName(): string {\n    return 'flowiseIdFallback';\n  }\n\n  protected getIntegrationType(): string {\n    return 'flowise';\n  }\n\n  protected getAdditionalBotData(data: FlowiseDto): Record<string, any> {\n    return {\n      apiUrl: data.apiUrl,\n      apiKey: data.apiKey,\n    };\n  }\n\n  protected getAdditionalUpdateFields(data: FlowiseDto): Record<string, any> {\n    return {\n      apiUrl: data.apiUrl,\n      apiKey: data.apiKey,\n    };\n  }\n\n  protected async validateNoDuplicatesOnUpdate(botId: string, instanceId: string, data: FlowiseDto): Promise<void> {\n    const checkDuplicate = await this.botRepository.findFirst({\n      where: {\n        id: { not: botId },\n        instanceId: instanceId,\n        apiUrl: data.apiUrl,\n        apiKey: data.apiKey,\n      },\n    });\n\n    if (checkDuplicate) {\n      throw new Error('Flowise already exists');\n    }\n  }\n\n  // Process Flowise-specific bot logic\n  protected async processBot(\n    instance: any,\n    remoteJid: string,\n    bot: FlowiseModel,\n    session: IntegrationSession,\n    settings: any,\n    content: string,\n    pushName?: string,\n    msg?: any,\n  ) {\n    await this.flowiseService.processBot(instance, remoteJid, bot, session, settings, content, pushName, msg);\n  }\n\n  // Override createBot to add module availability check and Flowise-specific validation\n  public async createBot(instance: InstanceDto, data: FlowiseDto) {\n    if (!this.integrationEnabled) throw new BadRequestException('Flowise is disabled');\n\n    const instanceId = await this.prismaRepository.instance\n      .findFirst({\n        where: {\n          name: instance.instanceName,\n        },\n      })\n      .then((instance) => instance.id);\n\n    // Flowise-specific duplicate check\n    const checkDuplicate = await this.botRepository.findFirst({\n      where: {\n        instanceId: instanceId,\n        apiUrl: data.apiUrl,\n        apiKey: data.apiKey,\n      },\n    });\n\n    if (checkDuplicate) {\n      throw new Error('Flowise already exists');\n    }\n\n    // Let the base class handle the rest\n    return super.createBot(instance, data);\n  }\n}\n","/* eslint-disable @typescript-eslint/no-unused-vars */\nimport { PrismaRepository } from '@api/repository/repository.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { Integration } from '@api/types/wa.types';\nimport { ConfigService, HttpServer } from '@config/env.config';\nimport { Flowise as FlowiseModel, IntegrationSession } from '@prisma/client';\nimport axios from 'axios';\nimport { isURL } from 'class-validator';\n\nimport { BaseChatbotService } from '../../base-chatbot.service';\nimport { OpenaiService } from '../../openai/services/openai.service';\n\nexport class FlowiseService extends BaseChatbotService<FlowiseModel> {\n  private openaiService: OpenaiService;\n\n  constructor(\n    waMonitor: WAMonitoringService,\n    prismaRepository: PrismaRepository,\n    configService: ConfigService,\n    openaiService: OpenaiService,\n  ) {\n    super(waMonitor, prismaRepository, 'FlowiseService', configService);\n    this.openaiService = openaiService;\n  }\n\n  // Return the bot type for Flowise\n  protected getBotType(): string {\n    return 'flowise';\n  }\n\n  // Process Flowise-specific bot logic\n  public async processBot(\n    instance: any,\n    remoteJid: string,\n    bot: FlowiseModel,\n    session: IntegrationSession,\n    settings: any,\n    content: string,\n    pushName?: string,\n    msg?: any,\n  ) {\n    await this.process(instance, remoteJid, bot, session, settings, content, pushName, msg);\n  }\n\n  // Implement the abstract method to send message to Flowise API\n  protected async sendMessageToBot(\n    instance: any,\n    session: IntegrationSession,\n    settings: any,\n    bot: FlowiseModel,\n    remoteJid: string,\n    pushName: string,\n    content: string,\n    msg?: any,\n  ): Promise<void> {\n    const payload: any = {\n      question: content,\n      overrideConfig: {\n        sessionId: remoteJid,\n        vars: {\n          messageId: msg?.key?.id,\n          fromMe: msg?.key?.fromMe,\n          remoteJid: remoteJid,\n          pushName: pushName,\n          instanceName: instance.instanceName,\n          serverUrl: this.configService.get<HttpServer>('SERVER').URL,\n          apiKey: instance.token,\n        },\n      },\n    };\n\n    // Handle audio messages\n    if (this.isAudioMessage(content) && msg) {\n      try {\n        this.logger.debug(`[Flowise] Downloading audio for Whisper transcription`);\n        const transcription = await this.openaiService.speechToText(msg, instance);\n        if (transcription) {\n          payload.question = `[audio] ${transcription}`;\n        }\n      } catch (err) {\n        this.logger.error(`[Flowise] Failed to transcribe audio: ${err}`);\n      }\n    }\n\n    if (this.isImageMessage(content)) {\n      const media = content.split('|');\n\n      if (msg.message.mediaUrl || msg.message.base64) {\n        payload.uploads = [\n          {\n            data: msg.message.base64 || msg.message.mediaUrl,\n            type: 'url',\n            name: 'Flowise.png',\n            mime: 'image/png',\n          },\n        ];\n      } else {\n        payload.uploads = [\n          {\n            data: media[1].split('?')[0],\n            type: 'url',\n            name: 'Flowise.png',\n            mime: 'image/png',\n          },\n        ];\n        payload.question = media[2] || content;\n      }\n    }\n\n    if (instance.integration === Integration.WHATSAPP_BAILEYS) {\n      await instance.client.presenceSubscribe(remoteJid);\n      await instance.client.sendPresenceUpdate('composing', remoteJid);\n    }\n\n    let headers: any = {\n      'Content-Type': 'application/json',\n    };\n\n    if (bot.apiKey) {\n      headers = {\n        ...headers,\n        Authorization: `Bearer ${bot.apiKey}`,\n      };\n    }\n\n    const endpoint = bot.apiUrl;\n\n    if (!endpoint) {\n      this.logger.error('No Flowise endpoint defined');\n      return;\n    }\n\n    const response = await axios.post(endpoint, payload, {\n      headers,\n    });\n\n    if (instance.integration === Integration.WHATSAPP_BAILEYS) {\n      await instance.client.sendPresenceUpdate('paused', remoteJid);\n    }\n\n    const message = response?.data?.text;\n\n    if (message) {\n      // Use the base class method to send the message to WhatsApp\n      await this.sendMessageWhatsApp(instance, remoteJid, message, settings, true);\n    }\n  }\n\n  // The service is now complete with just the abstract method implementations\n}\n","import { InstanceDto } from '@api/dto/instance.dto';\nimport { N8nDto } from '@api/integrations/chatbot/n8n/dto/n8n.dto';\nimport { N8nService } from '@api/integrations/chatbot/n8n/services/n8n.service';\nimport { PrismaRepository } from '@api/repository/repository.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { configService } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\nimport { BadRequestException } from '@exceptions';\nimport { IntegrationSession, N8n as N8nModel } from '@prisma/client';\n\nimport { BaseChatbotController } from '../../base-chatbot.controller';\n\nexport class N8nController extends BaseChatbotController<N8nModel, N8nDto> {\n  constructor(\n    private readonly n8nService: N8nService,\n    prismaRepository: PrismaRepository,\n    waMonitor: WAMonitoringService,\n  ) {\n    super(prismaRepository, waMonitor);\n\n    this.botRepository = this.prismaRepository.n8n;\n    this.settingsRepository = this.prismaRepository.n8nSetting;\n    this.sessionRepository = this.prismaRepository.integrationSession;\n  }\n\n  public readonly logger = new Logger('N8nController');\n  protected readonly integrationName = 'N8n';\n\n  integrationEnabled = configService.get('N8N').ENABLED;\n  botRepository: any;\n  settingsRepository: any;\n  sessionRepository: any;\n  userMessageDebounce: { [key: string]: { message: string; timeoutId: NodeJS.Timeout } } = {};\n\n  protected getFallbackBotId(settings: any): string | undefined {\n    return settings?.fallbackId;\n  }\n\n  protected getFallbackFieldName(): string {\n    return 'n8nIdFallback';\n  }\n\n  protected getIntegrationType(): string {\n    return 'n8n';\n  }\n\n  protected getAdditionalBotData(data: N8nDto): Record<string, any> {\n    return {\n      webhookUrl: data.webhookUrl,\n      basicAuthUser: data.basicAuthUser,\n      basicAuthPass: data.basicAuthPass,\n    };\n  }\n\n  // Implementation for bot-specific updates\n  protected getAdditionalUpdateFields(data: N8nDto): Record<string, any> {\n    return {\n      webhookUrl: data.webhookUrl,\n      basicAuthUser: data.basicAuthUser,\n      basicAuthPass: data.basicAuthPass,\n    };\n  }\n\n  // Implementation for bot-specific duplicate validation on update\n  protected async validateNoDuplicatesOnUpdate(botId: string, instanceId: string, data: N8nDto): Promise<void> {\n    const checkDuplicate = await this.botRepository.findFirst({\n      where: {\n        id: {\n          not: botId,\n        },\n        instanceId: instanceId,\n        webhookUrl: data.webhookUrl,\n        basicAuthUser: data.basicAuthUser,\n        basicAuthPass: data.basicAuthPass,\n      },\n    });\n\n    if (checkDuplicate) {\n      throw new Error('N8n already exists');\n    }\n  }\n\n  // Bots\n  public async createBot(instance: InstanceDto, data: N8nDto) {\n    if (!this.integrationEnabled) throw new BadRequestException('N8n is disabled');\n\n    const instanceId = await this.prismaRepository.instance\n      .findFirst({\n        where: {\n          name: instance.instanceName,\n        },\n      })\n      .then((instance) => instance.id);\n\n    // Check for N8n-specific duplicate\n    const checkDuplicate = await this.botRepository.findFirst({\n      where: {\n        instanceId: instanceId,\n        webhookUrl: data.webhookUrl,\n        basicAuthUser: data.basicAuthUser,\n        basicAuthPass: data.basicAuthPass,\n      },\n    });\n\n    if (checkDuplicate) {\n      throw new Error('N8n already exists');\n    }\n\n    // Let the base class handle the rest of the bot creation process\n    return super.createBot(instance, data);\n  }\n\n  // Process N8n-specific bot logic\n  protected async processBot(\n    instance: any,\n    remoteJid: string,\n    bot: N8nModel,\n    session: IntegrationSession,\n    settings: any,\n    content: string,\n    pushName?: string,\n    msg?: any,\n  ) {\n    // Use the base class pattern instead of calling n8nService.process directly\n    await this.n8nService.process(instance, remoteJid, bot, session, settings, content, pushName, msg);\n  }\n}\n","import { PrismaRepository } from '@api/repository/repository.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { ConfigService, HttpServer } from '@config/env.config';\nimport { IntegrationSession, N8n, N8nSetting } from '@prisma/client';\nimport axios from 'axios';\n\nimport { BaseChatbotService } from '../../base-chatbot.service';\nimport { OpenaiService } from '../../openai/services/openai.service';\n\nexport class N8nService extends BaseChatbotService<N8n, N8nSetting> {\n  private openaiService: OpenaiService;\n\n  constructor(\n    waMonitor: WAMonitoringService,\n    prismaRepository: PrismaRepository,\n    configService: ConfigService,\n    openaiService: OpenaiService,\n  ) {\n    super(waMonitor, prismaRepository, 'N8nService', configService);\n    this.openaiService = openaiService;\n  }\n\n  /**\n   * Return the bot type for N8n\n   */\n  protected getBotType(): string {\n    return 'n8n';\n  }\n\n  protected async sendMessageToBot(\n    instance: any,\n    session: IntegrationSession,\n    settings: N8nSetting,\n    n8n: N8n,\n    remoteJid: string,\n    pushName: string,\n    content: string,\n    msg?: any,\n  ) {\n    try {\n      if (!session) {\n        this.logger.error('Session is null in sendMessageToBot');\n        return;\n      }\n\n      const endpoint: string = n8n.webhookUrl;\n      const payload: any = {\n        chatInput: content,\n        sessionId: session.sessionId,\n        remoteJid: remoteJid,\n        pushName: pushName,\n        keyId: msg?.key?.id,\n        fromMe: msg?.key?.fromMe,\n        quotedMessage: msg?.contextInfo?.quotedMessage,\n        instanceName: instance.instanceName,\n        serverUrl: this.configService.get<HttpServer>('SERVER').URL,\n        apiKey: instance.token,\n      };\n\n      // Handle audio messages\n      if (this.isAudioMessage(content) && msg) {\n        try {\n          this.logger.debug(`[N8n] Downloading audio for Whisper transcription`);\n          const transcription = await this.openaiService.speechToText(msg, instance);\n          if (transcription) {\n            payload.chatInput = `[audio] ${transcription}`;\n          }\n        } catch (err) {\n          this.logger.error(`[N8n] Failed to transcribe audio: ${err}`);\n        }\n      }\n\n      const headers: Record<string, string> = {};\n      if (n8n.basicAuthUser && n8n.basicAuthPass) {\n        const auth = Buffer.from(`${n8n.basicAuthUser}:${n8n.basicAuthPass}`).toString('base64');\n        headers['Authorization'] = `Basic ${auth}`;\n      }\n      const response = await axios.post(endpoint, payload, { headers });\n      const message = response?.data?.output || response?.data?.answer;\n\n      // Use base class method instead of custom implementation\n      await this.sendMessageWhatsApp(instance, remoteJid, message, settings, true);\n\n      await this.prismaRepository.integrationSession.update({\n        where: {\n          id: session.id,\n        },\n        data: {\n          status: 'opened',\n          awaitUser: true,\n        },\n      });\n    } catch (error) {\n      this.logger.error(error.response?.data || error);\n      return;\n    }\n  }\n}\n","import { InstanceDto } from '@api/dto/instance.dto';\nimport { OpenaiCredsDto, OpenaiDto } from '@api/integrations/chatbot/openai/dto/openai.dto';\nimport { OpenaiService } from '@api/integrations/chatbot/openai/services/openai.service';\nimport { PrismaRepository } from '@api/repository/repository.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { configService, Openai } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\nimport { BadRequestException } from '@exceptions';\nimport { IntegrationSession, OpenaiBot } from '@prisma/client';\nimport OpenAI from 'openai';\n\nimport { BaseChatbotController } from '../../base-chatbot.controller';\n\nexport class OpenaiController extends BaseChatbotController<OpenaiBot, OpenaiDto> {\n  constructor(\n    private readonly openaiService: OpenaiService,\n    prismaRepository: PrismaRepository,\n    waMonitor: WAMonitoringService,\n  ) {\n    super(prismaRepository, waMonitor);\n\n    this.botRepository = this.prismaRepository.openaiBot;\n    this.settingsRepository = this.prismaRepository.openaiSetting;\n    this.sessionRepository = this.prismaRepository.integrationSession;\n    this.credsRepository = this.prismaRepository.openaiCreds;\n  }\n\n  public readonly logger = new Logger('OpenaiController');\n  protected readonly integrationName = 'Openai';\n\n  integrationEnabled = configService.get<Openai>('OPENAI').ENABLED;\n  botRepository: any;\n  settingsRepository: any;\n  sessionRepository: any;\n  userMessageDebounce: { [key: string]: { message: string; timeoutId: NodeJS.Timeout } } = {};\n  private client: OpenAI;\n  private credsRepository: any;\n\n  protected getFallbackBotId(settings: any): string | undefined {\n    return settings?.openaiIdFallback;\n  }\n\n  protected getFallbackFieldName(): string {\n    return 'openaiIdFallback';\n  }\n\n  protected getIntegrationType(): string {\n    return 'openai';\n  }\n\n  protected getAdditionalBotData(data: OpenaiDto): Record<string, any> {\n    return {\n      openaiCredsId: data.openaiCredsId,\n      botType: data.botType,\n      assistantId: data.assistantId,\n      functionUrl: data.functionUrl,\n      model: data.model,\n      systemMessages: data.systemMessages,\n      assistantMessages: data.assistantMessages,\n      userMessages: data.userMessages,\n      maxTokens: data.maxTokens,\n    };\n  }\n\n  // Implementation for bot-specific updates\n  protected getAdditionalUpdateFields(data: OpenaiDto): Record<string, any> {\n    return {\n      openaiCredsId: data.openaiCredsId,\n      botType: data.botType,\n      assistantId: data.assistantId,\n      functionUrl: data.functionUrl,\n      model: data.model,\n      systemMessages: data.systemMessages,\n      assistantMessages: data.assistantMessages,\n      userMessages: data.userMessages,\n      maxTokens: data.maxTokens,\n    };\n  }\n\n  // Implementation for bot-specific duplicate validation on update\n  protected async validateNoDuplicatesOnUpdate(botId: string, instanceId: string, data: OpenaiDto): Promise<void> {\n    let whereDuplication: any = {\n      id: {\n        not: botId,\n      },\n      instanceId: instanceId,\n    };\n\n    if (data.botType === 'assistant') {\n      if (!data.assistantId) throw new Error('Assistant ID is required');\n\n      whereDuplication = {\n        ...whereDuplication,\n        assistantId: data.assistantId,\n        botType: data.botType,\n      };\n    } else if (data.botType === 'chatCompletion') {\n      if (!data.model) throw new Error('Model is required');\n      if (!data.maxTokens) throw new Error('Max tokens is required');\n\n      whereDuplication = {\n        ...whereDuplication,\n        model: data.model,\n        maxTokens: data.maxTokens,\n        botType: data.botType,\n      };\n    } else {\n      throw new Error('Bot type is required');\n    }\n\n    const checkDuplicate = await this.botRepository.findFirst({\n      where: whereDuplication,\n    });\n\n    if (checkDuplicate) {\n      throw new Error('OpenAI Bot already exists');\n    }\n  }\n\n  // Override createBot to handle OpenAI-specific credential logic\n  public async createBot(instance: InstanceDto, data: OpenaiDto) {\n    if (!this.integrationEnabled) throw new BadRequestException('Openai is disabled');\n\n    const instanceId = await this.prismaRepository.instance\n      .findFirst({\n        where: {\n          name: instance.instanceName,\n        },\n      })\n      .then((instance) => instance.id);\n\n    // OpenAI specific validation\n    let whereDuplication: any = {\n      instanceId: instanceId,\n    };\n\n    if (data.botType === 'assistant') {\n      if (!data.assistantId) throw new Error('Assistant ID is required');\n\n      whereDuplication = {\n        ...whereDuplication,\n        assistantId: data.assistantId,\n        botType: data.botType,\n      };\n    } else if (data.botType === 'chatCompletion') {\n      if (!data.model) throw new Error('Model is required');\n      if (!data.maxTokens) throw new Error('Max tokens is required');\n\n      whereDuplication = {\n        ...whereDuplication,\n        model: data.model,\n        maxTokens: data.maxTokens,\n        botType: data.botType,\n      };\n    } else {\n      throw new Error('Bot type is required');\n    }\n\n    const checkDuplicate = await this.botRepository.findFirst({\n      where: whereDuplication,\n    });\n\n    if (checkDuplicate) {\n      throw new Error('Openai Bot already exists');\n    }\n\n    // Check if settings exist and create them if not\n    const existingSettings = await this.settingsRepository.findFirst({\n      where: {\n        instanceId: instanceId,\n      },\n    });\n\n    if (!existingSettings) {\n      // Create default settings with the OpenAI credentials\n      await this.settings(instance, {\n        openaiCredsId: data.openaiCredsId,\n        expire: data.expire || 300,\n        keywordFinish: data.keywordFinish || 'bye',\n        delayMessage: data.delayMessage || 1000,\n        unknownMessage: data.unknownMessage || 'Sorry, I dont understand',\n        listeningFromMe: data.listeningFromMe !== undefined ? data.listeningFromMe : true,\n        stopBotFromMe: data.stopBotFromMe !== undefined ? data.stopBotFromMe : true,\n        keepOpen: data.keepOpen !== undefined ? data.keepOpen : false,\n        debounceTime: data.debounceTime || 1,\n        ignoreJids: data.ignoreJids || [],\n        speechToText: false,\n      });\n    } else if (!existingSettings.openaiCredsId && data.openaiCredsId) {\n      // Update settings with OpenAI credentials if they're missing\n      await this.settingsRepository.update({\n        where: {\n          id: existingSettings.id,\n        },\n        data: {\n          OpenaiCreds: {\n            connect: {\n              id: data.openaiCredsId,\n            },\n          },\n        },\n      });\n    }\n\n    // Let the base class handle the rest of the bot creation process\n    return super.createBot(instance, data);\n  }\n\n  // Process OpenAI-specific bot logic\n  protected async processBot(\n    instance: any,\n    remoteJid: string,\n    bot: OpenaiBot,\n    session: IntegrationSession,\n    settings: any,\n    content: string,\n    pushName?: string,\n    msg?: any,\n  ) {\n    await this.openaiService.process(instance, remoteJid, bot, session, settings, content, pushName, msg);\n  }\n\n  // Credentials - OpenAI specific functionality\n  public async createOpenaiCreds(instance: InstanceDto, data: OpenaiCredsDto) {\n    if (!this.integrationEnabled) throw new BadRequestException('Openai is disabled');\n\n    const instanceId = await this.prismaRepository.instance\n      .findFirst({\n        where: {\n          name: instance.instanceName,\n        },\n      })\n      .then((instance) => instance.id);\n\n    if (!data.apiKey) throw new BadRequestException('API Key is required');\n    if (!data.name) throw new BadRequestException('Name is required');\n\n    // Check if API key already exists\n    const existingApiKey = await this.credsRepository.findFirst({\n      where: {\n        apiKey: data.apiKey,\n      },\n    });\n\n    if (existingApiKey) {\n      throw new BadRequestException('This API key is already registered. Please use a different API key.');\n    }\n\n    // Check if name already exists for this instance\n    const existingName = await this.credsRepository.findFirst({\n      where: {\n        name: data.name,\n        instanceId: instanceId,\n      },\n    });\n\n    if (existingName) {\n      throw new BadRequestException('This credential name is already in use. Please choose a different name.');\n    }\n\n    try {\n      const creds = await this.credsRepository.create({\n        data: {\n          name: data.name,\n          apiKey: data.apiKey,\n          instanceId: instanceId,\n        },\n      });\n\n      return creds;\n    } catch (error) {\n      this.logger.error(error);\n      throw new Error('Error creating openai creds');\n    }\n  }\n\n  public async findOpenaiCreds(instance: InstanceDto) {\n    if (!this.integrationEnabled) throw new BadRequestException('Openai is disabled');\n\n    const instanceId = await this.prismaRepository.instance\n      .findFirst({\n        where: {\n          name: instance.instanceName,\n        },\n      })\n      .then((instance) => instance.id);\n\n    const creds = await this.credsRepository.findMany({\n      where: {\n        instanceId: instanceId,\n      },\n      include: {\n        OpenaiAssistant: true,\n      },\n    });\n\n    return creds;\n  }\n\n  public async deleteCreds(instance: InstanceDto, openaiCredsId: string) {\n    if (!this.integrationEnabled) throw new BadRequestException('Openai is disabled');\n\n    const instanceId = await this.prismaRepository.instance\n      .findFirst({\n        where: {\n          name: instance.instanceName,\n        },\n      })\n      .then((instance) => instance.id);\n\n    const creds = await this.credsRepository.findFirst({\n      where: {\n        id: openaiCredsId,\n      },\n    });\n\n    if (!creds) {\n      throw new Error('Openai Creds not found');\n    }\n\n    if (creds.instanceId !== instanceId) {\n      throw new Error('Openai Creds not found');\n    }\n\n    try {\n      await this.credsRepository.delete({\n        where: {\n          id: openaiCredsId,\n        },\n      });\n\n      return { openaiCreds: { id: openaiCredsId } };\n    } catch (error) {\n      this.logger.error(error);\n      throw new Error('Error deleting openai creds');\n    }\n  }\n\n  // Override the settings method to handle the OpenAI credentials\n  public async settings(instance: InstanceDto, data: any) {\n    if (!this.integrationEnabled) throw new BadRequestException('Openai is disabled');\n\n    try {\n      const instanceId = await this.prismaRepository.instance\n        .findFirst({\n          where: {\n            name: instance.instanceName,\n          },\n        })\n        .then((instance) => instance.id);\n\n      const existingSettings = await this.settingsRepository.findFirst({\n        where: {\n          instanceId: instanceId,\n        },\n      });\n\n      // Convert keywordFinish to string if it's an array\n      const keywordFinish = data.keywordFinish;\n\n      // Additional OpenAI-specific fields\n      const settingsData = {\n        expire: data.expire,\n        keywordFinish,\n        delayMessage: data.delayMessage,\n        unknownMessage: data.unknownMessage,\n        listeningFromMe: data.listeningFromMe,\n        stopBotFromMe: data.stopBotFromMe,\n        keepOpen: data.keepOpen,\n        debounceTime: data.debounceTime,\n        ignoreJids: data.ignoreJids,\n        splitMessages: data.splitMessages,\n        timePerChar: data.timePerChar,\n        openaiIdFallback: data.fallbackId,\n        OpenaiCreds: data.openaiCredsId\n          ? {\n              connect: {\n                id: data.openaiCredsId,\n              },\n            }\n          : undefined,\n        speechToText: data.speechToText,\n      };\n\n      if (existingSettings) {\n        const settings = await this.settingsRepository.update({\n          where: {\n            id: existingSettings.id,\n          },\n          data: settingsData,\n        });\n\n        // Map the specific fallback field to a generic 'fallbackId' in the response\n        return {\n          ...settings,\n          fallbackId: settings.openaiIdFallback,\n        };\n      } else {\n        const settings = await this.settingsRepository.create({\n          data: {\n            ...settingsData,\n            Instance: {\n              connect: {\n                id: instanceId,\n              },\n            },\n          },\n        });\n\n        // Map the specific fallback field to a generic 'fallbackId' in the response\n        return {\n          ...settings,\n          fallbackId: settings.openaiIdFallback,\n        };\n      }\n    } catch (error) {\n      this.logger.error(error);\n      throw new Error('Error setting default settings');\n    }\n  }\n\n  // Models - OpenAI specific functionality\n  public async getModels(instance: InstanceDto, openaiCredsId?: string) {\n    if (!this.integrationEnabled) throw new BadRequestException('Openai is disabled');\n\n    const instanceId = await this.prismaRepository.instance\n      .findFirst({\n        where: {\n          name: instance.instanceName,\n        },\n      })\n      .then((instance) => instance.id);\n\n    if (!instanceId) throw new Error('Instance not found');\n\n    let apiKey: string;\n\n    if (openaiCredsId) {\n      // Use specific credential ID if provided\n      const creds = await this.credsRepository.findFirst({\n        where: {\n          id: openaiCredsId,\n          instanceId: instanceId, // Ensure the credential belongs to this instance\n        },\n      });\n\n      if (!creds) throw new Error('OpenAI credentials not found for the provided ID');\n\n      apiKey = creds.apiKey;\n    } else {\n      // Use default credentials from settings if no ID provided\n      const defaultSettings = await this.settingsRepository.findFirst({\n        where: {\n          instanceId: instanceId,\n        },\n        include: {\n          OpenaiCreds: true,\n        },\n      });\n\n      if (!defaultSettings) throw new Error('Settings not found');\n\n      if (!defaultSettings.OpenaiCreds)\n        throw new Error(\n          'OpenAI credentials not found. Please create credentials and associate them with the settings.',\n        );\n\n      apiKey = defaultSettings.OpenaiCreds.apiKey;\n    }\n\n    try {\n      this.client = new OpenAI({ apiKey });\n\n      const models: any = await this.client.models.list();\n\n      return models?.body?.data;\n    } catch (error) {\n      this.logger.error(error);\n      throw new Error('Error fetching models');\n    }\n  }\n}\n","import { InstanceDto } from '@api/dto/instance.dto';\nimport { TypebotDto } from '@api/integrations/chatbot/typebot/dto/typebot.dto';\nimport { TypebotService } from '@api/integrations/chatbot/typebot/services/typebot.service';\nimport { PrismaRepository } from '@api/repository/repository.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { Events } from '@api/types/wa.types';\nimport { configService, Typebot } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\nimport { BadRequestException } from '@exceptions';\nimport { IntegrationSession, Typebot as TypebotModel } from '@prisma/client';\nimport axios from 'axios';\n\nimport { BaseChatbotController } from '../../base-chatbot.controller';\n\nexport class TypebotController extends BaseChatbotController<TypebotModel, TypebotDto> {\n  constructor(\n    private readonly typebotService: TypebotService,\n    prismaRepository: PrismaRepository,\n    waMonitor: WAMonitoringService,\n  ) {\n    super(prismaRepository, waMonitor);\n\n    this.botRepository = this.prismaRepository.typebot;\n    this.settingsRepository = this.prismaRepository.typebotSetting;\n    this.sessionRepository = this.prismaRepository.integrationSession;\n  }\n\n  public readonly logger = new Logger('TypebotController');\n  protected readonly integrationName = 'Typebot';\n\n  integrationEnabled = configService.get<Typebot>('TYPEBOT').ENABLED;\n  botRepository: any;\n  settingsRepository: any;\n  sessionRepository: any;\n  userMessageDebounce: { [key: string]: { message: string; timeoutId: NodeJS.Timeout } } = {};\n\n  protected getFallbackBotId(settings: any): string | undefined {\n    return settings?.typebotIdFallback;\n  }\n\n  protected getFallbackFieldName(): string {\n    return 'typebotIdFallback';\n  }\n\n  protected getIntegrationType(): string {\n    return 'typebot';\n  }\n\n  protected getAdditionalBotData(data: TypebotDto): Record<string, any> {\n    return {\n      url: data.url,\n      typebot: data.typebot,\n    };\n  }\n\n  // Implementation for bot-specific updates\n  protected getAdditionalUpdateFields(data: TypebotDto): Record<string, any> {\n    return {\n      url: data.url,\n      typebot: data.typebot,\n    };\n  }\n\n  // Implementation for bot-specific duplicate validation on update\n  protected async validateNoDuplicatesOnUpdate(botId: string, instanceId: string, data: TypebotDto): Promise<void> {\n    const checkDuplicate = await this.botRepository.findFirst({\n      where: {\n        url: data.url,\n        typebot: data.typebot,\n        id: {\n          not: botId,\n        },\n        instanceId: instanceId,\n      },\n    });\n\n    if (checkDuplicate) {\n      throw new Error('Typebot already exists');\n    }\n  }\n\n  // Process Typebot-specific bot logic\n  protected async processBot(\n    instance: any,\n    remoteJid: string,\n    bot: TypebotModel,\n    session: IntegrationSession,\n    settings: any,\n    content: string,\n    pushName?: string,\n    msg?: any,\n  ) {\n    // Map to the original processTypebot method signature\n    await this.typebotService.processTypebot(\n      instance,\n      remoteJid,\n      msg,\n      session,\n      bot,\n      bot.url,\n      settings.expire,\n      bot.typebot,\n      settings.keywordFinish,\n      settings.delayMessage,\n      settings.unknownMessage,\n      settings.listeningFromMe,\n      settings.stopBotFromMe,\n      settings.keepOpen,\n      content,\n      {}, // prefilledVariables (optional)\n    );\n  }\n\n  // TypeBot specific method for starting a bot from API\n  public async startBot(instance: InstanceDto, data: any) {\n    if (!this.integrationEnabled) throw new BadRequestException('Typebot is disabled');\n\n    if (data.remoteJid === 'status@broadcast') return;\n\n    const instanceData = await this.prismaRepository.instance.findFirst({\n      where: {\n        name: instance.instanceName,\n      },\n    });\n\n    if (!instanceData) throw new Error('Instance not found');\n\n    const remoteJid = data.remoteJid;\n    const url = data.url;\n    const typebot = data.typebot;\n    const startSession = data.startSession;\n    const variables = data.variables;\n    let expire = data?.typebot?.expire;\n    let keywordFinish = data?.typebot?.keywordFinish;\n    let delayMessage = data?.typebot?.delayMessage;\n    let unknownMessage = data?.typebot?.unknownMessage;\n    let listeningFromMe = data?.typebot?.listeningFromMe;\n    let stopBotFromMe = data?.typebot?.stopBotFromMe;\n    let keepOpen = data?.typebot?.keepOpen;\n    let debounceTime = data?.typebot?.debounceTime;\n    let ignoreJids = data?.typebot?.ignoreJids;\n\n    const defaultSettingCheck = await this.settingsRepository.findFirst({\n      where: {\n        instanceId: instanceData.id,\n      },\n    });\n\n    if (this.checkIgnoreJids(defaultSettingCheck?.ignoreJids, remoteJid)) throw new Error('Jid not allowed');\n\n    if (\n      !expire ||\n      !keywordFinish ||\n      !delayMessage ||\n      !unknownMessage ||\n      !listeningFromMe ||\n      !stopBotFromMe ||\n      !keepOpen ||\n      !debounceTime ||\n      !ignoreJids\n    ) {\n      if (expire === undefined || expire === null) expire = defaultSettingCheck.expire;\n      if (keywordFinish === undefined || keywordFinish === null) keywordFinish = defaultSettingCheck.keywordFinish;\n      if (delayMessage === undefined || delayMessage === null) delayMessage = defaultSettingCheck.delayMessage;\n      if (unknownMessage === undefined || unknownMessage === null) unknownMessage = defaultSettingCheck.unknownMessage;\n      if (listeningFromMe === undefined || listeningFromMe === null)\n        listeningFromMe = defaultSettingCheck.listeningFromMe;\n      if (stopBotFromMe === undefined || stopBotFromMe === null) stopBotFromMe = defaultSettingCheck.stopBotFromMe;\n      if (keepOpen === undefined || keepOpen === null) keepOpen = defaultSettingCheck.keepOpen;\n      if (debounceTime === undefined || debounceTime === null) debounceTime = defaultSettingCheck.debounceTime;\n      if (ignoreJids === undefined || ignoreJids === null) ignoreJids = defaultSettingCheck.ignoreJids;\n\n      if (!defaultSettingCheck) {\n        await this.settings(instance, {\n          expire: expire,\n          keywordFinish: keywordFinish,\n          delayMessage: delayMessage,\n          unknownMessage: unknownMessage,\n          listeningFromMe: listeningFromMe,\n          stopBotFromMe: stopBotFromMe,\n          keepOpen: keepOpen,\n          debounceTime: debounceTime,\n          ignoreJids: ignoreJids,\n        });\n      }\n    }\n\n    const prefilledVariables: any = {};\n\n    if (variables?.length) {\n      variables.forEach((variable: { name: string | number; value: string }) => {\n        prefilledVariables[variable.name] = variable.value;\n      });\n    }\n\n    if (startSession) {\n      let findBot: any = await this.botRepository.findFirst({\n        where: {\n          url: url,\n          typebot: typebot,\n          instanceId: instanceData.id,\n        },\n      });\n\n      if (!findBot) {\n        findBot = await this.botRepository.create({\n          data: {\n            enabled: true,\n            url: url,\n            typebot: typebot,\n            instanceId: instanceData.id,\n            expire: expire,\n            keywordFinish: keywordFinish,\n            delayMessage: delayMessage,\n            unknownMessage: unknownMessage,\n            listeningFromMe: listeningFromMe,\n            stopBotFromMe: stopBotFromMe,\n            keepOpen: keepOpen,\n          },\n        });\n      }\n\n      await this.prismaRepository.integrationSession.deleteMany({\n        where: {\n          remoteJid: remoteJid,\n          instanceId: instanceData.id,\n          botId: { not: null },\n        },\n      });\n\n      // Use the original processTypebot method with all parameters\n      await this.typebotService.processTypebot(\n        this.waMonitor.waInstances[instanceData.name],\n        remoteJid,\n        null, // msg\n        null, // session\n        findBot,\n        url,\n        expire,\n        typebot,\n        keywordFinish,\n        delayMessage,\n        unknownMessage,\n        listeningFromMe,\n        stopBotFromMe,\n        keepOpen,\n        'init',\n        prefilledVariables,\n      );\n    } else {\n      const id = Math.floor(Math.random() * 10000000000).toString();\n\n      try {\n        const version = configService.get<Typebot>('TYPEBOT').API_VERSION;\n        let url: string;\n        let reqData: {};\n        if (version === 'latest') {\n          url = `${data.url}/api/v1/typebots/${data.typebot}/startChat`;\n\n          reqData = {\n            prefilledVariables: prefilledVariables,\n          };\n        } else {\n          url = `${data.url}/api/v1/sendMessage`;\n\n          reqData = {\n            startParams: {\n              publicId: data.typebot,\n              prefilledVariables: prefilledVariables,\n            },\n          };\n        }\n        const request = await axios.post(url, reqData);\n\n        await this.typebotService.sendWAMessage(\n          instanceData,\n          null,\n          {\n            expire: expire,\n            keywordFinish: keywordFinish,\n            delayMessage: delayMessage,\n            unknownMessage: unknownMessage,\n            listeningFromMe: listeningFromMe,\n            stopBotFromMe: stopBotFromMe,\n            keepOpen: keepOpen,\n          },\n          remoteJid,\n          request.data.messages,\n          request.data.input,\n          request.data.clientSideActions,\n        );\n\n        this.waMonitor.waInstances[instance.instanceName].sendDataWebhook(Events.TYPEBOT_START, {\n          remoteJid: remoteJid,\n          url: url,\n          typebot: typebot,\n          variables: variables,\n          sessionId: id,\n        });\n      } catch (error) {\n        this.logger.error(error);\n        return;\n      }\n    }\n\n    return {\n      typebot: {\n        ...instance,\n        typebot: {\n          url: url,\n          remoteJid: remoteJid,\n          typebot: typebot,\n          prefilledVariables: prefilledVariables,\n        },\n      },\n    };\n  }\n}\n","import { EventDto } from '@api/integrations/event/event.dto';\nimport { PrismaRepository } from '@api/repository/repository.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { wa } from '@api/types/wa.types';\n\nexport type EmitData = {\n  instanceName: string;\n  origin: string;\n  event: string;\n  data: any;\n  serverUrl: string;\n  dateTime: string;\n  sender: string;\n  apiKey?: string;\n  local?: boolean;\n  integration?: string[];\n  extra?: Record<string, any>;\n};\n\nexport interface EventControllerInterface {\n  set(instanceName: string, data: any): Promise<any>;\n  get(instanceName: string): Promise<any>;\n  emit({\n    instanceName,\n    origin,\n    event,\n    data,\n    serverUrl,\n    dateTime,\n    sender,\n    apiKey,\n    local,\n    extra,\n  }: EmitData): Promise<void>;\n}\n\nexport class EventController {\n  public prismaRepository: PrismaRepository;\n  protected waMonitor: WAMonitoringService;\n  private integrationStatus: boolean;\n  private integrationName: string;\n\n  constructor(\n    prismaRepository: PrismaRepository,\n    waMonitor: WAMonitoringService,\n    integrationStatus: boolean,\n    integrationName: string,\n  ) {\n    this.prisma = prismaRepository;\n    this.monitor = waMonitor;\n    this.status = integrationStatus;\n    this.name = integrationName;\n  }\n\n  public set prisma(prisma: PrismaRepository) {\n    this.prismaRepository = prisma;\n  }\n\n  public get prisma() {\n    return this.prismaRepository;\n  }\n\n  public set monitor(waMonitor: WAMonitoringService) {\n    this.waMonitor = waMonitor;\n  }\n\n  public get monitor() {\n    return this.waMonitor;\n  }\n\n  public set name(name: string) {\n    this.integrationName = name;\n  }\n\n  public get name() {\n    return this.integrationName;\n  }\n\n  public set status(status: boolean) {\n    this.integrationStatus = status;\n  }\n\n  public get status() {\n    return this.integrationStatus;\n  }\n\n  public async set(instanceName: string, data: EventDto): Promise<wa.LocalEvent> {\n    if (!this.status) {\n      return;\n    }\n\n    if (!data[this.name]?.enabled) {\n      data[this.name].events = [];\n    } else {\n      if (0 === data[this.name].events.length) {\n        data[this.name].events = EventController.events;\n      }\n    }\n\n    return this.prisma[this.name].upsert({\n      where: {\n        instanceId: this.monitor.waInstances[instanceName].instanceId,\n      },\n      update: {\n        enabled: data[this.name]?.enabled,\n        events: data[this.name].events,\n      },\n      create: {\n        enabled: data[this.name]?.enabled,\n        events: data[this.name].events,\n        instanceId: this.monitor.waInstances[instanceName].instanceId,\n      },\n    });\n  }\n\n  public async get(instanceName: string): Promise<wa.LocalEvent> {\n    if (!this.status) {\n      return;\n    }\n\n    if (undefined === this.monitor.waInstances[instanceName]) {\n      return null;\n    }\n\n    const data = await this.prisma[this.name].findUnique({\n      where: {\n        instanceId: this.monitor.waInstances[instanceName].instanceId,\n      },\n    });\n\n    if (!data) {\n      return null;\n    }\n\n    return data;\n  }\n\n  public static readonly events = [\n    'APPLICATION_STARTUP',\n    'QRCODE_UPDATED',\n    'MESSAGES_SET',\n    'MESSAGES_UPSERT',\n    'MESSAGES_EDITED',\n    'MESSAGES_UPDATE',\n    'MESSAGES_DELETE',\n    'SEND_MESSAGE',\n    'SEND_MESSAGE_UPDATE',\n    'CONTACTS_SET',\n    'CONTACTS_UPSERT',\n    'CONTACTS_UPDATE',\n    'PRESENCE_UPDATE',\n    'CHATS_SET',\n    'CHATS_UPSERT',\n    'CHATS_UPDATE',\n    'CHATS_DELETE',\n    'GROUPS_UPSERT',\n    'GROUP_UPDATE',\n    'GROUP_PARTICIPANTS_UPDATE',\n    'CONNECTION_UPDATE',\n    'LABELS_EDIT',\n    'LABELS_ASSOCIATION',\n    'CALL',\n    'TYPEBOT_START',\n    'TYPEBOT_CHANGE_STATUS',\n    'REMOVE_INSTANCE',\n    'LOGOUT_INSTANCE',\n    'INSTANCE_CREATE',\n    'INSTANCE_DELETE',\n    'STATUS_INSTANCE',\n  ];\n}\n","import { PrismaRepository } from '@api/repository/repository.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { configService, Kafka, Log } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\nimport { Consumer, ConsumerConfig, Kafka as KafkaJS, KafkaConfig, Producer, ProducerConfig } from 'kafkajs';\n\nimport { EmitData, EventController, EventControllerInterface } from '../event.controller';\n\nexport class KafkaController extends EventController implements EventControllerInterface {\n  private kafkaClient: KafkaJS | null = null;\n  private producer: Producer | null = null;\n  private consumer: Consumer | null = null;\n  private readonly logger = new Logger('KafkaController');\n  private reconnectAttempts = 0;\n  private maxReconnectAttempts = 10;\n  private reconnectDelay = 5000; // 5 seconds\n  private isReconnecting = false;\n\n  constructor(prismaRepository: PrismaRepository, waMonitor: WAMonitoringService) {\n    super(prismaRepository, waMonitor, configService.get<Kafka>('KAFKA')?.ENABLED, 'kafka');\n  }\n\n  public async init(): Promise<void> {\n    if (!this.status) {\n      return;\n    }\n\n    await this.connect();\n  }\n\n  private async connect(): Promise<void> {\n    try {\n      const kafkaConfig = configService.get<Kafka>('KAFKA');\n\n      const clientConfig: KafkaConfig = {\n        clientId: kafkaConfig.CLIENT_ID || 'evolution-api',\n        brokers: kafkaConfig.BROKERS || ['localhost:9092'],\n        connectionTimeout: kafkaConfig.CONNECTION_TIMEOUT || 3000,\n        requestTimeout: kafkaConfig.REQUEST_TIMEOUT || 30000,\n        retry: {\n          initialRetryTime: 100,\n          retries: 8,\n        },\n      };\n\n      // Add SASL authentication if configured\n      if (kafkaConfig.SASL?.ENABLED) {\n        clientConfig.sasl = {\n          mechanism: (kafkaConfig.SASL.MECHANISM as any) || 'plain',\n          username: kafkaConfig.SASL.USERNAME,\n          password: kafkaConfig.SASL.PASSWORD,\n        };\n      }\n\n      // Add SSL configuration if enabled\n      if (kafkaConfig.SSL?.ENABLED) {\n        clientConfig.ssl = {\n          rejectUnauthorized: kafkaConfig.SSL.REJECT_UNAUTHORIZED !== false,\n          ca: kafkaConfig.SSL.CA ? [kafkaConfig.SSL.CA] : undefined,\n          key: kafkaConfig.SSL.KEY,\n          cert: kafkaConfig.SSL.CERT,\n        };\n      }\n\n      this.kafkaClient = new KafkaJS(clientConfig);\n\n      // Initialize producer\n      const producerConfig: ProducerConfig = {\n        maxInFlightRequests: 1,\n        idempotent: true,\n        transactionTimeout: 30000,\n      };\n\n      this.producer = this.kafkaClient.producer(producerConfig);\n      await this.producer.connect();\n\n      // Initialize consumer for global events if enabled\n      if (kafkaConfig.GLOBAL_ENABLED) {\n        await this.initGlobalConsumer();\n      }\n\n      this.reconnectAttempts = 0;\n      this.isReconnecting = false;\n\n      this.logger.info('Kafka initialized successfully');\n\n      // Create topics if they don't exist\n      if (kafkaConfig.AUTO_CREATE_TOPICS) {\n        await this.createTopics();\n      }\n    } catch (error) {\n      this.logger.error({\n        local: 'KafkaController.connect',\n        message: 'Failed to connect to Kafka',\n        error: error.message || error,\n      });\n      this.scheduleReconnect();\n      throw error;\n    }\n  }\n\n  private async initGlobalConsumer(): Promise<void> {\n    try {\n      const kafkaConfig = configService.get<Kafka>('KAFKA');\n\n      const consumerConfig: ConsumerConfig = {\n        groupId: kafkaConfig.CONSUMER_GROUP_ID || 'evolution-api-consumers',\n        sessionTimeout: 30000,\n        heartbeatInterval: 3000,\n      };\n\n      this.consumer = this.kafkaClient.consumer(consumerConfig);\n      await this.consumer.connect();\n\n      // Subscribe to global topics\n      const events = kafkaConfig.EVENTS;\n      if (events) {\n        const eventKeys = Object.keys(events).filter((event) => events[event]);\n\n        for (const event of eventKeys) {\n          const topicName = this.getTopicName(event, true);\n          await this.consumer.subscribe({ topic: topicName });\n        }\n\n        // Start consuming messages\n        await this.consumer.run({\n          eachMessage: async ({ topic, message }) => {\n            try {\n              const data = JSON.parse(message.value?.toString() || '{}');\n              this.logger.debug(`Received message from topic ${topic}: ${JSON.stringify(data)}`);\n\n              // Process the message here if needed\n              // This is where you can add custom message processing logic\n            } catch (error) {\n              this.logger.error(`Error processing message from topic ${topic}: ${error}`);\n            }\n          },\n        });\n\n        this.logger.info('Global Kafka consumer initialized');\n      }\n    } catch (error) {\n      this.logger.error(`Failed to initialize global Kafka consumer: ${error}`);\n    }\n  }\n\n  private async createTopics(): Promise<void> {\n    try {\n      const kafkaConfig = configService.get<Kafka>('KAFKA');\n      const admin = this.kafkaClient.admin();\n      await admin.connect();\n\n      const topics = [];\n\n      // Create global topics if enabled\n      if (kafkaConfig.GLOBAL_ENABLED && kafkaConfig.EVENTS) {\n        const eventKeys = Object.keys(kafkaConfig.EVENTS).filter((event) => kafkaConfig.EVENTS[event]);\n\n        for (const event of eventKeys) {\n          const topicName = this.getTopicName(event, true);\n          topics.push({\n            topic: topicName,\n            numPartitions: kafkaConfig.NUM_PARTITIONS || 1,\n            replicationFactor: kafkaConfig.REPLICATION_FACTOR || 1,\n          });\n        }\n      }\n\n      if (topics.length > 0) {\n        await admin.createTopics({\n          topics,\n          waitForLeaders: true,\n        });\n\n        this.logger.info(`Created ${topics.length} Kafka topics`);\n      }\n\n      await admin.disconnect();\n    } catch (error) {\n      this.logger.error(`Failed to create Kafka topics: ${error}`);\n    }\n  }\n\n  private getTopicName(event: string, isGlobal: boolean = false, instanceName?: string): string {\n    const kafkaConfig = configService.get<Kafka>('KAFKA');\n    const prefix = kafkaConfig.TOPIC_PREFIX || 'evolution';\n\n    if (isGlobal) {\n      return `${prefix}.global.${event.toLowerCase().replace(/_/g, '.')}`;\n    } else {\n      return `${prefix}.${instanceName}.${event.toLowerCase().replace(/_/g, '.')}`;\n    }\n  }\n\n  private handleConnectionLoss(): void {\n    if (this.isReconnecting) {\n      return;\n    }\n\n    this.cleanup();\n    this.scheduleReconnect();\n  }\n\n  private scheduleReconnect(): void {\n    if (this.reconnectAttempts >= this.maxReconnectAttempts) {\n      this.logger.error(\n        `Maximum reconnect attempts (${this.maxReconnectAttempts}) reached. Stopping reconnection attempts.`,\n      );\n      return;\n    }\n\n    if (this.isReconnecting) {\n      return;\n    }\n\n    this.isReconnecting = true;\n    this.reconnectAttempts++;\n\n    const delay = this.reconnectDelay * Math.pow(2, Math.min(this.reconnectAttempts - 1, 5));\n\n    this.logger.info(\n      `Scheduling Kafka reconnection attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts} in ${delay}ms`,\n    );\n\n    setTimeout(async () => {\n      try {\n        this.logger.info(\n          `Attempting to reconnect to Kafka (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`,\n        );\n        await this.connect();\n        this.logger.info('Successfully reconnected to Kafka');\n      } catch (error) {\n        this.logger.error({\n          local: 'KafkaController.scheduleReconnect',\n          message: `Reconnection attempt ${this.reconnectAttempts} failed`,\n          error: error.message || error,\n        });\n        this.isReconnecting = false;\n        this.scheduleReconnect();\n      }\n    }, delay);\n  }\n\n  private async ensureConnection(): Promise<boolean> {\n    if (!this.producer) {\n      this.logger.warn('Kafka producer is not available, attempting to reconnect...');\n      if (!this.isReconnecting) {\n        this.scheduleReconnect();\n      }\n      return false;\n    }\n    return true;\n  }\n\n  public async emit({\n    instanceName,\n    origin,\n    event,\n    data,\n    serverUrl,\n    dateTime,\n    sender,\n    apiKey,\n    integration,\n    extra,\n  }: EmitData): Promise<void> {\n    if (integration && !integration.includes('kafka')) {\n      return;\n    }\n\n    if (!this.status) {\n      return;\n    }\n\n    if (!(await this.ensureConnection())) {\n      this.logger.warn(`Failed to emit event ${event} for instance ${instanceName}: No Kafka connection`);\n      return;\n    }\n\n    const instanceKafka = await this.get(instanceName);\n    const kafkaLocal = instanceKafka?.events;\n    const kafkaGlobal = configService.get<Kafka>('KAFKA').GLOBAL_ENABLED;\n    const kafkaEvents = configService.get<Kafka>('KAFKA').EVENTS;\n    const we = event.replace(/[.-]/gm, '_').toUpperCase();\n    const logEnabled = configService.get<Log>('LOG').LEVEL.includes('WEBHOOKS');\n\n    const message = {\n      ...(extra ?? {}),\n      event,\n      instance: instanceName,\n      data,\n      server_url: serverUrl,\n      date_time: dateTime,\n      sender,\n      apikey: apiKey,\n      timestamp: Date.now(),\n    };\n\n    const messageValue = JSON.stringify(message);\n\n    // Instance-specific events\n    if (instanceKafka?.enabled && this.producer && Array.isArray(kafkaLocal) && kafkaLocal.includes(we)) {\n      const topicName = this.getTopicName(event, false, instanceName);\n\n      let retry = 0;\n      while (retry < 3) {\n        try {\n          await this.producer.send({\n            topic: topicName,\n            messages: [\n              {\n                key: instanceName,\n                value: messageValue,\n                headers: {\n                  event,\n                  instance: instanceName,\n                  origin,\n                  timestamp: dateTime,\n                },\n              },\n            ],\n          });\n\n          if (logEnabled) {\n            const logData = {\n              local: `${origin}.sendData-Kafka`,\n              ...message,\n            };\n            this.logger.log(logData);\n          }\n\n          break;\n        } catch (error) {\n          this.logger.error({\n            local: 'KafkaController.emit',\n            message: `Error publishing local Kafka message (attempt ${retry + 1}/3)`,\n            error: error.message || error,\n          });\n          retry++;\n          if (retry >= 3) {\n            this.handleConnectionLoss();\n          }\n        }\n      }\n    }\n\n    // Global events\n    if (kafkaGlobal && kafkaEvents[we] && this.producer) {\n      const topicName = this.getTopicName(event, true);\n\n      let retry = 0;\n      while (retry < 3) {\n        try {\n          await this.producer.send({\n            topic: topicName,\n            messages: [\n              {\n                key: `${instanceName}-${event}`,\n                value: messageValue,\n                headers: {\n                  event,\n                  instance: instanceName,\n                  origin,\n                  timestamp: dateTime,\n                },\n              },\n            ],\n          });\n\n          if (logEnabled) {\n            const logData = {\n              local: `${origin}.sendData-Kafka-Global`,\n              ...message,\n            };\n            this.logger.log(logData);\n          }\n\n          break;\n        } catch (error) {\n          this.logger.error({\n            local: 'KafkaController.emit',\n            message: `Error publishing global Kafka message (attempt ${retry + 1}/3)`,\n            error: error.message || error,\n          });\n          retry++;\n          if (retry >= 3) {\n            this.handleConnectionLoss();\n          }\n        }\n      }\n    }\n  }\n\n  public async cleanup(): Promise<void> {\n    try {\n      if (this.consumer) {\n        await this.consumer.disconnect();\n        this.consumer = null;\n      }\n      if (this.producer) {\n        await this.producer.disconnect();\n        this.producer = null;\n      }\n      this.kafkaClient = null;\n    } catch (error) {\n      this.logger.warn({\n        local: 'KafkaController.cleanup',\n        message: 'Error during cleanup',\n        error: error.message || error,\n      });\n      this.producer = null;\n      this.consumer = null;\n      this.kafkaClient = null;\n    }\n  }\n}\n","import { PrismaRepository } from '@api/repository/repository.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { configService, Log, Nats } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\nimport { connect, NatsConnection, StringCodec } from 'nats';\n\nimport { EmitData, EventController, EventControllerInterface } from '../event.controller';\n\nexport class NatsController extends EventController implements EventControllerInterface {\n  public natsClient: NatsConnection | null = null;\n  private readonly logger = new Logger('NatsController');\n  private readonly sc = StringCodec();\n\n  constructor(prismaRepository: PrismaRepository, waMonitor: WAMonitoringService) {\n    super(prismaRepository, waMonitor, configService.get<Nats>('NATS')?.ENABLED, 'nats');\n  }\n\n  public async init(): Promise<void> {\n    if (!this.status) {\n      return;\n    }\n\n    try {\n      const uri = configService.get<Nats>('NATS').URI;\n\n      this.natsClient = await connect({ servers: uri });\n\n      this.logger.info('NATS initialized');\n\n      if (configService.get<Nats>('NATS')?.GLOBAL_ENABLED) {\n        await this.initGlobalSubscriptions();\n      }\n    } catch (error) {\n      this.logger.error('Failed to connect to NATS:');\n      this.logger.error(error);\n      throw error;\n    }\n  }\n\n  public async emit({\n    instanceName,\n    origin,\n    event,\n    data,\n    serverUrl,\n    dateTime,\n    sender,\n    apiKey,\n    integration,\n    extra,\n  }: EmitData): Promise<void> {\n    if (integration && !integration.includes('nats')) {\n      return;\n    }\n\n    if (!this.status || !this.natsClient) {\n      return;\n    }\n\n    const instanceNats = await this.get(instanceName);\n    const natsLocal = instanceNats?.events;\n    const natsGlobal = configService.get<Nats>('NATS').GLOBAL_ENABLED;\n    const natsEvents = configService.get<Nats>('NATS').EVENTS;\n    const prefixKey = configService.get<Nats>('NATS').PREFIX_KEY;\n    const we = event.replace(/[.-]/gm, '_').toUpperCase();\n    const logEnabled = configService.get<Log>('LOG').LEVEL.includes('WEBHOOKS');\n\n    const message = {\n      ...(extra ?? {}),\n      event,\n      instance: instanceName,\n      data,\n      server_url: serverUrl,\n      date_time: dateTime,\n      sender,\n      apikey: apiKey,\n    };\n\n    // Instncia especfica\n    if (instanceNats?.enabled) {\n      if (Array.isArray(natsLocal) && natsLocal.includes(we)) {\n        const subject = `${instanceName}.${event.toLowerCase()}`;\n\n        try {\n          this.natsClient.publish(subject, this.sc.encode(JSON.stringify(message)));\n\n          if (logEnabled) {\n            const logData = {\n              local: `${origin}.sendData-NATS`,\n              ...message,\n            };\n            this.logger.log(logData);\n          }\n        } catch (error) {\n          this.logger.error(`Failed to publish to NATS (instance): ${error}`);\n        }\n      }\n    }\n\n    // Global\n    if (natsGlobal && natsEvents[we]) {\n      try {\n        const subject = prefixKey ? `${prefixKey}.${event.toLowerCase()}` : event.toLowerCase();\n\n        this.natsClient.publish(subject, this.sc.encode(JSON.stringify(message)));\n\n        if (logEnabled) {\n          const logData = {\n            local: `${origin}.sendData-NATS-Global`,\n            ...message,\n          };\n          this.logger.log(logData);\n        }\n      } catch (error) {\n        this.logger.error(`Failed to publish to NATS (global): ${error}`);\n      }\n    }\n  }\n\n  private async initGlobalSubscriptions(): Promise<void> {\n    this.logger.info('Initializing global subscriptions');\n\n    const events = configService.get<Nats>('NATS').EVENTS;\n    const prefixKey = configService.get<Nats>('NATS').PREFIX_KEY;\n\n    if (!events) {\n      this.logger.warn('No events to initialize on NATS');\n      return;\n    }\n\n    const eventKeys = Object.keys(events);\n\n    for (const event of eventKeys) {\n      if (events[event] === false) continue;\n\n      const subject = prefixKey ? `${prefixKey}.${event.toLowerCase()}` : event.toLowerCase();\n\n      // Criar uma subscription para cada evento\n      try {\n        const subscription = this.natsClient.subscribe(subject);\n        this.logger.info(`Subscribed to: ${subject}`);\n\n        // Processar mensagens (exemplo bsico)\n        (async () => {\n          for await (const msg of subscription) {\n            try {\n              const data = JSON.parse(this.sc.decode(msg.data));\n              // Aqui voc pode adicionar a lgica de processamento\n              this.logger.debug(`Received message on ${subject}:`);\n              this.logger.debug(data);\n            } catch (error) {\n              this.logger.error(`Error processing message on ${subject}:`);\n              this.logger.error(error);\n            }\n          }\n        })();\n      } catch (error) {\n        this.logger.error(`Failed to subscribe to ${subject}:`);\n        this.logger.error(error);\n      }\n    }\n  }\n}\n","import { EventDto } from '@api/integrations/event/event.dto';\nimport { PrismaRepository } from '@api/repository/repository.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { wa } from '@api/types/wa.types';\nimport { configService, Log, Pusher as ConfigPusher } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\nimport Pusher from 'pusher';\n\nimport { EmitData, EventController, EventControllerInterface } from '../event.controller';\nexport class PusherController extends EventController implements EventControllerInterface {\n  private readonly logger = new Logger('PusherController');\n  private pusherClients: { [instanceName: string]: Pusher } = {};\n  private globalPusherClient: Pusher | null = null;\n  private pusherConfig: ConfigPusher = configService.get<ConfigPusher>('PUSHER');\n  constructor(prismaRepository: PrismaRepository, waMonitor: WAMonitoringService) {\n    super(prismaRepository, waMonitor, configService.get<ConfigPusher>('PUSHER')?.ENABLED, 'pusher');\n    this.init();\n  }\n  public async init(): Promise<void> {\n    if (!this.status) {\n      return;\n    }\n    if (this.pusherConfig.GLOBAL?.ENABLED) {\n      const { APP_ID, KEY, SECRET, CLUSTER, USE_TLS } = this.pusherConfig.GLOBAL;\n      if (APP_ID && KEY && SECRET && CLUSTER) {\n        this.globalPusherClient = new Pusher({\n          appId: APP_ID,\n          key: KEY,\n          secret: SECRET,\n          cluster: CLUSTER,\n          useTLS: USE_TLS,\n        });\n        this.logger.info('Pusher global client initialized');\n      }\n    }\n    const instances = await this.prismaRepository.instance.findMany({\n      where: {\n        Pusher: {\n          isNot: null,\n        },\n      },\n      include: {\n        Pusher: true,\n      },\n    });\n    instances.forEach((instance) => {\n      if (\n        instance.Pusher.enabled &&\n        instance.Pusher.appId &&\n        instance.Pusher.key &&\n        instance.Pusher.secret &&\n        instance.Pusher.cluster\n      ) {\n        this.pusherClients[instance.name] = new Pusher({\n          appId: instance.Pusher.appId,\n          key: instance.Pusher.key,\n          secret: instance.Pusher.secret,\n          cluster: instance.Pusher.cluster,\n          useTLS: instance.Pusher.useTLS,\n        });\n        this.logger.info(`Pusher client initialized for instance ${instance.name}`);\n      } else {\n        delete this.pusherClients[instance.name];\n        this.logger.warn(`Pusher client disabled or misconfigured for instance ${instance.name}`);\n      }\n    });\n  }\n  override async set(instanceName: string, data: EventDto): Promise<wa.LocalPusher> {\n    if (!data.pusher?.enabled) {\n      data.pusher.events = [];\n    } else if (data.pusher.events.length === 0) {\n      data.pusher.events = EventController.events;\n    }\n    const instance = await this.prisma.pusher.upsert({\n      where: {\n        instanceId: this.monitor.waInstances[instanceName].instanceId,\n      },\n      update: {\n        enabled: data.pusher.enabled,\n        events: data.pusher.events,\n        appId: data.pusher.appId,\n        key: data.pusher.key,\n        secret: data.pusher.secret,\n        cluster: data.pusher.cluster,\n        useTLS: data.pusher.useTLS,\n      },\n      create: {\n        enabled: data.pusher.enabled,\n        events: data.pusher.events,\n        instanceId: this.monitor.waInstances[instanceName].instanceId,\n        appId: data.pusher.appId,\n        key: data.pusher.key,\n        secret: data.pusher.secret,\n        cluster: data.pusher.cluster,\n        useTLS: data.pusher.useTLS,\n      },\n    });\n    if (instance.enabled && instance.appId && instance.key && instance.secret && instance.cluster) {\n      this.pusherClients[instanceName] = new Pusher({\n        appId: instance.appId,\n        key: instance.key,\n        secret: instance.secret,\n        cluster: instance.cluster,\n        useTLS: instance.useTLS,\n      });\n      this.logger.info(`Pusher client initialized for instance ${instanceName}`);\n    } else {\n      delete this.pusherClients[instanceName];\n      this.logger.warn(`Pusher client disabled or misconfigured for instance ${instanceName}`);\n    }\n    return instance;\n  }\n  public async emit({\n    instanceName,\n    origin,\n    event,\n    data,\n    serverUrl,\n    dateTime,\n    sender,\n    apiKey,\n    local,\n    integration,\n    extra,\n  }: EmitData): Promise<void> {\n    if (integration && !integration.includes('pusher')) {\n      return;\n    }\n    if (!this.status) {\n      return;\n    }\n    const instance = (await this.get(instanceName)) as wa.LocalPusher;\n    const we = event.replace(/[.-]/gm, '_').toUpperCase();\n    const enabledLog = configService.get<Log>('LOG').LEVEL.includes('WEBHOOKS');\n    const eventName = event.replace(/_/g, '.').toLowerCase();\n    const pusherData = {\n      ...(extra ?? {}),\n      event,\n      instance: instanceName,\n      data,\n      destination: instance?.appId || this.pusherConfig.GLOBAL?.APP_ID,\n      date_time: dateTime,\n      sender,\n      server_url: serverUrl,\n      apikey: apiKey,\n    };\n    if (event == 'qrcode.updated') {\n      delete pusherData.data.qrcode.base64;\n    }\n    const payload = JSON.stringify(pusherData);\n    const payloadSize = Buffer.byteLength(payload, 'utf8');\n    const MAX_SIZE = 10240;\n    if (payloadSize > MAX_SIZE) {\n      this.logger.error({\n        local: `${origin}.sendData-Pusher`,\n        message: 'Payload size exceeds Pusher limit',\n        event,\n        instanceName,\n        payloadSize,\n      });\n      return;\n    }\n    if (local && instance && instance.enabled) {\n      const pusherLocalEvents = instance.events;\n      if (Array.isArray(pusherLocalEvents) && pusherLocalEvents.includes(we)) {\n        if (enabledLog) {\n          this.logger.log({\n            local: `${origin}.sendData-Pusher`,\n            appId: instance.appId,\n            ...pusherData,\n          });\n        }\n        try {\n          const pusher = this.pusherClients[instanceName];\n          if (pusher) {\n            pusher.trigger(instanceName, eventName, pusherData);\n          } else {\n            this.logger.error(`Pusher client not found for instance ${instanceName}`);\n          }\n        } catch (error) {\n          this.logger.error({\n            local: `${origin}.sendData-Pusher`,\n            message: error?.message,\n            error,\n          });\n        }\n      }\n    }\n    if (this.pusherConfig.GLOBAL?.ENABLED) {\n      const globalEvents = this.pusherConfig.EVENTS;\n      if (globalEvents[we]) {\n        if (enabledLog) {\n          this.logger.log({\n            local: `${origin}.sendData-Pusher-Global`,\n            appId: this.pusherConfig.GLOBAL?.APP_ID,\n            ...pusherData,\n          });\n        }\n        try {\n          if (this.globalPusherClient) {\n            this.globalPusherClient.trigger(instanceName, eventName, pusherData);\n          } else {\n            this.logger.error('Global Pusher client not initialized');\n          }\n        } catch (error) {\n          this.logger.error({\n            local: `${origin}.sendData-Pusher-Global`,\n            message: error?.message,\n            error,\n          });\n        }\n      }\n    }\n  }\n}\n","import { PrismaRepository } from '@api/repository/repository.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { configService, Log, Rabbitmq } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\nimport * as amqp from 'amqplib/callback_api';\n\nimport { EmitData, EventController, EventControllerInterface } from '../event.controller';\n\nexport class RabbitmqController extends EventController implements EventControllerInterface {\n  public amqpChannel: amqp.Channel | null = null;\n  private amqpConnection: amqp.Connection | null = null;\n  private readonly logger = new Logger('RabbitmqController');\n  private reconnectAttempts = 0;\n  private maxReconnectAttempts = 10;\n  private reconnectDelay = 5000; // 5 seconds\n  private isReconnecting = false;\n\n  constructor(prismaRepository: PrismaRepository, waMonitor: WAMonitoringService) {\n    super(prismaRepository, waMonitor, configService.get<Rabbitmq>('RABBITMQ')?.ENABLED, 'rabbitmq');\n  }\n\n  public async init(): Promise<void> {\n    if (!this.status) {\n      return;\n    }\n\n    await this.connect();\n  }\n\n  private async connect(): Promise<void> {\n    return new Promise<void>((resolve, reject) => {\n      const uri = configService.get<Rabbitmq>('RABBITMQ').URI;\n      const frameMax = configService.get<Rabbitmq>('RABBITMQ').FRAME_MAX;\n      const rabbitmqExchangeName = configService.get<Rabbitmq>('RABBITMQ').EXCHANGE_NAME;\n\n      const url = new URL(uri);\n      const connectionOptions = {\n        protocol: url.protocol.slice(0, -1),\n        hostname: url.hostname,\n        port: url.port || 5672,\n        username: url.username || 'guest',\n        password: url.password || 'guest',\n        vhost: url.pathname.slice(1) || '/',\n        frameMax: frameMax,\n        heartbeat: 30, // Add heartbeat of 30 seconds\n      };\n\n      amqp.connect(connectionOptions, (error: Error, connection: amqp.Connection) => {\n        if (error) {\n          this.logger.error({\n            local: 'RabbitmqController.connect',\n            message: 'Failed to connect to RabbitMQ',\n            error: error.message || error,\n          });\n          reject(error);\n          return;\n        }\n\n        // Connection event handlers\n        connection.on('error', (err: Error) => {\n          this.logger.error({\n            local: 'RabbitmqController.connectionError',\n            message: 'RabbitMQ connection error',\n            error: err.message || err,\n          });\n          this.handleConnectionLoss();\n        });\n\n        connection.on('close', () => {\n          this.logger.warn('RabbitMQ connection closed');\n          this.handleConnectionLoss();\n        });\n\n        connection.createChannel((channelError: Error, channel: amqp.Channel) => {\n          if (channelError) {\n            this.logger.error({\n              local: 'RabbitmqController.createChannel',\n              message: 'Failed to create RabbitMQ channel',\n              error: channelError.message || channelError,\n            });\n            reject(channelError);\n            return;\n          }\n\n          // Channel event handlers\n          channel.on('error', (err: Error) => {\n            this.logger.error({\n              local: 'RabbitmqController.channelError',\n              message: 'RabbitMQ channel error',\n              error: err.message || err,\n            });\n            this.handleConnectionLoss();\n          });\n\n          channel.on('close', () => {\n            this.logger.warn('RabbitMQ channel closed');\n            this.handleConnectionLoss();\n          });\n\n          const exchangeName = rabbitmqExchangeName;\n\n          channel.assertExchange(exchangeName, 'topic', {\n            durable: true,\n            autoDelete: false,\n          });\n\n          this.amqpConnection = connection;\n          this.amqpChannel = channel;\n          this.reconnectAttempts = 0; // Reset reconnect attempts on successful connection\n          this.isReconnecting = false;\n\n          this.logger.info('AMQP initialized successfully');\n\n          resolve();\n        });\n      });\n    })\n      .then(() => {\n        if (configService.get<Rabbitmq>('RABBITMQ')?.GLOBAL_ENABLED) {\n          this.initGlobalQueues();\n        }\n      })\n      .catch((error) => {\n        this.logger.error({\n          local: 'RabbitmqController.init',\n          message: 'Failed to initialize AMQP',\n          error: error.message || error,\n        });\n        this.scheduleReconnect();\n        throw error;\n      });\n  }\n\n  private handleConnectionLoss(): void {\n    if (this.isReconnecting) {\n      return; // Already attempting to reconnect\n    }\n\n    this.cleanup();\n    this.scheduleReconnect();\n  }\n\n  private scheduleReconnect(): void {\n    if (this.reconnectAttempts >= this.maxReconnectAttempts) {\n      this.logger.error(\n        `Maximum reconnect attempts (${this.maxReconnectAttempts}) reached. Stopping reconnection attempts.`,\n      );\n      return;\n    }\n\n    if (this.isReconnecting) {\n      return; // Already scheduled\n    }\n\n    this.isReconnecting = true;\n    this.reconnectAttempts++;\n\n    const delay = this.reconnectDelay * Math.pow(2, Math.min(this.reconnectAttempts - 1, 5)); // Exponential backoff with max delay\n\n    this.logger.info(\n      `Scheduling RabbitMQ reconnection attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts} in ${delay}ms`,\n    );\n\n    setTimeout(async () => {\n      try {\n        this.logger.info(\n          `Attempting to reconnect to RabbitMQ (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`,\n        );\n        await this.connect();\n        this.logger.info('Successfully reconnected to RabbitMQ');\n      } catch (error) {\n        this.logger.error({\n          local: 'RabbitmqController.scheduleReconnect',\n          message: `Reconnection attempt ${this.reconnectAttempts} failed`,\n          error: error.message || error,\n        });\n        this.isReconnecting = false;\n        this.scheduleReconnect();\n      }\n    }, delay);\n  }\n\n  private set channel(channel: amqp.Channel) {\n    this.amqpChannel = channel;\n  }\n\n  public get channel(): amqp.Channel {\n    return this.amqpChannel;\n  }\n\n  private async ensureConnection(): Promise<boolean> {\n    if (!this.amqpChannel) {\n      this.logger.warn('AMQP channel is not available, attempting to reconnect...');\n      if (!this.isReconnecting) {\n        this.scheduleReconnect();\n      }\n      return false;\n    }\n    return true;\n  }\n\n  public async emit({\n    instanceName,\n    origin,\n    event,\n    data,\n    serverUrl,\n    dateTime,\n    sender,\n    apiKey,\n    integration,\n    extra,\n  }: EmitData): Promise<void> {\n    if (integration && !integration.includes('rabbitmq')) {\n      return;\n    }\n\n    if (!this.status) {\n      return;\n    }\n\n    if (!(await this.ensureConnection())) {\n      this.logger.warn(`Failed to emit event ${event} for instance ${instanceName}: No AMQP connection`);\n      return;\n    }\n\n    const instanceRabbitmq = await this.get(instanceName);\n    const rabbitmqLocal = instanceRabbitmq?.events;\n    const rabbitmqGlobal = configService.get<Rabbitmq>('RABBITMQ').GLOBAL_ENABLED;\n    const rabbitmqEvents = configService.get<Rabbitmq>('RABBITMQ').EVENTS;\n    const prefixKey = configService.get<Rabbitmq>('RABBITMQ').PREFIX_KEY;\n    const rabbitmqExchangeName = configService.get<Rabbitmq>('RABBITMQ').EXCHANGE_NAME;\n    const we = event.replace(/[.-]/gm, '_').toUpperCase();\n    const logEnabled = configService.get<Log>('LOG').LEVEL.includes('WEBHOOKS');\n\n    const message = {\n      ...(extra ?? {}),\n      event,\n      instance: instanceName,\n      data,\n      server_url: serverUrl,\n      date_time: dateTime,\n      sender,\n      apikey: apiKey,\n    };\n\n    if (instanceRabbitmq?.enabled && this.amqpChannel) {\n      if (Array.isArray(rabbitmqLocal) && rabbitmqLocal.includes(we)) {\n        const exchangeName = instanceName ?? rabbitmqExchangeName;\n\n        let retry = 0;\n\n        while (retry < 3) {\n          try {\n            await this.amqpChannel.assertExchange(exchangeName, 'topic', {\n              durable: true,\n              autoDelete: false,\n            });\n\n            const eventName = event.replace(/_/g, '.').toLowerCase();\n\n            const queueName = `${instanceName}.${eventName}`;\n\n            await this.amqpChannel.assertQueue(queueName, {\n              durable: true,\n              autoDelete: false,\n              arguments: {\n                'x-queue-type': 'quorum',\n              },\n            });\n\n            await this.amqpChannel.bindQueue(queueName, exchangeName, eventName);\n\n            await this.amqpChannel.publish(exchangeName, event, Buffer.from(JSON.stringify(message)));\n\n            if (logEnabled) {\n              const logData = {\n                local: `${origin}.sendData-RabbitMQ`,\n                ...message,\n              };\n\n              this.logger.log(logData);\n            }\n\n            break;\n          } catch (error) {\n            this.logger.error({\n              local: 'RabbitmqController.emit',\n              message: `Error publishing local RabbitMQ message (attempt ${retry + 1}/3)`,\n              error: error.message || error,\n            });\n            retry++;\n            if (retry >= 3) {\n              this.handleConnectionLoss();\n            }\n          }\n        }\n      }\n    }\n\n    if (rabbitmqGlobal && rabbitmqEvents[we] && this.amqpChannel) {\n      const exchangeName = rabbitmqExchangeName;\n\n      let retry = 0;\n\n      while (retry < 3) {\n        try {\n          await this.amqpChannel.assertExchange(exchangeName, 'topic', {\n            durable: true,\n            autoDelete: false,\n          });\n\n          const queueName = prefixKey\n            ? `${prefixKey}.${event.replace(/_/g, '.').toLowerCase()}`\n            : event.replace(/_/g, '.').toLowerCase();\n\n          await this.amqpChannel.assertQueue(queueName, {\n            durable: true,\n            autoDelete: false,\n            arguments: {\n              'x-queue-type': 'quorum',\n            },\n          });\n\n          await this.amqpChannel.bindQueue(queueName, exchangeName, event);\n\n          await this.amqpChannel.publish(exchangeName, event, Buffer.from(JSON.stringify(message)));\n\n          if (logEnabled) {\n            const logData = {\n              local: `${origin}.sendData-RabbitMQ-Global`,\n              ...message,\n            };\n\n            this.logger.log(logData);\n          }\n\n          break;\n        } catch (error) {\n          this.logger.error({\n            local: 'RabbitmqController.emit',\n            message: `Error publishing global RabbitMQ message (attempt ${retry + 1}/3)`,\n            error: error.message || error,\n          });\n          retry++;\n          if (retry >= 3) {\n            this.handleConnectionLoss();\n          }\n        }\n      }\n    }\n  }\n\n  private async initGlobalQueues(): Promise<void> {\n    this.logger.info('Initializing global queues');\n\n    if (!(await this.ensureConnection())) {\n      this.logger.error('Cannot initialize global queues: No AMQP connection');\n      return;\n    }\n\n    const rabbitmqExchangeName = configService.get<Rabbitmq>('RABBITMQ').EXCHANGE_NAME;\n    const events = configService.get<Rabbitmq>('RABBITMQ').EVENTS;\n    const prefixKey = configService.get<Rabbitmq>('RABBITMQ').PREFIX_KEY;\n\n    if (!events) {\n      this.logger.warn('No events to initialize on AMQP');\n      return;\n    }\n\n    const eventKeys = Object.keys(events);\n\n    for (const event of eventKeys) {\n      if (events[event] === false) continue;\n\n      try {\n        const queueName =\n          prefixKey !== ''\n            ? `${prefixKey}.${event.replace(/_/g, '.').toLowerCase()}`\n            : `${event.replace(/_/g, '.').toLowerCase()}`;\n        const exchangeName = rabbitmqExchangeName;\n\n        await this.amqpChannel.assertExchange(exchangeName, 'topic', {\n          durable: true,\n          autoDelete: false,\n        });\n\n        await this.amqpChannel.assertQueue(queueName, {\n          durable: true,\n          autoDelete: false,\n          arguments: {\n            'x-queue-type': 'quorum',\n          },\n        });\n\n        await this.amqpChannel.bindQueue(queueName, exchangeName, event);\n\n        this.logger.info(`Global queue initialized: ${queueName}`);\n      } catch (error) {\n        this.logger.error({\n          local: 'RabbitmqController.initGlobalQueues',\n          message: `Failed to initialize global queue for event ${event}`,\n          error: error.message || error,\n        });\n        this.handleConnectionLoss();\n        break;\n      }\n    }\n  }\n\n  public async cleanup(): Promise<void> {\n    try {\n      if (this.amqpChannel) {\n        await this.amqpChannel.close();\n        this.amqpChannel = null;\n      }\n      if (this.amqpConnection) {\n        await this.amqpConnection.close();\n        this.amqpConnection = null;\n      }\n    } catch (error) {\n      this.logger.warn({\n        local: 'RabbitmqController.cleanup',\n        message: 'Error during cleanup',\n        error: error.message || error,\n      });\n      this.amqpChannel = null;\n      this.amqpConnection = null;\n    }\n  }\n}\n","import * as s3Service from '@api/integrations/storage/s3/libs/minio.server';\nimport { PrismaRepository } from '@api/repository/repository.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { CreateQueueCommand, DeleteQueueCommand, ListQueuesCommand, SQS } from '@aws-sdk/client-sqs';\nimport { configService, HttpServer, Log, S3, Sqs } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\n\nimport { EmitData, EventController, EventControllerInterface } from '../event.controller';\nimport { EventDto } from '../event.dto';\n\nexport class SqsController extends EventController implements EventControllerInterface {\n  private sqs: SQS;\n  private readonly logger = new Logger('SqsController');\n\n  constructor(prismaRepository: PrismaRepository, waMonitor: WAMonitoringService) {\n    super(prismaRepository, waMonitor, configService.get<Sqs>('SQS')?.ENABLED, 'sqs');\n  }\n\n  public async init(): Promise<void> {\n    if (!this.status) {\n      return;\n    }\n\n    const awsConfig = configService.get<Sqs>('SQS');\n\n    this.sqs = new SQS({\n      credentials: {\n        accessKeyId: awsConfig.ACCESS_KEY_ID,\n        secretAccessKey: awsConfig.SECRET_ACCESS_KEY,\n      },\n\n      region: awsConfig.REGION,\n    });\n\n    this.logger.info('SQS initialized');\n\n    const sqsConfig = configService.get<Sqs>('SQS');\n    if (this.sqs && sqsConfig.GLOBAL_ENABLED) {\n      const sqsEvents = Object.keys(sqsConfig.EVENTS).filter((e) => sqsConfig.EVENTS[e]);\n      await this.saveQueues(sqsConfig.GLOBAL_PREFIX_NAME, sqsEvents, true);\n    }\n  }\n\n  private set channel(sqs: SQS) {\n    this.sqs = sqs;\n  }\n\n  public get channel(): SQS {\n    return this.sqs;\n  }\n\n  override async set(instanceName: string, data: EventDto): Promise<any> {\n    if (!this.status || configService.get<Sqs>('SQS').GLOBAL_ENABLED) {\n      return;\n    }\n\n    if (!data[this.name]?.enabled) {\n      data[this.name].events = [];\n    } else {\n      if (0 === data[this.name].events.length) {\n        data[this.name].events = EventController.events;\n      }\n    }\n\n    await this.saveQueues(instanceName, data[this.name].events, data[this.name]?.enabled);\n\n    const payload: any = {\n      where: {\n        instanceId: this.monitor.waInstances[instanceName].instanceId,\n      },\n      update: {\n        enabled: data[this.name]?.enabled,\n        events: data[this.name].events,\n      },\n      create: {\n        enabled: data[this.name]?.enabled,\n        events: data[this.name].events,\n        instanceId: this.monitor.waInstances[instanceName].instanceId,\n      },\n    };\n\n    console.log('*** payload: ', payload);\n    return this.prisma[this.name].upsert(payload);\n  }\n\n  public async emit({\n    instanceName,\n    origin,\n    event,\n    data,\n    serverUrl,\n    dateTime,\n    sender,\n    apiKey,\n    integration,\n    extra,\n  }: EmitData): Promise<void> {\n    if (integration && !integration.includes('sqs')) {\n      return;\n    }\n\n    if (!this.status) {\n      return;\n    }\n\n    if (this.sqs) {\n      const serverConfig = configService.get<HttpServer>('SERVER');\n      const sqsConfig = configService.get<Sqs>('SQS');\n\n      const we = event.replace(/[.-]/gm, '_').toUpperCase();\n\n      let sqsEvents = [];\n      if (sqsConfig.GLOBAL_ENABLED) {\n        sqsEvents = Object.keys(sqsConfig.EVENTS).filter((e) => sqsConfig.EVENTS[e]);\n      } else {\n        const instanceSqs = await this.get(instanceName);\n        if (instanceSqs?.enabled && Array.isArray(instanceSqs?.events)) {\n          sqsEvents = instanceSqs?.events;\n        }\n      }\n\n      if (Array.isArray(sqsEvents) && sqsEvents.includes(we)) {\n        const prefixName = sqsConfig.GLOBAL_ENABLED ? sqsConfig.GLOBAL_PREFIX_NAME : instanceName;\n        const eventFormatted =\n          sqsConfig.GLOBAL_ENABLED && sqsConfig.GLOBAL_FORCE_SINGLE_QUEUE\n            ? 'singlequeue'\n            : `${event.replace('.', '_').toLowerCase()}`;\n        const queueName = `${prefixName}_${eventFormatted}.fifo`;\n        const sqsUrl = `https://sqs.${sqsConfig.REGION}.amazonaws.com/${sqsConfig.ACCOUNT_ID}/${queueName}`;\n\n        const message = {\n          ...(extra ?? {}),\n          event,\n          instance: instanceName,\n          dataType: 'json',\n          data,\n          server: serverConfig.NAME,\n          server_url: serverUrl,\n          date_time: dateTime,\n          sender,\n          apikey: apiKey,\n        };\n\n        const jsonStr = JSON.stringify(message);\n        const size = Buffer.byteLength(jsonStr, 'utf8');\n        if (size > sqsConfig.MAX_PAYLOAD_SIZE) {\n          if (!configService.get<S3>('S3').ENABLE) {\n            this.logger.error(\n              `${instanceName} - ${eventFormatted} - SQS ignored: payload (${size} bytes) exceeds SQS size limit (${sqsConfig.MAX_PAYLOAD_SIZE} bytes) and S3 storage is not enabled.`,\n            );\n            return;\n          }\n\n          const buffer = Buffer.from(jsonStr, 'utf8');\n          const fullName = `messages/${instanceName}_${eventFormatted}_${Date.now()}.json`;\n\n          await s3Service.uploadFile(fullName, buffer, size, {\n            'Content-Type': 'application/json',\n            'Cache-Control': 'no-store',\n          });\n\n          const fileUrl = await s3Service.getObjectUrl(fullName);\n\n          message.data = { fileUrl };\n          message.dataType = 's3';\n        }\n\n        const messageGroupId = sqsConfig.GLOBAL_ENABLED\n          ? `${serverConfig.NAME}-${eventFormatted}-${instanceName}`\n          : 'evolution';\n        const isGlobalEnabled = sqsConfig.GLOBAL_ENABLED;\n        const params = {\n          MessageBody: JSON.stringify(message),\n          MessageGroupId: messageGroupId,\n          QueueUrl: sqsUrl,\n          ...(!isGlobalEnabled && {\n            MessageDeduplicationId: `${instanceName}_${eventFormatted}_${Date.now()}`,\n          }),\n        };\n\n        this.sqs.sendMessage(params, (err) => {\n          if (err) {\n            this.logger.error({\n              local: `${origin}.sendData-SQS`,\n              params: JSON.stringify(message),\n              sqsUrl: sqsUrl,\n              message: err?.message,\n              hostName: err?.hostname,\n              code: err?.code,\n              stack: err?.stack,\n              name: err?.name,\n              url: queueName,\n              server_url: serverUrl,\n            });\n          } else if (configService.get<Log>('LOG').LEVEL.includes('WEBHOOKS')) {\n            const logData = {\n              local: `${origin}.sendData-SQS`,\n              ...message,\n            };\n\n            this.logger.log(logData);\n          }\n        });\n      }\n    }\n  }\n\n  private async saveQueues(prefixName: string, events: string[], enable: boolean) {\n    if (enable) {\n      const sqsConfig = configService.get<Sqs>('SQS');\n      const eventsFinded = await this.listQueues(prefixName);\n      console.log('eventsFinded', eventsFinded);\n\n      for (const event of events) {\n        const normalizedEvent =\n          sqsConfig.GLOBAL_ENABLED && sqsConfig.GLOBAL_FORCE_SINGLE_QUEUE ? 'singlequeue' : event.toLowerCase();\n        if (eventsFinded.includes(normalizedEvent)) {\n          this.logger.info(`A queue para o evento \"${normalizedEvent}\" j existe. Ignorando criao.`);\n          continue;\n        }\n\n        const queueName = `${prefixName}_${normalizedEvent}.fifo`;\n        try {\n          const isGlobalEnabled = sqsConfig.GLOBAL_ENABLED;\n          const createCommand = new CreateQueueCommand({\n            QueueName: queueName,\n            Attributes: {\n              FifoQueue: 'true',\n              ...(isGlobalEnabled && { ContentBasedDeduplication: 'true' }),\n            },\n          });\n\n          const data = await this.sqs.send(createCommand);\n          this.logger.info(`Queue ${queueName} criada: ${data.QueueUrl}`);\n        } catch (err: any) {\n          this.logger.error(`Erro ao criar queue ${queueName}: ${err.message}`);\n        }\n\n        if (sqsConfig.GLOBAL_ENABLED && sqsConfig.GLOBAL_FORCE_SINGLE_QUEUE) {\n          break;\n        }\n      }\n    }\n  }\n\n  private async listQueues(prefixName: string) {\n    let existingQueues: string[] = [];\n\n    try {\n      const listCommand = new ListQueuesCommand({\n        QueueNamePrefix: `${prefixName}_`,\n      });\n\n      const listData = await this.sqs.send(listCommand);\n      if (listData.QueueUrls && listData.QueueUrls.length > 0) {\n        // Extrai o nome da fila a partir da URL\n        existingQueues = listData.QueueUrls.map((queueUrl) => {\n          const parts = queueUrl.split('/');\n          return parts[parts.length - 1];\n        });\n      }\n    } catch (error: any) {\n      this.logger.error(`Erro ao listar filas para ${prefixName}: ${error.message}`);\n      return;\n    }\n\n    // Mapeia os eventos j existentes nas filas: remove o prefixo e o sufixo \".fifo\"\n    return existingQueues\n      .map((queueName) => {\n        // Espera-se que o nome seja `${instanceName}_${event}.fifo`\n        if (queueName.startsWith(`${prefixName}_`) && queueName.endsWith('.fifo')) {\n          return queueName.substring(prefixName.length + 1, queueName.length - 5).toLowerCase();\n        }\n        return '';\n      })\n      .filter((event) => event !== '');\n  }\n\n  // Para uma futura feature de excluso forada das queues\n  private async removeQueuesByInstance(prefixName: string) {\n    try {\n      const listCommand = new ListQueuesCommand({\n        QueueNamePrefix: `${prefixName}_`,\n      });\n      const listData = await this.sqs.send(listCommand);\n\n      if (!listData.QueueUrls || listData.QueueUrls.length === 0) {\n        this.logger.info(`No queues found for ${prefixName}`);\n        return;\n      }\n\n      for (const queueUrl of listData.QueueUrls) {\n        try {\n          const deleteCommand = new DeleteQueueCommand({ QueueUrl: queueUrl });\n          await this.sqs.send(deleteCommand);\n          this.logger.info(`Queue ${queueUrl} deleted`);\n        } catch (err: any) {\n          this.logger.error(`Error deleting queue ${queueUrl}: ${err.message}`);\n        }\n      }\n    } catch (err: any) {\n      this.logger.error(`Error listing queues for ${prefixName}: ${err.message}`);\n    }\n  }\n}\n","import { EventDto } from '@api/integrations/event/event.dto';\nimport { PrismaRepository } from '@api/repository/repository.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { wa } from '@api/types/wa.types';\nimport { configService, Log, Webhook } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\n// import { BadRequestException } from '@exceptions';\nimport axios, { AxiosInstance } from 'axios';\nimport * as jwt from 'jsonwebtoken';\n\nimport { EmitData, EventController, EventControllerInterface } from '../event.controller';\n\nexport class WebhookController extends EventController implements EventControllerInterface {\n  private readonly logger = new Logger('WebhookController');\n\n  constructor(prismaRepository: PrismaRepository, waMonitor: WAMonitoringService) {\n    super(prismaRepository, waMonitor, true, 'webhook');\n  }\n\n  override async set(instanceName: string, data: EventDto): Promise<wa.LocalWebHook> {\n    // if (!/^(https?:\\/\\/)/.test(data.webhook.url)) {\n    //   throw new BadRequestException('Invalid \"url\" property');\n    // }\n\n    if (!data.webhook?.enabled) {\n      data.webhook.events = [];\n    } else {\n      if (0 === data.webhook.events.length) {\n        data.webhook.events = EventController.events;\n      }\n    }\n\n    return this.prisma.webhook.upsert({\n      where: {\n        instanceId: this.monitor.waInstances[instanceName].instanceId,\n      },\n      update: {\n        enabled: data.webhook?.enabled,\n        events: data.webhook?.events,\n        url: data.webhook?.url,\n        headers: data.webhook?.headers,\n        webhookBase64: data.webhook.base64,\n        webhookByEvents: data.webhook.byEvents,\n      },\n      create: {\n        enabled: data.webhook?.enabled,\n        events: data.webhook?.events,\n        instanceId: this.monitor.waInstances[instanceName].instanceId,\n        url: data.webhook?.url,\n        headers: data.webhook?.headers,\n        webhookBase64: data.webhook.base64,\n        webhookByEvents: data.webhook.byEvents,\n      },\n    });\n  }\n\n  public async emit({\n    instanceName,\n    origin,\n    event,\n    data,\n    serverUrl,\n    dateTime,\n    sender,\n    apiKey,\n    local,\n    integration,\n    extra,\n  }: EmitData): Promise<void> {\n    if (integration && !integration.includes('webhook')) {\n      return;\n    }\n\n    const instance = (await this.get(instanceName)) as wa.LocalWebHook;\n\n    const webhookConfig = configService.get<Webhook>('WEBHOOK');\n    const webhookLocal = instance?.events;\n    const webhookHeaders = { ...((instance?.headers as Record<string, string>) || {}) };\n\n    if (webhookHeaders && 'jwt_key' in webhookHeaders) {\n      const jwtKey = webhookHeaders['jwt_key'];\n      const jwtToken = this.generateJwtToken(jwtKey);\n      webhookHeaders['Authorization'] = `Bearer ${jwtToken}`;\n\n      delete webhookHeaders['jwt_key'];\n    }\n\n    const we = event.replace(/[.-]/gm, '_').toUpperCase();\n    const transformedWe = we.replace(/_/gm, '-').toLowerCase();\n    const enabledLog = configService.get<Log>('LOG').LEVEL.includes('WEBHOOKS');\n    const regex = /^(https?:\\/\\/)/;\n\n    const webhookData = {\n      ...(extra ?? {}),\n      event,\n      instance: instanceName,\n      data,\n      destination: instance?.url || `${webhookConfig.GLOBAL.URL}/${transformedWe}`,\n      date_time: dateTime,\n      sender,\n      server_url: serverUrl,\n      apikey: apiKey,\n    };\n\n    if (local && instance?.enabled) {\n      if (Array.isArray(webhookLocal) && webhookLocal.includes(we)) {\n        let baseURL: string;\n\n        if (instance?.webhookByEvents) {\n          baseURL = `${instance?.url}/${transformedWe}`;\n        } else {\n          baseURL = instance?.url;\n        }\n\n        if (enabledLog) {\n          const logData = {\n            local: `${origin}.sendData-Webhook`,\n            url: baseURL,\n            ...webhookData,\n          };\n\n          this.logger.log(logData);\n        }\n\n        try {\n          if (instance?.enabled && regex.test(instance.url)) {\n            const httpService = axios.create({\n              baseURL,\n              headers: webhookHeaders as Record<string, string> | undefined,\n              timeout: webhookConfig.REQUEST?.TIMEOUT_MS ?? 30000,\n            });\n\n            await this.retryWebhookRequest(httpService, webhookData, `${origin}.sendData-Webhook`, baseURL, serverUrl);\n          }\n        } catch (error) {\n          this.logger.error({\n            local: `${origin}.sendData-Webhook`,\n            message: `Todas as tentativas falharam: ${error?.message}`,\n            hostName: error?.hostname,\n            syscall: error?.syscall,\n            code: error?.code,\n            error: error?.errno,\n            stack: error?.stack,\n            name: error?.name,\n            url: baseURL,\n            server_url: serverUrl,\n          });\n        }\n      }\n    }\n\n    if (webhookConfig.GLOBAL?.ENABLED) {\n      if (webhookConfig.EVENTS[we]) {\n        let globalURL = webhookConfig.GLOBAL.URL;\n\n        if (webhookConfig.GLOBAL.WEBHOOK_BY_EVENTS) {\n          globalURL = `${globalURL}/${transformedWe}`;\n        }\n\n        if (enabledLog) {\n          const logData = {\n            local: `${origin}.sendData-Webhook-Global`,\n            url: globalURL,\n            ...webhookData,\n          };\n\n          this.logger.log(logData);\n        }\n\n        try {\n          if (regex.test(globalURL)) {\n            const httpService = axios.create({\n              baseURL: globalURL,\n              timeout: webhookConfig.REQUEST?.TIMEOUT_MS ?? 30000,\n            });\n\n            await this.retryWebhookRequest(\n              httpService,\n              webhookData,\n              `${origin}.sendData-Webhook-Global`,\n              globalURL,\n              serverUrl,\n            );\n          }\n        } catch (error) {\n          this.logger.error({\n            local: `${origin}.sendData-Webhook-Global`,\n            message: `Todas as tentativas falharam: ${error?.message}`,\n            hostName: error?.hostname,\n            syscall: error?.syscall,\n            code: error?.code,\n            error: error?.errno,\n            stack: error?.stack,\n            name: error?.name,\n            url: globalURL,\n            server_url: serverUrl,\n          });\n        }\n      }\n    }\n  }\n\n  private async retryWebhookRequest(\n    httpService: AxiosInstance,\n    webhookData: any,\n    origin: string,\n    baseURL: string,\n    serverUrl: string,\n    maxRetries?: number,\n    delaySeconds?: number,\n  ): Promise<void> {\n    const webhookConfig = configService.get<Webhook>('WEBHOOK');\n    const maxRetryAttempts = maxRetries ?? webhookConfig.RETRY?.MAX_ATTEMPTS ?? 10;\n    const initialDelay = delaySeconds ?? webhookConfig.RETRY?.INITIAL_DELAY_SECONDS ?? 5;\n    const useExponentialBackoff = webhookConfig.RETRY?.USE_EXPONENTIAL_BACKOFF ?? true;\n    const maxDelay = webhookConfig.RETRY?.MAX_DELAY_SECONDS ?? 300;\n    const jitterFactor = webhookConfig.RETRY?.JITTER_FACTOR ?? 0.2;\n    const nonRetryableStatusCodes = webhookConfig.RETRY?.NON_RETRYABLE_STATUS_CODES ?? [400, 401, 403, 404, 422];\n\n    let attempts = 0;\n\n    while (attempts < maxRetryAttempts) {\n      try {\n        await httpService.post('', webhookData);\n        if (attempts > 0) {\n          this.logger.log({\n            local: `${origin}`,\n            message: `Sucesso no envio aps ${attempts + 1} tentativas`,\n            url: baseURL,\n          });\n        }\n        return;\n      } catch (error) {\n        attempts++;\n\n        const isTimeout = error.code === 'ECONNABORTED';\n\n        if (error?.response?.status && nonRetryableStatusCodes.includes(error.response.status)) {\n          this.logger.error({\n            local: `${origin}`,\n            message: `Erro no recupervel (${error.response.status}): ${error?.message}. Cancelando retentativas.`,\n            statusCode: error?.response?.status,\n            url: baseURL,\n            server_url: serverUrl,\n          });\n          throw error;\n        }\n\n        this.logger.error({\n          local: `${origin}`,\n          message: `Tentativa ${attempts}/${maxRetryAttempts} falhou: ${isTimeout ? 'Timeout da requisio' : error?.message}`,\n          hostName: error?.hostname,\n          syscall: error?.syscall,\n          code: error?.code,\n          isTimeout,\n          statusCode: error?.response?.status,\n          error: error?.errno,\n          stack: error?.stack,\n          name: error?.name,\n          url: baseURL,\n          server_url: serverUrl,\n        });\n\n        if (attempts === maxRetryAttempts) {\n          throw error;\n        }\n\n        let nextDelay = initialDelay;\n        if (useExponentialBackoff) {\n          nextDelay = Math.min(initialDelay * Math.pow(2, attempts - 1), maxDelay);\n\n          const jitter = nextDelay * jitterFactor * (Math.random() * 2 - 1);\n          nextDelay = Math.max(initialDelay, nextDelay + jitter);\n        }\n\n        this.logger.log({\n          local: `${origin}`,\n          message: `Aguardando ${nextDelay.toFixed(1)} segundos antes da prxima tentativa`,\n          url: baseURL,\n        });\n\n        await new Promise((resolve) => setTimeout(resolve, nextDelay * 1000));\n      }\n    }\n  }\n\n  private generateJwtToken(authToken: string): string {\n    try {\n      const payload = {\n        iat: Math.floor(Date.now() / 1000),\n        exp: Math.floor(Date.now() / 1000) + 600, // 10 min expiration\n        app: 'evolution',\n        action: 'webhook',\n      };\n\n      const token = jwt.sign(payload, authToken, { algorithm: 'HS256' });\n      return token;\n    } catch (error) {\n      this.logger.error({\n        local: 'WebhookController.generateJwtToken',\n        message: `JWT generation failed: ${error?.message}`,\n      });\n      throw error;\n    }\n  }\n}\n","import { PrismaRepository } from '@api/repository/repository.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { Auth, configService, Cors, Log, Websocket } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\nimport { Server } from 'http';\nimport { Server as SocketIO } from 'socket.io';\n\nimport { EmitData, EventController, EventControllerInterface } from '../event.controller';\n\nexport class WebsocketController extends EventController implements EventControllerInterface {\n  private io: SocketIO;\n  private corsConfig: Array<any>;\n  private readonly logger = new Logger('WebsocketController');\n\n  constructor(prismaRepository: PrismaRepository, waMonitor: WAMonitoringService) {\n    super(prismaRepository, waMonitor, configService.get<Websocket>('WEBSOCKET')?.ENABLED, 'websocket');\n\n    this.cors = configService.get<Cors>('CORS').ORIGIN;\n  }\n\n  public init(httpServer: Server): void {\n    if (!this.status) {\n      return;\n    }\n\n    this.socket = new SocketIO(httpServer, {\n      cors: { origin: this.cors },\n      allowRequest: async (req, callback) => {\n        try {\n          const url = new URL(req.url || '', 'http://localhost');\n          const params = new URLSearchParams(url.search);\n\n          const { remoteAddress } = req.socket;\n          const websocketConfig = configService.get<Websocket>('WEBSOCKET');\n          const allowedHosts = websocketConfig.ALLOWED_HOSTS || '127.0.0.1,::1,::ffff:127.0.0.1';\n          const allowAllHosts = allowedHosts.trim() === '*';\n          const isAllowedHost =\n            allowAllHosts ||\n            allowedHosts\n              .split(',')\n              .map((h) => h.trim())\n              .includes(remoteAddress);\n\n          if (params.has('EIO') && isAllowedHost) {\n            return callback(null, true);\n          }\n\n          const apiKey = params.get('apikey') || (req.headers.apikey as string);\n\n          if (!apiKey) {\n            this.logger.error('Connection rejected: apiKey not provided');\n            return callback('apiKey is required', false);\n          }\n\n          const instance = await this.prismaRepository.instance.findFirst({ where: { token: apiKey } });\n\n          if (!instance) {\n            const globalToken = configService.get<Auth>('AUTHENTICATION').API_KEY.KEY;\n            if (apiKey !== globalToken) {\n              this.logger.error('Connection rejected: invalid global token');\n              return callback('Invalid global token', false);\n            }\n          }\n\n          callback(null, true);\n        } catch (error) {\n          this.logger.error('Authentication error:');\n          this.logger.error(error);\n          callback('Authentication error', false);\n        }\n      },\n    });\n\n    this.socket.on('connection', (socket) => {\n      this.logger.info('User connected');\n\n      socket.on('disconnect', () => {\n        this.logger.info('User disconnected');\n      });\n\n      socket.on('sendNode', async (data) => {\n        try {\n          await this.waMonitor.waInstances[data.instanceId].baileysSendNode(data.stanza);\n          this.logger.info('Node sent successfully');\n        } catch (error) {\n          this.logger.error('Error sending node:');\n          this.logger.error(error);\n        }\n      });\n    });\n\n    this.logger.info('Socket.io initialized');\n  }\n\n  private set cors(cors: Array<any>) {\n    this.corsConfig = cors;\n  }\n\n  private get cors(): string | Array<any> {\n    return this.corsConfig?.includes('*') ? '*' : this.corsConfig;\n  }\n\n  private set socket(socket: SocketIO) {\n    this.io = socket;\n  }\n\n  public get socket(): SocketIO {\n    return this.io;\n  }\n\n  public async emit({\n    instanceName,\n    origin,\n    event,\n    data,\n    serverUrl,\n    dateTime,\n    sender,\n    apiKey,\n    integration,\n    extra,\n  }: EmitData): Promise<void> {\n    if (integration && !integration.includes('websocket')) {\n      return;\n    }\n\n    if (!this.status) {\n      return;\n    }\n\n    const configEv = event.replace(/[.-]/gm, '_').toUpperCase();\n    const logEnabled = configService.get<Log>('LOG').LEVEL.includes('WEBSOCKET');\n    const message = {\n      ...(extra ?? {}),\n      event,\n      instance: instanceName,\n      data,\n      server_url: serverUrl,\n      date_time: dateTime,\n      sender,\n      apikey: apiKey,\n    };\n\n    if (configService.get<Websocket>('WEBSOCKET')?.GLOBAL_EVENTS) {\n      this.socket.emit(event, message);\n\n      if (logEnabled) {\n        this.logger.log({ local: `${origin}.sendData-WebsocketGlobal`, ...message });\n      }\n    }\n\n    try {\n      const instance = await this.get(instanceName);\n\n      if (!instance?.enabled) {\n        return;\n      }\n\n      if (Array.isArray(instance?.events) && instance?.events.includes(configEv)) {\n        this.socket.of(`/${instanceName}`).emit(event, message);\n\n        if (logEnabled) {\n          this.logger.log({ local: `${origin}.sendData-Websocket`, ...message });\n        }\n      }\n    } catch (err) {\n      if (logEnabled) {\n        this.logger.log(err);\n      }\n    }\n  }\n}\n","import { KafkaController } from '@api/integrations/event/kafka/kafka.controller';\nimport { NatsController } from '@api/integrations/event/nats/nats.controller';\nimport { PusherController } from '@api/integrations/event/pusher/pusher.controller';\nimport { RabbitmqController } from '@api/integrations/event/rabbitmq/rabbitmq.controller';\nimport { SqsController } from '@api/integrations/event/sqs/sqs.controller';\nimport { WebhookController } from '@api/integrations/event/webhook/webhook.controller';\nimport { WebsocketController } from '@api/integrations/event/websocket/websocket.controller';\nimport { PrismaRepository } from '@api/repository/repository.service';\nimport { WAMonitoringService } from '@api/services/monitor.service';\nimport { Server } from 'http';\n\nexport class EventManager {\n  private prismaRepository: PrismaRepository;\n  private waMonitor: WAMonitoringService;\n  private websocketController: WebsocketController;\n  private webhookController: WebhookController;\n  private rabbitmqController: RabbitmqController;\n  private natsController: NatsController;\n  private sqsController: SqsController;\n  private pusherController: PusherController;\n  private kafkaController: KafkaController;\n\n  constructor(prismaRepository: PrismaRepository, waMonitor: WAMonitoringService) {\n    this.prisma = prismaRepository;\n    this.monitor = waMonitor;\n\n    this.websocket = new WebsocketController(prismaRepository, waMonitor);\n    this.webhook = new WebhookController(prismaRepository, waMonitor);\n    this.rabbitmq = new RabbitmqController(prismaRepository, waMonitor);\n    this.nats = new NatsController(prismaRepository, waMonitor);\n    this.sqs = new SqsController(prismaRepository, waMonitor);\n    this.pusher = new PusherController(prismaRepository, waMonitor);\n    this.kafka = new KafkaController(prismaRepository, waMonitor);\n  }\n\n  public set prisma(prisma: PrismaRepository) {\n    this.prismaRepository = prisma;\n  }\n\n  public get prisma() {\n    return this.prismaRepository;\n  }\n\n  public set monitor(waMonitor: WAMonitoringService) {\n    this.waMonitor = waMonitor;\n  }\n\n  public get monitor() {\n    return this.waMonitor;\n  }\n\n  public set websocket(websocket: WebsocketController) {\n    this.websocketController = websocket;\n  }\n\n  public get websocket() {\n    return this.websocketController;\n  }\n\n  public set webhook(webhook: WebhookController) {\n    this.webhookController = webhook;\n  }\n\n  public get webhook() {\n    return this.webhookController;\n  }\n\n  public set rabbitmq(rabbitmq: RabbitmqController) {\n    this.rabbitmqController = rabbitmq;\n  }\n\n  public get rabbitmq() {\n    return this.rabbitmqController;\n  }\n\n  public set nats(nats: NatsController) {\n    this.natsController = nats;\n  }\n\n  public get nats() {\n    return this.natsController;\n  }\n\n  public set sqs(sqs: SqsController) {\n    this.sqsController = sqs;\n  }\n\n  public get sqs() {\n    return this.sqsController;\n  }\n\n  public set pusher(pusher: PusherController) {\n    this.pusherController = pusher;\n  }\n  public get pusher() {\n    return this.pusherController;\n  }\n\n  public set kafka(kafka: KafkaController) {\n    this.kafkaController = kafka;\n  }\n  public get kafka() {\n    return this.kafkaController;\n  }\n\n  public init(httpServer: Server): void {\n    this.websocket.init(httpServer);\n    this.rabbitmq.init();\n    this.nats.init();\n    this.sqs.init();\n    this.pusher.init();\n    this.kafka.init();\n  }\n\n  public async emit(eventData: {\n    instanceName: string;\n    origin: string;\n    event: string;\n    data: object;\n    serverUrl: string;\n    dateTime: string;\n    sender: string;\n    apiKey?: string;\n    local?: boolean;\n    integration?: string[];\n    extra?: Record<string, any>;\n  }): Promise<void> {\n    await this.websocket.emit(eventData);\n    await this.rabbitmq.emit(eventData);\n    await this.nats.emit(eventData);\n    await this.sqs.emit(eventData);\n    await this.webhook.emit(eventData);\n    await this.pusher.emit(eventData);\n    await this.kafka.emit(eventData);\n  }\n\n  public async setInstance(instanceName: string, data: any): Promise<any> {\n    if (data.websocket) {\n      await this.websocket.set(instanceName, {\n        websocket: {\n          enabled: true,\n          events: data.websocket?.events,\n        },\n      });\n    }\n\n    if (data.rabbitmq) {\n      await this.rabbitmq.set(instanceName, {\n        rabbitmq: {\n          enabled: true,\n          events: data.rabbitmq?.events,\n        },\n      });\n    }\n\n    if (data.nats) {\n      await this.nats.set(instanceName, {\n        nats: {\n          enabled: true,\n          events: data.nats?.events,\n        },\n      });\n    }\n\n    if (data.sqs) {\n      await this.sqs.set(instanceName, {\n        sqs: {\n          enabled: true,\n          events: data.sqs?.events,\n        },\n      });\n    }\n\n    if (data.webhook) {\n      await this.webhook.set(instanceName, {\n        webhook: {\n          enabled: true,\n          events: data.webhook?.events,\n          url: data.webhook?.url,\n          headers: data.webhook?.headers,\n          base64: data.webhook?.base64,\n          byEvents: data.webhook?.byEvents,\n        },\n      });\n    }\n\n    if (data.pusher) {\n      await this.pusher.set(instanceName, {\n        pusher: {\n          enabled: true,\n          events: data.pusher?.events,\n          appId: data.pusher?.appId,\n          key: data.pusher?.key,\n          secret: data.pusher?.secret,\n          cluster: data.pusher?.cluster,\n          useTLS: data.pusher?.useTLS,\n        },\n      });\n    }\n\n    if (data.kafka) {\n      await this.kafka.set(instanceName, {\n        kafka: {\n          enabled: true,\n          events: data.kafka?.events,\n        },\n      });\n    }\n  }\n}\n","import { InstanceDto } from '@api/dto/instance.dto';\nimport { MediaDto } from '@api/integrations/storage/s3/dto/media.dto';\nimport { S3Service } from '@api/integrations/storage/s3/services/s3.service';\n\nexport class S3Controller {\n  constructor(private readonly s3Service: S3Service) {}\n\n  public async getMedia(instance: InstanceDto, data: MediaDto) {\n    return this.s3Service.getMedia(instance, data);\n  }\n\n  public async getMediaUrl(instance: InstanceDto, data: MediaDto) {\n    return this.s3Service.getMediaUrl(instance, data);\n  }\n}\n","import { InstanceDto } from '@api/dto/instance.dto';\nimport { MediaDto } from '@api/integrations/storage/s3/dto/media.dto';\nimport { getObjectUrl } from '@api/integrations/storage/s3/libs/minio.server';\nimport { PrismaRepository } from '@api/repository/repository.service';\nimport { Logger } from '@config/logger.config';\nimport { BadRequestException } from '@exceptions';\n\nexport class S3Service {\n  constructor(private readonly prismaRepository: PrismaRepository) {}\n\n  private readonly logger = new Logger('S3Service');\n\n  public async getMedia(instance: InstanceDto, query?: MediaDto) {\n    try {\n      const where: any = {\n        instanceId: instance.instanceId,\n        ...query,\n      };\n\n      const media = await this.prismaRepository.media.findMany({\n        where,\n        select: {\n          id: true,\n          fileName: true,\n          type: true,\n          mimetype: true,\n          createdAt: true,\n          Message: true,\n        },\n      });\n\n      if (!media || media.length === 0) {\n        throw 'Media not found';\n      }\n\n      return media;\n    } catch (error) {\n      throw new BadRequestException(error);\n    }\n  }\n\n  public async getMediaUrl(instance: InstanceDto, data: MediaDto) {\n    const media = (await this.getMedia(instance, { id: data.id }))[0];\n    const mediaUrl = await getObjectUrl(media.fileName, data.expiry);\n    return {\n      mediaUrl,\n      ...media,\n    };\n  }\n}\n","import { InstanceDto } from '@api/dto/instance.dto';\nimport { ProviderFiles } from '@api/provider/sessions';\nimport { PrismaRepository } from '@api/repository/repository.service';\nimport { channelController } from '@api/server.module';\nimport { Events, Integration } from '@api/types/wa.types';\nimport { CacheConf, Chatwoot, ConfigService, Database, DelInstance, ProviderSession } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\nimport { INSTANCE_DIR, STORE_DIR } from '@config/path.config';\nimport { NotFoundException } from '@exceptions';\nimport { execFileSync } from 'child_process';\nimport EventEmitter2 from 'eventemitter2';\nimport { rmSync } from 'fs';\nimport { join } from 'path';\n\nimport { CacheService } from './cache.service';\n\nexport class WAMonitoringService {\n  constructor(\n    private readonly eventEmitter: EventEmitter2,\n    private readonly configService: ConfigService,\n    private readonly prismaRepository: PrismaRepository,\n    private readonly providerFiles: ProviderFiles,\n    private readonly cache: CacheService,\n    private readonly chatwootCache: CacheService,\n    private readonly baileysCache: CacheService,\n  ) {\n    this.removeInstance();\n    this.noConnection();\n\n    Object.assign(this.db, configService.get<Database>('DATABASE'));\n    Object.assign(this.redis, configService.get<CacheConf>('CACHE'));\n\n    (this as any).providerSession = Object.freeze(configService.get<ProviderSession>('PROVIDER'));\n  }\n\n  private readonly db: Partial<Database> = {};\n  private readonly redis: Partial<CacheConf> = {};\n\n  private readonly logger = new Logger('WAMonitoringService');\n  public readonly waInstances: Record<string, any> = {};\n  private readonly delInstanceTimeouts: Record<string, NodeJS.Timeout> = {};\n\n  private readonly providerSession: ProviderSession;\n\n  public delInstanceTime(instance: string) {\n    const time = this.configService.get<DelInstance>('DEL_INSTANCE');\n    if (typeof time === 'number' && time > 0) {\n      // Clear previous timeout if exists\n      if (this.delInstanceTimeouts[instance]) {\n        clearTimeout(this.delInstanceTimeouts[instance]);\n      }\n\n      // Set new timeout and store reference\n      this.delInstanceTimeouts[instance] = setTimeout(\n        async () => {\n          try {\n            if (this.waInstances[instance]?.connectionStatus?.state !== 'open') {\n              if (this.waInstances[instance]?.connectionStatus?.state === 'connecting') {\n                if ((await this.waInstances[instance].integration) === Integration.WHATSAPP_BAILEYS) {\n                  await this.waInstances[instance]?.client?.logout('Log out instance: ' + instance);\n                  this.waInstances[instance]?.client?.ws?.close();\n                  this.waInstances[instance]?.client?.end(undefined);\n                }\n                this.eventEmitter.emit('remove.instance', instance, 'inner');\n              } else {\n                this.eventEmitter.emit('remove.instance', instance, 'inner');\n              }\n            }\n          } finally {\n            // Clean up timeout reference\n            delete this.delInstanceTimeouts[instance];\n          }\n        },\n        1000 * 60 * time,\n      );\n    }\n  }\n\n  public clearDelInstanceTime(instance: string) {\n    if (this.delInstanceTimeouts[instance]) {\n      clearTimeout(this.delInstanceTimeouts[instance]);\n      delete this.delInstanceTimeouts[instance];\n    }\n  }\n\n  public async instanceInfo(instanceNames?: string[]): Promise<any> {\n    if (instanceNames && instanceNames.length > 0) {\n      const inexistentInstances = instanceNames ? instanceNames.filter((instance) => !this.waInstances[instance]) : [];\n\n      if (inexistentInstances.length > 0) {\n        throw new NotFoundException(\n          `Instance${inexistentInstances.length > 1 ? 's' : ''} \"${inexistentInstances.join(', ')}\" not found`,\n        );\n      }\n    }\n\n    const clientName = this.configService.get<Database>('DATABASE').CONNECTION.CLIENT_NAME;\n\n    const where =\n      instanceNames && instanceNames.length > 0\n        ? {\n            name: {\n              in: instanceNames,\n            },\n            clientName,\n          }\n        : { clientName };\n\n    const instances = await this.prismaRepository.instance.findMany({\n      where,\n      include: {\n        Chatwoot: true,\n        Proxy: true,\n        Rabbitmq: true,\n        Nats: true,\n        Sqs: true,\n        Websocket: true,\n        Setting: true,\n        _count: {\n          select: {\n            Message: true,\n            Contact: true,\n            Chat: true,\n          },\n        },\n      },\n    });\n\n    return instances;\n  }\n\n  public async instanceInfoById(instanceId?: string, number?: string) {\n    let instanceName: string;\n    if (instanceId) {\n      instanceName = await this.prismaRepository.instance.findFirst({ where: { id: instanceId } }).then((r) => r?.name);\n      if (!instanceName) {\n        throw new NotFoundException(`Instance \"${instanceId}\" not found`);\n      }\n    } else if (number) {\n      instanceName = await this.prismaRepository.instance.findFirst({ where: { number } }).then((r) => r?.name);\n      if (!instanceName) {\n        throw new NotFoundException(`Instance \"${number}\" not found`);\n      }\n    }\n\n    if (!instanceName) {\n      throw new NotFoundException(`Instance \"${instanceId}\" not found`);\n    }\n\n    if (instanceName && !this.waInstances[instanceName]) {\n      throw new NotFoundException(`Instance \"${instanceName}\" not found`);\n    }\n\n    const instanceNames = instanceName ? [instanceName] : null;\n\n    return this.instanceInfo(instanceNames);\n  }\n\n  public async cleaningUp(instanceName: string) {\n    let instanceDbId: string;\n    if (this.db.SAVE_DATA.INSTANCE) {\n      const findInstance = await this.prismaRepository.instance.findFirst({\n        where: { name: instanceName },\n      });\n\n      if (findInstance) {\n        const instance = await this.prismaRepository.instance.update({\n          where: { name: instanceName },\n          data: { connectionStatus: 'close' },\n        });\n\n        rmSync(join(INSTANCE_DIR, instance.id), { recursive: true, force: true });\n\n        instanceDbId = instance.id;\n        await this.prismaRepository.session.deleteMany({ where: { sessionId: instance.id } });\n      }\n    }\n\n    if (this.redis.REDIS.ENABLED && this.redis.REDIS.SAVE_INSTANCES) {\n      await this.cache.delete(instanceName);\n      if (instanceDbId) {\n        await this.cache.delete(instanceDbId);\n      }\n    }\n\n    if (this.providerSession?.ENABLED) {\n      await this.providerFiles.removeSession(instanceName);\n    }\n  }\n\n  public async cleaningStoreData(instanceName: string) {\n    if (this.configService.get<Chatwoot>('CHATWOOT').ENABLED) {\n      const instancePath = join(STORE_DIR, 'chatwoot', instanceName);\n      execFileSync('rm', ['-rf', instancePath]);\n    }\n\n    const instance = await this.prismaRepository.instance.findFirst({\n      where: { name: instanceName },\n    });\n\n    if (!instance) return;\n\n    rmSync(join(INSTANCE_DIR, instance.id), { recursive: true, force: true });\n\n    await this.prismaRepository.session.deleteMany({ where: { sessionId: instance.id } });\n\n    await this.prismaRepository.chat.deleteMany({ where: { instanceId: instance.id } });\n    await this.prismaRepository.contact.deleteMany({ where: { instanceId: instance.id } });\n    await this.prismaRepository.messageUpdate.deleteMany({ where: { instanceId: instance.id } });\n    await this.prismaRepository.message.deleteMany({ where: { instanceId: instance.id } });\n\n    await this.prismaRepository.webhook.deleteMany({ where: { instanceId: instance.id } });\n    await this.prismaRepository.chatwoot.deleteMany({ where: { instanceId: instance.id } });\n    await this.prismaRepository.proxy.deleteMany({ where: { instanceId: instance.id } });\n    await this.prismaRepository.rabbitmq.deleteMany({ where: { instanceId: instance.id } });\n    await this.prismaRepository.nats.deleteMany({ where: { instanceId: instance.id } });\n    await this.prismaRepository.sqs.deleteMany({ where: { instanceId: instance.id } });\n    await this.prismaRepository.integrationSession.deleteMany({ where: { instanceId: instance.id } });\n    await this.prismaRepository.typebot.deleteMany({ where: { instanceId: instance.id } });\n    await this.prismaRepository.websocket.deleteMany({ where: { instanceId: instance.id } });\n    await this.prismaRepository.setting.deleteMany({ where: { instanceId: instance.id } });\n    await this.prismaRepository.label.deleteMany({ where: { instanceId: instance.id } });\n\n    await this.prismaRepository.instance.delete({ where: { name: instanceName } });\n  }\n\n  public async loadInstance() {\n    try {\n      if (this.providerSession?.ENABLED) {\n        await this.loadInstancesFromProvider();\n      } else if (this.db.SAVE_DATA.INSTANCE) {\n        await this.loadInstancesFromDatabasePostgres();\n      } else if (this.redis.REDIS.ENABLED && this.redis.REDIS.SAVE_INSTANCES) {\n        await this.loadInstancesFromRedis();\n      }\n    } catch (error) {\n      this.logger.error(error);\n    }\n  }\n\n  public async saveInstance(data: any) {\n    try {\n      const clientName = await this.configService.get<Database>('DATABASE').CONNECTION.CLIENT_NAME;\n      await this.prismaRepository.instance.create({\n        data: {\n          id: data.instanceId,\n          name: data.instanceName,\n          ownerJid: data.ownerJid,\n          profileName: data.profileName,\n          profilePicUrl: data.profilePicUrl,\n          connectionStatus:\n            data.integration && data.integration === Integration.WHATSAPP_BAILEYS ? 'close' : (data.status ?? 'open'),\n          number: data.number,\n          integration: data.integration || Integration.WHATSAPP_BAILEYS,\n          token: data.hash,\n          clientName: clientName,\n          businessId: data.businessId,\n        },\n      });\n    } catch (error) {\n      this.logger.error(error);\n    }\n  }\n\n  public deleteInstance(instanceName: string) {\n    try {\n      this.eventEmitter.emit('remove.instance', instanceName, 'inner');\n    } catch (error) {\n      this.logger.error(error);\n    }\n  }\n\n  private async setInstance(instanceData: InstanceDto) {\n    const instance = channelController.init(instanceData, {\n      configService: this.configService,\n      eventEmitter: this.eventEmitter,\n      prismaRepository: this.prismaRepository,\n      cache: this.cache,\n      chatwootCache: this.chatwootCache,\n      baileysCache: this.baileysCache,\n      providerFiles: this.providerFiles,\n    });\n\n    if (!instance) return;\n\n    instance.setInstance({\n      instanceId: instanceData.instanceId,\n      instanceName: instanceData.instanceName,\n      integration: instanceData.integration,\n      token: instanceData.token,\n      number: instanceData.number,\n      businessId: instanceData.businessId,\n      ownerJid: instanceData.ownerJid,\n    });\n\n    if (instanceData.connectionStatus === 'open' || instanceData.connectionStatus === 'connecting') {\n      this.logger.info(\n        `Auto-connecting instance \"${instanceData.instanceName}\" (status: ${instanceData.connectionStatus})`,\n      );\n      await instance.connectToWhatsapp();\n    } else {\n      this.logger.info(\n        `Skipping auto-connect for instance \"${instanceData.instanceName}\" (status: ${instanceData.connectionStatus || 'close'})`,\n      );\n    }\n\n    this.waInstances[instanceData.instanceName] = instance;\n  }\n\n  private async loadInstancesFromRedis() {\n    const keys = await this.cache.keys();\n\n    if (keys?.length > 0) {\n      await Promise.all(\n        keys.map(async (k) => {\n          const instanceData = await this.prismaRepository.instance.findUnique({\n            where: { id: k.split(':')[1] },\n          });\n\n          if (!instanceData) {\n            return;\n          }\n\n          const instance = {\n            instanceId: k.split(':')[1],\n            instanceName: k.split(':')[2],\n            integration: instanceData.integration,\n            token: instanceData.token,\n            number: instanceData.number,\n            businessId: instanceData.businessId,\n            connectionStatus: instanceData.connectionStatus as any, // Pass connection status\n          };\n\n          this.setInstance(instance);\n        }),\n      );\n    }\n  }\n\n  private async loadInstancesFromDatabasePostgres() {\n    const clientName = await this.configService.get<Database>('DATABASE').CONNECTION.CLIENT_NAME;\n\n    const instances = await this.prismaRepository.instance.findMany({\n      where: { clientName: clientName },\n    });\n\n    if (instances.length === 0) {\n      return;\n    }\n\n    await Promise.all(\n      instances.map(async (instance) => {\n        this.setInstance({\n          instanceId: instance.id,\n          instanceName: instance.name,\n          integration: instance.integration,\n          token: instance.token,\n          number: instance.number,\n          businessId: instance.businessId,\n          ownerJid: instance.ownerJid,\n          connectionStatus: instance.connectionStatus as any, // Pass connection status\n        });\n      }),\n    );\n  }\n\n  private async loadInstancesFromProvider() {\n    const [instances] = await this.providerFiles.allInstances();\n\n    if (!instances?.data) {\n      return;\n    }\n\n    await Promise.all(\n      instances?.data?.map(async (instanceId: string) => {\n        const instance = await this.prismaRepository.instance.findUnique({\n          where: { id: instanceId },\n        });\n\n        this.setInstance({\n          instanceId: instance.id,\n          instanceName: instance.name,\n          integration: instance.integration,\n          token: instance.token,\n          businessId: instance.businessId,\n          connectionStatus: instance.connectionStatus as any, // Pass connection status\n        });\n      }),\n    );\n  }\n\n  private removeInstance() {\n    this.eventEmitter.on('remove.instance', async (instanceName: string) => {\n      try {\n        await this.waInstances[instanceName]?.sendDataWebhook(Events.REMOVE_INSTANCE, null);\n\n        this.clearDelInstanceTime(instanceName);\n\n        this.cleaningUp(instanceName);\n        this.cleaningStoreData(instanceName);\n      } finally {\n        this.logger.warn(`Instance \"${instanceName}\" - REMOVED`);\n      }\n\n      try {\n        delete this.waInstances[instanceName];\n      } catch (error) {\n        this.logger.error(error);\n      }\n    });\n    this.eventEmitter.on('logout.instance', async (instanceName: string) => {\n      try {\n        await this.waInstances[instanceName]?.sendDataWebhook(Events.LOGOUT_INSTANCE, null);\n\n        this.clearDelInstanceTime(instanceName);\n\n        if (this.configService.get<Chatwoot>('CHATWOOT').ENABLED) {\n          this.waInstances[instanceName]?.clearCacheChatwoot();\n        }\n\n        this.cleaningUp(instanceName);\n      } finally {\n        this.logger.warn(`Instance \"${instanceName}\" - LOGOUT`);\n      }\n    });\n  }\n\n  private noConnection() {\n    this.eventEmitter.on('no.connection', async (instanceName) => {\n      try {\n        await this.waInstances[instanceName]?.client?.logout('Log out instance: ' + instanceName);\n\n        this.waInstances[instanceName]?.client?.ws?.close();\n\n        this.waInstances[instanceName].instance.qrcode = { count: 0 };\n        this.waInstances[instanceName].stateConnection.state = 'close';\n      } catch (error) {\n        this.logger.error({\n          localError: 'noConnection',\n          warn: 'Error deleting instance from memory.',\n          error,\n        });\n      } finally {\n        this.logger.warn(`Instance \"${instanceName}\" - NOT CONNECTION`);\n      }\n    });\n  }\n}\n","import { InstanceDto } from '@api/dto/instance.dto';\nimport { ProxyDto } from '@api/dto/proxy.dto';\nimport { Logger } from '@config/logger.config';\nimport { Proxy } from '@prisma/client';\n\nimport { WAMonitoringService } from './monitor.service';\n\nexport class ProxyService {\n  constructor(private readonly waMonitor: WAMonitoringService) {}\n\n  private readonly logger = new Logger('ProxyService');\n\n  public create(instance: InstanceDto, data: ProxyDto) {\n    this.waMonitor.waInstances[instance.instanceName].setProxy(data);\n\n    return { proxy: { ...instance, proxy: data } };\n  }\n\n  public async find(instance: InstanceDto): Promise<Proxy> {\n    try {\n      const result = await this.waMonitor.waInstances[instance.instanceName].findProxy();\n\n      if (Object.keys(result).length === 0) {\n        throw new Error('Proxy not found');\n      }\n\n      return result;\n    } catch {\n      return null;\n    }\n  }\n}\n","import { InstanceDto } from '@api/dto/instance.dto';\nimport { SettingsDto } from '@api/dto/settings.dto';\nimport { Logger } from '@config/logger.config';\n\nimport { WAMonitoringService } from './monitor.service';\n\nexport class SettingsService {\n  constructor(private readonly waMonitor: WAMonitoringService) {}\n\n  private readonly logger = new Logger('SettingsService');\n\n  public async create(instance: InstanceDto, data: SettingsDto) {\n    await this.waMonitor.waInstances[instance.instanceName].setSettings(data);\n\n    return { settings: { ...instance, settings: data } };\n  }\n\n  public async find(instance: InstanceDto): Promise<SettingsDto> {\n    try {\n      const result = await this.waMonitor.waInstances[instance.instanceName].findSettings();\n\n      if (Object.keys(result).length === 0) {\n        throw new Error('Settings not found');\n      }\n\n      return result;\n    } catch {\n      return null;\n    }\n  }\n}\n","import { InstanceDto } from '@api/dto/instance.dto';\nimport { TemplateDto } from '@api/dto/template.dto';\nimport { PrismaRepository } from '@api/repository/repository.service';\nimport { ConfigService, WaBusiness } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\nimport axios from 'axios';\n\nimport { WAMonitoringService } from './monitor.service';\n\nexport class TemplateService {\n  constructor(\n    private readonly waMonitor: WAMonitoringService,\n    public readonly prismaRepository: PrismaRepository,\n    private readonly configService: ConfigService,\n  ) {}\n\n  private readonly logger = new Logger('TemplateService');\n\n  private businessId: string;\n  private token: string;\n\n  public async find(instance: InstanceDto) {\n    const getInstance = await this.waMonitor.waInstances[instance.instanceName].instance;\n\n    if (!getInstance) {\n      throw new Error('Instance not found');\n    }\n\n    this.businessId = getInstance.businessId;\n    this.token = getInstance.token;\n\n    const response = await this.requestTemplate({}, 'GET');\n\n    if (!response) {\n      throw new Error('Error to create template');\n    }\n\n    return response.data;\n  }\n\n  public async create(instance: InstanceDto, data: TemplateDto) {\n    try {\n      const getInstance = await this.waMonitor.waInstances[instance.instanceName].instance;\n\n      if (!getInstance) {\n        throw new Error('Instance not found');\n      }\n\n      this.businessId = getInstance.businessId;\n      this.token = getInstance.token;\n\n      const postData = {\n        name: data.name,\n        category: data.category,\n        allow_category_change: data.allowCategoryChange,\n        language: data.language,\n        components: data.components,\n      };\n\n      const response = await this.requestTemplate(postData, 'POST');\n\n      if (!response || response.error) {\n        // If there's an error from WhatsApp API, throw it with the real error data\n        if (response && response.error) {\n          // Create an error object that includes the template field for Meta errors\n          const metaError = new Error(response.error.message || 'WhatsApp API Error');\n          (metaError as any).template = response.error;\n          throw metaError;\n        }\n        throw new Error('Error to create template');\n      }\n\n      const template = await this.prismaRepository.template.create({\n        data: {\n          templateId: response.id,\n          name: data.name,\n          template: response,\n          webhookUrl: data.webhookUrl,\n          instanceId: getInstance.id,\n        },\n      });\n\n      return template;\n    } catch (error) {\n      this.logger.error('Error in create template: ' + error);\n      // Propagate the real error instead of \"engolindo\" it\n      throw error;\n    }\n  }\n\n  public async edit(\n    instance: InstanceDto,\n    data: { templateId: string; category?: string; components?: any; allowCategoryChange?: boolean; ttl?: number },\n  ) {\n    const getInstance = await this.waMonitor.waInstances[instance.instanceName].instance;\n    if (!getInstance) {\n      throw new Error('Instance not found');\n    }\n\n    this.businessId = getInstance.businessId;\n    this.token = getInstance.token;\n\n    const payload: Record<string, unknown> = {};\n    if (typeof data.category === 'string') payload.category = data.category;\n    if (typeof data.allowCategoryChange === 'boolean') payload.allow_category_change = data.allowCategoryChange;\n    if (typeof data.ttl === 'number') payload.time_to_live = data.ttl;\n    if (data.components) payload.components = data.components;\n\n    const response = await this.requestEditTemplate(data.templateId, payload);\n\n    if (!response || response.error) {\n      if (response && response.error) {\n        const metaError = new Error(response.error.message || 'WhatsApp API Error');\n        (metaError as any).template = response.error;\n        throw metaError;\n      }\n      throw new Error('Error to edit template');\n    }\n\n    return response;\n  }\n\n  public async delete(instance: InstanceDto, data: { name: string; hsmId?: string }) {\n    const getInstance = await this.waMonitor.waInstances[instance.instanceName].instance;\n    if (!getInstance) {\n      throw new Error('Instance not found');\n    }\n\n    this.businessId = getInstance.businessId;\n    this.token = getInstance.token;\n\n    const response = await this.requestDeleteTemplate({ name: data.name, hsm_id: data.hsmId });\n\n    if (!response || response.error) {\n      if (response && response.error) {\n        const metaError = new Error(response.error.message || 'WhatsApp API Error');\n        (metaError as any).template = response.error;\n        throw metaError;\n      }\n      throw new Error('Error to delete template');\n    }\n\n    try {\n      // Best-effort local cleanup of stored template metadata\n      await this.prismaRepository.template.deleteMany({\n        where: {\n          OR: [\n            { name: data.name, instanceId: getInstance.id },\n            data.hsmId ? { templateId: data.hsmId, instanceId: getInstance.id } : undefined,\n          ].filter(Boolean) as any,\n        },\n      });\n    } catch (err) {\n      this.logger.warn(\n        `Failed to cleanup local template records after delete: ${(err as Error)?.message || String(err)}`,\n      );\n    }\n\n    return response;\n  }\n\n  private async requestTemplate(data: any, method: string) {\n    try {\n      let urlServer = this.configService.get<WaBusiness>('WA_BUSINESS').URL;\n      const version = this.configService.get<WaBusiness>('WA_BUSINESS').VERSION;\n      urlServer = `${urlServer}/${version}/${this.businessId}/message_templates`;\n      const headers = { 'Content-Type': 'application/json', Authorization: `Bearer ${this.token}` };\n\n      if (method === 'GET') {\n        const result = await axios.get(urlServer, { headers });\n        return result.data;\n      } else if (method === 'POST') {\n        const result = await axios.post(urlServer, data, { headers });\n        return result.data;\n      }\n    } catch (e) {\n      this.logger.error(\n        'WhatsApp API request error: ' + (e.response?.data ? JSON.stringify(e.response?.data) : e.message),\n      );\n\n      // Return the complete error response from WhatsApp API\n      if (e.response?.data) {\n        return e.response.data;\n      }\n\n      // If no response data, throw connection error\n      throw new Error(`Connection error: ${e.message}`);\n    }\n  }\n\n  private async requestEditTemplate(templateId: string, data: any) {\n    try {\n      let urlServer = this.configService.get<WaBusiness>('WA_BUSINESS').URL;\n      const version = this.configService.get<WaBusiness>('WA_BUSINESS').VERSION;\n      urlServer = `${urlServer}/${version}/${templateId}`;\n      const headers = { 'Content-Type': 'application/json', Authorization: `Bearer ${this.token}` };\n      const result = await axios.post(urlServer, data, { headers });\n      return result.data;\n    } catch (e) {\n      this.logger.error(\n        'WhatsApp API request error: ' + (e.response?.data ? JSON.stringify(e.response?.data) : e.message),\n      );\n      if (e.response?.data) return e.response.data;\n      throw new Error(`Connection error: ${e.message}`);\n    }\n  }\n\n  private async requestDeleteTemplate(params: { name: string; hsm_id?: string }) {\n    try {\n      let urlServer = this.configService.get<WaBusiness>('WA_BUSINESS').URL;\n      const version = this.configService.get<WaBusiness>('WA_BUSINESS').VERSION;\n      urlServer = `${urlServer}/${version}/${this.businessId}/message_templates`;\n      const headers = { Authorization: `Bearer ${this.token}` };\n      const result = await axios.delete(urlServer, { headers, params });\n      return result.data;\n    } catch (e) {\n      this.logger.error(\n        'WhatsApp API request error: ' + (e.response?.data ? JSON.stringify(e.response?.data) : e.message),\n      );\n      if (e.response?.data) return e.response.data;\n      throw new Error(`Connection error: ${e.message}`);\n    }\n  }\n}\n","import { CacheEngine } from '@cache/cacheengine';\nimport { Chatwoot, configService, ProviderSession } from '@config/env.config';\nimport { eventEmitter } from '@config/event.config';\nimport { Logger } from '@config/logger.config';\n\nimport { BusinessController } from './controllers/business.controller';\nimport { CallController } from './controllers/call.controller';\nimport { ChatController } from './controllers/chat.controller';\nimport { GroupController } from './controllers/group.controller';\nimport { InstanceController } from './controllers/instance.controller';\nimport { LabelController } from './controllers/label.controller';\nimport { ProxyController } from './controllers/proxy.controller';\nimport { SendMessageController } from './controllers/sendMessage.controller';\nimport { SettingsController } from './controllers/settings.controller';\nimport { TemplateController } from './controllers/template.controller';\nimport { ChannelController } from './integrations/channel/channel.controller';\nimport { EvolutionController } from './integrations/channel/evolution/evolution.controller';\nimport { MetaController } from './integrations/channel/meta/meta.controller';\nimport { BaileysController } from './integrations/channel/whatsapp/baileys.controller';\nimport { ChatbotController } from './integrations/chatbot/chatbot.controller';\nimport { ChatwootController } from './integrations/chatbot/chatwoot/controllers/chatwoot.controller';\nimport { ChatwootService } from './integrations/chatbot/chatwoot/services/chatwoot.service';\nimport { DifyController } from './integrations/chatbot/dify/controllers/dify.controller';\nimport { DifyService } from './integrations/chatbot/dify/services/dify.service';\nimport { EvoaiController } from './integrations/chatbot/evoai/controllers/evoai.controller';\nimport { EvoaiService } from './integrations/chatbot/evoai/services/evoai.service';\nimport { EvolutionBotController } from './integrations/chatbot/evolutionBot/controllers/evolutionBot.controller';\nimport { EvolutionBotService } from './integrations/chatbot/evolutionBot/services/evolutionBot.service';\nimport { FlowiseController } from './integrations/chatbot/flowise/controllers/flowise.controller';\nimport { FlowiseService } from './integrations/chatbot/flowise/services/flowise.service';\nimport { N8nController } from './integrations/chatbot/n8n/controllers/n8n.controller';\nimport { N8nService } from './integrations/chatbot/n8n/services/n8n.service';\nimport { OpenaiController } from './integrations/chatbot/openai/controllers/openai.controller';\nimport { OpenaiService } from './integrations/chatbot/openai/services/openai.service';\nimport { TypebotController } from './integrations/chatbot/typebot/controllers/typebot.controller';\nimport { TypebotService } from './integrations/chatbot/typebot/services/typebot.service';\nimport { EventManager } from './integrations/event/event.manager';\nimport { S3Controller } from './integrations/storage/s3/controllers/s3.controller';\nimport { S3Service } from './integrations/storage/s3/services/s3.service';\nimport { ProviderFiles } from './provider/sessions';\nimport { PrismaRepository } from './repository/repository.service';\nimport { CacheService } from './services/cache.service';\nimport { WAMonitoringService } from './services/monitor.service';\nimport { ProxyService } from './services/proxy.service';\nimport { SettingsService } from './services/settings.service';\nimport { TemplateService } from './services/template.service';\n\nconst logger = new Logger('WA MODULE');\n\nlet chatwootCache: CacheService = null;\nif (configService.get<Chatwoot>('CHATWOOT').ENABLED) {\n  chatwootCache = new CacheService(new CacheEngine(configService, ChatwootService.name).getEngine());\n}\n\nexport const cache = new CacheService(new CacheEngine(configService, 'instance').getEngine());\nconst baileysCache = new CacheService(new CacheEngine(configService, 'baileys').getEngine());\n\nlet providerFiles: ProviderFiles = null;\nif (configService.get<ProviderSession>('PROVIDER').ENABLED) {\n  providerFiles = new ProviderFiles(configService);\n}\n\nexport const prismaRepository = new PrismaRepository(configService);\n\nexport const waMonitor = new WAMonitoringService(\n  eventEmitter,\n  configService,\n  prismaRepository,\n  providerFiles,\n  cache,\n  chatwootCache,\n  baileysCache,\n);\n\nconst s3Service = new S3Service(prismaRepository);\nexport const s3Controller = new S3Controller(s3Service);\n\nconst templateService = new TemplateService(waMonitor, prismaRepository, configService);\nexport const templateController = new TemplateController(templateService);\n\nconst proxyService = new ProxyService(waMonitor);\nexport const proxyController = new ProxyController(proxyService, waMonitor);\n\nconst chatwootService = new ChatwootService(waMonitor, configService, prismaRepository, chatwootCache);\nexport const chatwootController = new ChatwootController(chatwootService, configService);\n\nconst settingsService = new SettingsService(waMonitor);\nexport const settingsController = new SettingsController(settingsService);\n\nexport const instanceController = new InstanceController(\n  waMonitor,\n  configService,\n  prismaRepository,\n  eventEmitter,\n  chatwootService,\n  settingsService,\n  proxyController,\n  cache,\n  chatwootCache,\n  baileysCache,\n  providerFiles,\n);\nexport const sendMessageController = new SendMessageController(waMonitor);\nexport const callController = new CallController(waMonitor);\nexport const chatController = new ChatController(waMonitor);\nexport const businessController = new BusinessController(waMonitor);\nexport const groupController = new GroupController(waMonitor);\nexport const labelController = new LabelController(waMonitor);\n\nexport const eventManager = new EventManager(prismaRepository, waMonitor);\nexport const chatbotController = new ChatbotController(prismaRepository, waMonitor);\nexport const channelController = new ChannelController(prismaRepository, waMonitor);\n\n// channels\nexport const evolutionController = new EvolutionController(prismaRepository, waMonitor);\nexport const metaController = new MetaController(prismaRepository, waMonitor);\nexport const baileysController = new BaileysController(waMonitor);\n\nconst openaiService = new OpenaiService(waMonitor, prismaRepository, configService);\nexport const openaiController = new OpenaiController(openaiService, prismaRepository, waMonitor);\n\n// chatbots\nconst typebotService = new TypebotService(waMonitor, configService, prismaRepository, openaiService);\nexport const typebotController = new TypebotController(typebotService, prismaRepository, waMonitor);\n\nconst difyService = new DifyService(waMonitor, prismaRepository, configService, openaiService);\nexport const difyController = new DifyController(difyService, prismaRepository, waMonitor);\n\nconst evolutionBotService = new EvolutionBotService(waMonitor, prismaRepository, configService, openaiService);\nexport const evolutionBotController = new EvolutionBotController(evolutionBotService, prismaRepository, waMonitor);\n\nconst flowiseService = new FlowiseService(waMonitor, prismaRepository, configService, openaiService);\nexport const flowiseController = new FlowiseController(flowiseService, prismaRepository, waMonitor);\n\nconst n8nService = new N8nService(waMonitor, prismaRepository, configService, openaiService);\nexport const n8nController = new N8nController(n8nService, prismaRepository, waMonitor);\n\nconst evoaiService = new EvoaiService(waMonitor, prismaRepository, configService, openaiService);\nexport const evoaiController = new EvoaiController(evoaiService, prismaRepository, waMonitor);\n\nlogger.info('Module - ON');\n","import { InstanceDto } from '@api/dto/instance.dto';\nimport { prismaRepository } from '@api/server.module';\nimport { Auth, configService, Database } from '@config/env.config';\nimport { Logger } from '@config/logger.config';\nimport { ForbiddenException, UnauthorizedException } from '@exceptions';\nimport { NextFunction, Request, Response } from 'express';\n\nconst logger = new Logger('GUARD');\n\nasync function apikey(req: Request, _: Response, next: NextFunction) {\n  const env = configService.get<Auth>('AUTHENTICATION').API_KEY;\n  const key = req.get('apikey');\n  const db = configService.get<Database>('DATABASE');\n\n  if (!key) {\n    throw new UnauthorizedException();\n  }\n\n  if (env.KEY === key) {\n    return next();\n  }\n\n  if ((req.originalUrl.includes('/instance/create') || req.originalUrl.includes('/instance/fetchInstances')) && !key) {\n    throw new ForbiddenException('Missing global api key', 'The global api key must be set');\n  }\n  const param = req.params as unknown as InstanceDto;\n\n  try {\n    if (param?.instanceName) {\n      const instance = await prismaRepository.instance.findUnique({\n        where: { name: param.instanceName },\n      });\n      if (instance.token === key) {\n        return next();\n      }\n    } else {\n      if (req.originalUrl.includes('/instance/fetchInstances') && db.SAVE_DATA.INSTANCE) {\n        const instanceByKey = await prismaRepository.instance.findFirst({\n          where: { token: key },\n        });\n        if (instanceByKey) {\n          return next();\n        }\n      }\n    }\n  } catch (error) {\n    logger.error(error);\n  }\n\n  throw new UnauthorizedException();\n}\n\nexport const authGuard = { apikey };\n","import { InstanceDto } from '@api/dto/instance.dto';\nimport { cache, prismaRepository, waMonitor } from '@api/server.module';\nimport { CacheConf, configService } from '@config/env.config';\nimport { BadRequestException, ForbiddenException, InternalServerErrorException, NotFoundException } from '@exceptions';\nimport { NextFunction, Request, Response } from 'express';\n\nasync function getInstance(instanceName: string) {\n  try {\n    const cacheConf = configService.get<CacheConf>('CACHE');\n\n    const exists = !!waMonitor.waInstances[instanceName];\n\n    if (cacheConf.REDIS.ENABLED && cacheConf.REDIS.SAVE_INSTANCES) {\n      const keyExists = await cache.has(instanceName);\n\n      return exists || keyExists;\n    }\n\n    return exists || (await prismaRepository.instance.findMany({ where: { name: instanceName } })).length > 0;\n  } catch (error) {\n    throw new InternalServerErrorException(error?.toString());\n  }\n}\n\nexport async function instanceExistsGuard(req: Request, _: Response, next: NextFunction) {\n  if (req.originalUrl.includes('/instance/create') || req.originalUrl.includes('/instance/fetchInstances')) {\n    return next();\n  }\n\n  const param = req.params as unknown as InstanceDto;\n  if (!param?.instanceName) {\n    throw new BadRequestException('\"instanceName\" not provided.');\n  }\n\n  if (!(await getInstance(param.instanceName))) {\n    throw new NotFoundException(`The \"${param.instanceName}\" instance does not exist`);\n  }\n\n  next();\n}\n\nexport async function instanceLoggedGuard(req: Request, _: Response, next: NextFunction) {\n  if (req.originalUrl.includes('/instance/create')) {\n    const instance = req.body as InstanceDto;\n    if (await getInstance(instance.instanceName)) {\n      throw new ForbiddenException(`This name \"${instance.instanceName}\" is already in use.`);\n    }\n\n    if (waMonitor.waInstances[instance.instanceName]) {\n      delete waMonitor.waInstances[instance.instanceName];\n    }\n  }\n\n  next();\n}\n","import { sendTelemetry } from '@utils/sendTelemetry';\nimport { NextFunction, Request, Response } from 'express';\n\nclass Telemetry {\n  public collectTelemetry(req: Request, res: Response, next: NextFunction): void {\n    sendTelemetry(req.path);\n\n    next();\n  }\n}\n\nexport default Telemetry;\n","import 'express-async-errors';\n\nimport { GetParticipant, GroupInvite } from '@api/dto/group.dto';\nimport { InstanceDto } from '@api/dto/instance.dto';\nimport { Logger } from '@config/logger.config';\nimport { BadRequestException } from '@exceptions';\nimport { Request } from 'express';\nimport { JSONSchema7 } from 'json-schema';\nimport { validate } from 'jsonschema';\n\ntype DataValidate<T> = {\n  request: Request;\n  schema: JSONSchema7;\n  ClassRef: any;\n  execute: (instance: InstanceDto, data: T) => Promise<any>;\n};\n\nconst logger = new Logger('Validate');\n\nexport abstract class RouterBroker {\n  constructor() {}\n  public routerPath(path: string, param = true) {\n    let route = '/' + path;\n    param ? (route += '/:instanceName') : null;\n\n    return route;\n  }\n\n  public async dataValidate<T>(args: DataValidate<T>) {\n    const { request, schema, ClassRef, execute } = args;\n\n    const ref = new ClassRef();\n    const body = request.body;\n    const instance = request.params as unknown as InstanceDto;\n\n    if (request?.query && Object.keys(request.query).length > 0) {\n      Object.assign(instance, request.query);\n    }\n\n    if (request.originalUrl.includes('/instance/create')) {\n      Object.assign(instance, body);\n    }\n\n    Object.assign(ref, body);\n\n    const v = schema ? validate(ref, schema) : { valid: true, errors: [] };\n\n    if (!v.valid) {\n      const message: any[] = v.errors.map(({ stack, schema }) => {\n        let message: string;\n        if (schema['description']) {\n          message = schema['description'];\n        } else {\n          message = stack.replace('instance.', '');\n        }\n        return message;\n      });\n      logger.error(message);\n      throw new BadRequestException(message);\n    }\n\n    return await execute(instance, ref);\n  }\n\n  public async groupNoValidate<T>(args: DataValidate<T>) {\n    const { request, ClassRef, schema, execute } = args;\n\n    const instance = request.params as unknown as InstanceDto;\n\n    const ref = new ClassRef();\n\n    Object.assign(ref, request.body);\n\n    const v = validate(ref, schema);\n\n    if (!v.valid) {\n      const message: any[] = v.errors.map(({ property, stack, schema }) => {\n        let message: string;\n        if (schema['description']) {\n          message = schema['description'];\n        } else {\n          message = stack.replace('instance.', '');\n        }\n        return {\n          property: property.replace('instance.', ''),\n          message,\n        };\n      });\n      logger.error([...message]);\n      throw new BadRequestException(...message);\n    }\n\n    return await execute(instance, ref);\n  }\n\n  public async groupValidate<T>(args: DataValidate<T>) {\n    const { request, ClassRef, schema, execute } = args;\n\n    const instance = request.params as unknown as InstanceDto;\n    const body = request.body;\n\n    let groupJid = body?.groupJid;\n\n    if (!groupJid) {\n      if (request.query?.groupJid) {\n        groupJid = request.query.groupJid;\n      } else {\n        throw new BadRequestException('The group id needs to be informed in the query', 'ex: \"groupJid=120362@g.us\"');\n      }\n    }\n\n    if (!groupJid.endsWith('@g.us')) {\n      groupJid = groupJid + '@g.us';\n    }\n\n    Object.assign(body, {\n      groupJid: groupJid,\n    });\n\n    const ref = new ClassRef();\n\n    Object.assign(ref, body);\n\n    const v = validate(ref, schema);\n\n    if (!v.valid) {\n      const message: any[] = v.errors.map(({ property, stack, schema }) => {\n        let message: string;\n        if (schema['description']) {\n          message = schema['description'];\n        } else {\n          message = stack.replace('instance.', '');\n        }\n        return {\n          property: property.replace('instance.', ''),\n          message,\n        };\n      });\n      logger.error([...message]);\n      throw new BadRequestException(...message);\n    }\n\n    return await execute(instance, ref);\n  }\n\n  public async inviteCodeValidate<T>(args: DataValidate<T>) {\n    const { request, ClassRef, schema, execute } = args;\n\n    const inviteCode = request.query as unknown as GroupInvite;\n\n    if (!inviteCode?.inviteCode) {\n      throw new BadRequestException(\n        'The group invite code id needs to be informed in the query',\n        'ex: \"inviteCode=F1EX5QZxO181L3TMVP31gY\" (Obtained from group join link)',\n      );\n    }\n\n    const instance = request.params as unknown as InstanceDto;\n    const body = request.body;\n\n    const ref = new ClassRef();\n\n    Object.assign(body, inviteCode);\n    Object.assign(ref, body);\n\n    const v = validate(ref, schema);\n\n    if (!v.valid) {\n      const message: any[] = v.errors.map(({ property, stack, schema }) => {\n        let message: string;\n        if (schema['description']) {\n          message = schema['description'];\n        } else {\n          message = stack.replace('instance.', '');\n        }\n        return {\n          property: property.replace('instance.', ''),\n          message,\n        };\n      });\n      logger.error([...message]);\n      throw new BadRequestException(...message);\n    }\n\n    return await execute(instance, ref);\n  }\n\n  public async getParticipantsValidate<T>(args: DataValidate<T>) {\n    const { request, ClassRef, schema, execute } = args;\n\n    const getParticipants = request.query as unknown as GetParticipant;\n\n    if (!getParticipants?.getParticipants) {\n      throw new BadRequestException('The getParticipants needs to be informed in the query');\n    }\n\n    const instance = request.params as unknown as InstanceDto;\n    const body = request.body;\n\n    const ref = new ClassRef();\n\n    Object.assign(body, getParticipants);\n    Object.assign(ref, body);\n\n    const v = validate(ref, schema);\n\n    if (!v.valid) {\n      const message: any[] = v.errors.map(({ property, stack, schema }) => {\n        let message: string;\n        if (schema['description']) {\n          message = schema['description'];\n        } else {\n          message = stack.replace('instance.', '');\n        }\n        return {\n          property: property.replace('instance.', ''),\n          message,\n        };\n      });\n      logger.error([...message]);\n      throw new BadRequestException(...message);\n    }\n\n    return await execute(instance, ref);\n  }\n}\n","import { RouterBroker } from '@api/abstract/abstract.router';\nimport { evolutionController } from '@api/server.module';\nimport { ConfigService } from '@config/env.config';\nimport { Router } from 'express';\n\nexport class EvolutionRouter extends RouterBroker {\n  constructor(readonly configService: ConfigService) {\n    super();\n    this.router.post(this.routerPath('webhook/evolution', false), async (req, res) => {\n      const { body } = req;\n      const response = await evolutionController.receiveWebhook(body);\n\n      return res.status(200).json(response);\n    });\n  }\n\n  public readonly router: Router = Router();\n}\n","import { RouterBroker } from '@api/abstract/abstract.router';\nimport { metaController } from '@api/server.module';\nimport { ConfigService, WaBusiness } from '@config/env.config';\nimport { Router } from 'express';\n\nexport class MetaRouter extends RouterBroker {\n  constructor(readonly configService: ConfigService) {\n    super();\n    this.router\n      .get(this.routerPath('webhook/meta', false), async (req, res) => {\n        if (req.query['hub.verify_token'] === configService.get<WaBusiness>('WA_BUSINESS').TOKEN_WEBHOOK)\n          res.send(req.query['hub.challenge']);\n        else res.send('Error, wrong validation token');\n      })\n      .post(this.routerPath('webhook/meta', false), async (req, res) => {\n        const { body } = req;\n        const response = await metaController.receiveWebhook(body);\n\n        return res.status(200).json(response);\n      });\n  }\n\n  public readonly router: Router = Router();\n}\n","import { Constructor } from '@api/integrations/integration.dto';\n\nexport class ChatwootDto {\n  enabled?: boolean;\n  accountId?: string;\n  token?: string;\n  url?: string;\n  nameInbox?: string;\n  signMsg?: boolean;\n  signDelimiter?: string;\n  number?: string;\n  reopenConversation?: boolean;\n  conversationPending?: boolean;\n  mergeBrazilContacts?: boolean;\n  importContacts?: boolean;\n  importMessages?: boolean;\n  daysLimitImportMessages?: number;\n  autoCreate?: boolean;\n  organization?: string;\n  logo?: string;\n  ignoreJids?: string[];\n}\n\nexport function ChatwootInstanceMixin<TBase extends Constructor>(Base: TBase) {\n  return class extends Base {\n    chatwootAccountId?: string;\n    chatwootToken?: string;\n    chatwootUrl?: string;\n    chatwootSignMsg?: boolean;\n    chatwootReopenConversation?: boolean;\n    chatwootConversationPending?: boolean;\n    chatwootMergeBrazilContacts?: boolean;\n    chatwootImportContacts?: boolean;\n    chatwootImportMessages?: boolean;\n    chatwootDaysLimitImportMessages?: number;\n    chatwootNameInbox?: string;\n    chatwootOrganization?: string;\n    chatwootLogo?: string;\n    chatwootAutoCreate?: boolean;\n  };\n}\n","import { Constructor } from '@api/integrations/integration.dto';\nimport { JsonValue } from '@prisma/client/runtime/library';\n\nexport class EventDto {\n  webhook?: {\n    enabled?: boolean;\n    events?: string[];\n    url?: string;\n    headers?: JsonValue;\n    byEvents?: boolean;\n    base64?: boolean;\n  };\n\n  websocket?: {\n    enabled?: boolean;\n    events?: string[];\n  };\n\n  sqs?: {\n    enabled?: boolean;\n    events?: string[];\n  };\n\n  rabbitmq?: {\n    enabled?: boolean;\n    events?: string[];\n  };\n\n  nats?: {\n    enabled?: boolean;\n    events?: string[];\n  };\n\n  pusher?: {\n    enabled?: boolean;\n    appId?: string;\n    key?: string;\n    secret?: string;\n    cluster?: string;\n    useTLS?: boolean;\n    events?: string[];\n  };\n\n  kafka?: {\n    enabled?: boolean;\n    events?: string[];\n  };\n}\n\nexport function EventInstanceMixin<TBase extends Constructor>(Base: TBase) {\n  return class extends Base {\n    webhook?: {\n      enabled?: boolean;\n      events?: string[];\n      headers?: JsonValue;\n      url?: string;\n      byEvents?: boolean;\n      base64?: boolean;\n    };\n\n    websocket?: {\n      enabled?: boolean;\n      events?: string[];\n    };\n\n    sqs?: {\n      enabled?: boolean;\n      events?: string[];\n    };\n\n    rabbitmq?: {\n      enabled?: boolean;\n      events?: string[];\n    };\n\n    nats?: {\n      enabled?: boolean;\n      events?: string[];\n    };\n\n    pusher?: {\n      enabled?: boolean;\n      appId?: string;\n      key?: string;\n      secret?: string;\n      cluster?: string;\n      useTLS?: boolean;\n      events?: string[];\n    };\n\n    kafka?: {\n      enabled?: boolean;\n      events?: string[];\n    };\n  };\n}\n","import { ChatwootInstanceMixin } from '@api/integrations/chatbot/chatwoot/dto/chatwoot.dto';\nimport { EventInstanceMixin } from '@api/integrations/event/event.dto';\n\nexport type Constructor<T = {}> = new (...args: any[]) => T;\n\nexport class IntegrationDto extends EventInstanceMixin(ChatwootInstanceMixin(class {})) {}\n","import { IntegrationDto } from '@api/integrations/integration.dto';\nimport { JsonValue } from '@prisma/client/runtime/library';\nimport { WAPresence } from 'baileys';\n\nexport class InstanceDto extends IntegrationDto {\n  instanceName: string;\n  instanceId?: string;\n  qrcode?: boolean;\n  businessId?: string;\n  number?: string;\n  integration?: string;\n  token?: string;\n  status?: string;\n  ownerJid?: string;\n  connectionStatus?: string;\n  profileName?: string;\n  profilePicUrl?: string;\n  // settings\n  rejectCall?: boolean;\n  msgCall?: string;\n  groupsIgnore?: boolean;\n  alwaysOnline?: boolean;\n  readMessages?: boolean;\n  readStatus?: boolean;\n  syncFullHistory?: boolean;\n  wavoipToken?: string;\n  // proxy\n  proxyHost?: string;\n  proxyPort?: string;\n  proxyProtocol?: string;\n  proxyUsername?: string;\n  proxyPassword?: string;\n  webhook?: {\n    enabled?: boolean;\n    events?: string[];\n    headers?: JsonValue;\n    url?: string;\n    byEvents?: boolean;\n    base64?: boolean;\n  };\n  chatwootAccountId?: string;\n  chatwootConversationPending?: boolean;\n  chatwootAutoCreate?: boolean;\n  chatwootDaysLimitImportMessages?: number;\n  chatwootImportContacts?: boolean;\n  chatwootImportMessages?: boolean;\n  chatwootLogo?: string;\n  chatwootMergeBrazilContacts?: boolean;\n  chatwootNameInbox?: string;\n  chatwootOrganization?: string;\n  chatwootReopenConversation?: boolean;\n  chatwootSignMsg?: boolean;\n  chatwootToken?: string;\n  chatwootUrl?: string;\n}\n\nexport class SetPresenceDto {\n  presence: WAPresence;\n}\n","import { Integration } from '@api/types/wa.types';\nimport { JSONSchema7 } from 'json-schema';\nimport { v4 } from 'uuid';\n\nconst isNotEmpty = (...propertyNames: string[]): JSONSchema7 => {\n  const properties = {};\n  propertyNames.forEach(\n    (property) =>\n      (properties[property] = {\n        minLength: 1,\n        description: `The \"${property}\" cannot be empty`,\n      }),\n  );\n  return {\n    if: {\n      propertyNames: {\n        enum: [...propertyNames],\n      },\n    },\n    then: { properties },\n  };\n};\n\nexport const instanceSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    // Instance\n    instanceName: { type: 'string' },\n    token: { type: 'string' },\n    number: { type: 'string', pattern: '^\\\\d+[\\\\.@\\\\w-]+' },\n    businessId: { type: 'string' },\n    qrcode: { type: 'boolean' },\n    Integration: {\n      type: 'string',\n      enum: Object.values(Integration),\n    },\n    // Settings\n    rejectCall: { type: 'boolean' },\n    msgCall: { type: 'string' },\n    groupsIgnore: { type: 'boolean' },\n    alwaysOnline: { type: 'boolean' },\n    readMessages: { type: 'boolean' },\n    readStatus: { type: 'boolean' },\n    syncFullHistory: { type: 'boolean' },\n    wavoipToken: { type: 'string' },\n    // Proxy\n    proxyHost: { type: 'string' },\n    proxyPort: { type: 'string' },\n    proxyProtocol: { type: 'string' },\n    proxyUsername: { type: 'string' },\n    proxyPassword: { type: 'string' },\n    // Webhook\n    webhookUrl: { type: 'string' },\n    webhookByEvents: { type: 'boolean' },\n    webhookBase64: { type: 'boolean' },\n    webhookEvents: {\n      type: 'array',\n      minItems: 0,\n      items: {\n        type: 'string',\n        enum: [\n          'APPLICATION_STARTUP',\n          'QRCODE_UPDATED',\n          'MESSAGES_SET',\n          'MESSAGES_UPSERT',\n          'MESSAGES_EDITED',\n          'MESSAGES_UPDATE',\n          'MESSAGES_DELETE',\n          'SEND_MESSAGE',\n          'SEND_MESSAGE_UPDATE',\n          'CONTACTS_SET',\n          'CONTACTS_UPSERT',\n          'CONTACTS_UPDATE',\n          'PRESENCE_UPDATE',\n          'CHATS_SET',\n          'CHATS_UPSERT',\n          'CHATS_UPDATE',\n          'CHATS_DELETE',\n          'GROUPS_UPSERT',\n          'GROUP_UPDATE',\n          'GROUP_PARTICIPANTS_UPDATE',\n          'CONNECTION_UPDATE',\n          'LABELS_EDIT',\n          'LABELS_ASSOCIATION',\n          'CALL',\n          'TYPEBOT_START',\n          'TYPEBOT_CHANGE_STATUS',\n        ],\n      },\n    },\n    // RabbitMQ\n    rabbitmqEnabled: { type: 'boolean' },\n    rabbitmqEvents: {\n      type: 'array',\n      minItems: 0,\n      items: {\n        type: 'string',\n        enum: [\n          'APPLICATION_STARTUP',\n          'QRCODE_UPDATED',\n          'MESSAGES_SET',\n          'MESSAGES_UPSERT',\n          'MESSAGES_EDITED',\n          'MESSAGES_UPDATE',\n          'MESSAGES_DELETE',\n          'SEND_MESSAGE',\n          'SEND_MESSAGE_UPDATE',\n          'CONTACTS_SET',\n          'CONTACTS_UPSERT',\n          'CONTACTS_UPDATE',\n          'PRESENCE_UPDATE',\n          'CHATS_SET',\n          'CHATS_UPSERT',\n          'CHATS_UPDATE',\n          'CHATS_DELETE',\n          'GROUPS_UPSERT',\n          'GROUP_UPDATE',\n          'GROUP_PARTICIPANTS_UPDATE',\n          'CONNECTION_UPDATE',\n          'LABELS_EDIT',\n          'LABELS_ASSOCIATION',\n          'CALL',\n          'TYPEBOT_START',\n          'TYPEBOT_CHANGE_STATUS',\n        ],\n      },\n    },\n    // NATS\n    natsEnabled: { type: 'boolean' },\n    natsEvents: {\n      type: 'array',\n      minItems: 0,\n      items: {\n        type: 'string',\n        enum: [\n          'APPLICATION_STARTUP',\n          'QRCODE_UPDATED',\n          'MESSAGES_SET',\n          'MESSAGES_UPSERT',\n          'MESSAGES_EDITED',\n          'MESSAGES_UPDATE',\n          'MESSAGES_DELETE',\n          'SEND_MESSAGE',\n          'SEND_MESSAGE_UPDATE',\n          'CONTACTS_SET',\n          'CONTACTS_UPSERT',\n          'CONTACTS_UPDATE',\n          'PRESENCE_UPDATE',\n          'CHATS_SET',\n          'CHATS_UPSERT',\n          'CHATS_UPDATE',\n          'CHATS_DELETE',\n          'GROUPS_UPSERT',\n          'GROUP_UPDATE',\n          'GROUP_PARTICIPANTS_UPDATE',\n          'CONNECTION_UPDATE',\n          'LABELS_EDIT',\n          'LABELS_ASSOCIATION',\n          'CALL',\n          'TYPEBOT_START',\n          'TYPEBOT_CHANGE_STATUS',\n        ],\n      },\n    },\n    // SQS\n    sqsEnabled: { type: 'boolean' },\n    sqsEvents: {\n      type: 'array',\n      minItems: 0,\n      items: {\n        type: 'string',\n        enum: [\n          'APPLICATION_STARTUP',\n          'QRCODE_UPDATED',\n          'MESSAGES_SET',\n          'MESSAGES_UPSERT',\n          'MESSAGES_EDITED',\n          'MESSAGES_UPDATE',\n          'MESSAGES_DELETE',\n          'SEND_MESSAGE',\n          'SEND_MESSAGE_UPDATE',\n          'CONTACTS_SET',\n          'CONTACTS_UPSERT',\n          'CONTACTS_UPDATE',\n          'PRESENCE_UPDATE',\n          'CHATS_SET',\n          'CHATS_UPSERT',\n          'CHATS_UPDATE',\n          'CHATS_DELETE',\n          'GROUPS_UPSERT',\n          'GROUP_UPDATE',\n          'GROUP_PARTICIPANTS_UPDATE',\n          'CONNECTION_UPDATE',\n          'LABELS_EDIT',\n          'LABELS_ASSOCIATION',\n          'CALL',\n          'TYPEBOT_START',\n          'TYPEBOT_CHANGE_STATUS',\n        ],\n      },\n    },\n    // Chatwoot\n    chatwootAccountId: { type: 'string' },\n    chatwootToken: { type: 'string' },\n    chatwootUrl: { type: 'string' },\n    chatwootSignMsg: { type: 'boolean' },\n    chatwootReopenConversation: { type: 'boolean' },\n    chatwootConversationPending: { type: 'boolean' },\n    chatwootImportContacts: { type: 'boolean' },\n    chatwootNameInbox: { type: 'string' },\n    chatwootMergeBrazilContacts: { type: 'boolean' },\n    chatwootImportMessages: { type: 'boolean' },\n    chatwootDaysLimitImportMessages: { type: 'number' },\n  },\n  ...isNotEmpty('instanceName'),\n};\n\nexport const presenceOnlySchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    presence: {\n      type: 'string',\n      enum: ['unavailable', 'available', 'composing', 'recording', 'paused'],\n    },\n  },\n  required: ['presence'],\n};\n","import { RouterBroker } from '@api/abstract/abstract.router';\nimport { InstanceDto } from '@api/dto/instance.dto';\nimport { HttpStatus } from '@api/routes/index.router';\nimport { baileysController } from '@api/server.module';\nimport { instanceSchema } from '@validate/instance.schema';\nimport { RequestHandler, Router } from 'express';\n\nexport class BaileysRouter extends RouterBroker {\n  constructor(...guards: RequestHandler[]) {\n    super();\n    this.router\n      .post(this.routerPath('onWhatsapp'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => baileysController.onWhatsapp(instance, req.body),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('profilePictureUrl'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => baileysController.profilePictureUrl(instance, req.body),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('assertSessions'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => baileysController.assertSessions(instance, req.body),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('createParticipantNodes'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => baileysController.createParticipantNodes(instance, req.body),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('getUSyncDevices'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => baileysController.getUSyncDevices(instance, req.body),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('generateMessageTag'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => baileysController.generateMessageTag(instance),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('sendNode'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => baileysController.sendNode(instance, req.body),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('signalRepositoryDecryptMessage'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => baileysController.signalRepositoryDecryptMessage(instance, req.body),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('getAuthState'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => baileysController.getAuthState(instance),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      });\n  }\n\n  public readonly router: Router = Router();\n}\n","import { Router } from 'express';\n\nimport { EvolutionRouter } from './evolution/evolution.router';\nimport { MetaRouter } from './meta/meta.router';\nimport { BaileysRouter } from './whatsapp/baileys.router';\n\nexport class ChannelRouter {\n  public readonly router: Router;\n\n  constructor(configService: any, ...guards: any[]) {\n    this.router = Router();\n\n    this.router.use('/', new EvolutionRouter(configService).router);\n    this.router.use('/', new MetaRouter(configService).router);\n    this.router.use('/baileys', new BaileysRouter(...guards).router);\n  }\n}\n","import { JSONSchema7 } from 'json-schema';\n\nexport const catalogSchema: JSONSchema7 = {\n  type: 'object',\n  properties: {\n    number: { type: 'string' },\n    limit: { type: 'number' },\n  },\n};\n\nexport const collectionsSchema: JSONSchema7 = {\n  type: 'object',\n  properties: {\n    number: { type: 'string' },\n    limit: { type: 'number' },\n  },\n};\n","import { JSONSchema7, JSONSchema7Definition } from 'json-schema';\nimport { v4 } from 'uuid';\n\nconst isNotEmpty = (...propertyNames: string[]): JSONSchema7 => {\n  const properties = {};\n  propertyNames.forEach(\n    (property) =>\n      (properties[property] = {\n        minLength: 1,\n        description: `The \"${property}\" cannot be empty`,\n      }),\n  );\n  return {\n    if: {\n      propertyNames: {\n        enum: [...propertyNames],\n      },\n    },\n    then: { properties },\n  };\n};\n\nconst numberDefinition: JSONSchema7Definition = {\n  type: 'string',\n  description: 'Invalid format',\n};\n\nexport const whatsappNumberSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    numbers: {\n      type: 'array',\n      minItems: 1,\n      uniqueItems: true,\n      items: {\n        type: 'string',\n        description: '\"numbers\" must be an array of numeric strings',\n      },\n    },\n  },\n};\n\nexport const readMessageSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    readMessages: {\n      type: 'array',\n      minItems: 1,\n      uniqueItems: true,\n      items: {\n        properties: {\n          id: { type: 'string' },\n          fromMe: { type: 'boolean', enum: [true, false] },\n          remoteJid: { type: 'string' },\n        },\n        required: ['id', 'fromMe', 'remoteJid'],\n        ...isNotEmpty('id', 'remoteJid'),\n      },\n    },\n  },\n  required: ['readMessages'],\n};\n\nexport const archiveChatSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    chat: { type: 'string' },\n    lastMessage: {\n      type: 'object',\n      properties: {\n        key: {\n          type: 'object',\n          properties: {\n            id: { type: 'string' },\n            remoteJid: { type: 'string' },\n            fromMe: { type: 'boolean', enum: [true, false] },\n          },\n          required: ['id', 'fromMe', 'remoteJid'],\n          ...isNotEmpty('id', 'remoteJid'),\n        },\n        messageTimestamp: { type: 'integer', minLength: 1 },\n      },\n      required: ['key'],\n      ...isNotEmpty('messageTimestamp'),\n    },\n    archive: { type: 'boolean', enum: [true, false] },\n  },\n  required: ['archive'],\n};\n\nexport const markChatUnreadSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    chat: { type: 'string' },\n    lastMessage: {\n      type: 'object',\n      properties: {\n        key: {\n          type: 'object',\n          properties: {\n            id: { type: 'string' },\n            remoteJid: { type: 'string' },\n            fromMe: { type: 'boolean', enum: [true, false] },\n          },\n          required: ['id', 'fromMe', 'remoteJid'],\n          ...isNotEmpty('id', 'remoteJid'),\n        },\n        messageTimestamp: { type: 'integer', minLength: 1 },\n      },\n      required: ['key'],\n      ...isNotEmpty('messageTimestamp'),\n    },\n  },\n  required: ['lastMessage'],\n};\n\nexport const deleteMessageSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    id: { type: 'string' },\n    fromMe: { type: 'boolean', enum: [true, false] },\n    remoteJid: { type: 'string' },\n    participant: { type: 'string' },\n  },\n  required: ['id', 'fromMe', 'remoteJid'],\n  ...isNotEmpty('id', 'remoteJid', 'participant'),\n};\n\nexport const profilePictureSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    number: { type: 'string' },\n    picture: { type: 'string' },\n  },\n};\n\nexport const updateMessageSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    number: { type: 'string' },\n    text: { type: 'string' },\n    key: {\n      type: 'object',\n      properties: {\n        id: { type: 'string' },\n        remoteJid: { type: 'string' },\n        fromMe: { type: 'boolean', enum: [true, false] },\n      },\n      required: ['id', 'fromMe', 'remoteJid'],\n      ...isNotEmpty('id', 'remoteJid'),\n    },\n  },\n  ...isNotEmpty('number', 'text', 'key'),\n};\n\nexport const presenceSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    number: { ...numberDefinition },\n    delay: { type: 'number' },\n    presence: {\n      type: 'string',\n      enum: ['unavailable', 'available', 'composing', 'recording', 'paused'],\n    },\n  },\n  required: ['number', 'presence', 'delay'],\n};\n\nexport const blockUserSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    number: { type: 'string' },\n    status: { type: 'string', enum: ['block', 'unblock'] },\n  },\n  required: ['number', 'status'],\n  ...isNotEmpty('number', 'status'),\n};\n\nexport const contactValidateSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    where: {\n      type: 'object',\n      properties: {\n        _id: { type: 'string', minLength: 1 },\n        pushName: { type: 'string', minLength: 1 },\n        id: { type: 'string', minLength: 1 },\n        remoteJid: { type: 'string', minLength: 1 },\n      },\n      ...isNotEmpty('_id', 'id', 'pushName', 'remoteJid'),\n    },\n  },\n};\n\nexport const messageValidateSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    where: {\n      type: 'object',\n      properties: {\n        _id: { type: 'string', minLength: 1 },\n        key: {\n          type: 'object',\n          if: {\n            propertyNames: {\n              enum: ['fromMe', 'remoteJid', 'id'],\n            },\n          },\n          then: {\n            properties: {\n              remoteJid: {\n                type: 'string',\n                minLength: 1,\n                description: 'The property cannot be empty',\n              },\n              id: {\n                type: 'string',\n                minLength: 1,\n                description: 'The property cannot be empty',\n              },\n              fromMe: { type: 'boolean', enum: [true, false] },\n            },\n          },\n        },\n        message: { type: 'object' },\n      },\n      ...isNotEmpty('_id'),\n    },\n    limit: { type: 'integer' },\n  },\n};\n\nexport const messageUpSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    where: {\n      type: 'object',\n      properties: {\n        _id: { type: 'string' },\n        remoteJid: { type: 'string' },\n        id: { type: 'string' },\n        fromMe: { type: 'boolean', enum: [true, false] },\n        participant: { type: 'string' },\n        status: {\n          type: 'string',\n          enum: ['ERROR', 'PENDING', 'SERVER_ACK', 'DELIVERY_ACK', 'READ', 'PLAYED'],\n        },\n      },\n      ...isNotEmpty('_id', 'remoteJid', 'id', 'status'),\n    },\n    limit: { type: 'integer' },\n  },\n};\n\nexport const privacySettingsSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    readreceipts: { type: 'string', enum: ['all', 'none'] },\n    profile: {\n      type: 'string',\n      enum: ['all', 'contacts', 'contact_blacklist', 'none'],\n    },\n    status: {\n      type: 'string',\n      enum: ['all', 'contacts', 'contact_blacklist', 'none'],\n    },\n    online: { type: 'string', enum: ['all', 'match_last_seen'] },\n    last: { type: 'string', enum: ['all', 'contacts', 'contact_blacklist', 'none'] },\n    groupadd: {\n      type: 'string',\n      enum: ['all', 'contacts', 'contact_blacklist', 'none'],\n    },\n  },\n  required: ['readreceipts', 'profile', 'status', 'online', 'last', 'groupadd'],\n  ...isNotEmpty('readreceipts', 'profile', 'status', 'online', 'last', 'groupadd'),\n};\n\nexport const profileNameSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    name: { type: 'string' },\n  },\n  ...isNotEmpty('name'),\n};\n\nexport const profileStatusSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    status: { type: 'string' },\n  },\n  ...isNotEmpty('status'),\n};\n\nexport const profileSchema: JSONSchema7 = {\n  type: 'object',\n  properties: {\n    wuid: { type: 'string' },\n    name: { type: 'string' },\n    picture: { type: 'string' },\n    status: { type: 'string' },\n    isBusiness: { type: 'boolean' },\n  },\n};\n","import { JSONSchema7 } from 'json-schema';\nimport { v4 } from 'uuid';\n\nconst isNotEmpty = (...propertyNames: string[]): JSONSchema7 => {\n  const properties = {};\n  propertyNames.forEach(\n    (property) =>\n      (properties[property] = {\n        minLength: 1,\n        description: `The \"${property}\" cannot be empty`,\n      }),\n  );\n  return {\n    if: {\n      propertyNames: {\n        enum: [...propertyNames],\n      },\n    },\n    then: { properties },\n  };\n};\n\nexport const createGroupSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    subject: { type: 'string' },\n    description: { type: 'string' },\n    profilePicture: { type: 'string' },\n    promoteParticipants: { type: 'boolean', enum: [true, false] },\n    participants: {\n      type: 'array',\n      minItems: 1,\n      uniqueItems: true,\n      items: {\n        type: 'string',\n        minLength: 10,\n        pattern: '\\\\d+',\n        description: '\"participants\" must be an array of numeric strings',\n      },\n    },\n  },\n  required: ['subject', 'participants'],\n  ...isNotEmpty('subject', 'description', 'profilePicture'),\n};\n\nexport const groupJidSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    groupJid: { type: 'string', pattern: '^[\\\\d-]+@g.us$' },\n  },\n  required: ['groupJid'],\n  ...isNotEmpty('groupJid'),\n};\n\nexport const getParticipantsSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    getParticipants: { type: 'string', enum: ['true', 'false'] },\n  },\n  required: ['getParticipants'],\n  ...isNotEmpty('getParticipants'),\n};\n\nexport const groupSendInviteSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    groupJid: { type: 'string' },\n    description: { type: 'string' },\n    numbers: {\n      type: 'array',\n      minItems: 1,\n      uniqueItems: true,\n      items: {\n        type: 'string',\n        minLength: 10,\n        pattern: '\\\\d+',\n        description: '\"numbers\" must be an array of numeric strings',\n      },\n    },\n  },\n  required: ['groupJid', 'description', 'numbers'],\n  ...isNotEmpty('groupJid', 'description', 'numbers'),\n};\n\nexport const groupInviteSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    inviteCode: { type: 'string', pattern: '^[a-zA-Z0-9]{22}$' },\n  },\n  required: ['inviteCode'],\n  ...isNotEmpty('inviteCode'),\n};\n\nexport const AcceptGroupInviteSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    inviteCode: { type: 'string', pattern: '^[a-zA-Z0-9]{22}$' },\n  },\n  required: ['inviteCode'],\n  ...isNotEmpty('inviteCode'),\n};\n\nexport const updateParticipantsSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    groupJid: { type: 'string' },\n    action: {\n      type: 'string',\n      enum: ['add', 'remove', 'promote', 'demote'],\n    },\n    participants: {\n      type: 'array',\n      minItems: 1,\n      uniqueItems: true,\n      items: {\n        type: 'string',\n        minLength: 10,\n        pattern: '\\\\d+',\n        description: '\"participants\" must be an array of numeric strings',\n      },\n    },\n  },\n  required: ['groupJid', 'action', 'participants'],\n  ...isNotEmpty('groupJid', 'action'),\n};\n\nexport const updateSettingsSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    groupJid: { type: 'string' },\n    action: {\n      type: 'string',\n      enum: ['announcement', 'not_announcement', 'locked', 'unlocked'],\n    },\n  },\n  required: ['groupJid', 'action'],\n  ...isNotEmpty('groupJid', 'action'),\n};\n\nexport const toggleEphemeralSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    groupJid: { type: 'string' },\n    expiration: {\n      type: 'number',\n      enum: [0, 86400, 604800, 7776000],\n    },\n  },\n  required: ['groupJid', 'expiration'],\n  ...isNotEmpty('groupJid', 'expiration'),\n};\n\nexport const updateGroupPictureSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    groupJid: { type: 'string' },\n    image: { type: 'string' },\n  },\n  required: ['groupJid', 'image'],\n  ...isNotEmpty('groupJid', 'image'),\n};\n\nexport const updateGroupSubjectSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    groupJid: { type: 'string' },\n    subject: { type: 'string' },\n  },\n  required: ['groupJid', 'subject'],\n  ...isNotEmpty('groupJid', 'subject'),\n};\n\nexport const updateGroupDescriptionSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    groupJid: { type: 'string' },\n    description: { type: 'string' },\n  },\n  required: ['groupJid', 'description'],\n  ...isNotEmpty('groupJid', 'description'),\n};\n","import { JSONSchema7, JSONSchema7Definition } from 'json-schema';\nimport { v4 } from 'uuid';\n\nconst isNotEmpty = (...propertyNames: string[]): JSONSchema7 => {\n  const properties = {};\n  propertyNames.forEach(\n    (property) =>\n      (properties[property] = {\n        minLength: 1,\n        description: `The \"${property}\" cannot be empty`,\n      }),\n  );\n  return {\n    if: {\n      propertyNames: {\n        enum: [...propertyNames],\n      },\n    },\n    then: { properties },\n  };\n};\n\nconst numberDefinition: JSONSchema7Definition = {\n  type: 'string',\n  description: 'Invalid format',\n};\n\nexport const handleLabelSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    number: { ...numberDefinition },\n    labelId: { type: 'string' },\n    action: { type: 'string', enum: ['add', 'remove'] },\n  },\n  required: ['number', 'labelId', 'action'],\n  ...isNotEmpty('number', 'labelId', 'action'),\n};\n","import { JSONSchema7, JSONSchema7Definition } from 'json-schema';\nimport { v4 } from 'uuid';\n\nconst isNotEmpty = (...propertyNames: string[]): JSONSchema7 => {\n  const properties = {};\n  propertyNames.forEach(\n    (property) =>\n      (properties[property] = {\n        minLength: 1,\n        description: `The \"${property}\" cannot be empty`,\n      }),\n  );\n  return {\n    if: {\n      propertyNames: {\n        enum: [...propertyNames],\n      },\n    },\n    then: { properties },\n  };\n};\n\nconst numberDefinition: JSONSchema7Definition = {\n  type: 'string',\n  description: 'Invalid format',\n};\n\nexport const templateMessageSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    number: { ...numberDefinition },\n    name: { type: 'string' },\n    language: { type: 'string' },\n    components: { type: 'array' },\n    webhookUrl: { type: 'string' },\n  },\n  required: ['name', 'language'],\n};\n\nconst quotedOptionsSchema: JSONSchema7 = {\n  properties: {\n    key: {\n      type: 'object',\n      properties: {\n        id: { type: 'string' },\n        remoteJid: { type: 'string' },\n        fromMe: { type: 'boolean', enum: [true, false] },\n      },\n      required: ['id'],\n      ...isNotEmpty('id'),\n    },\n    message: { type: 'object' },\n  },\n};\n\nexport const offerCallSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    number: { ...numberDefinition },\n    isVideo: { type: 'boolean', enum: [true, false] },\n    callDuration: { type: 'integer', minimum: 1, maximum: 15 },\n  },\n  required: ['number', 'callDuration'],\n};\n\nexport const textMessageSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    number: { ...numberDefinition },\n    text: { type: 'string' },\n    linkPreview: { type: 'boolean' },\n    delay: {\n      type: 'integer',\n      description: 'Enter a value in milliseconds',\n    },\n    quoted: { ...quotedOptionsSchema },\n    everyOne: { type: 'boolean', enum: [true, false] },\n    mentioned: {\n      type: 'array',\n      minItems: 1,\n      uniqueItems: true,\n      items: {\n        type: 'string',\n        pattern: '^\\\\d+',\n        description: '\"mentioned\" must be an array of numeric strings',\n      },\n    },\n  },\n  required: ['number', 'text'],\n};\n\nexport const mediaMessageSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    number: { ...numberDefinition },\n    mediatype: { type: 'string', enum: ['image', 'document', 'video', 'audio'] },\n    mimetype: { type: 'string' },\n    media: { type: 'string' },\n    fileName: { type: 'string' },\n    caption: { type: 'string' },\n    delay: {\n      type: 'integer',\n      description: 'Enter a value in milliseconds',\n    },\n    quoted: { ...quotedOptionsSchema },\n    everyOne: { type: 'boolean', enum: [true, false] },\n    mentioned: {\n      type: 'array',\n      minItems: 1,\n      uniqueItems: true,\n      items: {\n        type: 'string',\n        pattern: '^\\\\d+',\n        description: '\"mentioned\" must be an array of numeric strings',\n      },\n    },\n  },\n  required: ['number', 'mediatype'],\n};\n\nexport const ptvMessageSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    number: { ...numberDefinition },\n    video: { type: 'string' },\n    delay: {\n      type: 'integer',\n      description: 'Enter a value in milliseconds',\n    },\n    quoted: { ...quotedOptionsSchema },\n    everyOne: { type: 'boolean', enum: [true, false] },\n    mentioned: {\n      type: 'array',\n      minItems: 1,\n      uniqueItems: true,\n      items: {\n        type: 'string',\n        pattern: '^\\\\d+',\n        description: '\"mentioned\" must be an array of numeric strings',\n      },\n    },\n  },\n  required: ['number'],\n};\n\nexport const audioMessageSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    number: { ...numberDefinition },\n    audio: { type: 'string' },\n    delay: {\n      type: 'integer',\n      description: 'Enter a value in milliseconds',\n    },\n    quoted: { ...quotedOptionsSchema },\n    everyOne: { type: 'boolean', enum: [true, false] },\n    mentioned: {\n      type: 'array',\n      minItems: 1,\n      uniqueItems: true,\n      items: {\n        type: 'string',\n        pattern: '^\\\\d+',\n        description: '\"mentioned\" must be an array of numeric strings',\n      },\n    },\n  },\n  required: ['number'],\n};\n\nexport const statusMessageSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    type: { type: 'string', enum: ['text', 'image', 'audio', 'video'] },\n    content: { type: 'string' },\n    caption: { type: 'string' },\n    backgroundColor: { type: 'string' },\n    font: { type: 'integer', minimum: 0, maximum: 5 },\n    statusJidList: {\n      type: 'array',\n      minItems: 1,\n      uniqueItems: true,\n      items: {\n        type: 'string',\n        pattern: '^\\\\d+',\n        description: '\"statusJidList\" must be an array of numeric strings',\n      },\n    },\n    allContacts: { type: 'boolean', enum: [true, false] },\n  },\n  required: ['type'],\n};\n\nexport const stickerMessageSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    number: { ...numberDefinition },\n    sticker: { type: 'string' },\n    delay: {\n      type: 'integer',\n      description: 'Enter a value in milliseconds',\n    },\n    quoted: { ...quotedOptionsSchema },\n    everyOne: { type: 'boolean', enum: [true, false] },\n    mentioned: {\n      type: 'array',\n      minItems: 1,\n      uniqueItems: true,\n      items: {\n        type: 'string',\n        pattern: '^\\\\d+',\n        description: '\"mentioned\" must be an array of numeric strings',\n      },\n    },\n  },\n  required: ['number'],\n};\n\nexport const locationMessageSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    number: { ...numberDefinition },\n    latitude: { type: 'number' },\n    longitude: { type: 'number' },\n    name: { type: 'string' },\n    address: { type: 'string' },\n    delay: {\n      type: 'integer',\n      description: 'Enter a value in milliseconds',\n    },\n    quoted: { ...quotedOptionsSchema },\n    everyOne: { type: 'boolean', enum: [true, false] },\n    mentioned: {\n      type: 'array',\n      minItems: 1,\n      uniqueItems: true,\n      items: {\n        type: 'string',\n        pattern: '^\\\\d+',\n        description: '\"mentioned\" must be an array of numeric strings',\n      },\n    },\n  },\n  required: ['number', 'latitude', 'longitude', 'name', 'address'],\n};\n\nexport const contactMessageSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    number: { ...numberDefinition },\n    contact: {\n      type: 'array',\n      items: {\n        type: 'object',\n        properties: {\n          fullName: { type: 'string' },\n          wuid: {\n            type: 'string',\n            minLength: 10,\n            pattern: '\\\\d+',\n            description: '\"wuid\" must be a numeric string',\n          },\n          phoneNumber: { type: 'string', minLength: 10 },\n          organization: { type: 'string' },\n          email: { type: 'string' },\n          url: { type: 'string' },\n        },\n        required: ['fullName', 'phoneNumber'],\n        ...isNotEmpty('fullName'),\n      },\n      minItems: 1,\n      uniqueItems: true,\n    },\n  },\n  required: ['number', 'contact'],\n};\n\nexport const reactionMessageSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    key: {\n      type: 'object',\n      properties: {\n        id: { type: 'string' },\n        remoteJid: { type: 'string' },\n        fromMe: { type: 'boolean', enum: [true, false] },\n      },\n      required: ['id', 'remoteJid', 'fromMe'],\n      ...isNotEmpty('id', 'remoteJid'),\n    },\n    reaction: { type: 'string' },\n  },\n  required: ['key', 'reaction'],\n};\n\nexport const pollMessageSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    number: { ...numberDefinition },\n    name: { type: 'string' },\n    selectableCount: { type: 'integer', minimum: 0, maximum: 10 },\n    values: {\n      type: 'array',\n      minItems: 2,\n      maxItems: 10,\n      uniqueItems: true,\n      items: {\n        type: 'string',\n      },\n    },\n    delay: {\n      type: 'integer',\n      description: 'Enter a value in milliseconds',\n    },\n    quoted: { ...quotedOptionsSchema },\n    everyOne: { type: 'boolean', enum: [true, false] },\n    mentioned: {\n      type: 'array',\n      minItems: 1,\n      uniqueItems: true,\n      items: {\n        type: 'string',\n        pattern: '^\\\\d+',\n        description: '\"mentioned\" must be an array of numeric strings',\n      },\n    },\n  },\n  required: ['number', 'name', 'selectableCount', 'values'],\n};\n\nexport const listMessageSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    number: { ...numberDefinition },\n    title: { type: 'string' },\n    description: { type: 'string' },\n    footerText: { type: 'string' },\n    buttonText: { type: 'string' },\n    sections: {\n      type: 'array',\n      minItems: 1,\n      uniqueItems: true,\n      items: {\n        type: 'object',\n        properties: {\n          title: { type: 'string' },\n          rows: {\n            type: 'array',\n            minItems: 1,\n            uniqueItems: true,\n            items: {\n              type: 'object',\n              properties: {\n                title: { type: 'string' },\n                description: { type: 'string' },\n                rowId: { type: 'string' },\n              },\n              required: ['title', 'rowId'],\n              ...isNotEmpty('title', 'description', 'rowId'),\n            },\n          },\n        },\n        required: ['title', 'rows'],\n        ...isNotEmpty('title'),\n      },\n    },\n    delay: {\n      type: 'integer',\n      description: 'Enter a value in milliseconds',\n    },\n    quoted: { ...quotedOptionsSchema },\n    everyOne: { type: 'boolean', enum: [true, false] },\n    mentioned: {\n      type: 'array',\n      minItems: 1,\n      uniqueItems: true,\n      items: {\n        type: 'string',\n        pattern: '^\\\\d+',\n        description: '\"mentioned\" must be an array of numeric strings',\n      },\n    },\n  },\n  required: ['number', 'title', 'footerText', 'buttonText', 'sections'],\n};\n\nexport const buttonsMessageSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    number: { ...numberDefinition },\n    thumbnailUrl: { type: 'string' },\n    title: { type: 'string' },\n    description: { type: 'string' },\n    footer: { type: 'string' },\n    buttons: {\n      type: 'array',\n      items: {\n        type: 'object',\n        properties: {\n          type: {\n            type: 'string',\n            enum: ['reply', 'copy', 'url', 'call', 'pix'],\n          },\n          displayText: { type: 'string' },\n          id: { type: 'string' },\n          url: { type: 'string' },\n          phoneNumber: { type: 'string' },\n          currency: { type: 'string' },\n          name: { type: 'string' },\n          keyType: { type: 'string', enum: ['phone', 'email', 'cpf', 'cnpj', 'random'] },\n          key: { type: 'string' },\n        },\n        required: ['type'],\n        ...isNotEmpty('id', 'url', 'phoneNumber'),\n      },\n    },\n    delay: {\n      type: 'integer',\n      description: 'Enter a value in milliseconds',\n    },\n    quoted: { ...quotedOptionsSchema },\n    everyOne: { type: 'boolean', enum: [true, false] },\n    mentioned: {\n      type: 'array',\n      minItems: 1,\n      uniqueItems: true,\n      items: {\n        type: 'string',\n        pattern: '^\\\\d+',\n        description: '\"mentioned\" must be an array of numeric strings',\n      },\n    },\n  },\n  required: ['number'],\n};\n","import { JSONSchema7 } from 'json-schema';\nimport { v4 } from 'uuid';\n\nconst isNotEmpty = (...propertyNames: string[]): JSONSchema7 => {\n  const properties = {};\n  propertyNames.forEach(\n    (property) =>\n      (properties[property] = {\n        minLength: 1,\n        description: `The \"${property}\" cannot be empty`,\n      }),\n  );\n  return {\n    if: {\n      propertyNames: {\n        enum: [...propertyNames],\n      },\n    },\n    then: { properties },\n  };\n};\n\nexport const proxySchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    enabled: { type: 'boolean', enum: [true, false] },\n    host: { type: 'string' },\n    port: { type: 'string' },\n    protocol: { type: 'string' },\n    username: { type: 'string' },\n    password: { type: 'string' },\n  },\n  required: ['enabled', 'host', 'port', 'protocol'],\n  ...isNotEmpty('enabled', 'host', 'port', 'protocol'),\n};\n","import { JSONSchema7 } from 'json-schema';\nimport { v4 } from 'uuid';\n\nconst isNotEmpty = (...propertyNames: string[]): JSONSchema7 => {\n  const properties = {};\n  propertyNames.forEach(\n    (property) =>\n      (properties[property] = {\n        minLength: 1,\n        description: `The \"${property}\" cannot be empty`,\n      }),\n  );\n  return {\n    if: {\n      propertyNames: {\n        enum: [...propertyNames],\n      },\n    },\n    then: { properties },\n  };\n};\n\nexport const settingsSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    rejectCall: { type: 'boolean' },\n    msgCall: { type: 'string' },\n    groupsIgnore: { type: 'boolean' },\n    alwaysOnline: { type: 'boolean' },\n    readMessages: { type: 'boolean' },\n    readStatus: { type: 'boolean' },\n    syncFullHistory: { type: 'boolean' },\n    wavoipToken: { type: 'string' },\n  },\n  required: ['rejectCall', 'groupsIgnore', 'alwaysOnline', 'readMessages', 'readStatus', 'syncFullHistory'],\n  ...isNotEmpty('rejectCall', 'groupsIgnore', 'alwaysOnline', 'readMessages', 'readStatus', 'syncFullHistory'),\n};\n","import { JSONSchema7 } from 'json-schema';\nimport { v4 } from 'uuid';\n\nconst isNotEmpty = (...propertyNames: string[]): JSONSchema7 => {\n  const properties = {};\n  propertyNames.forEach(\n    (property) =>\n      (properties[property] = {\n        minLength: 1,\n        description: `The \"${property}\" cannot be empty`,\n      }),\n  );\n  return {\n    if: {\n      propertyNames: {\n        enum: [...propertyNames],\n      },\n    },\n    then: { properties },\n  };\n};\n\nexport const templateSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    name: { type: 'string' },\n    category: { type: 'string', enum: ['AUTHENTICATION', 'MARKETING', 'UTILITY'] },\n    allowCategoryChange: { type: 'boolean' },\n    language: { type: 'string' },\n    components: { type: 'array' },\n    webhookUrl: { type: 'string' },\n  },\n  required: ['name', 'category', 'language', 'components'],\n  ...isNotEmpty('name', 'category', 'language', 'components'),\n};\n","import { JSONSchema7 } from 'json-schema';\nimport { v4 } from 'uuid';\n\nconst isNotEmpty = (...propertyNames: string[]): JSONSchema7 => {\n  const properties: Record<string, unknown> = {};\n  propertyNames.forEach(\n    (property) =>\n      (properties[property] = {\n        minLength: 1,\n        description: `The \"${property}\" cannot be empty`,\n      }),\n  );\n  return {\n    if: {\n      propertyNames: {\n        enum: [...propertyNames],\n      },\n    },\n    then: { properties },\n  } as JSONSchema7;\n};\n\nexport const templateDeleteSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    name: { type: 'string' },\n    hsmId: { type: 'string' },\n  },\n  required: ['name'],\n  ...isNotEmpty('name'),\n};\n","import { JSONSchema7 } from 'json-schema';\nimport { v4 } from 'uuid';\n\nconst isNotEmpty = (...propertyNames: string[]): JSONSchema7 => {\n  const properties: Record<string, unknown> = {};\n  propertyNames.forEach(\n    (property) =>\n      (properties[property] = {\n        minLength: 1,\n        description: `The \"${property}\" cannot be empty`,\n      }),\n  );\n  return {\n    if: {\n      propertyNames: {\n        enum: [...propertyNames],\n      },\n    },\n    then: { properties },\n  } as JSONSchema7;\n};\n\nexport const templateEditSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    templateId: { type: 'string' },\n    category: { type: 'string', enum: ['AUTHENTICATION', 'MARKETING', 'UTILITY'] },\n    allowCategoryChange: { type: 'boolean' },\n    ttl: { type: 'number' },\n    components: { type: 'array' },\n  },\n  required: ['templateId'],\n  ...isNotEmpty('templateId'),\n};\n","import { JSONSchema7 } from 'json-schema';\nimport { v4 } from 'uuid';\n\nconst isNotEmpty = (...propertyNames: string[]): JSONSchema7 => {\n  const properties = {};\n  propertyNames.forEach(\n    (property) =>\n      (properties[property] = {\n        minLength: 1,\n        description: `The \"${property}\" cannot be empty`,\n      }),\n  );\n  return {\n    if: {\n      propertyNames: {\n        enum: [...propertyNames],\n      },\n    },\n    then: { properties },\n  };\n};\n\nexport const chatwootSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    enabled: { type: 'boolean', enum: [true, false] },\n    accountId: { type: 'string' },\n    token: { type: 'string' },\n    url: { type: 'string' },\n    signMsg: { type: 'boolean', enum: [true, false] },\n    signDelimiter: { type: ['string', 'null'] },\n    nameInbox: { type: ['string', 'null'] },\n    reopenConversation: { type: 'boolean', enum: [true, false] },\n    conversationPending: { type: 'boolean', enum: [true, false] },\n    autoCreate: { type: 'boolean', enum: [true, false] },\n    importContacts: { type: 'boolean', enum: [true, false] },\n    mergeBrazilContacts: { type: 'boolean', enum: [true, false] },\n    importMessages: { type: 'boolean', enum: [true, false] },\n    daysLimitImportMessages: { type: 'number' },\n    ignoreJids: { type: 'array', items: { type: 'string' } },\n  },\n  required: ['enabled', 'accountId', 'token', 'url', 'signMsg', 'reopenConversation', 'conversationPending'],\n  ...isNotEmpty('enabled', 'accountId', 'token', 'url', 'signMsg', 'reopenConversation', 'conversationPending'),\n};\n","import { JSONSchema7 } from 'json-schema';\nimport { v4 } from 'uuid';\n\nconst isNotEmpty = (...propertyNames: string[]): JSONSchema7 => {\n  const properties = {};\n  propertyNames.forEach(\n    (property) =>\n      (properties[property] = {\n        minLength: 1,\n        description: `The \"${property}\" cannot be empty`,\n      }),\n  );\n  return {\n    if: {\n      propertyNames: {\n        enum: [...propertyNames],\n      },\n    },\n    then: { properties },\n  };\n};\n\nexport const difySchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    enabled: { type: 'boolean' },\n    description: { type: 'string' },\n    botType: { type: 'string', enum: ['chatBot', 'textGenerator', 'agent', 'workflow'] },\n    apiUrl: { type: 'string' },\n    apiKey: { type: 'string' },\n    triggerType: { type: 'string', enum: ['all', 'keyword', 'none', 'advanced'] },\n    triggerOperator: { type: 'string', enum: ['equals', 'contains', 'startsWith', 'endsWith', 'regex'] },\n    triggerValue: { type: 'string' },\n    expire: { type: 'integer' },\n    keywordFinish: { type: 'string' },\n    delayMessage: { type: 'integer' },\n    unknownMessage: { type: 'string' },\n    listeningFromMe: { type: 'boolean' },\n    stopBotFromMe: { type: 'boolean' },\n    keepOpen: { type: 'boolean' },\n    debounceTime: { type: 'integer' },\n    ignoreJids: { type: 'array', items: { type: 'string' } },\n    splitMessages: { type: 'boolean' },\n    timePerChar: { type: 'integer' },\n  },\n  required: ['enabled', 'botType', 'triggerType'],\n  ...isNotEmpty('enabled', 'botType', 'triggerType'),\n};\n\nexport const difyStatusSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    remoteJid: { type: 'string' },\n    status: { type: 'string', enum: ['opened', 'closed', 'paused', 'delete'] },\n  },\n  required: ['remoteJid', 'status'],\n  ...isNotEmpty('remoteJid', 'status'),\n};\n\nexport const difySettingSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    expire: { type: 'integer' },\n    keywordFinish: { type: 'string' },\n    delayMessage: { type: 'integer' },\n    unknownMessage: { type: 'string' },\n    listeningFromMe: { type: 'boolean' },\n    stopBotFromMe: { type: 'boolean' },\n    keepOpen: { type: 'boolean' },\n    debounceTime: { type: 'integer' },\n    ignoreJids: { type: 'array', items: { type: 'string' } },\n    difyIdFallback: { type: 'string' },\n    splitMessages: { type: 'boolean' },\n    timePerChar: { type: 'integer' },\n  },\n  required: [\n    'expire',\n    'keywordFinish',\n    'delayMessage',\n    'unknownMessage',\n    'listeningFromMe',\n    'stopBotFromMe',\n    'keepOpen',\n    'debounceTime',\n    'ignoreJids',\n    'splitMessages',\n    'timePerChar',\n  ],\n  ...isNotEmpty(\n    'expire',\n    'keywordFinish',\n    'delayMessage',\n    'unknownMessage',\n    'listeningFromMe',\n    'stopBotFromMe',\n    'keepOpen',\n    'debounceTime',\n    'ignoreJids',\n    'splitMessages',\n    'timePerChar',\n  ),\n};\n\nexport const difyIgnoreJidSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    remoteJid: { type: 'string' },\n    action: { type: 'string', enum: ['add', 'remove'] },\n  },\n  required: ['remoteJid', 'action'],\n  ...isNotEmpty('remoteJid', 'action'),\n};\n","import { JSONSchema7 } from 'json-schema';\nimport { v4 } from 'uuid';\n\nconst isNotEmpty = (...propertyNames: string[]): JSONSchema7 => {\n  const properties = {};\n  propertyNames.forEach(\n    (property) =>\n      (properties[property] = {\n        minLength: 1,\n        description: `The \"${property}\" cannot be empty`,\n      }),\n  );\n  return {\n    if: {\n      propertyNames: {\n        enum: [...propertyNames],\n      },\n    },\n    then: { properties },\n  };\n};\n\nexport const evoaiSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    enabled: { type: 'boolean' },\n    description: { type: 'string' },\n    agentUrl: { type: 'string' },\n    apiKey: { type: 'string' },\n    triggerType: { type: 'string', enum: ['all', 'keyword', 'none', 'advanced'] },\n    triggerOperator: { type: 'string', enum: ['equals', 'contains', 'startsWith', 'endsWith', 'regex'] },\n    triggerValue: { type: 'string' },\n    expire: { type: 'integer' },\n    keywordFinish: { type: 'string' },\n    delayMessage: { type: 'integer' },\n    unknownMessage: { type: 'string' },\n    listeningFromMe: { type: 'boolean' },\n    stopBotFromMe: { type: 'boolean' },\n    keepOpen: { type: 'boolean' },\n    debounceTime: { type: 'integer' },\n    ignoreJids: { type: 'array', items: { type: 'string' } },\n    splitMessages: { type: 'boolean' },\n    timePerChar: { type: 'integer' },\n  },\n  required: ['enabled', 'agentUrl', 'triggerType'],\n  ...isNotEmpty('enabled', 'agentUrl', 'triggerType'),\n};\n\nexport const evoaiStatusSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    remoteJid: { type: 'string' },\n    status: { type: 'string', enum: ['opened', 'closed', 'paused', 'delete'] },\n  },\n  required: ['remoteJid', 'status'],\n  ...isNotEmpty('remoteJid', 'status'),\n};\n\nexport const evoaiSettingSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    expire: { type: 'integer' },\n    keywordFinish: { type: 'string' },\n    delayMessage: { type: 'integer' },\n    unknownMessage: { type: 'string' },\n    listeningFromMe: { type: 'boolean' },\n    stopBotFromMe: { type: 'boolean' },\n    keepOpen: { type: 'boolean' },\n    debounceTime: { type: 'integer' },\n    ignoreJids: { type: 'array', items: { type: 'string' } },\n    botIdFallback: { type: 'string' },\n    splitMessages: { type: 'boolean' },\n    timePerChar: { type: 'integer' },\n  },\n  required: [\n    'expire',\n    'keywordFinish',\n    'delayMessage',\n    'unknownMessage',\n    'listeningFromMe',\n    'stopBotFromMe',\n    'keepOpen',\n    'debounceTime',\n    'ignoreJids',\n    'splitMessages',\n    'timePerChar',\n  ],\n  ...isNotEmpty(\n    'expire',\n    'keywordFinish',\n    'delayMessage',\n    'unknownMessage',\n    'listeningFromMe',\n    'stopBotFromMe',\n    'keepOpen',\n    'debounceTime',\n    'ignoreJids',\n    'splitMessages',\n    'timePerChar',\n  ),\n};\n\nexport const evoaiIgnoreJidSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    remoteJid: { type: 'string' },\n    action: { type: 'string', enum: ['add', 'remove'] },\n  },\n  required: ['remoteJid', 'action'],\n  ...isNotEmpty('remoteJid', 'action'),\n};\n","import { JSONSchema7 } from 'json-schema';\nimport { v4 } from 'uuid';\n\nconst isNotEmpty = (...propertyNames: string[]): JSONSchema7 => {\n  const properties = {};\n  propertyNames.forEach(\n    (property) =>\n      (properties[property] = {\n        minLength: 1,\n        description: `The \"${property}\" cannot be empty`,\n      }),\n  );\n  return {\n    if: {\n      propertyNames: {\n        enum: [...propertyNames],\n      },\n    },\n    then: { properties },\n  };\n};\n\nexport const evolutionBotSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    enabled: { type: 'boolean' },\n    description: { type: 'string' },\n    apiUrl: { type: 'string' },\n    apiKey: { type: 'string' },\n    triggerType: { type: 'string', enum: ['all', 'keyword', 'none', 'advanced'] },\n    triggerOperator: { type: 'string', enum: ['equals', 'contains', 'startsWith', 'endsWith', 'regex'] },\n    triggerValue: { type: 'string' },\n    expire: { type: 'integer' },\n    keywordFinish: { type: 'string' },\n    delayMessage: { type: 'integer' },\n    unknownMessage: { type: 'string' },\n    listeningFromMe: { type: 'boolean' },\n    stopBotFromMe: { type: 'boolean' },\n    keepOpen: { type: 'boolean' },\n    debounceTime: { type: 'integer' },\n    ignoreJids: { type: 'array', items: { type: 'string' } },\n    splitMessages: { type: 'boolean' },\n    timePerChar: { type: 'integer' },\n  },\n  required: ['enabled', 'apiUrl', 'triggerType'],\n  ...isNotEmpty('enabled', 'apiUrl', 'triggerType'),\n};\n\nexport const evolutionBotStatusSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    remoteJid: { type: 'string' },\n    status: { type: 'string', enum: ['opened', 'closed', 'paused', 'delete'] },\n  },\n  required: ['remoteJid', 'status'],\n  ...isNotEmpty('remoteJid', 'status'),\n};\n\nexport const evolutionBotSettingSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    expire: { type: 'integer' },\n    keywordFinish: { type: 'string' },\n    delayMessage: { type: 'integer' },\n    unknownMessage: { type: 'string' },\n    listeningFromMe: { type: 'boolean' },\n    stopBotFromMe: { type: 'boolean' },\n    keepOpen: { type: 'boolean' },\n    debounceTime: { type: 'integer' },\n    ignoreJids: { type: 'array', items: { type: 'string' } },\n    botIdFallback: { type: 'string' },\n    splitMessages: { type: 'boolean' },\n    timePerChar: { type: 'integer' },\n  },\n  required: [\n    'expire',\n    'keywordFinish',\n    'delayMessage',\n    'unknownMessage',\n    'listeningFromMe',\n    'stopBotFromMe',\n    'keepOpen',\n    'debounceTime',\n    'ignoreJids',\n    'splitMessages',\n    'timePerChar',\n  ],\n  ...isNotEmpty(\n    'expire',\n    'keywordFinish',\n    'delayMessage',\n    'unknownMessage',\n    'listeningFromMe',\n    'stopBotFromMe',\n    'keepOpen',\n    'debounceTime',\n    'ignoreJids',\n    'splitMessages',\n    'timePerChar',\n  ),\n};\n\nexport const evolutionBotIgnoreJidSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    remoteJid: { type: 'string' },\n    action: { type: 'string', enum: ['add', 'remove'] },\n  },\n  required: ['remoteJid', 'action'],\n  ...isNotEmpty('remoteJid', 'action'),\n};\n","import { JSONSchema7 } from 'json-schema';\nimport { v4 } from 'uuid';\n\nconst isNotEmpty = (...propertyNames: string[]): JSONSchema7 => {\n  const properties = {};\n  propertyNames.forEach(\n    (property) =>\n      (properties[property] = {\n        minLength: 1,\n        description: `The \"${property}\" cannot be empty`,\n      }),\n  );\n  return {\n    if: {\n      propertyNames: {\n        enum: [...propertyNames],\n      },\n    },\n    then: { properties },\n  };\n};\n\nexport const flowiseSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    enabled: { type: 'boolean' },\n    description: { type: 'string' },\n    apiUrl: { type: 'string' },\n    apiKey: { type: 'string' },\n    triggerType: { type: 'string', enum: ['all', 'keyword', 'none', 'advanced'] },\n    triggerOperator: { type: 'string', enum: ['equals', 'contains', 'startsWith', 'endsWith', 'regex'] },\n    triggerValue: { type: 'string' },\n    expire: { type: 'integer' },\n    keywordFinish: { type: 'string' },\n    delayMessage: { type: 'integer' },\n    unknownMessage: { type: 'string' },\n    listeningFromMe: { type: 'boolean' },\n    stopBotFromMe: { type: 'boolean' },\n    keepOpen: { type: 'boolean' },\n    debounceTime: { type: 'integer' },\n    ignoreJids: { type: 'array', items: { type: 'string' } },\n    splitMessages: { type: 'boolean' },\n    timePerChar: { type: 'integer' },\n  },\n  required: ['enabled', 'apiUrl', 'triggerType'],\n  ...isNotEmpty('enabled', 'apiUrl', 'triggerType'),\n};\n\nexport const flowiseStatusSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    remoteJid: { type: 'string' },\n    status: { type: 'string', enum: ['opened', 'closed', 'paused', 'delete'] },\n  },\n  required: ['remoteJid', 'status'],\n  ...isNotEmpty('remoteJid', 'status'),\n};\n\nexport const flowiseSettingSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    expire: { type: 'integer' },\n    keywordFinish: { type: 'string' },\n    delayMessage: { type: 'integer' },\n    unknownMessage: { type: 'string' },\n    listeningFromMe: { type: 'boolean' },\n    stopBotFromMe: { type: 'boolean' },\n    keepOpen: { type: 'boolean' },\n    debounceTime: { type: 'integer' },\n    ignoreJids: { type: 'array', items: { type: 'string' } },\n    flowiseIdFallback: { type: 'string' },\n    splitMessages: { type: 'boolean' },\n    timePerChar: { type: 'integer' },\n  },\n  required: [\n    'expire',\n    'keywordFinish',\n    'delayMessage',\n    'unknownMessage',\n    'listeningFromMe',\n    'stopBotFromMe',\n    'keepOpen',\n    'debounceTime',\n    'ignoreJids',\n  ],\n  ...isNotEmpty(\n    'expire',\n    'keywordFinish',\n    'delayMessage',\n    'unknownMessage',\n    'listeningFromMe',\n    'stopBotFromMe',\n    'keepOpen',\n    'debounceTime',\n    'ignoreJids',\n  ),\n};\n\nexport const flowiseIgnoreJidSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    remoteJid: { type: 'string' },\n    action: { type: 'string', enum: ['add', 'remove'] },\n  },\n  required: ['remoteJid', 'action'],\n  ...isNotEmpty('remoteJid', 'action'),\n};\n","import { JSONSchema7 } from 'json-schema';\nimport { v4 } from 'uuid';\n\nconst isNotEmpty = (...propertyNames: string[]): JSONSchema7 => {\n  const properties = {};\n  propertyNames.forEach(\n    (property) =>\n      (properties[property] = {\n        minLength: 1,\n        description: `The \"${property}\" cannot be empty`,\n      }),\n  );\n  return {\n    if: {\n      propertyNames: {\n        enum: [...propertyNames],\n      },\n    },\n    then: { properties },\n  };\n};\n\nexport const n8nSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    enabled: { type: 'boolean' },\n    description: { type: 'string' },\n    webhookUrl: { type: 'string' },\n    basicAuthUser: { type: 'string' },\n    basicAuthPassword: { type: 'string' },\n    triggerType: { type: 'string', enum: ['all', 'keyword', 'none', 'advanced'] },\n    triggerOperator: { type: 'string', enum: ['equals', 'contains', 'startsWith', 'endsWith', 'regex'] },\n    triggerValue: { type: 'string' },\n    expire: { type: 'integer' },\n    keywordFinish: { type: 'string' },\n    delayMessage: { type: 'integer' },\n    unknownMessage: { type: 'string' },\n    listeningFromMe: { type: 'boolean' },\n    stopBotFromMe: { type: 'boolean' },\n    keepOpen: { type: 'boolean' },\n    debounceTime: { type: 'integer' },\n    ignoreJids: { type: 'array', items: { type: 'string' } },\n    splitMessages: { type: 'boolean' },\n    timePerChar: { type: 'integer' },\n  },\n  required: ['enabled', 'webhookUrl', 'triggerType'],\n  ...isNotEmpty('enabled', 'webhookUrl', 'triggerType'),\n};\n\nexport const n8nStatusSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    remoteJid: { type: 'string' },\n    status: { type: 'string', enum: ['opened', 'closed', 'paused', 'delete'] },\n  },\n  required: ['remoteJid', 'status'],\n  ...isNotEmpty('remoteJid', 'status'),\n};\n\nexport const n8nSettingSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    expire: { type: 'integer' },\n    keywordFinish: { type: 'string' },\n    delayMessage: { type: 'integer' },\n    unknownMessage: { type: 'string' },\n    listeningFromMe: { type: 'boolean' },\n    stopBotFromMe: { type: 'boolean' },\n    keepOpen: { type: 'boolean' },\n    debounceTime: { type: 'integer' },\n    ignoreJids: { type: 'array', items: { type: 'string' } },\n    botIdFallback: { type: 'string' },\n    splitMessages: { type: 'boolean' },\n    timePerChar: { type: 'integer' },\n  },\n  required: [\n    'expire',\n    'keywordFinish',\n    'delayMessage',\n    'unknownMessage',\n    'listeningFromMe',\n    'stopBotFromMe',\n    'keepOpen',\n    'debounceTime',\n    'ignoreJids',\n    'splitMessages',\n    'timePerChar',\n  ],\n  ...isNotEmpty(\n    'expire',\n    'keywordFinish',\n    'delayMessage',\n    'unknownMessage',\n    'listeningFromMe',\n    'stopBotFromMe',\n    'keepOpen',\n    'debounceTime',\n    'ignoreJids',\n    'splitMessages',\n    'timePerChar',\n  ),\n};\n\nexport const n8nIgnoreJidSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    remoteJid: { type: 'string' },\n    action: { type: 'string', enum: ['add', 'remove'] },\n  },\n  required: ['remoteJid', 'action'],\n  ...isNotEmpty('remoteJid', 'action'),\n};\n","import { JSONSchema7 } from 'json-schema';\nimport { v4 } from 'uuid';\n\nconst isNotEmpty = (...propertyNames: string[]): JSONSchema7 => {\n  const properties = {};\n  propertyNames.forEach(\n    (property) =>\n      (properties[property] = {\n        minLength: 1,\n        description: `The \"${property}\" cannot be empty`,\n      }),\n  );\n  return {\n    if: {\n      propertyNames: {\n        enum: [...propertyNames],\n      },\n    },\n    then: { properties },\n  };\n};\n\nexport const openaiSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    enabled: { type: 'boolean' },\n    description: { type: 'string' },\n    openaiCredsId: { type: 'string' },\n    botType: { type: 'string', enum: ['assistant', 'chatCompletion'] },\n    assistantId: { type: 'string' },\n    functionUrl: { type: 'string' },\n    model: { type: 'string' },\n    systemMessages: { type: 'array', items: { type: 'string' } },\n    assistantMessages: { type: 'array', items: { type: 'string' } },\n    userMessages: { type: 'array', items: { type: 'string' } },\n    maxTokens: { type: 'integer' },\n    triggerType: { type: 'string', enum: ['all', 'keyword', 'none', 'advanced'] },\n    triggerOperator: { type: 'string', enum: ['equals', 'contains', 'startsWith', 'endsWith', 'regex'] },\n    triggerValue: { type: 'string' },\n    expire: { type: 'integer' },\n    keywordFinish: { type: 'string' },\n    delayMessage: { type: 'integer' },\n    unknownMessage: { type: 'string' },\n    listeningFromMe: { type: 'boolean' },\n    stopBotFromMe: { type: 'boolean' },\n    keepOpen: { type: 'boolean' },\n    debounceTime: { type: 'integer' },\n    ignoreJids: { type: 'array', items: { type: 'string' } },\n  },\n  required: ['enabled', 'openaiCredsId', 'botType', 'triggerType'],\n  ...isNotEmpty('enabled', 'openaiCredsId', 'botType', 'triggerType'),\n};\n\nexport const openaiCredsSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    name: { type: 'string' },\n    apiKey: { type: 'string' },\n  },\n  required: ['name', 'apiKey'],\n  ...isNotEmpty('name', 'apiKey'),\n};\n\nexport const openaiStatusSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    remoteJid: { type: 'string' },\n    status: { type: 'string', enum: ['opened', 'closed', 'paused', 'delete'] },\n  },\n  required: ['remoteJid', 'status'],\n  ...isNotEmpty('remoteJid', 'status'),\n};\n\nexport const openaiSettingSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    openaiCredsId: { type: 'string' },\n    expire: { type: 'integer' },\n    keywordFinish: { type: 'string' },\n    delayMessage: { type: 'integer' },\n    unknownMessage: { type: 'string' },\n    listeningFromMe: { type: 'boolean' },\n    stopBotFromMe: { type: 'boolean' },\n    keepOpen: { type: 'boolean' },\n    debounceTime: { type: 'integer' },\n    speechToText: { type: 'boolean' },\n    ignoreJids: { type: 'array', items: { type: 'string' } },\n    openaiIdFallback: { type: 'string' },\n  },\n  required: [\n    'openaiCredsId',\n    'expire',\n    'keywordFinish',\n    'delayMessage',\n    'unknownMessage',\n    'listeningFromMe',\n    'stopBotFromMe',\n    'keepOpen',\n    'debounceTime',\n    'ignoreJids',\n  ],\n  ...isNotEmpty(\n    'openaiCredsId',\n    'expire',\n    'keywordFinish',\n    'delayMessage',\n    'unknownMessage',\n    'listeningFromMe',\n    'stopBotFromMe',\n    'keepOpen',\n    'debounceTime',\n    'ignoreJids',\n  ),\n};\n\nexport const openaiIgnoreJidSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    remoteJid: { type: 'string' },\n    action: { type: 'string', enum: ['add', 'remove'] },\n  },\n  required: ['remoteJid', 'action'],\n  ...isNotEmpty('remoteJid', 'action'),\n};\n","import { JSONSchema7 } from 'json-schema';\nimport { v4 } from 'uuid';\n\nconst isNotEmpty = (...propertyNames: string[]): JSONSchema7 => {\n  const properties = {};\n  propertyNames.forEach(\n    (property) =>\n      (properties[property] = {\n        minLength: 1,\n        description: `The \"${property}\" cannot be empty`,\n      }),\n  );\n  return {\n    if: {\n      propertyNames: {\n        enum: [...propertyNames],\n      },\n    },\n    then: { properties },\n  };\n};\n\nexport const typebotSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    enabled: { type: 'boolean' },\n    description: { type: 'string' },\n    url: { type: 'string' },\n    typebot: { type: 'string' },\n    triggerType: { type: 'string', enum: ['all', 'keyword', 'none', 'advanced'] },\n    triggerOperator: { type: 'string', enum: ['equals', 'contains', 'startsWith', 'endsWith', 'regex'] },\n    triggerValue: { type: 'string' },\n    expire: { type: 'integer' },\n    keywordFinish: { type: 'string' },\n    delayMessage: { type: 'integer' },\n    unknownMessage: { type: 'string' },\n    listeningFromMe: { type: 'boolean' },\n    stopBotFromMe: { type: 'boolean' },\n    ignoreJids: { type: 'array', items: { type: 'string' } },\n  },\n  required: ['enabled', 'url', 'typebot', 'triggerType'],\n  ...isNotEmpty('enabled', 'url', 'typebot', 'triggerType'),\n};\n\nexport const typebotStatusSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    remoteJid: { type: 'string' },\n    status: { type: 'string', enum: ['opened', 'closed', 'paused', 'delete'] },\n  },\n  required: ['remoteJid', 'status'],\n  ...isNotEmpty('remoteJid', 'status'),\n};\n\nexport const typebotStartSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    remoteJid: { type: 'string' },\n    url: { type: 'string' },\n    typebot: { type: 'string' },\n  },\n  required: ['remoteJid', 'url', 'typebot'],\n  ...isNotEmpty('remoteJid', 'url', 'typebot'),\n};\n\nexport const typebotSettingSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    expire: { type: 'integer' },\n    keywordFinish: { type: 'string' },\n    delayMessage: { type: 'integer' },\n    unknownMessage: { type: 'string' },\n    listeningFromMe: { type: 'boolean' },\n    stopBotFromMe: { type: 'boolean' },\n    keepOpen: { type: 'boolean' },\n    debounceTime: { type: 'integer' },\n    typebotIdFallback: { type: 'string' },\n    ignoreJids: { type: 'array', items: { type: 'string' } },\n  },\n  required: ['expire', 'keywordFinish', 'delayMessage', 'unknownMessage', 'listeningFromMe', 'stopBotFromMe'],\n  ...isNotEmpty('expire', 'keywordFinish', 'delayMessage', 'unknownMessage', 'listeningFromMe', 'stopBotFromMe'),\n};\n\nexport const typebotIgnoreJidSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    remoteJid: { type: 'string' },\n    action: { type: 'string', enum: ['add', 'remove'] },\n  },\n  required: ['remoteJid', 'action'],\n  ...isNotEmpty('remoteJid', 'action'),\n};\n","export * from '@api/integrations/chatbot/chatwoot/validate/chatwoot.schema';\nexport * from '@api/integrations/chatbot/dify/validate/dify.schema';\nexport * from '@api/integrations/chatbot/evoai/validate/evoai.schema';\nexport * from '@api/integrations/chatbot/evolutionBot/validate/evolutionBot.schema';\nexport * from '@api/integrations/chatbot/flowise/validate/flowise.schema';\nexport * from '@api/integrations/chatbot/n8n/validate/n8n.schema';\nexport * from '@api/integrations/chatbot/openai/validate/openai.schema';\nexport * from '@api/integrations/chatbot/typebot/validate/typebot.schema';\n","import { JSONSchema7 } from 'json-schema';\nimport { v4 } from 'uuid';\n\nimport { EventController } from '../event.controller';\nconst isNotEmpty = (...propertyNames: string[]): JSONSchema7 => {\n  const properties = {};\n  propertyNames.forEach(\n    (property) =>\n      (properties[property] = {\n        minLength: 1,\n        description: `The \"${property}\" cannot be empty`,\n      }),\n  );\n  return {\n    if: {\n      propertyNames: {\n        enum: [...propertyNames],\n      },\n    },\n    then: { properties },\n  };\n};\nexport const pusherSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    pusher: {\n      type: 'object',\n      properties: {\n        enabled: { type: 'boolean' },\n        appId: { type: 'string' },\n        key: { type: 'string' },\n        secret: { type: 'string' },\n        cluster: { type: 'string' },\n        useTLS: { type: 'boolean' },\n        events: {\n          type: 'array',\n          minItems: 0,\n          items: {\n            type: 'string',\n            enum: EventController.events,\n          },\n        },\n      },\n      required: ['enabled', 'appId', 'key', 'secret', 'cluster', 'useTLS'],\n      ...isNotEmpty('enabled', 'appId', 'key', 'secret', 'cluster', 'useTLS'),\n    },\n  },\n  required: ['pusher'],\n};\n","import { JSONSchema7 } from 'json-schema';\nimport { v4 } from 'uuid';\n\nimport { EventController } from '../event.controller';\n\nconst isNotEmpty = (...propertyNames: string[]): JSONSchema7 => {\n  const properties = {};\n  propertyNames.forEach(\n    (property) =>\n      (properties[property] = {\n        minLength: 1,\n        description: `The \"${property}\" cannot be empty`,\n      }),\n  );\n  return {\n    if: {\n      propertyNames: {\n        enum: [...propertyNames],\n      },\n    },\n    then: { properties },\n  };\n};\n\nexport const webhookSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    webhook: {\n      type: 'object',\n      properties: {\n        enabled: { type: 'boolean' },\n        url: { type: 'string' },\n        headers: { type: 'object' },\n        byEvents: { type: 'boolean' },\n        base64: { type: 'boolean' },\n        events: {\n          type: 'array',\n          minItems: 0,\n          items: {\n            type: 'string',\n            enum: EventController.events,\n          },\n        },\n      },\n      required: ['enabled', 'url'],\n      ...isNotEmpty('enabled', 'url'),\n    },\n  },\n  required: ['webhook'],\n};\n","import { JSONSchema7 } from 'json-schema';\nimport { v4 } from 'uuid';\n\nimport { EventController } from './event.controller';\n\nexport * from '@api/integrations/event/pusher/pusher.schema';\nexport * from '@api/integrations/event/webhook/webhook.schema';\n\nexport const eventSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    websocket: {\n      $ref: '#/$defs/event',\n    },\n    rabbitmq: {\n      $ref: '#/$defs/event',\n    },\n    nats: {\n      $ref: '#/$defs/event',\n    },\n    sqs: {\n      $ref: '#/$defs/event',\n    },\n    kafka: {\n      $ref: '#/$defs/event',\n    },\n  },\n  $defs: {\n    event: {\n      type: 'object',\n      properties: {\n        enabled: { type: 'boolean', enum: [true, false] },\n        events: {\n          type: 'array',\n          minItems: 0,\n          items: {\n            type: 'string',\n            enum: EventController.events,\n          },\n        },\n      },\n      required: ['enabled'],\n    },\n  },\n};\n","// Integrations Schema\nexport * from './business.schema';\nexport * from './chat.schema';\nexport * from './group.schema';\nexport * from './instance.schema';\nexport * from './label.schema';\nexport * from './message.schema';\nexport * from './proxy.schema';\nexport * from './settings.schema';\nexport * from './template.schema';\nexport * from './templateDelete.schema';\nexport * from './templateEdit.schema';\nexport * from '@api/integrations/chatbot/chatbot.schema';\nexport * from '@api/integrations/event/event.schema';\n","import { RouterBroker } from '@api/abstract/abstract.router';\nimport { InstanceDto } from '@api/dto/instance.dto';\nimport { ChatwootDto } from '@api/integrations/chatbot/chatwoot/dto/chatwoot.dto';\nimport { HttpStatus } from '@api/routes/index.router';\nimport { chatwootController } from '@api/server.module';\nimport { chatwootSchema, instanceSchema } from '@validate/validate.schema';\nimport { RequestHandler, Router } from 'express';\n\nexport class ChatwootRouter extends RouterBroker {\n  constructor(...guards: RequestHandler[]) {\n    super();\n    this.router\n      .post(this.routerPath('set'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<ChatwootDto>({\n          request: req,\n          schema: chatwootSchema,\n          ClassRef: ChatwootDto,\n          execute: (instance, data) => chatwootController.createChatwoot(instance, data),\n        });\n\n        res.status(HttpStatus.CREATED).json(response);\n      })\n      .get(this.routerPath('find'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => chatwootController.findChatwoot(instance),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('webhook'), async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance, data) => chatwootController.receiveWebhook(instance, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      });\n  }\n\n  public readonly router: Router = Router();\n}\n","export class Session {\n  remoteJid?: string;\n  sessionId?: string;\n  status?: string;\n  createdAt?: number;\n  updateAt?: number;\n}\n\nexport class IgnoreJidDto {\n  remoteJid?: string;\n  action?: string;\n}\n","import { TriggerOperator, TriggerType } from '@prisma/client';\n\n/**\n * Base DTO for all chatbot integrations\n * Contains common properties shared by all chatbot types\n */\nexport class BaseChatbotDto {\n  enabled?: boolean;\n  description: string;\n  expire?: number;\n  keywordFinish?: string;\n  delayMessage?: number;\n  unknownMessage?: string;\n  listeningFromMe?: boolean;\n  stopBotFromMe?: boolean;\n  keepOpen?: boolean;\n  debounceTime?: number;\n  triggerType: TriggerType;\n  triggerOperator?: TriggerOperator;\n  triggerValue?: string;\n  ignoreJids?: string[];\n  splitMessages?: boolean;\n  timePerChar?: number;\n}\n\n/**\n * Base settings DTO for all chatbot integrations\n */\nexport class BaseChatbotSettingDto {\n  expire?: number;\n  keywordFinish?: string;\n  delayMessage?: number;\n  unknownMessage?: string;\n  listeningFromMe?: boolean;\n  stopBotFromMe?: boolean;\n  keepOpen?: boolean;\n  debounceTime?: number;\n  ignoreJids?: any;\n  splitMessages?: boolean;\n  timePerChar?: number;\n  fallbackId?: string; // Unified fallback ID field for all integrations\n}\n","import { $Enums } from '@prisma/client';\n\nimport { BaseChatbotDto, BaseChatbotSettingDto } from '../../base-chatbot.dto';\n\nexport class DifyDto extends BaseChatbotDto {\n  botType?: $Enums.DifyBotType;\n  apiUrl?: string;\n  apiKey?: string;\n}\n\nexport class DifySettingDto extends BaseChatbotSettingDto {\n  difyIdFallback?: string;\n}\n","import { RouterBroker } from '@api/abstract/abstract.router';\nimport { IgnoreJidDto } from '@api/dto/chatbot.dto';\nimport { InstanceDto } from '@api/dto/instance.dto';\nimport { DifyDto, DifySettingDto } from '@api/integrations/chatbot/dify/dto/dify.dto';\nimport { HttpStatus } from '@api/routes/index.router';\nimport { difyController } from '@api/server.module';\nimport {\n  difyIgnoreJidSchema,\n  difySchema,\n  difySettingSchema,\n  difyStatusSchema,\n  instanceSchema,\n} from '@validate/validate.schema';\nimport { RequestHandler, Router } from 'express';\n\nexport class DifyRouter extends RouterBroker {\n  constructor(...guards: RequestHandler[]) {\n    super();\n    this.router\n      .post(this.routerPath('create'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<DifyDto>({\n          request: req,\n          schema: difySchema,\n          ClassRef: DifyDto,\n          execute: (instance, data) => difyController.createBot(instance, data),\n        });\n\n        res.status(HttpStatus.CREATED).json(response);\n      })\n      .get(this.routerPath('find'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => difyController.findBot(instance),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('fetch/:difyId'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => difyController.fetchBot(instance, req.params.difyId),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .put(this.routerPath('update/:difyId'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<DifyDto>({\n          request: req,\n          schema: difySchema,\n          ClassRef: DifyDto,\n          execute: (instance, data) => difyController.updateBot(instance, req.params.difyId, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .delete(this.routerPath('delete/:difyId'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => difyController.deleteBot(instance, req.params.difyId),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('settings'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<DifySettingDto>({\n          request: req,\n          schema: difySettingSchema,\n          ClassRef: DifySettingDto,\n          execute: (instance, data) => difyController.settings(instance, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('fetchSettings'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => difyController.fetchSettings(instance),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('changeStatus'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: difyStatusSchema,\n          ClassRef: InstanceDto,\n          execute: (instance, data) => difyController.changeStatus(instance, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('fetchSessions/:difyId'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => difyController.fetchSessions(instance, req.params.difyId),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('ignoreJid'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<IgnoreJidDto>({\n          request: req,\n          schema: difyIgnoreJidSchema,\n          ClassRef: IgnoreJidDto,\n          execute: (instance, data) => difyController.ignoreJid(instance, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      });\n  }\n\n  public readonly router: Router = Router();\n}\n","import { BaseChatbotDto, BaseChatbotSettingDto } from '../../base-chatbot.dto';\n\nexport class OpenaiCredsDto {\n  name: string;\n  apiKey: string;\n}\n\nexport class OpenaiDto extends BaseChatbotDto {\n  openaiCredsId: string;\n  botType: string;\n  assistantId?: string;\n  functionUrl?: string;\n  model?: string;\n  systemMessages?: string[];\n  assistantMessages?: string[];\n  userMessages?: string[];\n  maxTokens?: number;\n}\n\nexport class OpenaiSettingDto extends BaseChatbotSettingDto {\n  openaiCredsId?: string;\n  openaiIdFallback?: string;\n  speechToText?: boolean;\n}\n","import { RouterBroker } from '@api/abstract/abstract.router';\nimport { IgnoreJidDto } from '@api/dto/chatbot.dto';\nimport { InstanceDto } from '@api/dto/instance.dto';\nimport { OpenaiCredsDto, OpenaiDto, OpenaiSettingDto } from '@api/integrations/chatbot/openai/dto/openai.dto';\nimport { HttpStatus } from '@api/routes/index.router';\nimport { openaiController } from '@api/server.module';\nimport {\n  instanceSchema,\n  openaiCredsSchema,\n  openaiIgnoreJidSchema,\n  openaiSchema,\n  openaiSettingSchema,\n  openaiStatusSchema,\n} from '@validate/validate.schema';\nimport { RequestHandler, Router } from 'express';\n\nexport class OpenaiRouter extends RouterBroker {\n  constructor(...guards: RequestHandler[]) {\n    super();\n    this.router\n      .post(this.routerPath('creds'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<OpenaiCredsDto>({\n          request: req,\n          schema: openaiCredsSchema,\n          ClassRef: OpenaiCredsDto,\n          execute: (instance, data) => openaiController.createOpenaiCreds(instance, data),\n        });\n\n        res.status(HttpStatus.CREATED).json(response);\n      })\n      .get(this.routerPath('creds'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => openaiController.findOpenaiCreds(instance),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .delete(this.routerPath('creds/:openaiCredsId'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => openaiController.deleteCreds(instance, req.params.openaiCredsId),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('create'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<OpenaiDto>({\n          request: req,\n          schema: openaiSchema,\n          ClassRef: OpenaiDto,\n          execute: (instance, data) => openaiController.createBot(instance, data),\n        });\n\n        res.status(HttpStatus.CREATED).json(response);\n      })\n      .get(this.routerPath('find'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => openaiController.findBot(instance),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('fetch/:openaiBotId'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => openaiController.fetchBot(instance, req.params.openaiBotId),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .put(this.routerPath('update/:openaiBotId'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<OpenaiDto>({\n          request: req,\n          schema: openaiSchema,\n          ClassRef: OpenaiDto,\n          execute: (instance, data) => openaiController.updateBot(instance, req.params.openaiBotId, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .delete(this.routerPath('delete/:openaiBotId'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => openaiController.deleteBot(instance, req.params.openaiBotId),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('settings'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<OpenaiSettingDto>({\n          request: req,\n          schema: openaiSettingSchema,\n          ClassRef: OpenaiSettingDto,\n          execute: (instance, data) => openaiController.settings(instance, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('fetchSettings'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => openaiController.fetchSettings(instance),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('changeStatus'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: openaiStatusSchema,\n          ClassRef: InstanceDto,\n          execute: (instance, data) => openaiController.changeStatus(instance, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('fetchSessions/:openaiBotId'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => openaiController.fetchSessions(instance, req.params.openaiBotId),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('ignoreJid'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<IgnoreJidDto>({\n          request: req,\n          schema: openaiIgnoreJidSchema,\n          ClassRef: IgnoreJidDto,\n          execute: (instance, data) => openaiController.ignoreJid(instance, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('getModels'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => openaiController.getModels(instance, req.query.openaiCredsId as string),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      });\n  }\n\n  public readonly router: Router = Router();\n}\n","import { BaseChatbotDto, BaseChatbotSettingDto } from '../../base-chatbot.dto';\n\nexport class PrefilledVariables {\n  remoteJid?: string;\n  pushName?: string;\n  messageType?: string;\n  additionalData?: { [key: string]: any };\n}\n\nexport class TypebotDto extends BaseChatbotDto {\n  url: string;\n  typebot: string;\n}\n\nexport class TypebotSettingDto extends BaseChatbotSettingDto {\n  typebotIdFallback?: string;\n}\n","import { RouterBroker } from '@api/abstract/abstract.router';\nimport { IgnoreJidDto } from '@api/dto/chatbot.dto';\nimport { InstanceDto } from '@api/dto/instance.dto';\nimport { TypebotDto, TypebotSettingDto } from '@api/integrations/chatbot/typebot/dto/typebot.dto';\nimport { HttpStatus } from '@api/routes/index.router';\nimport { typebotController } from '@api/server.module';\nimport {\n  instanceSchema,\n  typebotIgnoreJidSchema,\n  typebotSchema,\n  typebotSettingSchema,\n  typebotStartSchema,\n  typebotStatusSchema,\n} from '@validate/validate.schema';\nimport { RequestHandler, Router } from 'express';\n\nexport class TypebotRouter extends RouterBroker {\n  constructor(...guards: RequestHandler[]) {\n    super();\n    this.router\n      .post(this.routerPath('create'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<TypebotDto>({\n          request: req,\n          schema: typebotSchema,\n          ClassRef: TypebotDto,\n          execute: (instance, data) => typebotController.createBot(instance, data),\n        });\n\n        res.status(HttpStatus.CREATED).json(response);\n      })\n      .get(this.routerPath('find'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => typebotController.findBot(instance),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('fetch/:typebotId'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => typebotController.fetchBot(instance, req.params.typebotId),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .put(this.routerPath('update/:typebotId'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<TypebotDto>({\n          request: req,\n          schema: typebotSchema,\n          ClassRef: TypebotDto,\n          execute: (instance, data) => typebotController.updateBot(instance, req.params.typebotId, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .delete(this.routerPath('delete/:typebotId'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => typebotController.deleteBot(instance, req.params.typebotId),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('settings'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<TypebotSettingDto>({\n          request: req,\n          schema: typebotSettingSchema,\n          ClassRef: TypebotSettingDto,\n          execute: (instance, data) => typebotController.settings(instance, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('fetchSettings'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => typebotController.fetchSettings(instance),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('start'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: typebotStartSchema,\n          ClassRef: InstanceDto,\n          execute: (instance, data) => typebotController.startBot(instance, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('changeStatus'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: typebotStatusSchema,\n          ClassRef: InstanceDto,\n          execute: (instance, data) => typebotController.changeStatus(instance, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('fetchSessions/:typebotId'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => typebotController.fetchSessions(instance, req.params.typebotId),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('ignoreJid'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<IgnoreJidDto>({\n          request: req,\n          schema: typebotIgnoreJidSchema,\n          ClassRef: IgnoreJidDto,\n          execute: (instance, data) => typebotController.ignoreJid(instance, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      });\n  }\n\n  public readonly router: Router = Router();\n}\n","import { BaseChatbotDto, BaseChatbotSettingDto } from '../../base-chatbot.dto';\n\nexport class EvoaiDto extends BaseChatbotDto {\n  agentUrl?: string;\n  apiKey?: string;\n}\n\nexport class EvoaiSettingDto extends BaseChatbotSettingDto {\n  evoaiIdFallback?: string;\n}\n","import { RouterBroker } from '@api/abstract/abstract.router';\nimport { IgnoreJidDto } from '@api/dto/chatbot.dto';\nimport { InstanceDto } from '@api/dto/instance.dto';\nimport { HttpStatus } from '@api/routes/index.router';\nimport { evoaiController } from '@api/server.module';\nimport {\n  evoaiIgnoreJidSchema,\n  evoaiSchema,\n  evoaiSettingSchema,\n  evoaiStatusSchema,\n  instanceSchema,\n} from '@validate/validate.schema';\nimport { RequestHandler, Router } from 'express';\n\nimport { EvoaiDto, EvoaiSettingDto } from '../dto/evoai.dto';\n\nexport class EvoaiRouter extends RouterBroker {\n  constructor(...guards: RequestHandler[]) {\n    super();\n    this.router\n      .post(this.routerPath('create'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<EvoaiDto>({\n          request: req,\n          schema: evoaiSchema,\n          ClassRef: EvoaiDto,\n          execute: (instance, data) => evoaiController.createBot(instance, data),\n        });\n\n        res.status(HttpStatus.CREATED).json(response);\n      })\n      .get(this.routerPath('find'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => evoaiController.findBot(instance),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('fetch/:evoaiId'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => evoaiController.fetchBot(instance, req.params.evoaiId),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .put(this.routerPath('update/:evoaiId'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<EvoaiDto>({\n          request: req,\n          schema: evoaiSchema,\n          ClassRef: EvoaiDto,\n          execute: (instance, data) => evoaiController.updateBot(instance, req.params.evoaiId, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .delete(this.routerPath('delete/:evoaiId'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => evoaiController.deleteBot(instance, req.params.evoaiId),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('settings'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<EvoaiSettingDto>({\n          request: req,\n          schema: evoaiSettingSchema,\n          ClassRef: EvoaiSettingDto,\n          execute: (instance, data) => evoaiController.settings(instance, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('fetchSettings'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => evoaiController.fetchSettings(instance),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('changeStatus'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: evoaiStatusSchema,\n          ClassRef: InstanceDto,\n          execute: (instance, data) => evoaiController.changeStatus(instance, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('fetchSessions/:evoaiId'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => evoaiController.fetchSessions(instance, req.params.evoaiId),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('ignoreJid'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<IgnoreJidDto>({\n          request: req,\n          schema: evoaiIgnoreJidSchema,\n          ClassRef: IgnoreJidDto,\n          execute: (instance, data) => evoaiController.ignoreJid(instance, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      });\n  }\n\n  public readonly router: Router = Router();\n}\n","import { BaseChatbotDto, BaseChatbotSettingDto } from '../../base-chatbot.dto';\n\nexport class EvolutionBotDto extends BaseChatbotDto {\n  apiUrl: string;\n  apiKey: string;\n}\n\nexport class EvolutionBotSettingDto extends BaseChatbotSettingDto {\n  botIdFallback?: string;\n}\n","import { RouterBroker } from '@api/abstract/abstract.router';\nimport { IgnoreJidDto } from '@api/dto/chatbot.dto';\nimport { InstanceDto } from '@api/dto/instance.dto';\nimport { HttpStatus } from '@api/routes/index.router';\nimport { evolutionBotController } from '@api/server.module';\nimport { instanceSchema } from '@validate/instance.schema';\nimport { RequestHandler, Router } from 'express';\n\nimport { EvolutionBotDto, EvolutionBotSettingDto } from '../dto/evolutionBot.dto';\nimport {\n  evolutionBotIgnoreJidSchema,\n  evolutionBotSchema,\n  evolutionBotSettingSchema,\n  evolutionBotStatusSchema,\n} from '../validate/evolutionBot.schema';\n\nexport class EvolutionBotRouter extends RouterBroker {\n  constructor(...guards: RequestHandler[]) {\n    super();\n    this.router\n      .post(this.routerPath('create'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<EvolutionBotDto>({\n          request: req,\n          schema: evolutionBotSchema,\n          ClassRef: EvolutionBotDto,\n          execute: (instance, data) => evolutionBotController.createBot(instance, data),\n        });\n\n        res.status(HttpStatus.CREATED).json(response);\n      })\n      .get(this.routerPath('find'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => evolutionBotController.findBot(instance),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('fetch/:evolutionBotId'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => evolutionBotController.fetchBot(instance, req.params.evolutionBotId),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .put(this.routerPath('update/:evolutionBotId'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<EvolutionBotDto>({\n          request: req,\n          schema: evolutionBotSchema,\n          ClassRef: EvolutionBotDto,\n          execute: (instance, data) => evolutionBotController.updateBot(instance, req.params.evolutionBotId, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .delete(this.routerPath('delete/:evolutionBotId'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => evolutionBotController.deleteBot(instance, req.params.evolutionBotId),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('settings'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<EvolutionBotSettingDto>({\n          request: req,\n          schema: evolutionBotSettingSchema,\n          ClassRef: EvolutionBotSettingDto,\n          execute: (instance, data) => evolutionBotController.settings(instance, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('fetchSettings'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => evolutionBotController.fetchSettings(instance),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('changeStatus'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: evolutionBotStatusSchema,\n          ClassRef: InstanceDto,\n          execute: (instance, data) => evolutionBotController.changeStatus(instance, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('fetchSessions/:evolutionBotId'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => evolutionBotController.fetchSessions(instance, req.params.evolutionBotId),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('ignoreJid'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<IgnoreJidDto>({\n          request: req,\n          schema: evolutionBotIgnoreJidSchema,\n          ClassRef: IgnoreJidDto,\n          execute: (instance, data) => evolutionBotController.ignoreJid(instance, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      });\n  }\n\n  public readonly router: Router = Router();\n}\n","import { BaseChatbotDto, BaseChatbotSettingDto } from '../../base-chatbot.dto';\n\nexport class FlowiseDto extends BaseChatbotDto {\n  apiUrl: string;\n  apiKey?: string;\n}\n\nexport class FlowiseSettingDto extends BaseChatbotSettingDto {\n  flowiseIdFallback?: string;\n}\n","import { RouterBroker } from '@api/abstract/abstract.router';\nimport { IgnoreJidDto } from '@api/dto/chatbot.dto';\nimport { InstanceDto } from '@api/dto/instance.dto';\nimport { HttpStatus } from '@api/routes/index.router';\nimport { flowiseController } from '@api/server.module';\nimport { instanceSchema } from '@validate/instance.schema';\nimport { RequestHandler, Router } from 'express';\n\nimport { FlowiseDto, FlowiseSettingDto } from '../dto/flowise.dto';\nimport {\n  flowiseIgnoreJidSchema,\n  flowiseSchema,\n  flowiseSettingSchema,\n  flowiseStatusSchema,\n} from '../validate/flowise.schema';\n\nexport class FlowiseRouter extends RouterBroker {\n  constructor(...guards: RequestHandler[]) {\n    super();\n    this.router\n      .post(this.routerPath('create'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<FlowiseDto>({\n          request: req,\n          schema: flowiseSchema,\n          ClassRef: FlowiseDto,\n          execute: (instance, data) => flowiseController.createBot(instance, data),\n        });\n\n        res.status(HttpStatus.CREATED).json(response);\n      })\n      .get(this.routerPath('find'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => flowiseController.findBot(instance),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('fetch/:flowiseId'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => flowiseController.fetchBot(instance, req.params.flowiseId),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .put(this.routerPath('update/:flowiseId'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<FlowiseDto>({\n          request: req,\n          schema: flowiseSchema,\n          ClassRef: FlowiseDto,\n          execute: (instance, data) => flowiseController.updateBot(instance, req.params.flowiseId, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .delete(this.routerPath('delete/:flowiseId'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => flowiseController.deleteBot(instance, req.params.flowiseId),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('settings'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<FlowiseSettingDto>({\n          request: req,\n          schema: flowiseSettingSchema,\n          ClassRef: FlowiseSettingDto,\n          execute: (instance, data) => flowiseController.settings(instance, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('fetchSettings'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => flowiseController.fetchSettings(instance),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('changeStatus'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: flowiseStatusSchema,\n          ClassRef: InstanceDto,\n          execute: (instance, data) => flowiseController.changeStatus(instance, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('fetchSessions/:flowiseId'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => flowiseController.fetchSessions(instance, req.params.flowiseId),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('ignoreJid'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<IgnoreJidDto>({\n          request: req,\n          schema: flowiseIgnoreJidSchema,\n          ClassRef: IgnoreJidDto,\n          execute: (instance, data) => flowiseController.ignoreJid(instance, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      });\n  }\n\n  public readonly router: Router = Router();\n}\n","import { BaseChatbotDto, BaseChatbotSettingDto } from '../../base-chatbot.dto';\n\nexport class N8nDto extends BaseChatbotDto {\n  // N8n specific fields\n  webhookUrl?: string;\n  basicAuthUser?: string;\n  basicAuthPass?: string;\n}\n\nexport class N8nSettingDto extends BaseChatbotSettingDto {\n  // N8n has no specific fields\n}\n\nexport class N8nMessageDto {\n  chatInput: string;\n  sessionId: string;\n}\n","import { RouterBroker } from '@api/abstract/abstract.router';\nimport { IgnoreJidDto } from '@api/dto/chatbot.dto';\nimport { InstanceDto } from '@api/dto/instance.dto';\nimport { HttpStatus } from '@api/routes/index.router';\nimport { n8nController } from '@api/server.module';\nimport {\n  instanceSchema,\n  n8nIgnoreJidSchema,\n  n8nSchema,\n  n8nSettingSchema,\n  n8nStatusSchema,\n} from '@validate/validate.schema';\nimport { RequestHandler, Router } from 'express';\n\nimport { N8nDto, N8nSettingDto } from '../dto/n8n.dto';\n\nexport class N8nRouter extends RouterBroker {\n  constructor(...guards: RequestHandler[]) {\n    super();\n    this.router\n      .post(this.routerPath('create'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<N8nDto>({\n          request: req,\n          schema: n8nSchema,\n          ClassRef: N8nDto,\n          execute: (instance, data) => n8nController.createBot(instance, data),\n        });\n        res.status(HttpStatus.CREATED).json(response);\n      })\n      .get(this.routerPath('find'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => n8nController.findBot(instance),\n        });\n        res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('fetch/:n8nId'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => n8nController.fetchBot(instance, req.params.n8nId),\n        });\n        res.status(HttpStatus.OK).json(response);\n      })\n      .put(this.routerPath('update/:n8nId'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<N8nDto>({\n          request: req,\n          schema: n8nSchema,\n          ClassRef: N8nDto,\n          execute: (instance, data) => n8nController.updateBot(instance, req.params.n8nId, data),\n        });\n        res.status(HttpStatus.OK).json(response);\n      })\n      .delete(this.routerPath('delete/:n8nId'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => n8nController.deleteBot(instance, req.params.n8nId),\n        });\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('settings'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<N8nSettingDto>({\n          request: req,\n          schema: n8nSettingSchema,\n          ClassRef: N8nSettingDto,\n          execute: (instance, data) => n8nController.settings(instance, data),\n        });\n        res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('fetchSettings'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => n8nController.fetchSettings(instance),\n        });\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('changeStatus'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: n8nStatusSchema,\n          ClassRef: InstanceDto,\n          execute: (instance, data) => n8nController.changeStatus(instance, data),\n        });\n        res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('fetchSessions/:n8nId'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => n8nController.fetchSessions(instance, req.params.n8nId),\n        });\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('ignoreJid'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<IgnoreJidDto>({\n          request: req,\n          schema: n8nIgnoreJidSchema,\n          ClassRef: IgnoreJidDto,\n          execute: (instance, data) => n8nController.ignoreJid(instance, data),\n        });\n        res.status(HttpStatus.OK).json(response);\n      });\n  }\n\n  public readonly router: Router = Router();\n}\n","import { ChatwootRouter } from '@api/integrations/chatbot/chatwoot/routes/chatwoot.router';\nimport { DifyRouter } from '@api/integrations/chatbot/dify/routes/dify.router';\nimport { OpenaiRouter } from '@api/integrations/chatbot/openai/routes/openai.router';\nimport { TypebotRouter } from '@api/integrations/chatbot/typebot/routes/typebot.router';\nimport { Router } from 'express';\n\nimport { EvoaiRouter } from './evoai/routes/evoai.router';\nimport { EvolutionBotRouter } from './evolutionBot/routes/evolutionBot.router';\nimport { FlowiseRouter } from './flowise/routes/flowise.router';\nimport { N8nRouter } from './n8n/routes/n8n.router';\n\nexport class ChatbotRouter {\n  public readonly router: Router;\n\n  constructor(...guards: any[]) {\n    this.router = Router();\n\n    this.router.use('/evolutionBot', new EvolutionBotRouter(...guards).router);\n    this.router.use('/chatwoot', new ChatwootRouter(...guards).router);\n    this.router.use('/typebot', new TypebotRouter(...guards).router);\n    this.router.use('/openai', new OpenaiRouter(...guards).router);\n    this.router.use('/dify', new DifyRouter(...guards).router);\n    this.router.use('/flowise', new FlowiseRouter(...guards).router);\n    this.router.use('/n8n', new N8nRouter(...guards).router);\n    this.router.use('/evoai', new EvoaiRouter(...guards).router);\n  }\n}\n","import { RouterBroker } from '@api/abstract/abstract.router';\nimport { InstanceDto } from '@api/dto/instance.dto';\nimport { EventDto } from '@api/integrations/event/event.dto';\nimport { HttpStatus } from '@api/routes/index.router';\nimport { eventManager } from '@api/server.module';\nimport { eventSchema, instanceSchema } from '@validate/validate.schema';\nimport { RequestHandler, Router } from 'express';\n\nexport class KafkaRouter extends RouterBroker {\n  constructor(...guards: RequestHandler[]) {\n    super();\n    this.router\n      .post(this.routerPath('set'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<EventDto>({\n          request: req,\n          schema: eventSchema,\n          ClassRef: EventDto,\n          execute: (instance, data) => eventManager.kafka.set(instance.instanceName, data),\n        });\n\n        res.status(HttpStatus.CREATED).json(response);\n      })\n      .get(this.routerPath('find'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => eventManager.kafka.get(instance.instanceName),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      });\n  }\n\n  public readonly router: Router = Router();\n}\n","import { RouterBroker } from '@api/abstract/abstract.router';\nimport { InstanceDto } from '@api/dto/instance.dto';\nimport { EventDto } from '@api/integrations/event/event.dto';\nimport { HttpStatus } from '@api/routes/index.router';\nimport { eventManager } from '@api/server.module';\nimport { eventSchema, instanceSchema } from '@validate/validate.schema';\nimport { RequestHandler, Router } from 'express';\n\nexport class NatsRouter extends RouterBroker {\n  constructor(...guards: RequestHandler[]) {\n    super();\n    this.router\n      .post(this.routerPath('set'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<EventDto>({\n          request: req,\n          schema: eventSchema,\n          ClassRef: EventDto,\n          execute: (instance, data) => eventManager.nats.set(instance.instanceName, data),\n        });\n\n        res.status(HttpStatus.CREATED).json(response);\n      })\n      .get(this.routerPath('find'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => eventManager.nats.get(instance.instanceName),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      });\n  }\n\n  public readonly router: Router = Router();\n}\n","import { RouterBroker } from '@api/abstract/abstract.router';\nimport { InstanceDto } from '@api/dto/instance.dto';\nimport { EventDto } from '@api/integrations/event/event.dto';\nimport { HttpStatus } from '@api/routes/index.router';\nimport { eventManager } from '@api/server.module';\nimport { instanceSchema, pusherSchema } from '@validate/validate.schema';\nimport { RequestHandler, Router } from 'express';\nexport class PusherRouter extends RouterBroker {\n  constructor(...guards: RequestHandler[]) {\n    super();\n    this.router\n      .post(this.routerPath('set'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<EventDto>({\n          request: req,\n          schema: pusherSchema,\n          ClassRef: EventDto,\n          execute: (instance, data) => eventManager.pusher.set(instance.instanceName, data),\n        });\n        res.status(HttpStatus.CREATED).json(response);\n      })\n      .get(this.routerPath('find'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => eventManager.pusher.get(instance.instanceName),\n        });\n        res.status(HttpStatus.OK).json(response);\n      });\n  }\n  public readonly router: Router = Router();\n}\n","import { RouterBroker } from '@api/abstract/abstract.router';\nimport { InstanceDto } from '@api/dto/instance.dto';\nimport { EventDto } from '@api/integrations/event/event.dto';\nimport { HttpStatus } from '@api/routes/index.router';\nimport { eventManager } from '@api/server.module';\nimport { eventSchema, instanceSchema } from '@validate/validate.schema';\nimport { RequestHandler, Router } from 'express';\n\nexport class RabbitmqRouter extends RouterBroker {\n  constructor(...guards: RequestHandler[]) {\n    super();\n    this.router\n      .post(this.routerPath('set'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<EventDto>({\n          request: req,\n          schema: eventSchema,\n          ClassRef: EventDto,\n          execute: (instance, data) => eventManager.rabbitmq.set(instance.instanceName, data),\n        });\n\n        res.status(HttpStatus.CREATED).json(response);\n      })\n      .get(this.routerPath('find'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => eventManager.rabbitmq.get(instance.instanceName),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      });\n  }\n\n  public readonly router: Router = Router();\n}\n","import { RouterBroker } from '@api/abstract/abstract.router';\nimport { InstanceDto } from '@api/dto/instance.dto';\nimport { EventDto } from '@api/integrations/event/event.dto';\nimport { HttpStatus } from '@api/routes/index.router';\nimport { eventManager } from '@api/server.module';\nimport { eventSchema, instanceSchema } from '@validate/validate.schema';\nimport { RequestHandler, Router } from 'express';\n\nexport class SqsRouter extends RouterBroker {\n  constructor(...guards: RequestHandler[]) {\n    super();\n    this.router\n      .post(this.routerPath('set'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<EventDto>({\n          request: req,\n          schema: eventSchema,\n          ClassRef: EventDto,\n          execute: (instance, data) => eventManager.sqs.set(instance.instanceName, data),\n        });\n\n        res.status(HttpStatus.CREATED).json(response);\n      })\n      .get(this.routerPath('find'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => eventManager.sqs.get(instance.instanceName),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      });\n  }\n\n  public readonly router: Router = Router();\n}\n","import { RouterBroker } from '@api/abstract/abstract.router';\nimport { InstanceDto } from '@api/dto/instance.dto';\nimport { EventDto } from '@api/integrations/event/event.dto';\nimport { HttpStatus } from '@api/routes/index.router';\nimport { eventManager } from '@api/server.module';\nimport { ConfigService } from '@config/env.config';\nimport { instanceSchema, webhookSchema } from '@validate/validate.schema';\nimport { RequestHandler, Router } from 'express';\n\nexport class WebhookRouter extends RouterBroker {\n  constructor(\n    readonly configService: ConfigService,\n    ...guards: RequestHandler[]\n  ) {\n    super();\n    this.router\n      .post(this.routerPath('set'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<EventDto>({\n          request: req,\n          schema: webhookSchema,\n          ClassRef: EventDto,\n          execute: (instance, data) => eventManager.webhook.set(instance.instanceName, data),\n        });\n\n        res.status(HttpStatus.CREATED).json(response);\n      })\n      .get(this.routerPath('find'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => eventManager.webhook.get(instance.instanceName),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      });\n  }\n\n  public readonly router: Router = Router();\n}\n","import { RouterBroker } from '@api/abstract/abstract.router';\nimport { InstanceDto } from '@api/dto/instance.dto';\nimport { EventDto } from '@api/integrations/event/event.dto';\nimport { HttpStatus } from '@api/routes/index.router';\nimport { eventManager } from '@api/server.module';\nimport { eventSchema, instanceSchema } from '@validate/validate.schema';\nimport { RequestHandler, Router } from 'express';\n\nexport class WebsocketRouter extends RouterBroker {\n  constructor(...guards: RequestHandler[]) {\n    super();\n    this.router\n      .post(this.routerPath('set'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<EventDto>({\n          request: req,\n          schema: eventSchema,\n          ClassRef: EventDto,\n          execute: (instance, data) => eventManager.websocket.set(instance.instanceName, data),\n        });\n\n        res.status(HttpStatus.CREATED).json(response);\n      })\n      .get(this.routerPath('find'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => eventManager.websocket.get(instance.instanceName),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      });\n  }\n\n  public readonly router: Router = Router();\n}\n","import { KafkaRouter } from '@api/integrations/event/kafka/kafka.router';\nimport { NatsRouter } from '@api/integrations/event/nats/nats.router';\nimport { PusherRouter } from '@api/integrations/event/pusher/pusher.router';\nimport { RabbitmqRouter } from '@api/integrations/event/rabbitmq/rabbitmq.router';\nimport { SqsRouter } from '@api/integrations/event/sqs/sqs.router';\nimport { WebhookRouter } from '@api/integrations/event/webhook/webhook.router';\nimport { WebsocketRouter } from '@api/integrations/event/websocket/websocket.router';\nimport { Router } from 'express';\n\nexport class EventRouter {\n  public readonly router: Router;\n\n  constructor(configService: any, ...guards: any[]) {\n    this.router = Router();\n\n    this.router.use('/webhook', new WebhookRouter(configService, ...guards).router);\n    this.router.use('/websocket', new WebsocketRouter(...guards).router);\n    this.router.use('/rabbitmq', new RabbitmqRouter(...guards).router);\n    this.router.use('/nats', new NatsRouter(...guards).router);\n    this.router.use('/pusher', new PusherRouter(...guards).router);\n    this.router.use('/sqs', new SqsRouter(...guards).router);\n    this.router.use('/kafka', new KafkaRouter(...guards).router);\n  }\n}\n","export class MediaDto {\n  id?: string;\n  type?: string;\n  messageId?: number;\n  expiry?: number;\n}\n","import { JSONSchema7 } from 'json-schema';\nimport { v4 } from 'uuid';\n\nconst isNotEmpty = (...propertyNames: string[]): JSONSchema7 => {\n  const properties = {};\n  propertyNames.forEach(\n    (property) =>\n      (properties[property] = {\n        minLength: 1,\n        description: `The \"${property}\" cannot be empty`,\n      }),\n  );\n  return {\n    if: {\n      propertyNames: {\n        enum: [...propertyNames],\n      },\n    },\n    then: { properties },\n  };\n};\n\nexport const s3Schema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    id: { type: 'string' },\n    type: { type: 'string' },\n    messageId: { type: 'integer' },\n  },\n  ...isNotEmpty('id', 'type', 'messageId'),\n};\n\nexport const s3UrlSchema: JSONSchema7 = {\n  $id: v4(),\n  type: 'object',\n  properties: {\n    id: { type: 'string', pattern: '\\\\d+', minLength: 1 },\n    expiry: { type: 'string', pattern: '\\\\d+', minLength: 1 },\n  },\n  ...isNotEmpty('id'),\n  required: ['id'],\n};\n","import { RouterBroker } from '@api/abstract/abstract.router';\nimport { MediaDto } from '@api/integrations/storage/s3/dto/media.dto';\nimport { s3Schema, s3UrlSchema } from '@api/integrations/storage/s3/validate/s3.schema';\nimport { HttpStatus } from '@api/routes/index.router';\nimport { s3Controller } from '@api/server.module';\nimport { RequestHandler, Router } from 'express';\n\nexport class S3Router extends RouterBroker {\n  constructor(...guards: RequestHandler[]) {\n    super();\n    this.router\n      .post(this.routerPath('getMedia'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<MediaDto>({\n          request: req,\n          schema: s3Schema,\n          ClassRef: MediaDto,\n          execute: (instance, data) => s3Controller.getMedia(instance, data),\n        });\n\n        res.status(HttpStatus.CREATED).json(response);\n      })\n      .post(this.routerPath('getMediaUrl'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<MediaDto>({\n          request: req,\n          schema: s3UrlSchema,\n          ClassRef: MediaDto,\n          execute: (instance, data) => s3Controller.getMediaUrl(instance, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      });\n  }\n\n  public readonly router: Router = Router();\n}\n","import { S3Router } from '@api/integrations/storage/s3/routes/s3.router';\nimport { Router } from 'express';\n\nexport class StorageRouter {\n  public readonly router: Router;\n\n  constructor(...guards: any[]) {\n    this.router = Router();\n\n    this.router.use('/s3', new S3Router(...guards).router);\n  }\n}\n","import { HttpStatus } from '@api/routes/index.router';\n\nexport interface MetaErrorResponse {\n  status: number;\n  error: string;\n  message: string;\n  details: {\n    whatsapp_error: string;\n    whatsapp_code: string | number;\n    error_user_title: string;\n    error_user_msg: string;\n    error_type: string;\n    error_subcode: number | null;\n    fbtrace_id: string | null;\n    context: string;\n    type: string;\n  };\n  timestamp: string;\n}\n\n/**\n * Creates standardized error response for Meta/WhatsApp API errors\n */\nexport function createMetaErrorResponse(error: any, context: string): MetaErrorResponse {\n  // Extract Meta/WhatsApp specific error fields\n  const metaError = error.template || error;\n  const errorUserTitle = metaError.error_user_title || metaError.message || 'Unknown error';\n  const errorUserMsg = metaError.error_user_msg || metaError.message || 'Unknown error';\n\n  return {\n    status: HttpStatus.BAD_REQUEST,\n    error: 'Bad Request',\n    message: errorUserTitle,\n    details: {\n      whatsapp_error: errorUserMsg,\n      whatsapp_code: metaError.code || 'UNKNOWN_ERROR',\n      error_user_title: errorUserTitle,\n      error_user_msg: errorUserMsg,\n      error_type: metaError.type || 'UNKNOWN',\n      error_subcode: metaError.error_subcode || null,\n      fbtrace_id: metaError.fbtrace_id || null,\n      context,\n      type: 'whatsapp_api_error',\n    },\n    timestamp: new Date().toISOString(),\n  };\n}\n","import { RouterBroker } from '@api/abstract/abstract.router';\nimport { NumberDto } from '@api/dto/chat.dto';\nimport { businessController } from '@api/server.module';\nimport { createMetaErrorResponse } from '@utils/errorResponse';\nimport { catalogSchema, collectionsSchema } from '@validate/validate.schema';\nimport { RequestHandler, Router } from 'express';\n\nimport { HttpStatus } from './index.router';\n\nexport class BusinessRouter extends RouterBroker {\n  constructor(...guards: RequestHandler[]) {\n    super();\n    this.router\n      .post(this.routerPath('getCatalog'), ...guards, async (req, res) => {\n        try {\n          const response = await this.dataValidate<NumberDto>({\n            request: req,\n            schema: catalogSchema,\n            ClassRef: NumberDto,\n            execute: (instance, data) => businessController.fetchCatalog(instance, data),\n          });\n\n          return res.status(HttpStatus.OK).json(response);\n        } catch (error) {\n          // Log error for debugging\n          console.error('Business catalog error:', error);\n\n          // Use utility function to create standardized error response\n          const errorResponse = createMetaErrorResponse(error, 'business_catalog');\n          return res.status(errorResponse.status).json(errorResponse);\n        }\n      })\n\n      .post(this.routerPath('getCollections'), ...guards, async (req, res) => {\n        try {\n          const response = await this.dataValidate<NumberDto>({\n            request: req,\n            schema: collectionsSchema,\n            ClassRef: NumberDto,\n            execute: (instance, data) => businessController.fetchCollections(instance, data),\n          });\n\n          return res.status(HttpStatus.OK).json(response);\n        } catch (error) {\n          // Log error for debugging\n          console.error('Business collections error:', error);\n\n          // Use utility function to create standardized error response\n          const errorResponse = createMetaErrorResponse(error, 'business_collections');\n          return res.status(errorResponse.status).json(errorResponse);\n        }\n      });\n  }\n\n  public readonly router: Router = Router();\n}\n","export class Metadata {\n  number: string;\n}\n\nexport class OfferCallDto extends Metadata {\n  isVideo?: boolean;\n  callDuration?: number;\n}\n","import { RouterBroker } from '@api/abstract/abstract.router';\nimport { OfferCallDto } from '@api/dto/call.dto';\nimport { callController } from '@api/server.module';\nimport { offerCallSchema } from '@validate/validate.schema';\nimport { RequestHandler, Router } from 'express';\n\nimport { HttpStatus } from './index.router';\n\nexport class CallRouter extends RouterBroker {\n  constructor(...guards: RequestHandler[]) {\n    super();\n    this.router.post(this.routerPath('offer'), ...guards, async (req, res) => {\n      const response = await this.dataValidate<OfferCallDto>({\n        request: req,\n        schema: offerCallSchema,\n        ClassRef: OfferCallDto,\n        execute: (instance, data) => callController.offerCall(instance, data),\n      });\n\n      return res.status(HttpStatus.CREATED).json(response);\n    });\n  }\n\n  public readonly router: Router = Router();\n}\n","import { RouterBroker } from '@api/abstract/abstract.router';\nimport {\n  ArchiveChatDto,\n  BlockUserDto,\n  DeleteMessage,\n  getBase64FromMediaMessageDto,\n  MarkChatUnreadDto,\n  NumberDto,\n  PrivacySettingDto,\n  ProfileNameDto,\n  ProfilePictureDto,\n  ProfileStatusDto,\n  ReadMessageDto,\n  SendPresenceDto,\n  UpdateMessageDto,\n  WhatsAppNumberDto,\n} from '@api/dto/chat.dto';\nimport { InstanceDto } from '@api/dto/instance.dto';\nimport { Query } from '@api/repository/repository.service';\nimport { chatController } from '@api/server.module';\nimport { Contact, Message, MessageUpdate } from '@prisma/client';\nimport {\n  archiveChatSchema,\n  blockUserSchema,\n  contactValidateSchema,\n  deleteMessageSchema,\n  markChatUnreadSchema,\n  messageUpSchema,\n  messageValidateSchema,\n  presenceSchema,\n  privacySettingsSchema,\n  profileNameSchema,\n  profilePictureSchema,\n  profileSchema,\n  profileStatusSchema,\n  readMessageSchema,\n  updateMessageSchema,\n  whatsappNumberSchema,\n} from '@validate/validate.schema';\nimport { RequestHandler, Router } from 'express';\n\nimport { HttpStatus } from './index.router';\n\nexport class ChatRouter extends RouterBroker {\n  constructor(...guards: RequestHandler[]) {\n    super();\n    this.router\n      .post(this.routerPath('whatsappNumbers'), ...guards, async (req, res) => {\n        try {\n          const response = await this.dataValidate<WhatsAppNumberDto>({\n            request: req,\n            schema: whatsappNumberSchema,\n            ClassRef: WhatsAppNumberDto,\n            execute: (instance, data) => chatController.whatsappNumber(instance, data),\n          });\n\n          return res.status(HttpStatus.OK).json(response);\n        } catch (error) {\n          console.log(error);\n          return res.status(HttpStatus.BAD_REQUEST).json(error);\n        }\n      })\n      .post(this.routerPath('markMessageAsRead'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<ReadMessageDto>({\n          request: req,\n          schema: readMessageSchema,\n          ClassRef: ReadMessageDto,\n          execute: (instance, data) => chatController.readMessage(instance, data),\n        });\n\n        return res.status(HttpStatus.CREATED).json(response);\n      })\n      .post(this.routerPath('archiveChat'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<ArchiveChatDto>({\n          request: req,\n          schema: archiveChatSchema,\n          ClassRef: ArchiveChatDto,\n          execute: (instance, data) => chatController.archiveChat(instance, data),\n        });\n\n        return res.status(HttpStatus.CREATED).json(response);\n      })\n      .post(this.routerPath('markChatUnread'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<MarkChatUnreadDto>({\n          request: req,\n          schema: markChatUnreadSchema,\n          ClassRef: MarkChatUnreadDto,\n          execute: (instance, data) => chatController.markChatUnread(instance, data),\n        });\n\n        return res.status(HttpStatus.CREATED).json(response);\n      })\n      .delete(this.routerPath('deleteMessageForEveryone'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<DeleteMessage>({\n          request: req,\n          schema: deleteMessageSchema,\n          ClassRef: DeleteMessage,\n          execute: (instance, data) => chatController.deleteMessage(instance, data),\n        });\n\n        return res.status(HttpStatus.CREATED).json(response);\n      })\n      .post(this.routerPath('fetchProfilePictureUrl'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<NumberDto>({\n          request: req,\n          schema: profilePictureSchema,\n          ClassRef: NumberDto,\n          execute: (instance, data) => chatController.fetchProfilePicture(instance, data),\n        });\n\n        return res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('getBase64FromMediaMessage'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<getBase64FromMediaMessageDto>({\n          request: req,\n          schema: null,\n          ClassRef: getBase64FromMediaMessageDto,\n          execute: (instance, data) => chatController.getBase64FromMediaMessage(instance, data),\n        });\n\n        return res.status(HttpStatus.CREATED).json(response);\n      })\n      // TODO: corrigir updateMessage para medias tambem\n      .post(this.routerPath('updateMessage'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<UpdateMessageDto>({\n          request: req,\n          schema: updateMessageSchema,\n          ClassRef: UpdateMessageDto,\n          execute: (instance, data) => chatController.updateMessage(instance, data),\n        });\n\n        return res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('sendPresence'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<null>({\n          request: req,\n          schema: presenceSchema,\n          ClassRef: SendPresenceDto,\n          execute: (instance, data) => chatController.sendPresence(instance, data),\n        });\n\n        return res.status(HttpStatus.CREATED).json(response);\n      })\n      .post(this.routerPath('updateBlockStatus'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<BlockUserDto>({\n          request: req,\n          schema: blockUserSchema,\n          ClassRef: BlockUserDto,\n          execute: (instance, data) => chatController.blockUser(instance, data),\n        });\n\n        return res.status(HttpStatus.CREATED).json(response);\n      })\n      .post(this.routerPath('findContacts'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<Query<Contact>>({\n          request: req,\n          schema: contactValidateSchema,\n          ClassRef: Query<Contact>,\n          execute: (instance, data) => chatController.fetchContacts(instance, data),\n        });\n\n        return res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('findMessages'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<Query<Message>>({\n          request: req,\n          schema: messageValidateSchema,\n          ClassRef: Query<Message>,\n          execute: (instance, data) => chatController.fetchMessages(instance, data),\n        });\n\n        return res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('findStatusMessage'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<Query<MessageUpdate>>({\n          request: req,\n          schema: messageUpSchema,\n          ClassRef: Query<MessageUpdate>,\n          execute: (instance, data) => chatController.fetchStatusMessage(instance, data),\n        });\n\n        return res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('findChats'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<Query<Contact>>({\n          request: req,\n          schema: contactValidateSchema,\n          ClassRef: Query<Contact>,\n          execute: (instance, data) => chatController.fetchChats(instance, data),\n        });\n\n        return res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('findChatByRemoteJid'), ...guards, async (req, res) => {\n        const instance = req.params as unknown as InstanceDto;\n        const { remoteJid } = req.query as unknown as { remoteJid: string };\n        if (!remoteJid) {\n          return res.status(HttpStatus.BAD_REQUEST).json({ error: 'remoteJid is a required query parameter' });\n        }\n        const response = await chatController.findChatByRemoteJid(instance, remoteJid);\n\n        return res.status(HttpStatus.OK).json(response);\n      })\n      // Profile routes\n      .post(this.routerPath('fetchBusinessProfile'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<ProfilePictureDto>({\n          request: req,\n          schema: profilePictureSchema,\n          ClassRef: ProfilePictureDto,\n          execute: (instance, data) => chatController.fetchBusinessProfile(instance, data),\n        });\n\n        return res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('fetchProfile'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<NumberDto>({\n          request: req,\n          schema: profileSchema,\n          ClassRef: NumberDto,\n          execute: (instance, data) => chatController.fetchProfile(instance, data),\n        });\n\n        return res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('updateProfileName'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<ProfileNameDto>({\n          request: req,\n          schema: profileNameSchema,\n          ClassRef: ProfileNameDto,\n          execute: (instance, data) => chatController.updateProfileName(instance, data),\n        });\n\n        return res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('updateProfileStatus'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<ProfileStatusDto>({\n          request: req,\n          schema: profileStatusSchema,\n          ClassRef: ProfileStatusDto,\n          execute: (instance, data) => chatController.updateProfileStatus(instance, data),\n        });\n\n        return res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('updateProfilePicture'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<ProfilePictureDto>({\n          request: req,\n          schema: profilePictureSchema,\n          ClassRef: ProfilePictureDto,\n          execute: (instance, data) => chatController.updateProfilePicture(instance, data),\n        });\n\n        return res.status(HttpStatus.OK).json(response);\n      })\n      .delete(this.routerPath('removeProfilePicture'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<ProfilePictureDto>({\n          request: req,\n          schema: profilePictureSchema,\n          ClassRef: ProfilePictureDto,\n          execute: (instance) => chatController.removeProfilePicture(instance),\n        });\n\n        return res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('fetchPrivacySettings'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: null,\n          ClassRef: InstanceDto,\n          execute: (instance) => chatController.fetchPrivacySettings(instance),\n        });\n\n        return res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('updatePrivacySettings'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<PrivacySettingDto>({\n          request: req,\n          schema: privacySettingsSchema,\n          ClassRef: PrivacySettingDto,\n          execute: (instance, data) => chatController.updatePrivacySettings(instance, data),\n        });\n\n        return res.status(HttpStatus.CREATED).json(response);\n      });\n  }\n\n  public readonly router: Router = Router();\n}\n","export class CreateGroupDto {\n  subject: string;\n  participants: string[];\n  description?: string;\n  promoteParticipants?: boolean;\n}\n\nexport class GroupPictureDto {\n  groupJid: string;\n  image: string;\n}\n\nexport class GroupSubjectDto {\n  groupJid: string;\n  subject: string;\n}\n\nexport class GroupDescriptionDto {\n  groupJid: string;\n  description: string;\n}\n\nexport class GroupJid {\n  groupJid: string;\n}\n\nexport class GetParticipant {\n  getParticipants: string;\n}\n\nexport class GroupInvite {\n  inviteCode: string;\n}\n\nexport class AcceptGroupInvite {\n  inviteCode: string;\n}\n\nexport class GroupSendInvite {\n  groupJid: string;\n  description: string;\n  numbers: string[];\n}\n\nexport class GroupUpdateParticipantDto extends GroupJid {\n  action: 'add' | 'remove' | 'promote' | 'demote';\n  participants: string[];\n}\n\nexport class GroupUpdateSettingDto extends GroupJid {\n  action: 'announcement' | 'not_announcement' | 'unlocked' | 'locked';\n}\n\nexport class GroupToggleEphemeralDto extends GroupJid {\n  expiration: 0 | 86400 | 604800 | 7776000;\n}\n","import { RouterBroker } from '@api/abstract/abstract.router';\nimport {\n  AcceptGroupInvite,\n  CreateGroupDto,\n  GetParticipant,\n  GroupDescriptionDto,\n  GroupInvite,\n  GroupJid,\n  GroupPictureDto,\n  GroupSendInvite,\n  GroupSubjectDto,\n  GroupToggleEphemeralDto,\n  GroupUpdateParticipantDto,\n  GroupUpdateSettingDto,\n} from '@api/dto/group.dto';\nimport { groupController } from '@api/server.module';\nimport {\n  AcceptGroupInviteSchema,\n  createGroupSchema,\n  getParticipantsSchema,\n  groupInviteSchema,\n  groupJidSchema,\n  groupSendInviteSchema,\n  toggleEphemeralSchema,\n  updateGroupDescriptionSchema,\n  updateGroupPictureSchema,\n  updateGroupSubjectSchema,\n  updateParticipantsSchema,\n  updateSettingsSchema,\n} from '@validate/validate.schema';\nimport { RequestHandler, Router } from 'express';\n\nimport { HttpStatus } from './index.router';\n\nexport class GroupRouter extends RouterBroker {\n  constructor(...guards: RequestHandler[]) {\n    super();\n    this.router\n      .post(this.routerPath('create'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<CreateGroupDto>({\n          request: req,\n          schema: createGroupSchema,\n          ClassRef: CreateGroupDto,\n          execute: (instance, data) => groupController.createGroup(instance, data),\n        });\n\n        res.status(HttpStatus.CREATED).json(response);\n      })\n      .post(this.routerPath('updateGroupSubject'), ...guards, async (req, res) => {\n        const response = await this.groupValidate<GroupSubjectDto>({\n          request: req,\n          schema: updateGroupSubjectSchema,\n          ClassRef: GroupSubjectDto,\n          execute: (instance, data) => groupController.updateGroupSubject(instance, data),\n        });\n\n        res.status(HttpStatus.CREATED).json(response);\n      })\n      .post(this.routerPath('updateGroupPicture'), ...guards, async (req, res) => {\n        const response = await this.groupValidate<GroupPictureDto>({\n          request: req,\n          schema: updateGroupPictureSchema,\n          ClassRef: GroupPictureDto,\n          execute: (instance, data) => groupController.updateGroupPicture(instance, data),\n        });\n\n        res.status(HttpStatus.CREATED).json(response);\n      })\n      .post(this.routerPath('updateGroupDescription'), ...guards, async (req, res) => {\n        const response = await this.groupValidate<GroupDescriptionDto>({\n          request: req,\n          schema: updateGroupDescriptionSchema,\n          ClassRef: GroupDescriptionDto,\n          execute: (instance, data) => groupController.updateGroupDescription(instance, data),\n        });\n\n        res.status(HttpStatus.CREATED).json(response);\n      })\n      .get(this.routerPath('findGroupInfos'), ...guards, async (req, res) => {\n        const response = await this.groupValidate<GroupJid>({\n          request: req,\n          schema: groupJidSchema,\n          ClassRef: GroupJid,\n          execute: (instance, data) => groupController.findGroupInfo(instance, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('fetchAllGroups'), ...guards, async (req, res) => {\n        const response = await this.getParticipantsValidate<GetParticipant>({\n          request: req,\n          schema: getParticipantsSchema,\n          ClassRef: GetParticipant,\n          execute: (instance, data) => groupController.fetchAllGroups(instance, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('participants'), ...guards, async (req, res) => {\n        const response = await this.groupValidate<GroupJid>({\n          request: req,\n          schema: groupJidSchema,\n          ClassRef: GroupJid,\n          execute: (instance, data) => groupController.findParticipants(instance, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('inviteCode'), ...guards, async (req, res) => {\n        const response = await this.groupValidate<GroupJid>({\n          request: req,\n          schema: groupJidSchema,\n          ClassRef: GroupJid,\n          execute: (instance, data) => groupController.inviteCode(instance, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('inviteInfo'), ...guards, async (req, res) => {\n        const response = await this.inviteCodeValidate<GroupInvite>({\n          request: req,\n          schema: groupInviteSchema,\n          ClassRef: GroupInvite,\n          execute: (instance, data) => groupController.inviteInfo(instance, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('acceptInviteCode'), ...guards, async (req, res) => {\n        const response = await this.inviteCodeValidate<AcceptGroupInvite>({\n          request: req,\n          schema: AcceptGroupInviteSchema,\n          ClassRef: AcceptGroupInvite,\n          execute: (instance, data) => groupController.acceptInviteCode(instance, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('sendInvite'), ...guards, async (req, res) => {\n        const response = await this.groupNoValidate<GroupSendInvite>({\n          request: req,\n          schema: groupSendInviteSchema,\n          ClassRef: GroupSendInvite,\n          execute: (instance, data) => groupController.sendInvite(instance, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('revokeInviteCode'), ...guards, async (req, res) => {\n        const response = await this.groupValidate<GroupJid>({\n          request: req,\n          schema: groupJidSchema,\n          ClassRef: GroupJid,\n          execute: (instance, data) => groupController.revokeInviteCode(instance, data),\n        });\n\n        res.status(HttpStatus.CREATED).json(response);\n      })\n      .post(this.routerPath('updateParticipant'), ...guards, async (req, res) => {\n        const response = await this.groupValidate<GroupUpdateParticipantDto>({\n          request: req,\n          schema: updateParticipantsSchema,\n          ClassRef: GroupUpdateParticipantDto,\n          execute: (instance, data) => groupController.updateGParticipate(instance, data),\n        });\n\n        res.status(HttpStatus.CREATED).json(response);\n      })\n      .post(this.routerPath('updateSetting'), ...guards, async (req, res) => {\n        const response = await this.groupValidate<GroupUpdateSettingDto>({\n          request: req,\n          schema: updateSettingsSchema,\n          ClassRef: GroupUpdateSettingDto,\n          execute: (instance, data) => groupController.updateGSetting(instance, data),\n        });\n\n        res.status(HttpStatus.CREATED).json(response);\n      })\n      .post(this.routerPath('toggleEphemeral'), ...guards, async (req, res) => {\n        const response = await this.groupValidate<GroupToggleEphemeralDto>({\n          request: req,\n          schema: toggleEphemeralSchema,\n          ClassRef: GroupToggleEphemeralDto,\n          execute: (instance, data) => groupController.toggleEphemeral(instance, data),\n        });\n\n        res.status(HttpStatus.CREATED).json(response);\n      })\n      .delete(this.routerPath('leaveGroup'), ...guards, async (req, res) => {\n        const response = await this.groupValidate<GroupJid>({\n          request: req,\n          schema: {},\n          ClassRef: GroupJid,\n          execute: (instance, data) => groupController.leaveGroup(instance, data),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      });\n  }\n\n  public readonly router: Router = Router();\n}\n","import { RouterBroker } from '@api/abstract/abstract.router';\nimport { InstanceDto, SetPresenceDto } from '@api/dto/instance.dto';\nimport { instanceController } from '@api/server.module';\nimport { ConfigService } from '@config/env.config';\nimport { instanceSchema, presenceOnlySchema } from '@validate/validate.schema';\nimport { RequestHandler, Router } from 'express';\n\nimport { HttpStatus } from './index.router';\n\nexport class InstanceRouter extends RouterBroker {\n  constructor(\n    readonly configService: ConfigService,\n    ...guards: RequestHandler[]\n  ) {\n    super();\n    this.router\n      .post('/create', ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => instanceController.createInstance(instance),\n        });\n\n        return res.status(HttpStatus.CREATED).json(response);\n      })\n      .post(this.routerPath('restart'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: null,\n          ClassRef: InstanceDto,\n          execute: (instance) => instanceController.restartInstance(instance),\n        });\n\n        return res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('connect'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: null,\n          ClassRef: InstanceDto,\n          execute: (instance) => instanceController.connectToWhatsapp(instance),\n        });\n\n        return res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('connectionState'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: null,\n          ClassRef: InstanceDto,\n          execute: (instance) => instanceController.connectionState(instance),\n        });\n\n        return res.status(HttpStatus.OK).json(response);\n      })\n      .get(this.routerPath('fetchInstances', false), ...guards, async (req, res) => {\n        const key = req.get('apikey');\n\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: null,\n          ClassRef: InstanceDto,\n          execute: (instance) => instanceController.fetchInstances(instance, key),\n        });\n\n        return res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('setPresence'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<null>({\n          request: req,\n          schema: presenceOnlySchema,\n          ClassRef: SetPresenceDto,\n          execute: (instance, data) => instanceController.setPresence(instance, data),\n        });\n\n        return res.status(HttpStatus.CREATED).json(response);\n      })\n      .delete(this.routerPath('logout'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: null,\n          ClassRef: InstanceDto,\n          execute: (instance) => instanceController.logout(instance),\n        });\n\n        return res.status(HttpStatus.OK).json(response);\n      })\n      .delete(this.routerPath('delete'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: null,\n          ClassRef: InstanceDto,\n          execute: (instance) => instanceController.deleteInstance(instance),\n        });\n\n        return res.status(HttpStatus.OK).json(response);\n      });\n  }\n\n  public readonly router: Router = Router();\n}\n","export class LabelDto {\n  id?: string;\n  name: string;\n  color: string;\n  predefinedId?: string;\n}\n\nexport class HandleLabelDto {\n  number: string;\n  labelId: string;\n  action: 'add' | 'remove';\n}\n","import { RouterBroker } from '@api/abstract/abstract.router';\nimport { HandleLabelDto, LabelDto } from '@api/dto/label.dto';\nimport { labelController } from '@api/server.module';\nimport { handleLabelSchema } from '@validate/validate.schema';\nimport { RequestHandler, Router } from 'express';\n\nimport { HttpStatus } from './index.router';\n\nexport class LabelRouter extends RouterBroker {\n  constructor(...guards: RequestHandler[]) {\n    super();\n    this.router\n      .get(this.routerPath('findLabels'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<LabelDto>({\n          request: req,\n          schema: null,\n          ClassRef: LabelDto,\n          execute: (instance) => labelController.fetchLabels(instance),\n        });\n\n        return res.status(HttpStatus.OK).json(response);\n      })\n      .post(this.routerPath('handleLabel'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<HandleLabelDto>({\n          request: req,\n          schema: handleLabelSchema,\n          ClassRef: HandleLabelDto,\n          execute: (instance, data) => labelController.handleLabel(instance, data),\n        });\n\n        return res.status(HttpStatus.OK).json(response);\n      });\n  }\n\n  public readonly router: Router = Router();\n}\n","export class ProxyDto {\n  enabled?: boolean;\n  host: string;\n  port: string;\n  protocol: string;\n  username?: string;\n  password?: string;\n}\n","import { RouterBroker } from '@api/abstract/abstract.router';\nimport { InstanceDto } from '@api/dto/instance.dto';\nimport { ProxyDto } from '@api/dto/proxy.dto';\nimport { proxyController } from '@api/server.module';\nimport { instanceSchema, proxySchema } from '@validate/validate.schema';\nimport { RequestHandler, Router } from 'express';\n\nimport { HttpStatus } from './index.router';\n\nexport class ProxyRouter extends RouterBroker {\n  constructor(...guards: RequestHandler[]) {\n    super();\n    this.router\n      .post(this.routerPath('set'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<ProxyDto>({\n          request: req,\n          schema: proxySchema,\n          ClassRef: ProxyDto,\n          execute: (instance, data) => proxyController.createProxy(instance, data),\n        });\n\n        res.status(HttpStatus.CREATED).json(response);\n      })\n      .get(this.routerPath('find'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: instanceSchema,\n          ClassRef: InstanceDto,\n          execute: (instance) => proxyController.findProxy(instance),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      });\n  }\n\n  public readonly router: Router = Router();\n}\n","import { proto, WAPresence } from 'baileys';\n\nexport class Quoted {\n  key: proto.IMessageKey;\n  message: proto.IMessage;\n}\n\nexport class Options {\n  delay?: number;\n  presence?: WAPresence;\n  quoted?: Quoted;\n  linkPreview?: boolean;\n  encoding?: boolean;\n  mentionsEveryOne?: boolean;\n  mentioned?: string[];\n  webhookUrl?: string;\n}\n\nexport class MediaMessage {\n  mediatype: MediaType;\n  mimetype?: string;\n  caption?: string;\n  // for document\n  fileName?: string;\n  // url or base64\n  media: string;\n}\n\nexport class StatusMessage {\n  type: string;\n  content: string;\n  statusJidList?: string[];\n  allContacts?: boolean;\n  caption?: string;\n  backgroundColor?: string;\n  font?: number;\n}\n\nexport class Metadata {\n  number: string;\n  delay?: number;\n  quoted?: Quoted;\n  linkPreview?: boolean;\n  mentionsEveryOne?: boolean;\n  mentioned?: string[];\n  encoding?: boolean;\n  notConvertSticker?: boolean;\n}\n\nexport class SendTextDto extends Metadata {\n  text: string;\n}\nexport class SendPresence extends Metadata {\n  text: string;\n}\n\nexport class SendStatusDto extends Metadata {\n  type: string;\n  content: string;\n  statusJidList?: string[];\n  allContacts?: boolean;\n  caption?: string;\n  backgroundColor?: string;\n  font?: number;\n}\n\nexport class SendPollDto extends Metadata {\n  name: string;\n  selectableCount: number;\n  values: string[];\n  messageSecret?: Uint8Array;\n}\n\nexport type MediaType = 'image' | 'document' | 'video' | 'audio' | 'ptv';\n\nexport class SendMediaDto extends Metadata {\n  mediatype: MediaType;\n  mimetype?: string;\n  caption?: string;\n  // for document\n  fileName?: string;\n  // url or base64\n  media: string;\n}\n\nexport class SendPtvDto extends Metadata {\n  video: string;\n}\n\nexport class SendStickerDto extends Metadata {\n  sticker: string;\n}\n\nexport class SendAudioDto extends Metadata {\n  audio: string;\n}\n\nexport type TypeButton = 'reply' | 'copy' | 'url' | 'call' | 'pix';\n\nexport type KeyType = 'phone' | 'email' | 'cpf' | 'cnpj' | 'random';\n\nexport class Button {\n  type: TypeButton;\n  displayText?: string;\n  id?: string;\n  url?: string;\n  copyCode?: string;\n  phoneNumber?: string;\n  currency?: string;\n  name?: string;\n  keyType?: KeyType;\n  key?: string;\n}\n\nexport class SendButtonsDto extends Metadata {\n  thumbnailUrl?: string;\n  title: string;\n  description?: string;\n  footer?: string;\n  buttons: Button[];\n}\n\nexport class SendLocationDto extends Metadata {\n  latitude: number;\n  longitude: number;\n  name?: string;\n  address?: string;\n}\n\nclass Row {\n  title: string;\n  description: string;\n  rowId: string;\n}\nclass Section {\n  title: string;\n  rows: Row[];\n}\nexport class SendListDto extends Metadata {\n  title: string;\n  description?: string;\n  footerText?: string;\n  buttonText: string;\n  sections: Section[];\n}\n\nexport class ContactMessage {\n  fullName: string;\n  wuid: string;\n  phoneNumber: string;\n  organization?: string;\n  email?: string;\n  url?: string;\n}\n\nexport class SendTemplateDto extends Metadata {\n  name: string;\n  language: string;\n  components: any;\n  webhookUrl?: string;\n}\nexport class SendContactDto extends Metadata {\n  contact: ContactMessage[];\n}\n\nexport class SendReactionDto {\n  key: proto.IMessageKey;\n  reaction: string;\n}\n","import { RouterBroker } from '@api/abstract/abstract.router';\nimport {\n  SendAudioDto,\n  SendButtonsDto,\n  SendContactDto,\n  SendListDto,\n  SendLocationDto,\n  SendMediaDto,\n  SendPollDto,\n  SendPtvDto,\n  SendReactionDto,\n  SendStatusDto,\n  SendStickerDto,\n  SendTemplateDto,\n  SendTextDto,\n} from '@api/dto/sendMessage.dto';\nimport { sendMessageController } from '@api/server.module';\nimport {\n  audioMessageSchema,\n  buttonsMessageSchema,\n  contactMessageSchema,\n  listMessageSchema,\n  locationMessageSchema,\n  mediaMessageSchema,\n  pollMessageSchema,\n  ptvMessageSchema,\n  reactionMessageSchema,\n  statusMessageSchema,\n  stickerMessageSchema,\n  templateMessageSchema,\n  textMessageSchema,\n} from '@validate/validate.schema';\nimport { RequestHandler, Router } from 'express';\nimport multer from 'multer';\n\nimport { HttpStatus } from './index.router';\n\nconst upload = multer({ storage: multer.memoryStorage() });\n\nexport class MessageRouter extends RouterBroker {\n  constructor(...guards: RequestHandler[]) {\n    super();\n    this.router\n      .post(this.routerPath('sendTemplate'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<SendTemplateDto>({\n          request: req,\n          schema: templateMessageSchema,\n          ClassRef: SendTemplateDto,\n          execute: (instance, data) => sendMessageController.sendTemplate(instance, data),\n        });\n\n        return res.status(HttpStatus.CREATED).json(response);\n      })\n      .post(this.routerPath('sendText'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<SendTextDto>({\n          request: req,\n          schema: textMessageSchema,\n          ClassRef: SendTextDto,\n          execute: (instance, data) => sendMessageController.sendText(instance, data),\n        });\n\n        return res.status(HttpStatus.CREATED).json(response);\n      })\n      .post(this.routerPath('sendMedia'), ...guards, upload.single('file'), async (req, res) => {\n        const bodyData = req.body;\n\n        const response = await this.dataValidate<SendMediaDto>({\n          request: req,\n          schema: mediaMessageSchema,\n          ClassRef: SendMediaDto,\n          execute: (instance) => sendMessageController.sendMedia(instance, bodyData, req.file as any),\n        });\n\n        return res.status(HttpStatus.CREATED).json(response);\n      })\n      .post(this.routerPath('sendPtv'), ...guards, upload.single('file'), async (req, res) => {\n        const bodyData = req.body;\n\n        const response = await this.dataValidate<SendPtvDto>({\n          request: req,\n          schema: ptvMessageSchema,\n          ClassRef: SendPtvDto,\n          execute: (instance) => sendMessageController.sendPtv(instance, bodyData, req.file as any),\n        });\n\n        return res.status(HttpStatus.CREATED).json(response);\n      })\n      .post(this.routerPath('sendWhatsAppAudio'), ...guards, upload.single('file'), async (req, res) => {\n        const bodyData = req.body;\n\n        const response = await this.dataValidate<SendAudioDto>({\n          request: req,\n          schema: audioMessageSchema,\n          ClassRef: SendMediaDto,\n          execute: (instance) => sendMessageController.sendWhatsAppAudio(instance, bodyData, req.file as any),\n        });\n\n        return res.status(HttpStatus.CREATED).json(response);\n      })\n      // TODO: Revisar funcionamento do envio de Status\n      .post(this.routerPath('sendStatus'), ...guards, upload.single('file'), async (req, res) => {\n        const bodyData = req.body;\n\n        const response = await this.dataValidate<SendStatusDto>({\n          request: req,\n          schema: statusMessageSchema,\n          ClassRef: SendStatusDto,\n          execute: (instance) => sendMessageController.sendStatus(instance, bodyData, req.file as any),\n        });\n\n        return res.status(HttpStatus.CREATED).json(response);\n      })\n      .post(this.routerPath('sendSticker'), ...guards, upload.single('file'), async (req, res) => {\n        const bodyData = req.body;\n\n        const response = await this.dataValidate<SendStickerDto>({\n          request: req,\n          schema: stickerMessageSchema,\n          ClassRef: SendStickerDto,\n          execute: (instance) => sendMessageController.sendSticker(instance, bodyData, req.file as any),\n        });\n\n        return res.status(HttpStatus.CREATED).json(response);\n      })\n      .post(this.routerPath('sendLocation'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<SendLocationDto>({\n          request: req,\n          schema: locationMessageSchema,\n          ClassRef: SendLocationDto,\n          execute: (instance, data) => sendMessageController.sendLocation(instance, data),\n        });\n\n        return res.status(HttpStatus.CREATED).json(response);\n      })\n      .post(this.routerPath('sendContact'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<SendContactDto>({\n          request: req,\n          schema: contactMessageSchema,\n          ClassRef: SendContactDto,\n          execute: (instance, data) => sendMessageController.sendContact(instance, data),\n        });\n\n        return res.status(HttpStatus.CREATED).json(response);\n      })\n      .post(this.routerPath('sendReaction'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<SendReactionDto>({\n          request: req,\n          schema: reactionMessageSchema,\n          ClassRef: SendReactionDto,\n          execute: (instance, data) => sendMessageController.sendReaction(instance, data),\n        });\n\n        return res.status(HttpStatus.CREATED).json(response);\n      })\n      .post(this.routerPath('sendPoll'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<SendPollDto>({\n          request: req,\n          schema: pollMessageSchema,\n          ClassRef: SendPollDto,\n          execute: (instance, data) => sendMessageController.sendPoll(instance, data),\n        });\n\n        return res.status(HttpStatus.CREATED).json(response);\n      })\n      .post(this.routerPath('sendList'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<SendListDto>({\n          request: req,\n          schema: listMessageSchema,\n          ClassRef: SendListDto,\n          execute: (instance, data) => sendMessageController.sendList(instance, data),\n        });\n\n        return res.status(HttpStatus.CREATED).json(response);\n      })\n      .post(this.routerPath('sendButtons'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<SendButtonsDto>({\n          request: req,\n          schema: buttonsMessageSchema,\n          ClassRef: SendButtonsDto,\n          execute: (instance, data) => sendMessageController.sendButtons(instance, data),\n        });\n\n        return res.status(HttpStatus.CREATED).json(response);\n      });\n  }\n\n  public readonly router: Router = Router();\n}\n","export class SettingsDto {\n  rejectCall?: boolean;\n  msgCall?: string;\n  groupsIgnore?: boolean;\n  alwaysOnline?: boolean;\n  readMessages?: boolean;\n  readStatus?: boolean;\n  syncFullHistory?: boolean;\n  wavoipToken?: string;\n}\n","import { RouterBroker } from '@api/abstract/abstract.router';\nimport { InstanceDto } from '@api/dto/instance.dto';\nimport { SettingsDto } from '@api/dto/settings.dto';\nimport { settingsController } from '@api/server.module';\nimport { settingsSchema } from '@validate/validate.schema';\nimport { RequestHandler, Router } from 'express';\n\nimport { HttpStatus } from './index.router';\n\nexport class SettingsRouter extends RouterBroker {\n  constructor(...guards: RequestHandler[]) {\n    super();\n    this.router\n      .post(this.routerPath('set'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<SettingsDto>({\n          request: req,\n          schema: settingsSchema,\n          ClassRef: SettingsDto,\n          execute: (instance, data) => settingsController.createSettings(instance, data),\n        });\n\n        res.status(HttpStatus.CREATED).json(response);\n      })\n      .get(this.routerPath('find'), ...guards, async (req, res) => {\n        const response = await this.dataValidate<InstanceDto>({\n          request: req,\n          schema: null,\n          ClassRef: InstanceDto,\n          execute: (instance) => settingsController.findSettings(instance),\n        });\n\n        res.status(HttpStatus.OK).json(response);\n      });\n  }\n\n  public readonly router: Router = Router();\n}\n","export class TemplateDto {\n  name: string;\n  category: string;\n  allowCategoryChange: boolean;\n  language: string;\n  components: any;\n  webhookUrl?: string;\n}\n\nexport class TemplateEditDto {\n  templateId: string;\n  category?: 'AUTHENTICATION' | 'MARKETING' | 'UTILITY';\n  allowCategoryChange?: boolean;\n  ttl?: number;\n  components?: any;\n}\n\nexport class TemplateDeleteDto {\n  name: string;\n  hsmId?: string;\n}\n","import { RouterBroker } from '@api/abstract/abstract.router';\nimport { InstanceDto } from '@api/dto/instance.dto';\nimport { TemplateDeleteDto, TemplateDto, TemplateEditDto } from '@api/dto/template.dto';\nimport { templateController } from '@api/server.module';\nimport { ConfigService } from '@config/env.config';\nimport { createMetaErrorResponse } from '@utils/errorResponse';\nimport { templateDeleteSchema } from '@validate/templateDelete.schema';\nimport { templateEditSchema } from '@validate/templateEdit.schema';\nimport { instanceSchema, templateSchema } from '@validate/validate.schema';\nimport { RequestHandler, Router } from 'express';\n\nimport { HttpStatus } from './index.router';\n\nexport class TemplateRouter extends RouterBroker {\n  constructor(\n    readonly configService: ConfigService,\n    ...guards: RequestHandler[]\n  ) {\n    super();\n    this.router\n      .post(this.routerPath('create'), ...guards, async (req, res) => {\n        try {\n          const response = await this.dataValidate<TemplateDto>({\n            request: req,\n            schema: templateSchema,\n            ClassRef: TemplateDto,\n            execute: (instance, data) => templateController.createTemplate(instance, data),\n          });\n\n          res.status(HttpStatus.CREATED).json(response);\n        } catch (error) {\n          // Log error for debugging\n          console.error('Template creation error:', error);\n\n          // Use utility function to create standardized error response\n          const errorResponse = createMetaErrorResponse(error, 'template_creation');\n          res.status(errorResponse.status).json(errorResponse);\n        }\n      })\n      .post(this.routerPath('edit'), ...guards, async (req, res) => {\n        try {\n          const response = await this.dataValidate<TemplateEditDto>({\n            request: req,\n            schema: templateEditSchema,\n            ClassRef: TemplateEditDto,\n            execute: (instance, data) => templateController.editTemplate(instance, data),\n          });\n\n          res.status(HttpStatus.OK).json(response);\n        } catch (error) {\n          console.error('Template edit error:', error);\n          const errorResponse = createMetaErrorResponse(error, 'template_edit');\n          res.status(errorResponse.status).json(errorResponse);\n        }\n      })\n      .delete(this.routerPath('delete'), ...guards, async (req, res) => {\n        try {\n          const response = await this.dataValidate<TemplateDeleteDto>({\n            request: req,\n            schema: templateDeleteSchema,\n            ClassRef: TemplateDeleteDto,\n            execute: (instance, data) => templateController.deleteTemplate(instance, data),\n          });\n\n          res.status(HttpStatus.OK).json(response);\n        } catch (error) {\n          console.error('Template delete error:', error);\n          const errorResponse = createMetaErrorResponse(error, 'template_delete');\n          res.status(errorResponse.status).json(errorResponse);\n        }\n      })\n      .get(this.routerPath('find'), ...guards, async (req, res) => {\n        try {\n          const response = await this.dataValidate<InstanceDto>({\n            request: req,\n            schema: instanceSchema,\n            ClassRef: InstanceDto,\n            execute: (instance) => templateController.findTemplate(instance),\n          });\n\n          res.status(HttpStatus.OK).json(response);\n        } catch (error) {\n          // Log error for debugging\n          console.error('Template find error:', error);\n\n          // Use utility function to create standardized error response\n          const errorResponse = createMetaErrorResponse(error, 'template_find');\n          res.status(errorResponse.status).json(errorResponse);\n        }\n      });\n  }\n\n  public readonly router: Router = Router();\n}\n","import { RouterBroker } from '@api/abstract/abstract.router';\nimport express, { Router } from 'express';\nimport path from 'path';\n\nexport class ViewsRouter extends RouterBroker {\n  public readonly router: Router;\n\n  constructor() {\n    super();\n    this.router = Router();\n\n    const basePath = path.join(process.cwd(), 'manager', 'dist');\n    const indexPath = path.join(basePath, 'index.html');\n\n    this.router.use(express.static(basePath));\n\n    this.router.get('*', (req, res) => {\n      res.sendFile(indexPath);\n    });\n  }\n}\n","import { authGuard } from '@api/guards/auth.guard';\nimport { instanceExistsGuard, instanceLoggedGuard } from '@api/guards/instance.guard';\nimport Telemetry from '@api/guards/telemetry.guard';\nimport { ChannelRouter } from '@api/integrations/channel/channel.router';\nimport { ChatbotRouter } from '@api/integrations/chatbot/chatbot.router';\nimport { EventRouter } from '@api/integrations/event/event.router';\nimport { StorageRouter } from '@api/integrations/storage/storage.router';\nimport { waMonitor } from '@api/server.module';\nimport { configService, Database, Facebook } from '@config/env.config';\nimport { fetchLatestWaWebVersion } from '@utils/fetchLatestWaWebVersion';\nimport { NextFunction, Request, Response, Router } from 'express';\nimport fs from 'fs';\nimport mimeTypes from 'mime-types';\nimport path from 'path';\n\nimport { BusinessRouter } from './business.router';\nimport { CallRouter } from './call.router';\nimport { ChatRouter } from './chat.router';\nimport { GroupRouter } from './group.router';\nimport { InstanceRouter } from './instance.router';\nimport { LabelRouter } from './label.router';\nimport { ProxyRouter } from './proxy.router';\nimport { MessageRouter } from './sendMessage.router';\nimport { SettingsRouter } from './settings.router';\nimport { TemplateRouter } from './template.router';\nimport { ViewsRouter } from './view.router';\n\nenum HttpStatus {\n  OK = 200,\n  CREATED = 201,\n  NOT_FOUND = 404,\n  FORBIDDEN = 403,\n  BAD_REQUEST = 400,\n  UNAUTHORIZED = 401,\n  INTERNAL_SERVER_ERROR = 500,\n}\n\nconst router: Router = Router();\nconst serverConfig = configService.get('SERVER');\nconst databaseConfig = configService.get<Database>('DATABASE');\nconst guards = [instanceExistsGuard, instanceLoggedGuard, authGuard['apikey']];\n\nconst telemetry = new Telemetry();\n\nconst packageJson = JSON.parse(fs.readFileSync('./package.json', 'utf8'));\n\n// Middleware for metrics IP whitelist\nconst metricsIPWhitelist = (req: Request, res: Response, next: NextFunction) => {\n  const metricsConfig = configService.get('METRICS');\n  const allowedIPs = metricsConfig.ALLOWED_IPS?.split(',').map((ip) => ip.trim()) || ['127.0.0.1'];\n  const clientIPs = [\n    req.ip,\n    req.connection.remoteAddress,\n    req.socket.remoteAddress,\n    req.headers['x-forwarded-for'],\n  ].filter((ip) => ip !== undefined);\n\n  if (allowedIPs.filter((ip) => clientIPs.includes(ip)) === 0) {\n    return res.status(403).send('Forbidden: IP not allowed');\n  }\n\n  next();\n};\n\n// Middleware for metrics Basic Authentication\nconst metricsBasicAuth = (req: Request, res: Response, next: NextFunction) => {\n  const metricsConfig = configService.get('METRICS');\n  const metricsUser = metricsConfig.USER;\n  const metricsPass = metricsConfig.PASSWORD;\n\n  if (!metricsUser || !metricsPass) {\n    return res.status(500).send('Metrics authentication not configured');\n  }\n\n  const auth = req.get('Authorization');\n  if (!auth || !auth.startsWith('Basic ')) {\n    res.set('WWW-Authenticate', 'Basic realm=\"Evolution API Metrics\"');\n    return res.status(401).send('Authentication required');\n  }\n\n  const credentials = Buffer.from(auth.slice(6), 'base64').toString();\n  const [user, pass] = credentials.split(':');\n\n  if (user !== metricsUser || pass !== metricsPass) {\n    return res.status(401).send('Invalid credentials');\n  }\n\n  next();\n};\n\n// Expose Prometheus metrics when enabled by env flag\nconst metricsConfig = configService.get('METRICS');\nif (metricsConfig.ENABLED) {\n  const metricsMiddleware = [];\n\n  // Add IP whitelist if configured\n  if (metricsConfig.ALLOWED_IPS) {\n    metricsMiddleware.push(metricsIPWhitelist);\n  }\n\n  // Add Basic Auth if required\n  if (metricsConfig.AUTH_REQUIRED) {\n    metricsMiddleware.push(metricsBasicAuth);\n  }\n\n  router.get('/metrics', ...metricsMiddleware, async (req, res) => {\n    res.set('Content-Type', 'text/plain; version=0.0.4; charset=utf-8');\n    res.set('Cache-Control', 'no-cache, no-store, must-revalidate');\n\n    const escapeLabel = (value: unknown) =>\n      String(value ?? '')\n        .replace(/\\\\/g, '\\\\\\\\')\n        .replace(/\\n/g, '\\\\n')\n        .replace(/\"/g, '\\\\\"');\n\n    const lines: string[] = [];\n\n    const clientName = databaseConfig.CONNECTION.CLIENT_NAME || 'unknown';\n    const serverUrl = serverConfig.URL || '';\n\n    // environment info\n    lines.push('# HELP evolution_environment_info Environment information');\n    lines.push('# TYPE evolution_environment_info gauge');\n    lines.push(\n      `evolution_environment_info{version=\"${escapeLabel(packageJson.version)}\",clientName=\"${escapeLabel(\n        clientName,\n      )}\",serverUrl=\"${escapeLabel(serverUrl)}\"} 1`,\n    );\n\n    const instances = (waMonitor && waMonitor.waInstances) || {};\n    const instanceEntries = Object.entries(instances);\n\n    // total instances\n    lines.push('# HELP evolution_instances_total Total number of instances');\n    lines.push('# TYPE evolution_instances_total gauge');\n    lines.push(`evolution_instances_total ${instanceEntries.length}`);\n\n    // per-instance status\n    lines.push('# HELP evolution_instance_up 1 if instance state is open, else 0');\n    lines.push('# TYPE evolution_instance_up gauge');\n    lines.push('# HELP evolution_instance_state Instance state as a labelled metric');\n    lines.push('# TYPE evolution_instance_state gauge');\n\n    for (const [name, instance] of instanceEntries) {\n      const state = instance?.connectionStatus?.state || 'unknown';\n      const integration = instance?.integration || '';\n      const up = state === 'open' ? 1 : 0;\n\n      lines.push(\n        `evolution_instance_up{instance=\"${escapeLabel(name)}\",integration=\"${escapeLabel(integration)}\"} ${up}`,\n      );\n      lines.push(\n        `evolution_instance_state{instance=\"${escapeLabel(name)}\",integration=\"${escapeLabel(\n          integration,\n        )}\",state=\"${escapeLabel(state)}\"} 1`,\n      );\n    }\n\n    res.send(lines.join('\\n') + '\\n');\n  });\n}\n\nif (!serverConfig.DISABLE_MANAGER) router.use('/manager', new ViewsRouter().router);\n\nrouter.get('/assets/*', (req, res) => {\n  const fileName = req.params[0];\n\n  // Security: Reject paths containing traversal patterns\n  if (!fileName || fileName.includes('..') || fileName.includes('\\\\') || path.isAbsolute(fileName)) {\n    return res.status(403).send('Forbidden');\n  }\n\n  const basePath = path.join(process.cwd(), 'manager', 'dist');\n  const assetsPath = path.join(basePath, 'assets');\n  const filePath = path.join(assetsPath, fileName);\n\n  // Security: Ensure the resolved path is within the assets directory\n  const resolvedPath = path.resolve(filePath);\n  const resolvedAssetsPath = path.resolve(assetsPath);\n\n  if (!resolvedPath.startsWith(resolvedAssetsPath + path.sep) && resolvedPath !== resolvedAssetsPath) {\n    return res.status(403).send('Forbidden');\n  }\n\n  if (fs.existsSync(resolvedPath)) {\n    res.set('Content-Type', mimeTypes.lookup(resolvedPath) || 'text/css');\n    res.send(fs.readFileSync(resolvedPath));\n  } else {\n    res.status(404).send('File not found');\n  }\n});\n\nrouter\n  .use((req, res, next) => telemetry.collectTelemetry(req, res, next))\n\n  .get('/', async (req, res) => {\n    res.status(HttpStatus.OK).json({\n      status: HttpStatus.OK,\n      message: 'Welcome to the Evolution API, it is working!',\n      version: packageJson.version,\n      clientName: databaseConfig.CONNECTION.CLIENT_NAME,\n      manager: !serverConfig.DISABLE_MANAGER ? `${req.protocol}://${req.get('host')}/manager` : undefined,\n      documentation: `https://doc.evolution-api.com`,\n      whatsappWebVersion: (await fetchLatestWaWebVersion({})).version.join('.'),\n    });\n  })\n  .post('/verify-creds', authGuard['apikey'], async (req, res) => {\n    const facebookConfig = configService.get<Facebook>('FACEBOOK');\n    return res.status(HttpStatus.OK).json({\n      status: HttpStatus.OK,\n      message: 'Credentials are valid',\n      facebookAppId: facebookConfig.APP_ID,\n      facebookConfigId: facebookConfig.CONFIG_ID,\n      facebookUserToken: facebookConfig.USER_TOKEN,\n    });\n  })\n  .use('/instance', new InstanceRouter(configService, ...guards).router)\n  .use('/message', new MessageRouter(...guards).router)\n  .use('/call', new CallRouter(...guards).router)\n  .use('/chat', new ChatRouter(...guards).router)\n  .use('/business', new BusinessRouter(...guards).router)\n  .use('/group', new GroupRouter(...guards).router)\n  .use('/template', new TemplateRouter(configService, ...guards).router)\n  .use('/settings', new SettingsRouter(...guards).router)\n  .use('/proxy', new ProxyRouter(...guards).router)\n  .use('/label', new LabelRouter(...guards).router)\n  .use('', new ChannelRouter(configService, ...guards).router)\n  .use('', new EventRouter(configService, ...guards).router)\n  .use('', new ChatbotRouter(...guards).router)\n  .use('', new StorageRouter(...guards).router);\n\nexport { HttpStatus, router };\n","import { Logger } from './logger.config';\n\nexport function onUnexpectedError() {\n  process.on('uncaughtException', (error, origin) => {\n    const logger = new Logger('uncaughtException');\n    logger.error({\n      origin,\n      stderr: process.stderr.fd,\n      error,\n    });\n  });\n\n  process.on('unhandledRejection', (error, origin) => {\n    const logger = new Logger('unhandledRejection');\n    logger.error({\n      origin,\n      stderr: process.stderr.fd,\n    });\n    logger.error(error);\n  });\n}\n","import { configService, SslConf } from '@config/env.config';\nimport { Express } from 'express';\nimport { readFileSync } from 'fs';\nimport * as http from 'http';\nimport * as https from 'https';\n\nexport class ServerUP {\n  static #app: Express;\n\n  static set app(e: Express) {\n    this.#app = e;\n  }\n\n  static get https() {\n    const { FULLCHAIN, PRIVKEY } = configService.get<SslConf>('SSL_CONF');\n    return https.createServer(\n      {\n        cert: readFileSync(FULLCHAIN),\n        key: readFileSync(PRIVKEY),\n      },\n      ServerUP.#app,\n    );\n  }\n\n  static get http() {\n    return http.createServer(ServerUP.#app);\n  }\n}\n","// Import this first from sentry instrument!\nimport '@utils/instrumentSentry';\n\n// Now import other modules\nimport { ProviderFiles } from '@api/provider/sessions';\nimport { PrismaRepository } from '@api/repository/repository.service';\nimport { HttpStatus, router } from '@api/routes/index.router';\nimport { eventManager, waMonitor } from '@api/server.module';\nimport {\n  Auth,\n  configService,\n  Cors,\n  HttpServer,\n  ProviderSession,\n  Sentry as SentryConfig,\n  Webhook,\n} from '@config/env.config';\nimport { onUnexpectedError } from '@config/error.config';\nimport { Logger } from '@config/logger.config';\nimport { ROOT_DIR } from '@config/path.config';\nimport * as Sentry from '@sentry/node';\nimport { ServerUP } from '@utils/server-up';\nimport axios from 'axios';\nimport compression from 'compression';\nimport cors from 'cors';\nimport express, { json, NextFunction, Request, Response, urlencoded } from 'express';\nimport { join } from 'path';\n\nasync function initWA() {\n  await waMonitor.loadInstance();\n}\n\nasync function bootstrap() {\n  const logger = new Logger('SERVER');\n  const app = express();\n\n  let providerFiles: ProviderFiles = null;\n  if (configService.get<ProviderSession>('PROVIDER').ENABLED) {\n    providerFiles = new ProviderFiles(configService);\n    await providerFiles.onModuleInit();\n    logger.info('Provider:Files - ON');\n  }\n\n  const prismaRepository = new PrismaRepository(configService);\n  await prismaRepository.onModuleInit();\n\n  app.use(\n    cors({\n      origin(requestOrigin, callback) {\n        const { ORIGIN } = configService.get<Cors>('CORS');\n        if (ORIGIN.includes('*')) {\n          return callback(null, true);\n        }\n        if (ORIGIN.indexOf(requestOrigin) !== -1) {\n          return callback(null, true);\n        }\n        return callback(new Error('Not allowed by CORS'));\n      },\n      methods: [...configService.get<Cors>('CORS').METHODS],\n      credentials: configService.get<Cors>('CORS').CREDENTIALS,\n    }),\n    urlencoded({ extended: true, limit: '136mb' }),\n    json({ limit: '136mb' }),\n    compression(),\n  );\n\n  app.set('view engine', 'hbs');\n  app.set('views', join(ROOT_DIR, 'views'));\n  app.use(express.static(join(ROOT_DIR, 'public')));\n\n  app.use('/store', express.static(join(ROOT_DIR, 'store')));\n\n  app.use('/', router);\n\n  app.use(\n    (err: Error, req: Request, res: Response, next: NextFunction) => {\n      if (err) {\n        const webhook = configService.get<Webhook>('WEBHOOK');\n\n        if (webhook.EVENTS.ERRORS_WEBHOOK && webhook.EVENTS.ERRORS_WEBHOOK != '' && webhook.EVENTS.ERRORS) {\n          const tzoffset = new Date().getTimezoneOffset() * 60000; //offset in milliseconds\n          const localISOTime = new Date(Date.now() - tzoffset).toISOString();\n          const now = localISOTime;\n          const globalApiKey = configService.get<Auth>('AUTHENTICATION').API_KEY.KEY;\n          const serverUrl = configService.get<HttpServer>('SERVER').URL;\n\n          const errorData = {\n            event: 'error',\n            data: {\n              error: err['error'] || 'Internal Server Error',\n              message: err['message'] || 'Internal Server Error',\n              status: err['status'] || 500,\n              response: {\n                message: err['message'] || 'Internal Server Error',\n              },\n            },\n            date_time: now,\n            api_key: globalApiKey,\n            server_url: serverUrl,\n          };\n\n          logger.error(errorData);\n\n          const baseURL = webhook.EVENTS.ERRORS_WEBHOOK;\n          const httpService = axios.create({ baseURL });\n\n          httpService.post('', errorData);\n        }\n\n        return res.status(err['status'] || 500).json({\n          status: err['status'] || 500,\n          error: err['error'] || 'Internal Server Error',\n          response: {\n            message: err['message'] || 'Internal Server Error',\n          },\n        });\n      }\n\n      next();\n    },\n    (req: Request, res: Response, next: NextFunction) => {\n      const { method, url } = req;\n\n      res.status(HttpStatus.NOT_FOUND).json({\n        status: HttpStatus.NOT_FOUND,\n        error: 'Not Found',\n        response: {\n          message: [`Cannot ${method.toUpperCase()} ${url}`],\n        },\n      });\n\n      next();\n    },\n  );\n\n  const httpServer = configService.get<HttpServer>('SERVER');\n\n  ServerUP.app = app;\n  let server = ServerUP[httpServer.TYPE];\n\n  if (server === null) {\n    logger.warn('SSL cert load failed  falling back to HTTP.');\n    logger.info(\"Ensure 'SSL_CONF_PRIVKEY' and 'SSL_CONF_FULLCHAIN' env vars point to valid certificate files.\");\n\n    httpServer.TYPE = 'http';\n    server = ServerUP[httpServer.TYPE];\n  }\n\n  eventManager.init(server);\n\n  const sentryConfig = configService.get<SentryConfig>('SENTRY');\n  if (sentryConfig.DSN) {\n    logger.info('Sentry - ON');\n\n    // Add this after all routes,\n    // but before any and other error-handling middlewares are defined\n    Sentry.setupExpressErrorHandler(app);\n  }\n\n  server.listen(httpServer.PORT, () => logger.log(httpServer.TYPE.toUpperCase() + ' - ON: ' + httpServer.PORT));\n\n  initWA().catch((error) => {\n    logger.error('Error loading instances: ' + error);\n  });\n\n  onUnexpectedError();\n}\n\nbootstrap();\n"],"mappings":"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M,QAAS,EAChCqB,cAAe,CAAErB,KAAM,QAAS,EAChCsB,cAAe,CAAEtB,KAAM,QAAS,EAEhCuB,WAAY,CAAEvB,KAAM,QAAS,EAC7BwB,gBAAiB,CAAExB,KAAM,SAAU,EACnCyB,cAAe,CAAEzB,KAAM,SAAU,EACjC0B,cAAe,CACb1B,KAAM,QACN2B,SAAU,EACVC,MAAO,CACL5B,KAAM,SACNH,KAAM,CACJ,sBACA,iBACA,eACA,kBACA,kBACA,kBACA,kBACA,eACA,sBACA,eACA,kBACA,kBACA,kBACA,YACA,eACA,eACA,eACA,gBACA,eACA,4BACA,oBACA,cACA,qBACA,OACA,gBACA,wBAEJ,CACF,EAEAgC,gBAAiB,CAAE7B,KAAM,SAAU,EACnC8B,eAAgB,CACd9B,KAAM,QACN2B,SAAU,EACVC,MAAO,CACL5B,KAAM,SACNH,KAAM,CACJ,sBACA,iBACA,eACA,kBACA,kBACA,kBACA,kBACA,eACA,sBACA,eACA,kBACA,kBACA,kBACA,YACA,eACA,eACA,eACA,gBACA,eACA,4BACA,oBACA,cACA,qBACA,OACA,gBACA,wBAEJ,CACF,EAEAkC,YAAa,CAAE/B,KAAM,SAAU,EAC/BgC,WAAY,CACVhC,KAAM,QACN2B,SAAU,EACVC,MAAO,CACL5B,KAAM,SACNH,KAAM,CACJ,sBACA,iBACA,eACA,kBACA,kBACA,kBACA,kBACA,eACA,sBACA,eACA,kBACA,kBACA,kBACA,YACA,eACA,eACA,eACA,gBACA,eACA,4BACA,oBACA,cACA,qBACA,OACA,gBACA,wBAEJ,CACF,EAEAoC,WAAY,CAAEjC,KAAM,SAAU,EAC9BkC,UAAW,CACTlC,KAAM,QACN2B,SAAU,EACVC,MAAO,CACL5B,KAAM,SACNH,KAAM,CACJ,sBACA,iBACA,eACA,kBACA,kBACA,kBACA,kBACA,eACA,sBACA,eACA,kBACA,kBACA,kBACA,YACA,eACA,eACA,eACA,gBACA,eACA,4BACA,oBACA,cACA,qBACA,OACA,gBACA,wBAEJ,CACF,EAEAsC,kBAAmB,CAAEnC,KAAM,QAAS,EACpCoC,cAAe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","names":["isBooleanString","dotenv","ConfigService","configService","init_env_config","__esmMin","config","env","loadEnv","get","key","envProcess","PRODUCTION","process","NODE_ENV","DOCKER_ENV","SERVER","TYPE","SERVER_TYPE","PORT","Number","parseInt","SERVER_PORT","NAME","SERVER_NAME","URL","SERVER_URL","DISABLE_DOCS","SERVER_DISABLE_DOCS","DISABLE_MANAGER","SERVER_DISABLE_MANAGER","CORS","ORIGIN","CORS_ORIGIN","split","METHODS","CORS_METHODS","CREDENTIALS","CORS_CREDENTIALS","SSL_CONF","PRIVKEY","SSL_CONF_PRIVKEY","FULLCHAIN","SSL_CONF_FULLCHAIN","PROVIDER","ENABLED","PROVIDER_ENABLED","HOST","PROVIDER_HOST","PROVIDER_PORT","PREFIX","PROVIDER_PREFIX","DATABASE","CONNECTION","URI","DATABASE_CONNECTION_URI","CLIENT_NAME","DATABASE_CONNECTION_CLIENT_NAME","DATABASE_PROVIDER","SAVE_DATA","INSTANCE","DATABASE_SAVE_DATA_INSTANCE","NEW_MESSAGE","DATABASE_SAVE_DATA_NEW_MESSAGE","MESSAGE_UPDATE","DATABASE_SAVE_MESSAGE_UPDATE","CONTACTS","DATABASE_SAVE_DATA_CONTACTS","CHATS","DATABASE_SAVE_DATA_CHATS","HISTORIC","DATABASE_SAVE_DATA_HISTORIC","LABELS","DATABASE_SAVE_DATA_LABELS","IS_ON_WHATSAPP","DATABASE_SAVE_IS_ON_WHATSAPP","IS_ON_WHATSAPP_DAYS","DATABASE_SAVE_IS_ON_WHATSAPP_DAYS","DELETE_DATA","LOGICAL_MESSAGE_DELETE","DATABASE_DELETE_MESSAGE","RABBITMQ","RABBITMQ_ENABLED","GLOBAL_ENABLED","RABBITMQ_GLOBAL_ENABLED","PREFIX_KEY","RABBITMQ_PREFIX_KEY","EXCHANGE_NAME","RABBITMQ_EXCHANGE_NAME","RABBITMQ_URI","FRAME_MAX","RABBITMQ_FRAME_MAX","EVENTS","APPLICATION_STARTUP","RABBITMQ_EVENTS_APPLICATION_STARTUP","INSTANCE_CREATE","RABBITMQ_EVENTS_INSTANCE_CREATE","INSTANCE_DELETE","RABBITMQ_EVENTS_INSTANCE_DELETE","QRCODE_UPDATED","RABBITMQ_EVENTS_QRCODE_UPDATED","MESSAGES_SET","RABBITMQ_EVENTS_MESSAGES_SET","MESSAGES_UPSERT","RABBITMQ_EVENTS_MESSAGES_UPSERT","MESSAGES_EDITED","RABBITMQ_EVENTS_MESSAGES_EDITED","MESSAGES_UPDATE","RABBITMQ_EVENTS_MESSAGES_UPDATE","MESSAGES_DELETE","RABBITMQ_EVENTS_MESSAGES_DELETE","SEND_MESSAGE","RABBITMQ_EVENTS_SEND_MESSAGE","SEND_MESSAGE_UPDATE","RABBITMQ_EVENTS_SEND_MESSAGE_UPDATE","CONTACTS_SET","RABBITMQ_EVENTS_CONTACTS_SET","CONTACTS_UPDATE","RABBITMQ_EVENTS_CONTACTS_UPDATE","CONTACTS_UPSERT","RABBITMQ_EVENTS_CONTACTS_UPSERT","PRESENCE_UPDATE","RABBITMQ_EVENTS_PRESENCE_UPDATE","CHATS_SET","RABBITMQ_EVENTS_CHATS_SET","CHATS_UPDATE","RABBITMQ_EVENTS_CHATS_UPDATE","CHATS_UPSERT","RABBITMQ_EVENTS_CHATS_UPSERT","CHATS_DELETE","RABBITMQ_EVENTS_CHATS_DELETE","CONNECTION_UPDATE","RABBITMQ_EVENTS_CONNECTION_UPDATE","LABELS_EDIT","RABBITMQ_EVENTS_LABELS_EDIT","LABELS_ASSOCIATION","RABBITMQ_EVENTS_LABELS_ASSOCIATION","GROUPS_UPSERT","RABBITMQ_EVENTS_GROUPS_UPSERT","GROUP_UPDATE","RABBITMQ_EVENTS_GROUPS_UPDATE","GROUP_PARTICIPANTS_UPDATE","RABBITMQ_EVENTS_GROUP_PARTICIPANTS_UPDATE","CALL","RABBITMQ_EVENTS_CALL","TYPEBOT_START","RABBITMQ_EVENTS_TYPEBOT_START","TYPEBOT_CHANGE_STATUS","RABBITMQ_EVENTS_TYPEBOT_CHANGE_STATUS","NATS","NATS_ENABLED","NATS_GLOBAL_ENABLED","NATS_PREFIX_KEY","NATS_EXCHANGE_NAME","NATS_URI","NATS_EVENTS_APPLICATION_STARTUP","NATS_EVENTS_INSTANCE_CREATE","NATS_EVENTS_INSTANCE_DELETE","NATS_EVENTS_QRCODE_UPDATED","NATS_EVENTS_MESSAGES_SET","NATS_EVENTS_MESSAGES_UPSERT","NATS_EVENTS_MESSAGES_EDITED","NATS_EVENTS_MESSAGES_UPDATE","NATS_EVENTS_MESSAGES_DELETE","NATS_EVENTS_SEND_MESSAGE","NATS_EVENTS_SEND_MESSAGE_UPDATE","NATS_EVENTS_CONTACTS_SET","NATS_EVENTS_CONTACTS_UPDATE","NATS_EVENTS_CONTACTS_UPSERT","NATS_EVENTS_PRESENCE_UPDATE","NATS_EVENTS_CHATS_SET","NATS_EVENTS_CHATS_UPDATE","NATS_EVENTS_CHATS_UPSERT","NATS_EVENTS_CHATS_DELETE","NATS_EVENTS_CONNECTION_UPDATE","NATS_EVENTS_LABELS_EDIT","NATS_EVENTS_LABELS_ASSOCIATION","NATS_EVENTS_GROUPS_UPSERT","NATS_EVENTS_GROUPS_UPDATE","NATS_EVENTS_GROUP_PARTICIPANTS_UPDATE","NATS_EVENTS_CALL","NATS_EVENTS_TYPEBOT_START","NATS_EVENTS_TYPEBOT_CHANGE_STATUS","SQS","SQS_ENABLED","SQS_GLOBAL_ENABLED","GLOBAL_FORCE_SINGLE_QUEUE","SQS_GLOBAL_FORCE_SINGLE_QUEUE","GLOBAL_PREFIX_NAME","SQS_GLOBAL_PREFIX_NAME","ACCESS_KEY_ID","SQS_ACCESS_KEY_ID","SECRET_ACCESS_KEY","SQS_SECRET_ACCESS_KEY","ACCOUNT_ID","SQS_ACCOUNT_ID","REGION","SQS_REGION","MAX_PAYLOAD_SIZE","SQS_MAX_PAYLOAD_SIZE","SQS_GLOBAL_APPLICATION_STARTUP","SQS_GLOBAL_CALL","SQS_GLOBAL_CHATS_DELETE","SQS_GLOBAL_CHATS_SET","SQS_GLOBAL_CHATS_UPDATE","SQS_GLOBAL_CHATS_UPSERT","SQS_GLOBAL_CONNECTION_UPDATE","SQS_GLOBAL_CONTACTS_SET","SQS_GLOBAL_CONTACTS_UPDATE","SQS_GLOBAL_CONTACTS_UPSERT","SQS_GLOBAL_GROUP_PARTICIPANTS_UPDATE","GROUPS_UPDATE","SQS_GLOBAL_GROUPS_UPDATE","SQS_GLOBAL_GROUPS_UPSERT","SQS_GLOBAL_LABELS_ASSOCIATION","SQS_GLOBAL_LABELS_EDIT","LOGOUT_INSTANCE","SQS_GLOBAL_LOGOUT_INSTANCE","SQS_GLOBAL_MESSAGES_DELETE","SQS_GLOBAL_MESSAGES_EDITED","SQS_GLOBAL_MESSAGES_SET","SQS_GLOBAL_MESSAGES_UPDATE","SQS_GLOBAL_MESSAGES_UPSERT","SQS_GLOBAL_PRESENCE_UPDATE","SQS_GLOBAL_QRCODE_UPDATED","REMOVE_INSTANCE","SQS_GLOBAL_REMOVE_INSTANCE","SQS_GLOBAL_SEND_MESSAGE","SQS_GLOBAL_TYPEBOT_CHANGE_STATUS","SQS_GLOBAL_TYPEBOT_START","KAFKA","KAFKA_ENABLED","CLIENT_ID","KAFKA_CLIENT_ID","BROKERS","KAFKA_BROKERS","CONNECTION_TIMEOUT","KAFKA_CONNECTION_TIMEOUT","REQUEST_TIMEOUT","KAFKA_REQUEST_TIMEOUT","KAFKA_GLOBAL_ENABLED","CONSUMER_GROUP_ID","KAFKA_CONSUMER_GROUP_ID","TOPIC_PREFIX","KAFKA_TOPIC_PREFIX","NUM_PARTITIONS","KAFKA_NUM_PARTITIONS","REPLICATION_FACTOR","KAFKA_REPLICATION_FACTOR","AUTO_CREATE_TOPICS","KAFKA_AUTO_CREATE_TOPICS","KAFKA_EVENTS_APPLICATION_STARTUP","KAFKA_EVENTS_INSTANCE_CREATE","KAFKA_EVENTS_INSTANCE_DELETE","KAFKA_EVENTS_QRCODE_UPDATED","KAFKA_EVENTS_MESSAGES_SET","KAFKA_EVENTS_MESSAGES_UPSERT","KAFKA_EVENTS_MESSAGES_EDITED","KAFKA_EVENTS_MESSAGES_UPDATE","KAFKA_EVENTS_MESSAGES_DELETE","KAFKA_EVENTS_SEND_MESSAGE","KAFKA_EVENTS_SEND_MESSAGE_UPDATE","KAFKA_EVENTS_CONTACTS_SET","KAFKA_EVENTS_CONTACTS_UPSERT","KAFKA_EVENTS_CONTACTS_UPDATE","KAFKA_EVENTS_PRESENCE_UPDATE","KAFKA_EVENTS_CHATS_SET","KAFKA_EVENTS_CHATS_UPSERT","KAFKA_EVENTS_CHATS_UPDATE","KAFKA_EVENTS_CHATS_DELETE","KAFKA_EVENTS_CONNECTION_UPDATE","KAFKA_EVENTS_LABELS_EDIT","KAFKA_EVENTS_LABELS_ASSOCIATION","KAFKA_EVENTS_GROUPS_UPSERT","KAFKA_EVENTS_GROUPS_UPDATE","KAFKA_EVENTS_GROUP_PARTICIPANTS_UPDATE","KAFKA_EVENTS_CALL","KAFKA_EVENTS_TYPEBOT_START","KAFKA_EVENTS_TYPEBOT_CHANGE_STATUS","SASL","KAFKA_SASL_ENABLED","MECHANISM","KAFKA_SASL_MECHANISM","USERNAME","KAFKA_SASL_USERNAME","PASSWORD","KAFKA_SASL_PASSWORD","undefined","SSL","KAFKA_SSL_ENABLED","REJECT_UNAUTHORIZED","KAFKA_SSL_REJECT_UNAUTHORIZED","CA","KAFKA_SSL_CA","KEY","KAFKA_SSL_KEY","CERT","KAFKA_SSL_CERT","WEBSOCKET","WEBSOCKET_ENABLED","GLOBAL_EVENTS","WEBSOCKET_GLOBAL_EVENTS","ALLOWED_HOSTS","WEBSOCKET_ALLOWED_HOSTS","PUSHER","PUSHER_ENABLED","GLOBAL","PUSHER_GLOBAL_ENABLED","APP_ID","PUSHER_GLOBAL_APP_ID","PUSHER_GLOBAL_KEY","SECRET","PUSHER_GLOBAL_SECRET","CLUSTER","PUSHER_GLOBAL_CLUSTER","USE_TLS","PUSHER_GLOBAL_USE_TLS","PUSHER_EVENTS_APPLICATION_STARTUP","PUSHER_EVENTS_INSTANCE_CREATE","PUSHER_EVENTS_INSTANCE_DELETE","PUSHER_EVENTS_QRCODE_UPDATED","PUSHER_EVENTS_MESSAGES_SET","PUSHER_EVENTS_MESSAGES_UPSERT","PUSHER_EVENTS_MESSAGES_EDITED","PUSHER_EVENTS_MESSAGES_UPDATE","PUSHER_EVENTS_MESSAGES_DELETE","PUSHER_EVENTS_SEND_MESSAGE","PUSHER_EVENTS_SEND_MESSAGE_UPDATE","PUSHER_EVENTS_CONTACTS_SET","PUSHER_EVENTS_CONTACTS_UPDATE","PUSHER_EVENTS_CONTACTS_UPSERT","PUSHER_EVENTS_PRESENCE_UPDATE","PUSHER_EVENTS_CHATS_SET","PUSHER_EVENTS_CHATS_UPDATE","PUSHER_EVENTS_CHATS_UPSERT","PUSHER_EVENTS_CHATS_DELETE","PUSHER_EVENTS_CONNECTION_UPDATE","PUSHER_EVENTS_LABELS_EDIT","PUSHER_EVENTS_LABELS_ASSOCIATION","PUSHER_EVENTS_GROUPS_UPSERT","PUSHER_EVENTS_GROUPS_UPDATE","PUSHER_EVENTS_GROUP_PARTICIPANTS_UPDATE","PUSHER_EVENTS_CALL","PUSHER_EVENTS_TYPEBOT_START","PUSHER_EVENTS_TYPEBOT_CHANGE_STATUS","WA_BUSINESS","TOKEN_WEBHOOK","WA_BUSINESS_TOKEN_WEBHOOK","WA_BUSINESS_URL","VERSION","WA_BUSINESS_VERSION","LANGUAGE","WA_BUSINESS_LANGUAGE","LOG","LEVEL","LOG_LEVEL","COLOR","LOG_COLOR","BAILEYS","LOG_BAILEYS","DEL_INSTANCE","DEL_TEMP_INSTANCES","WEBHOOK","WEBHOOK_GLOBAL_URL","WEBHOOK_GLOBAL_ENABLED","WEBHOOK_BY_EVENTS","WEBHOOK_GLOBAL_WEBHOOK_BY_EVENTS","WEBHOOK_EVENTS_APPLICATION_STARTUP","WEBHOOK_EVENTS_INSTANCE_CREATE","WEBHOOK_EVENTS_INSTANCE_DELETE","WEBHOOK_EVENTS_QRCODE_UPDATED","WEBHOOK_EVENTS_MESSAGES_SET","WEBHOOK_EVENTS_MESSAGES_UPSERT","WEBHOOK_EVENTS_MESSAGES_EDITED","WEBHOOK_EVENTS_MESSAGES_UPDATE","WEBHOOK_EVENTS_MESSAGES_DELETE","WEBHOOK_EVENTS_SEND_MESSAGE","WEBHOOK_EVENTS_SEND_MESSAGE_UPDATE","WEBHOOK_EVENTS_CONTACTS_SET","WEBHOOK_EVENTS_CONTACTS_UPDATE","WEBHOOK_EVENTS_CONTACTS_UPSERT","WEBHOOK_EVENTS_PRESENCE_UPDATE","WEBHOOK_EVENTS_CHATS_SET","WEBHOOK_EVENTS_CHATS_UPDATE","WEBHOOK_EVENTS_CHATS_UPSERT","WEBHOOK_EVENTS_CHATS_DELETE","WEBHOOK_EVENTS_CONNECTION_UPDATE","WEBHOOK_EVENTS_LABELS_EDIT","WEBHOOK_EVENTS_LABELS_ASSOCIATION","WEBHOOK_EVENTS_GROUPS_UPSERT","WEBHOOK_EVENTS_GROUPS_UPDATE","WEBHOOK_EVENTS_GROUP_PARTICIPANTS_UPDATE","WEBHOOK_EVENTS_CALL","WEBHOOK_EVENTS_TYPEBOT_START","WEBHOOK_EVENTS_TYPEBOT_CHANGE_STATUS","ERRORS","WEBHOOK_EVENTS_ERRORS","ERRORS_WEBHOOK","WEBHOOK_EVENTS_ERRORS_WEBHOOK","REQUEST","TIMEOUT_MS","WEBHOOK_REQUEST_TIMEOUT_MS","RETRY","MAX_ATTEMPTS","WEBHOOK_RETRY_MAX_ATTEMPTS","INITIAL_DELAY_SECONDS","WEBHOOK_RETRY_INITIAL_DELAY_SECONDS","USE_EXPONENTIAL_BACKOFF","WEBHOOK_RETRY_USE_EXPONENTIAL_BACKOFF","MAX_DELAY_SECONDS","WEBHOOK_RETRY_MAX_DELAY_SECONDS","JITTER_FACTOR","parseFloat","WEBHOOK_RETRY_JITTER_FACTOR","NON_RETRYABLE_STATUS_CODES","WEBHOOK_RETRY_NON_RETRYABLE_STATUS_CODES","map","CONFIG_SESSION_PHONE","CLIENT","CONFIG_SESSION_PHONE_CLIENT","CONFIG_SESSION_PHONE_NAME","QRCODE","LIMIT","QRCODE_LIMIT","QRCODE_COLOR","TYPEBOT","TYPEBOT_ENABLED","API_VERSION","TYPEBOT_API_VERSION","SEND_MEDIA_BASE64","TYPEBOT_SEND_MEDIA_BASE64","CHATWOOT","CHATWOOT_ENABLED","MESSAGE_DELETE","CHATWOOT_MESSAGE_DELETE","MESSAGE_READ","CHATWOOT_MESSAGE_READ","BOT_CONTACT","CHATWOOT_BOT_CONTACT","IMPORT","CHATWOOT_IMPORT_DATABASE_CONNECTION_URI","PLACEHOLDER_MEDIA_MESSAGE","CHATWOOT_IMPORT_PLACEHOLDER_MEDIA_MESSAGE","OPENAI","OPENAI_ENABLED","API_KEY_GLOBAL","OPENAI_API_KEY_GLOBAL","DIFY","DIFY_ENABLED","N8N","N8N_ENABLED","EVOAI","EVOAI_ENABLED","FLOWISE","FLOWISE_ENABLED","CACHE","REDIS","CACHE_REDIS_ENABLED","CACHE_REDIS_URI","CACHE_REDIS_PREFIX_KEY","TTL","CACHE_REDIS_TTL","SAVE_INSTANCES","CACHE_REDIS_SAVE_INSTANCES","LOCAL","CACHE_LOCAL_ENABLED","S3","ACCESS_KEY","S3_ACCESS_KEY","SECRET_KEY","S3_SECRET_KEY","ENDPOINT","S3_ENDPOINT","BUCKET_NAME","S3_BUCKET","ENABLE","S3_ENABLED","S3_PORT","USE_SSL","S3_USE_SSL","S3_REGION","SKIP_POLICY","S3_SKIP_POLICY","SAVE_VIDEO","S3_SAVE_VIDEO","AUTHENTICATION","API_KEY","AUTHENTICATION_API_KEY","EXPOSE_IN_FETCH_INSTANCES","AUTHENTICATION_EXPOSE_IN_FETCH_INSTANCES","METRICS","PROMETHEUS_METRICS","AUTH_REQUIRED","METRICS_AUTH_REQUIRED","USER","METRICS_USER","METRICS_PASSWORD","ALLOWED_IPS","METRICS_ALLOWED_IPS","TELEMETRY","TELEMETRY_ENABLED","TELEMETRY_URL","PROXY","PROXY_HOST","PROXY_PORT","PROTOCOL","PROXY_PROTOCOL","PROXY_USERNAME","PROXY_PASSWORD","AUDIO_CONVERTER","API_URL","API_AUDIO_CONVERTER","API_AUDIO_CONVERTER_KEY","FACEBOOK","FACEBOOK_APP_ID","CONFIG_ID","FACEBOOK_CONFIG_ID","USER_TOKEN","FACEBOOK_USER_TOKEN","SENTRY","DSN","SENTRY_DSN","EVENT_EMITTER","MAX_LISTENERS","EVENT_EMITTER_MAX_LISTENERS","_ConfigService","Sentry","require_instrumentSentry","__commonJSMin","init_env_config","sentryConfig","configService","get","DSN","init","dsn","environment","process","env","NODE_ENV","tracesSampleRate","profilesSampleRate","dayjs","fs","packageJson","formatDateLog","Color","Level","Type","Background","Logger","init_logger_config","__esmMin","init_env_config","JSON","parse","readFileSync","__name","timestamp","toDate","toString","replace","context","configService","instance","setContext","value","setInstance","console","type","types","get","LEVEL","forEach","level","push","typeValue","includes","COLOR","log","Command","version","process","pid","Date","now","info","warn","error","verbose","debug","dark","_Logger","axios","execFileSync","ProviderFiles","init_sessions","__esmMin","init_logger_config","configService","logger","Logger","baseUrl","globalApiToken","config","Object","freeze","get","HOST","PORT","PREFIX","API_KEY","KEY","isEnabled","ENABLED","onModuleInit","url","options","data","Error","post","group","headers","apikey","error","message","stack","pid","process","onModuleDestroy","create","instance","response","status","write","key","read","delete","allInstances","removeSession","_ProviderFiles","PrismaClient","Query","PrismaRepository","init_repository_service","__esmMin","init_logger_config","where","sort","page","offset","_Query","configService","logger","Logger","onModuleInit","$connect","info","onModuleDestroy","$disconnect","warn","_PrismaRepository","BufferJSON","NodeCache","LocalCache","init_localcache","__esmMin","init_logger_config","configService","module","logger","Logger","conf","get","LOCAL","key","localCache","buildKey","set","value","ttl","TTL","has","delete","del","deleteAll","appendCriteria","keys","length","filter","substring","hGet","field","data","JSON","parse","reviver","error","hSet","json","stringify","replacer","hash","hDelete","__publicField","_LocalCache","createClient","_a","Redis","redisClient","init_rediscache_client","__esmMin","init_env_config","init_logger_config","logger","Logger","client","conf","connected","configService","get","REDIS","getConnection","url","URI","on","verbose","error","connect","e","BufferJSON","RedisCache","init_rediscache","__esmMin","init_logger_config","init_rediscache_client","configService","module","logger","Logger","client","conf","get","REDIS","redisClient","getConnection","key","JSON","parse","buildKey","error","hGet","field","data","reviver","set","value","ttl","setEx","TTL","stringify","hSet","json","replacer","has","exists","delete","del","hDelete","hDel","deleteAll","appendCriteria","keys","length","match","scanIterator","MATCH","COUNT","push","Set","PREFIX_KEY","_RedisCache","logger","CacheEngine","init_cacheengine","__esmMin","init_logger_config","init_localcache","init_rediscache","Logger","configService","module","engine","cacheConf","get","REDIS","ENABLED","URI","verbose","RedisCache","LOCAL","LocalCache","getEngine","_CacheEngine","EventEmitter2","eventEmitterConfig","eventEmitter","init_event_config","__esmMin","init_env_config","configService","get","delimiter","newListener","ignoreErrors","maxListeners","MAX_LISTENERS","BusinessController","init_business_controller","__esmMin","waMonitor","fetchCatalog","instanceName","data","waInstances","fetchCollections","_BusinessController","CallController","init_call_controller","__esmMin","waMonitor","offerCall","instanceName","data","waInstances","_CallController","ChatController","init_chat_controller","__esmMin","waMonitor","whatsappNumber","instanceName","data","waInstances","readMessage","markMessageAsRead","archiveChat","markChatUnread","deleteMessage","fetchProfilePicture","profilePicture","number","fetchProfile","fetchContacts","query","getBase64FromMediaMessage","fetchMessages","fetchStatusMessage","fetchChats","findChatByRemoteJid","remoteJid","sendPresence","fetchPrivacySettings","updatePrivacySettings","fetchBusinessProfile","updateProfileName","name","updateProfileStatus","status","updateProfilePicture","picture","removeProfilePicture","updateMessage","blockUser","_ChatController","GroupController","init_group_controller","__esmMin","waMonitor","createGroup","instance","create","waInstances","instanceName","updateGroupPicture","update","updateGroupSubject","updateGroupDescription","findGroupInfo","groupJid","findGroup","fetchAllGroups","getPaticipants","inviteCode","inviteInfo","sendInvite","data","acceptInviteCode","revokeInviteCode","findParticipants","updateGParticipate","updateGParticipant","updateGSetting","toggleEphemeral","leaveGroup","_GroupController","Events","TypeMediaMessage","MessageSubtype","Integration","init_wa_types","__esmMin","WHATSAPP_BUSINESS","WHATSAPP_BAILEYS","EVOLUTION","BadRequestException","init_exception","__esmMin","init_index_router","objectError","status","HttpStatus","BAD_REQUEST","error","message","length","undefined","_BadRequestException","UnauthorizedException","init_exception","__esmMin","init_index_router","objectError","status","HttpStatus","UNAUTHORIZED","error","message","length","_UnauthorizedException","ForbiddenException","init_exception","__esmMin","init_index_router","objectError","status","HttpStatus","FORBIDDEN","error","message","length","undefined","_ForbiddenException","NotFoundException","init_exception","__esmMin","init_index_router","objectError","status","HttpStatus","NOT_FOUND","error","message","length","undefined","_NotFoundException","InternalServerErrorException","init_exception","__esmMin","init_index_router","objectError","status","HttpStatus","INTERNAL_SERVER_ERROR","error","message","length","undefined","_InternalServerErrorException","init_exceptions","__esmMin","init_exception","delay","isArray","isURL","v4","InstanceController","init_instance_controller","__esmMin","init_server_module","init_wa_types","init_logger_config","init_exceptions","waMonitor","configService","prismaRepository","eventEmitter","chatwootService","settingsService","proxyService","cache","chatwootCache","baileysCache","providerFiles","logger","Logger","createInstance","instanceData","instance","channelController","init","BadRequestException","instanceId","hash","token","toUpperCase","saveInstance","integration","instanceName","ownerJid","profileName","profilePicUrl","number","businessId","status","setInstance","waInstances","delInstanceTime","eventManager","sendDataWebhook","Events","INSTANCE_CREATE","instanceDto","connectionStatus","state","proxyHost","proxyPort","proxyProtocol","testProxy","host","port","protocol","username","proxyUsername","password","proxyPassword","createProxy","enabled","settings","rejectCall","msgCall","groupsIgnore","alwaysOnline","readMessages","readStatus","syncFullHistory","wavoipToken","create","webhookWaBusiness","accessTokenWaBusiness","Integration","WHATSAPP_BUSINESS","get","URL","urlServer","TOKEN_WEBHOOK","chatwootAccountId","chatwootToken","chatwootUrl","getQrcode","qrcode","WHATSAPP_BAILEYS","connectToWhatsapp","qrCode","webhook","webhookUrl","url","webhookHeaders","headers","webhookByEvents","byEvents","webhookBase64","base64","websocket","rabbitmq","nats","sqs","ENABLED","require_tld","chatwootSignMsg","chatwootReopenConversation","chatwootConversationPending","accountId","signMsg","nameInbox","chatwootNameInbox","split","reopenConversation","conversationPending","importContacts","chatwootImportContacts","mergeBrazilContacts","chatwootMergeBrazilContacts","importMessages","chatwootImportMessages","daysLimitImportMessages","chatwootDaysLimitImportMessages","organization","chatwootOrganization","logo","chatwootLogo","autoCreate","chatwootAutoCreate","error","log","chatwoot","encodeURIComponent","deleteInstance","message","connectionState","toString","restartInstance","info","restart","Promise","r","setTimeout","clearCacheChatwoot","client","ws","close","end","Error","fetchInstances","key","API_KEY","KEY","instancesByKey","findMany","where","name","undefined","id","length","names","map","instanceInfo","UnauthorizedException","instanceInfoById","instanceNames","setPresence","data","logout","logoutInstance","response","InternalServerErrorException","INSTANCE_DELETE","emit","_InstanceController","LabelController","init_label_controller","__esmMin","waMonitor","fetchLabels","instanceName","waInstances","handleLabel","data","_LabelController","socksDispatcher","HttpsProxyAgent","SocksProxyAgent","ProxyAgent","selectProxyAgent","proxyUrl","url","URL","PROXY_HTTP_PROTOCOL","PROXY_SOCKS_PROTOCOL","PROXY_SOCKS5_PROTOCOL","protocol","urlSocks","username","password","hostname","port","Error","makeProxyAgent","proxy","host","makeProxyAgentUndici","replace","proto","auth","toLowerCase","PROXY_HTTPS_PROTOCOL","PROXY_SOCKS4_PROTOCOL","type","Number","userId","undefined","init_makeProxyAgent","__esmMin","axios","logger","ProxyController","init_proxy_controller","__esmMin","init_logger_config","init_exceptions","init_makeProxyAgent","Logger","proxyService","waMonitor","createProxy","instance","data","waInstances","instanceName","NotFoundException","enabled","host","port","protocol","username","password","testProxy","BadRequestException","create","findProxy","find","proxy","serverIp","get","result","httpsAgent","makeProxyAgent","info","warn","error","isAxiosError","message","_ProxyController","isBase64","isURL","emojiRegex","isEmoji","str","match","regex","length","SendMessageController","init_sendMessage_controller","__esmMin","init_exceptions","waMonitor","sendTemplate","instanceName","data","waInstances","templateMessage","sendText","textMessage","sendMedia","file","media","fileName","mediatype","BadRequestException","mediaMessage","sendPtv","video","ptvMessage","sendSticker","sticker","mediaSticker","sendWhatsAppAudio","buffer","audio","audioWhatsapp","console","error","sendButtons","buttonMessage","sendLocation","locationMessage","sendList","listMessage","sendContact","contactMessage","sendReaction","reaction","reactionMessage","sendPoll","pollMessage","sendStatus","statusMessage","_SendMessageController","SettingsController","init_settings_controller","__esmMin","settingsService","createSettings","instance","data","create","findSettings","find","_SettingsController","TemplateController","init_template_controller","__esmMin","templateService","createTemplate","instance","data","create","findTemplate","find","editTemplate","edit","deleteTemplate","delete","_TemplateController","MinIo","join","logger","BUCKET","minioClient","bucketName","bucketExists","setBucketPolicy","createBucket","uploadFile","getObjectUrl","init_minio_server","__esmMin","init_env_config","init_logger_config","init_exceptions","Logger","ConfigService","get","ENABLE","Client","endPoint","ENDPOINT","port","PORT","useSSL","USE_SSL","accessKey","ACCESS_KEY","secretKey","SECRET_KEY","region","REGION","BUCKET_NAME","__name","listBuckets","find","bucket","name","policy","Version","Statement","Effect","Principal","Action","Resource","JSON","stringify","makeBucket","SKIP_POLICY","info","error","fileName","file","size","metadata","objectName","putObject","expiry","presignedGetObject","BadRequestException","message","postgresql","Pool","_a","Postgres","postgresClient","init_postgres_client","__esmMin","init_env_config","init_logger_config","logger","Logger","pool","connected","getConnection","connectionString","ssl","rejectUnauthorized","on","error","e","getChatwootConnection","uri","configService","get","IMPORT","DATABASE","CONNECTION","URI","_a","ChatwootImport","chatwootImport","init_chatwoot_import_helper","__esmMin","init_postgres_client","init_env_config","init_logger_config","logger","Logger","repositoryMessagesCache","Map","historyMessages","historyContacts","getRepositoryMessagesCache","instance","has","instanceName","get","setRepositoryMessagesCache","set","deleteRepositoryMessagesCache","delete","addHistoryMessages","messagesRaw","actualValue","addHistoryContacts","contactsRaw","concat","deleteHistoryMessages","deleteHistoryContacts","clearAll","getHistoryMessagesLenght","length","importHistoryContacts","provider","pgClient","postgresClient","getChatwootConnection","totalContactsImported","contacts","contactsChunk","sliceIntoChunks","labelSql","nameInbox","accountId","labelId","query","rows","id","sqlLabel","sqlInsert","bindInsert","contact","isGroup","isIgnorePhoneNumber","remoteJid","contactName","pushName","push","bindName","bindPhoneNumber","split","bindIdentifier","slice","rowCount","sqlTags","tagId","sqlTag","sqlInsertLabel","forEach","bindTaggableId","error","toString","getExistingSourceIds","sourceIds","conversationId","existingSourceIdsSet","Set","formattedSourceIds","map","sourceId","replace","params","result","row","add","source_id","importHistoryMessages","chatwootService","inbox","chatwootUser","getChatwootUser","Error","totalMessagesImported","messagesOrdered","sort","a","b","aKey","key","bKey","aMessageTimestamp","messageTimestamp","bMessageTimestamp","parseInt","allMessagesMappedByPhoneNumber","createMessagesMapByPhoneNumber","phoneNumbersWithTimestamp","messages","phoneNumber","first","last","existingSourceIds","message","filter","batchSize","messagesChunk","messagesByPhoneNumber","size","fksByNumber","selectOrCreateFksFromChatwoot","sqlInsertMsg","bindInsertMsg","fksChatwoot","conversation_id","contact_id","contentMessage","getContentMessage","bindContent","bindConversationId","fromMe","bindMessageType","user_type","bindSenderType","user_id","bindSenderId","bindSourceId","bindmessageTimestamp","providerData","ignoreJids","Array","isArray","event","String","bindValues","sqlFromChatwoot","from","keys","phoneNumberTimestamp","bindStr","join","phoneNumberBind","fksFromChatwoot","item","phone_number","token","reduce","acc","phoneNumberPlus","getContactsOrderByRecentConversations","limit","msg","getConversationMessage","configService","IMPORT","PLACEHOLDER_MEDIA_MESSAGE","types","documentMessage","documentWithCaptionMessage","imageMessage","videoMessage","audioMessage","stickerMessage","templateMessage","hydratedTemplate","hydratedContentText","Object","find","undefined","typeKey","doc","fileName","caption","template","hydratedTitleText","arr","chunkSize","splice","includes","updateMessageSourceID","messageId","fs","i18next","path","languages","translationsPath","configService","resources","i18n_default","init_i18n","__esmMin","init_env_config","join","__dirname","ConfigService","forEach","language","languagePath","existsSync","translationContent","readFileSync","translation","JSON","parse","init","fallbackLng","lng","get","debug","interpolation","escapeValue","axios","fs","packageJson","sendTelemetry","init_sendTelemetry","__esmMin","init_env_config","JSON","parse","readFileSync","__name","route","telemetryConfig","configService","get","ENABLED","telemetry","apiVersion","version","timestamp","Date","url","URL","post","then","catch","ChatwootClient","request","chatwootRequest","axios","dayjs","FormData","Jimp","JimpMime","parsePhoneNumberFromString","Long","mimeTypes","path","Readable","ChatwootService","init_chatwoot_service","__esmMin","init_postgres_client","init_chatwoot_import_helper","init_wa_types","init_logger_config","init_i18n","init_sendTelemetry","waMonitor","configService","prismaRepository","cache","logger","Logger","LOCK_POLLING_DELAY_MS","provider","pgClient","postgresClient","getChatwootConnection","getProvider","instance","cacheKey","instanceName","has","get","waInstances","findChatwoot","set","warn","clientCw","config","getClientCwConfig","error","basePath","url","with_credentials","credentials","token","nameInbox","mergeBrazilContacts","getCache","create","data","setChatwoot","autoCreate","log","urlServer","URL","initInstanceChatwoot","split","encodeURIComponent","number","organization","logo","find","enabled","getContact","id","client","contact","getContactable","accountId","inboxName","webhookUrl","qrcode","findInbox","inboxes","list","checkDuplicate","payload","map","inbox","name","includes","inboxId","type","webhook_url","channel","BOT_CONTACT","findContact","createContact","contactId","contact_id","toString","inbox_id","conversation","conversations","contentMsg","messages","conversationId","content","message_type","phoneNumber","isGroup","avatar_url","jid","identifier","contacts","addLabelToContact","status","response","existingContact","findContactByIdentifier","console","updateContact","update","IMPORT","DATABASE","CONNECTION","URI","tagData","query","rows","tagId","taggingsCount","taggings_count","rowCount","params","q","sort","length","contactByAttr","post","attribute_key","filter_operator","values","query_operator","search","method","body","getFilterPayload","findContactInContactList","mergeContacts","baseId","mergeId","base_contact_id","mergee_contact_id","mergeBrazilianContacts","phone_number","phoneNumbers","getNumbers","searchableFields","getSearchableFields","startsWith","phone","reduce","savedNumber","contact_with9","field","numbers","push","withoutNine","slice","withNine","filterPayload","fieldsToSearch","forEach","index1","index2","queryOperator","replace","createConversation","isLid","key","addressingMode","remoteJid","endsWith","remoteJidAlt","lockKey","maxWaitTime","verbose","baseContact","JSON","stringify","conversationExists","meta","sender","delete","start","Date","now","Promise","res","setTimeout","chatId","nameContact","fromMe","pushName","filterInbox","getInbox","group","groupMetadata","JID","subject","Name","participantJid","participantAlt","participant","picture_url","profilePicture","findParticipant","profilePictureUrl","waProfilePictureFile","pop","chatwootProfilePictureFile","thumbnail","pictureNeedsUpdate","nameNeedsUpdate","avatar","contactConversations","listConversations","inboxConversation","reopenConversation","conversationPending","toggleStatus","findByName","createMessage","messageType","privateMessage","attachments","messageBody","sourceId","quotedMsg","replyToIds","getReplyToIds","sourceReplyId","chatwootMessageId","message","private","source_id","content_attributes","source_reply_id","getOpenConversationByContact","undefined","createBotMessage","sendData","fileStream","fileName","isImportHistoryAvailable","messageAlreadySaved","chatwootImport","getExistingSourceIds","size","append","filename","in_reply_to","in_reply_to_external_id","maxBodyLength","Infinity","headers","api_access_token","getHeaders","createBotQr","sendAttachment","waInstance","media","caption","options","parsedMedia","parse","decodeURIComponent","mimeType","lookup","ext","parts","responseType","audio","delay","Math","floor","random","quoted","sendTelemetry","audioWhatsapp","mediatype","mediaMessage","onSendMessageError","exists","i18next","t","receiveWebhook","resolve","event","keyToDelete","deleted","messageReceived","replaceAll","senderName","available_name","instanceId","findFirst","where","sendMessage","deleteMany","cwBotContact","command","connectionStatus","state","connectToWhatsapp","clearCacheChatwoot","msgLogout","logout","ws","close","substring","formatText","formattedDelimiter","signDelimiter","textToConcat","signMsg","join","attachment","getQuotedMessage","messageSent","data_url","updateChatwootMessageId","messageId","contactInboxSourceId","contact_inbox","text","textMessage","Error","isLong","messageTimestamp","toNumber","MESSAGE_READ","lastMessage","equals","chatwootIsRead","markMessageAsRead","readMessages","updateMessage","chatwootConversationId","chatwootInboxId","chatwootContactInboxSourceId","updateMany","chatwootMessageIds","result","$executeRaw","isRead","updateMessageSourceID","getMessageByKeyId","keyId","$queryRaw","msg","inReplyTo","inReplyToExternalId","extendedTextMessage","contextInfo","stanzaId","messageContent","isMediaMessage","Object","keys","some","isInteractiveButtonMessage","interactiveMessage","nativeFlowMessage","buttons","getAdsMessage","title","externalAdReply","thumbnailUrl","sourceUrl","getReactionMessage","reactionMessage","getTypeMessage","imageMessage","videoMessage","messageContextInfo","stickerMessage","documentMessage","documentWithCaptionMessage","audioMessage","contactMessage","vcard","contactsArrayMessage","locationMessage","liveLocationMessage","listMessage","listResponseMessage","viewOnceMessageV2","getMessageContent","types","typeKey","filter","Boolean","latitude","degreesLatitude","longitude","degreesLongitude","locationName","locationAddress","address","vCardData","contactInfo","line","value","formattedContact","numberCount","displayName","listTitle","listDescription","description","listFooter","footerText","formattedList","sections","section","sectionIndex","row","rowIndex","rowId","responseTitle","responseDescription","responseRowId","singleSelectReply","selectedRowId","getConversationMessage","eventWhatsapp","ignoreJids","ignoreGroups","ignoreContacts","info","ephemeralMessage","originalMessage","bodyMessage","quotedId","not","isMedia","adsMessage","getConversation","downloadBase64","getBase64FromMediaMessage","nameFile","originalFilename","parsedFile","extension","mimetype","fileData","Buffer","from","base64","_read","participantName","rawPhoneNumber","formattedPhoneNumber","formatInternational","send","button","paymentSettings","buttonParamsJson","payment_settings","pixSettings","pix_static_code","pixKeyType","key_type","pixKey","merchant_name","imgBuffer","img","read","cover","w","h","processedBuffer","getBuffer","png","truncStr","__name","str","len","Events","MESSAGES_DELETE","MESSAGE_DELETE","editedMessageContent","editedMessage","trim","editedText","last_non_activity_message","inbox_identifier","msgStatus","timeSinceLastNotification","lastConnectionNotification","qrCode","count","msgConnection","clearAll","statusCode","erroQRcode","msgQrCode","pairingCode","normalizeJidIdentifier","startImportHistoryMessages","uri","addHistoryMessages","messagesRaw","addHistoryContacts","contactsRaw","importHistoryMessages","totalMessagesImported","updateContactAvatarInRecentConversations","Number","isInteger","limitContacts","recentContacts","getContactsOrderByRecentConversations","contactIdentifiers","contactsWithProfilePicture","findMany","in","profilePicUrl","acc","Map","syncLostMessages","chatwootConfig","prepareMessage","SAVE_DATA","MESSAGE_UPDATE","sqlMessages","ids","filteredMessages","Instance","gte","subtract","unix","AND","isIgnorePhoneNumber","m","_ChatwootService","BaseChatbotService","init_base_chatbot_service","__esmMin","init_wa_types","init_logger_config","waMonitor","prismaRepository","loggerName","configService","logger","Logger","isImageMessage","content","includes","isAudioMessage","isJSON","str","JSON","parse","getMediaType","url","extension","split","pop","toLowerCase","imageExtensions","audioExtensions","videoExtensions","documentExtensions","createNewSession","instance","data","type","pushNameValue","pushName","remoteJidValue","remoteJid","session","integrationSession","create","sessionId","status","awaitUser","botId","instanceId","error","process","bot","settings","msg","initNewSession","keywordFinish","normalizedContent","trim","length","update","where","id","sendMessageToBot","sendMessageWhatsApp","message","linkPreview","linkRegex","textBuffer","lastIndex","match","splitMessages","exec","fullMatch","altText","mediaType","beforeText","slice","index","sendFormattedText","audioWhatsapp","number","delay","delayMessage","audio","caption","mediaMessage","mediatype","media","fileName","undefined","remainingText","splitMessageByDoubleLineBreaks","filter","part","sendSingleMessage","timePerChar","Math","min","max","minDelay","maxDelay","debug","integration","Integration","WHATSAPP_BAILEYS","client","presenceSubscribe","sendPresenceUpdate","Promise","resolve","setTimeout","textMessage","text","messageParts","sessionResult","instanceName","getBotType","_BaseChatbotService","axios","isURL","DifyService","init_dify_service","__esmMin","init_wa_types","init_base_chatbot_service","BaseChatbotService","waMonitor","prismaRepository","configService","openaiService","getBotType","sendMessageToBot","instance","session","settings","dify","remoteJid","pushName","content","msg","endpoint","apiUrl","logger","error","processedContent","isAudioMessage","debug","transcription","speechToText","err","botType","payload","inputs","instanceName","serverUrl","get","URL","apiKey","token","query","response_mode","conversation_id","sessionId","undefined","user","isImageMessage","media","split","message","mediaUrl","base64","mediaBase64","result","responseType","Buffer","from","data","toString","files","type","transfer_method","url","integration","Integration","WHATSAPP_BAILEYS","client","presenceSubscribe","sendPresenceUpdate","response","post","headers","Authorization","answer","conversationId","sendMessageWhatsApp","integrationSession","update","where","id","status","awaitUser","events","replaceAll","filter","line","trim","eventString","startsWith","event","JSON","parse","console","log","_DifyService","axios","downloadMediaMessage","isURL","FormData","OpenAI","P","OpenaiService","init_openai_service","__esmMin","init_wa_types","init_sendTelemetry","init_base_chatbot_service","BaseChatbotService","waMonitor","prismaRepository","configService","client","getBotType","initClient","apiKey","process","instance","remoteJid","openaiBot","session","settings","content","pushName","msg","logger","log","botType","startsWith","creds","openaiCreds","findUnique","where","id","openaiCredsId","error","transcription","speechToText","sendMessageWhatsApp","keywordFinish","normalizedContent","toLowerCase","trim","length","keepOpen","integrationSession","update","data","status","delete","sendTelemetry","botId","createSession","createNewSession","instanceName","instanceId","initNewSession","awaitUser","sendMessageToBot","message","JSON","stringify","processAssistantMessage","processChatCompletionMessage","substring","response","fromMe","messageData","role","type","text","isImageMessage","media","split","mediaUrl","base64","mediaBase64","result","get","responseType","Buffer","from","toString","image_url","url","threadId","sessionId","beta","threads","create","messages","runAssistant","runs","assistant_id","assistantId","integration","Integration","WHATSAPP_BAILEYS","presenceSubscribe","sendPresenceUpdate","getAIResponse","functionUrl","responseText","messageContent","textContent","value","model","maxTokens","findFirst","conversationHistory","context","parse","history","systemMessages","assistantMessages","userMessages","messagesSystem","map","messagesAssistant","messagesUser","completions","chat","max_tokens","responseContent","choices","push","slice","runId","retrieve","maxRetries","checkInterval","Promise","resolve","setTimeout","required_action","toolCalls","submit_tool_outputs","tool_calls","toolOutputs","toolCall","payloadData","function","arguments","post","functionName","name","functionArguments","tool_call_id","output","submitToolOutputs","tool_outputs","list","includes","openaiSetting","audio","then","key","level","reuploadRequest","lang","formData","append","API_KEY_GLOBAL","headers","Authorization","_OpenaiService","getTypeMessage","getMessageContent","getConversationMessage","init_getConversationMessage","__esmMin","init_env_config","__name","msg","mediaId","configService","get","ENABLE","SAVE_VIDEO","message","videoMessage","undefined","viewOnceMessageV2","mediaUrl","key","id","types","conversation","extendedTextMessage","text","contactMessage","displayName","locationMessage","degreesLatitude","toString","imageMessage","url","audioMessage","listResponseMessage","title","responseRowId","singleSelectReply","selectedRowId","templateButtonReplyMessage","selectedId","buttonsResponseMessage","selectedButtonId","speechToText","caption","documentMessage","documentWithCaptionMessage","externalAdReplyBody","contextInfo","externalAdReply","body","messageType","Object","keys","find","typeKey","result","axios","TypebotService","init_typebot_service","__esmMin","init_wa_types","init_getConversationMessage","init_sendTelemetry","init_base_chatbot_service","BaseChatbotService","waMonitor","configService","prismaRepository","openaiService","getBotType","sendMessageToBot","instance","session","settings","bot","remoteJid","pushName","content","msg","processTypebot","url","expire","typebot","keywordFinish","delayMessage","unknownMessage","listeningFromMe","stopBotFromMe","keepOpen","processTypebotSimple","process","createNewSession","data","id","Math","floor","random","toString","version","get","API_VERSION","reqData","prefilledVariables","instanceName","name","serverUrl","URL","apiKey","API_KEY","KEY","ownerJid","number","startParams","publicId","request","post","sessionId","integrationSession","create","status","parameters","awaitUser","botId","type","Instance","connect","typebotData","waInstances","sendDataWebhook","Events","TYPEBOT_CHANGE_STATUS","error","logger","sendWAMessage","instanceDb","messages","input","clientSideActions","waInstance","processMessages","applyFormatting","bind","catch","err","console","element","text","children","child","trim","split","map","line","index","join","formats","bold","italic","underline","formattedText","reverse","findItemAndGetSecondsToWait","__name","array","targetId","item","lastBubbleBlockId","wait","secondsToWaitFor","message","richText","replace","includes","processListMessage","processButtonMessage","sendMessageWhatsApp","sendTelemetry","mediaMessage","delay","mediatype","media","audioWhatsapp","encoding","audio","Promise","resolve","setTimeout","items","update","where","statusChange","deleteMany","listJson","title","description","buttonText","footerText","sections","titleMatch","match","descriptionMatch","buttonTextMatch","footerTextMatch","menuContent","forEach","section","sectionTitle","rows","sectionData","row","rowId","push","listMessage","buttonJson","thumbnailUrl","undefined","footer","buttons","thumbnailUrlMatch","footerMatch","buttonTypes","reply","pix","copy","call","pattern","Object","entries","exec","button","currency","keyType","key","displayText","copyCode","phoneNumber","keys","length","buttonMessage","findTypebot","findFirst","now","Date","sessionUpdatedAt","updatedAt","getTime","diff","enabled","getConversationMessage","toLowerCase","urlTypebot","isAudioMessage","debug","transcription","speechToText","_TypebotService","formatMXOrARNumber","jid","countryCode","substring","Number","length","formatBRNumber","regexp","RegExp","test","match","exec","joker","parseInt","ddd","createJid","number","replace","includes","split","init_createJid","__esmMin","Prisma","isArray","v4","ChannelStartupService","init_channel_service","__esmMin","init_chatwoot_service","init_dify_service","init_openai_service","init_typebot_service","init_server_module","init_wa_types","init_logger_config","init_exceptions","init_createJid","configService","eventEmitter","prismaRepository","chatwootCache","logger","Logger","client","instance","localChatwoot","localProxy","localSettings","localWebhook","chatwootService","ChatwootService","waMonitor","openaiService","OpenaiService","typebotService","TypebotService","difyService","DifyService","setInstance","instanceName","name","id","instanceId","integration","number","token","businessId","ownerJid","get","ENABLED","enabled","eventWhatsapp","Events","STATUS_INSTANCE","status","wuid","loadWebhook","data","webhook","findUnique","where","webhookBase64","loadSettings","setting","rejectCall","msgCall","groupsIgnore","alwaysOnline","readMessages","readStatus","syncFullHistory","wavoipToken","setSettings","upsert","update","create","length","ws","close","connect","findSettings","loadChatwoot","chatwoot","accountId","url","nameInbox","signMsg","signDelimiter","reopenConversation","conversationPending","mergeBrazilContacts","importContacts","importMessages","daysLimitImportMessages","setChatwoot","organization","logo","ignoreJids","Object","assign","clearCacheChatwoot","findChatwoot","ignoreJidsArray","Array","map","event","String","getCache","deleteAll","loadProxy","proxyConfig","HOST","host","port","PORT","protocol","PROTOCOL","username","USERNAME","password","PASSWORD","proxy","setProxy","findProxy","NotFoundException","sendDataWebhook","local","extra","serverUrl","URL","tzoffset","Date","getTimezoneOffset","now","toISOString","expose","EXPOSE_IN_FETCH_INSTANCES","instanceApikey","eventManager","emit","origin","dateTime","sender","apiKey","formatMXOrARNumber","jid","countryCode","substring","Number","formatBRNumber","regexp","RegExp","test","match","exec","joker","parseInt","ddd","fetchContacts","query","remoteJid","includes","createJid","pushName","contactFindManyArgs","offset","take","page","validPage","Math","max","skip","contact","findMany","isGroup","endsWith","isSaved","profilePicUrl","type","cleanMessageData","message","cleanedMessage","mediaUrl","base64","imageMessage","caption","videoMessage","audioMessage","seconds","stickerMessage","documentMessage","documentWithCaptionMessage","fetchMessages","keyFilters","key","timestampFilter","messageTimestamp","gte","floor","getTime","lte","count","source","messageType","AND","path","equals","fromMe","participants","messages","orderBy","select","contextInfo","MessageUpdate","total","pages","ceil","currentPage","records","fetchStatusMessage","messageUpdate","keyId","findChatByRemoteJid","chat","findFirst","fetchChats","sql","limit","results","$queryRaw","lastMessage","lastMessageId","lastMessage_key","lastMessagePushName","participant","lastMessageParticipant","lastMessageMessageType","lastMessageMessage","lastMessageContextInfo","lastMessageSource","lastMessageMessageTimestamp","lastMessageInstanceId","sessionId","lastMessageSessionId","lastMessageStatus","undefined","contactId","updatedAt","windowStart","windowExpires","windowActive","unreadCount","unreadMessages","hasValidMediaContent","msg","keys","prototype","hasOwnProperty","call","some","_ChannelStartupService","axios","isBase64","isURL","FormData","mimeTypes","join","v4","EvolutionStartupService","init_evolution_channel_service","__esmMin","init_minio_server","init_server_module","init_channel_service","init_wa_types","init_exceptions","init_createJid","init_sendTelemetry","ChannelStartupService","configService","eventEmitter","prismaRepository","cache","chatwootCache","client","stateConnection","state","phoneNumber","mobile","connectionStatus","closeClient","qrCode","pairingCode","instance","qrcode","code","base64","count","logoutInstance","setInstance","logger","instanceId","name","instanceName","id","integration","number","token","businessId","get","ENABLED","localChatwoot","enabled","chatwootService","eventWhatsapp","Events","STATUS_INSTANCE","status","profilePicture","wuid","createJid","profilePictureUrl","getProfileName","getProfileStatus","connectToWhatsapp","data","loadChatwoot","eventHandler","error","InternalServerErrorException","toString","received","messageRaw","message","key","remoteJid","fromMe","profilePicUrl","pushName","messageType","messageTimestamp","Math","round","Date","getTime","source","isAudio","audioMessage","openAiDefaultSettings","openaiSetting","findFirst","where","include","OpenaiCreds","openaiCredsId","speechToText","openaiService","log","sendTelemetry","sendDataWebhook","MESSAGES_UPSERT","chatbotController","emit","msg","chatwootSentMessage","chatwootMessageId","chatwootInboxId","chatwootConversationId","create","updateContact","contactRaw","contact","updateMany","CONTACTS_UPSERT","CONTACTS_UPDATE","chat","chatRaw","CHATS_UPDATE","CHATS_UPSERT","sendMessageWithTyping","options","file","isIntegration","quoted","webhookUrl","delay","Promise","resolve","setTimeout","audioFile","messageId","mediaType","media","mediaUrl","buffer","Buffer","from","mimetype","originalname","buttonMessage","buttons","footer","body","listMessage","contextInfo","stanzaId","findMessage","quotedMessage","ENABLE","hasValidMediaContent","warn","fileBuffer","fileName","split","size","byteLength","fullName","uploadFile","getObjectUrl","stack","SEND_MESSAGE","BadRequestException","textMessage","conversation","text","presence","linkPreview","mentionsEveryOne","mentioned","prepareMediaMessage","mediaMessage","mediatype","arrayMatch","RegExp","exec","prepareMedia","caption","gifPlayback","lookup","mediaData","processAudio","audio","replace","hash","audioConverterConfig","API_URL","verbose","formData","append","filename","contentType","response","post","headers","getHeaders","apikey","API_KEY","audioWhatsapp","console","Error","title","description","locationMessage","templateMessage","contactMessage","reactionMessage","getBase64FromMediaMessage","deleteMessage","mediaSticker","pollMessage","statusMessage","reloadConnection","whatsappNumber","markMessageAsRead","archiveChat","markChatUnread","fetchProfile","offerCall","sendPresence","setPresence","fetchPrivacySettings","updatePrivacySettings","fetchBusinessProfile","updateProfileName","updateProfileStatus","updateProfilePicture","removeProfilePicture","blockUser","updateMessage","createGroup","updateGroupPicture","updateGroupSubject","updateGroupDescription","findGroup","fetchAllGroups","inviteCode","inviteInfo","sendInvite","acceptInviteCode","revokeInviteCode","findParticipants","updateGParticipant","updateGSetting","toggleEphemeral","leaveGroup","fetchLabels","handleLabel","receiveMobileCode","fakeCall","_EvolutionStartupService","status","init_renderStatus","__esmMin","axios","arrayUnique","isURL","FormData","mimeTypes","join","BusinessStartupService","init_whatsapp_business_service","__esmMin","init_minio_server","init_server_module","init_channel_service","init_wa_types","init_exceptions","init_createJid","init_renderStatus","init_sendTelemetry","ChannelStartupService","configService","eventEmitter","prismaRepository","cache","chatwootCache","baileysCache","providerFiles","stateConnection","state","phoneNumber","mobile","connectionStatus","closeClient","qrCode","pairingCode","instance","qrcode","code","base64","count","logoutInstance","isMediaMessage","message","document","image","audio","video","post","params","urlServer","get","URL","version","VERSION","number","headers","Authorization","token","data","e","response","error","profilePicture","wuid","createJid","profilePictureUrl","getProfileName","getProfileStatus","setWhatsappBusinessProfile","content","messaging_product","about","address","description","vertical","email","websites","profile_picture_handle","profilehandle","connectToWhatsapp","entry","changes","value","loadChatwoot","eventHandler","messages","from","statuses","recipient_id","logger","InternalServerErrorException","toString","downloadMediaMessage","id","type","result","url","responseType","messageMediaJson","received","context","contextInfo","stanzaId","messageAudioJson","audioMessage","ptt","voice","messageInteractiveJson","conversation","interactive","title","messageButtonJson","button","text","messageReactionJson","reactionMessage","key","reaction","message_id","emoji","messageTextJson","length","metadata","phone_number_id","extendedTextMessage","body","stickerMessage","locationMessage","degreesLatitude","location","latitude","degreesLongitude","longitude","name","log","messageLocationJson","messageContactsJson","vcard","__name","contact","formatted_name","org","company","emails","urls","phones","wa_id","phone","contacts","contactMessage","displayName","contactsArrayMessage","map","renderMessageType","messageType","messageHandle","database","settings","messageRaw","pushName","profile","remoteJid","fromMe","sticker","messageTimestamp","parseInt","timestamp","source","instanceId","messageContent","ENABLE","hasValidMediaContent","warn","buffer","mediaType","SAVE_VIDEO","info","success","mimetype","mime_type","contentDisposition","fileName","split","match","includes","size","byteLength","fullName","uploadFile","createdMessage","create","media","messageId","mediaUrl","getObjectUrl","localWebhook","enabled","webhookBase64","ENABLED","openAiDefaultSettings","openaiSetting","findFirst","where","include","OpenaiCreds","openaiCredsId","speechToText","openaiService","speechError","stack","openAiBase64","localSettings","readMessages","sendTelemetry","sendDataWebhook","Events","MESSAGES_UPSERT","chatbotController","emit","instanceName","msg","localChatwoot","chatwootSentMessage","chatwootService","eventWhatsapp","chatwootMessageId","chatwootInboxId","chatwootConversationId","contactRaw","CONTACTS_UPDATE","updateMany","CONTACTS_UPSERT","item","groups_ignore","findMessage","path","equals","status","undefined","MESSAGES_DELETE","keyId","participant","messageUpdate","toUpperCase","MESSAGES_UPDATE","webhookUrl","convertMessageToRaw","convertMessage","imageMessage","videoMessage","documentMessage","JSON","stringify","findSettings","sendMessageWithTyping","options","isIntegration","quoted","messageSent","recipient_type","to","replace","preview_url","Boolean","linkPreview","isImage","startsWith","filename","caption","action","buttons","formattedText","reply","header","footer","sections","section","row","rows","template","language","components","error_data","Math","round","Date","getTime","SEND_MESSAGE","BadRequestException","textMessage","delay","presence","mentionsEveryOne","mentioned","getIdMedia","mediaMessage","isFile","formData","Buffer","append","contentType","originalname","prepareMediaMessage","mediatype","arrayMatch","RegExp","exec","prepareMedia","gifPlayback","lookup","file","mediaData","processAudio","hash","audioConverterConfig","API_URL","verbose","getHeaders","apikey","API_KEY","audioConverter","audioWhatsapp","buttonMessage","embeddedMedia","btnItems","btn","displayText","ids","mediaKey","listMessage","sectionsItems","list","sendData","footerText","buttonText","substring","rowId","templateMessage","organization","first_name","getBase64FromMediaMessage","fileLength","height","width","deleteMessage","mediaSticker","pollMessage","statusMessage","reloadConnection","whatsappNumber","markMessageAsRead","archiveChat","markChatUnread","fetchProfile","offerCall","sendPresence","setPresence","fetchPrivacySettings","updatePrivacySettings","fetchBusinessProfile","updateProfileName","updateProfileStatus","updateProfilePicture","removeProfilePicture","blockUser","updateMessage","createGroup","updateGroupPicture","updateGroupSubject","updateGroupDescription","findGroup","fetchAllGroups","inviteCode","inviteInfo","sendInvite","acceptInviteCode","revokeInviteCode","findParticipants","updateGParticipant","updateGSetting","toggleEphemeral","leaveGroup","fetchLabels","handleLabel","receiveMobileCode","fakeCall","_BusinessStartupService","OnWhatsAppDto","getBase64FromMediaMessageDto","WhatsAppNumberDto","NumberDto","ProfileNameDto","ProfileStatusDto","ProfilePictureDto","ReadMessageDto","ArchiveChatDto","MarkChatUnreadDto","PrivacySettingDto","DeleteMessage","_a","OptionsMessage","Metadata","SendPresenceDto","UpdateMessageDto","BlockUserDto","init_chat_dto","__esmMin","jid","exists","number","name","lid","_OnWhatsAppDto","message","convertToMp4","_getBase64FromMediaMessageDto","numbers","_WhatsAppNumberDto","_NumberDto","_ProfileNameDto","status","_ProfileStatusDto","picture","_ProfilePictureDto","readMessages","_ReadMessageDto","lastMessage","chat","archive","_ArchiveChatDto","_MarkChatUnreadDto","readreceipts","profile","online","last","groupadd","_PrivacySettingDto","id","fromMe","remoteJid","participant","_DeleteMessage","options","_Metadata","presence","delay","_SendPresenceDto","key","text","_UpdateMessageDto","_BlockUserDto","BufferJSON","CacheService","init_cache_service","__esmMin","init_logger_config","cache","logger","Logger","verbose","name","get","key","hGet","field","data","JSON","parse","reviver","error","set","value","ttl","hSet","json","stringify","replacer","has","delete","hDelete","deleteAll","appendCriteria","keys","_CacheService","axios","fetchLatestBaileysVersion","fetchLatestWaWebVersion","init_fetchLatestWaWebVersion","__esmMin","__name","options","data","get","responseType","regex","match","version","isLatest","error","message","dayjs","getAvailableNumbers","remoteJid","numbersAvailable","startsWith","slice","number","domain","split","numberWithDigit","length","numberWithoutDigit","push","prefix","map","normalizeJid","jid","saveOnWhatsappCache","data","configService","get","SAVE_DATA","IS_ON_WHATSAPP","processingPromises","item","logger","warn","altJidNormalized","remoteJidAlt","lidAltJid","includes","baseJids","expandedJids","flatMap","existingRecord","prismaRepository","isOnWhatsapp","findFirst","where","OR","jidOptions","contains","verbose","join","finalJidOptions","Set","add","forEach","newJidOptionsString","sort","newLid","lid","dataPayload","existingJidOptionsString","update","id","create","e","error","Promise","allSettled","getOnWhatsappCache","remoteJids","results","remoteJidsWithoutPlus","flat","findMany","updatedAt","gte","subtract","IS_ON_WHATSAPP_DAYS","toDate","init_onWhatsappCache","__esmMin","init_server_module","init_env_config","init_logger_config","Logger","join","ROOT_DIR","INSTANCE_DIR","SRC_DIR","AUTH_DIR","STORE_DIR","init_path_config","__esmMin","process","cwd","BufferJSON","initAuthCreds","WAProto","proto","fs","path","keyExists","sessionId","prismaRepository","session","findUnique","where","saveKey","keyJson","exists","create","data","creds","JSON","stringify","update","getAuthKey","auth","parse","deleteAuthKey","delete","fileExists","file","stat","isFile","useMultiFileAuthStatePrisma","cache","localFolder","join","INSTANCE_DIR","localFile","__name","key","fixFileName","mkdir","recursive","writeData","dataString","replacer","cacheConfig","configService","get","REDIS","ENABLED","hSet","writeFile","readData","rawData","hGet","readFile","encoding","reviver","removeData","hDelete","unlink","removeCreds","logger","info","action","err","warn","state","keys","type","ids","Promise","all","map","id","value","Message","AppStateSyncKeyData","set","tasks","category","push","saveCreds","init_use_multi_file_auth_state_prisma","__esmMin","init_server_module","init_env_config","init_logger_config","init_path_config","replace","Logger","BufferJSON","initAuthCreds","proto","isNotEmpty","AuthStateProvider","logger","init_use_multi_file_auth_state_provider_files","__esmMin","init_logger_config","providerFiles","Logger","authStateProvider","instance","error","create","message","stack","writeData","__name","data","key","json","JSON","stringify","replacer","response","write","readData","read","parse","reviver","removeData","delete","removeCreds","removeSession","info","action","creds","state","keys","get","type","ids","Promise","all","map","id","value","Message","AppStateSyncKeyData","set","tasks","category","push","saveCreds","_AuthStateProvider","initAuthCreds","proto","useMultiFileAuthStateRedisDb","instanceName","cache","logger","Logger","writeData","__name","data","key","hSet","error","localError","readData","hGet","removeData","hDelete","removeCreds","warn","action","delete","creds","state","keys","get","type","ids","Promise","all","map","id","value","Message","AppStateSyncKeyData","create","set","tasks","category","push","saveCreds","init_use_multi_file_auth_state_redis_db","__esmMin","init_logger_config","catchError","concatMap","delay","EMPTY","from","retryWhen","Subject","take","tap","BaileysMessageProcessor","init_baileysMessage_processor","__esmMin","init_logger_config","processorLogs","Logger","subscription","messageSubject","mount","onMessageReceive","closed","unsubscribe","warn","pipe","messages","log","length","type","requestId","settings","errors","error","message","subscribe","__name","processMessage","payload","next","onDestroy","complete","_BaileysMessageProcessor","io","baileys_connection_state","useVoiceCallsBaileys","init_useVoiceCallsBaileys","__esmMin","__name","wavoip_token","baileys_sock","status","logger","socket","transports","path","on","console","log","id","emit","authState","creds","me","account","error","active","message","jid","callback","response","onWhatsApp","type","timeoutMs","profilePictureUrl","jids","force","assertSessions","extraAttrs","createParticipantNodes","useCache","ignoreZeroDevices","getUSyncDevices","generateMessageTag","stanza","JSON","stringify","sendNode","ciphertext","signalRepository","decryptMessage","ev","update","connection","timeout","qr","ws","packet","volatile","ffmpegPath","createId","cuid","axios","makeWASocket","BufferJSON","decryptPollVote","delay","DisconnectReason","downloadContentFromMessage","downloadMediaMessage","generateWAMessageFromContent","getAggregateVotesInPollMessage","getContentType","getDevice","isJidBroadcast","isJidGroup","isJidNewsletter","isPnUser","jidNormalizedUser","makeCacheableSignalKeyStore","prepareWAMessageMedia","proto","spawn","isArray","isBase64","isURL","createHash","ffmpeg","FormData","Long","mimeTypes","NodeCache","cron","release","join","P","qrcode","qrcodeTerminal","sharp","PassThrough","Readable","v4","getVideoDuration","input","MediaInfoFactory","default","mediainfo","format","fileSize","readChunk","Buffer","isBuffer","length","__name","size","offset","slice","fs","promises","stat","fd","open","buffer","alloc","read","result","analyzeData","duration","JSON","parse","media","track","find","t","Duration","Math","round","parseFloat","close","chunks","chunk","push","data","concat","Error","groupMetadataCache","BaileysStartupService","init_whatsapp_baileys_service","__esmMin","init_chat_dto","init_chatwoot_import_helper","init_minio_server","init_server_module","init_cache_service","init_channel_service","init_wa_types","init_cacheengine","init_env_config","init_exceptions","init_createJid","init_fetchLatestWaWebVersion","init_makeProxyAgent","init_onWhatsappCache","init_renderStatus","init_sendTelemetry","init_use_multi_file_auth_state_prisma","init_use_multi_file_auth_state_provider_files","init_use_multi_file_auth_state_redis_db","init_baileysMessage_processor","init_useVoiceCallsBaileys","CacheService","CacheEngine","configService","getEngine","ChannelStartupService","eventEmitter","prismaRepository","cache","chatwootCache","baileysCache","providerFiles","messageProcessor","BaileysMessageProcessor","authStateProvider","msgRetryCounterCache","userDevicesCache","stdTTL","useClones","endSession","logBaileys","eventProcessingQueue","Promise","resolve","MESSAGE_CACHE_TTL_SECONDS","UPDATE_CACHE_TTL_SECONDS","stateConnection","state","phoneNumber","chatHandle","chats","existingChatIds","chat","findMany","where","instanceId","select","remoteJid","existingChatIdSet","Set","map","chatsToInsert","filter","has","id","name","unreadMessages","unreadCount","undefined","sendDataWebhook","Events","CHATS_UPSERT","get","SAVE_DATA","CHATS","createMany","skipDuplicates","chatsRaw","CHATS_UPDATE","updateMany","forEach","deleteMany","CHATS_DELETE","contactHandle","contacts","contactsRaw","contact","pushName","verifiedName","split","profilePicUrl","CONTACTS_UPSERT","CONTACTS","usersContacts","c","includes","saveOnWhatsappCache","ENABLED","localChatwoot","enabled","importContacts","chatwootService","addHistoryContacts","instanceName","instance","chatwootImport","importHistoryContacts","updatedContacts","all","profilePicture","profilePictureUrl","CONTACTS_UPDATE","findParticipant","findContact","updateContact","avatar_url","error","console","logger","message","debug","stringify","updateTransactions","upsert","remoteJid_instanceId","create","update","$transaction","messageHandle","messages","isLatest","progress","syncType","HistorySync","HistorySyncType","ON_DEMAND","log","timestampLimitToImport","daysLimitToImport","daysLimitImportMessages","date","Date","setDate","getDate","getTime","max","messageTimestamp","contactsMap","Map","notify","set","jid","chatsRepository","CHATS_SET","HISTORIC","messagesRaw","messagesRepository","getRepositoryMessagesCache","key","setRepositoryMessagesCache","m","isLong","toNumber","fromMe","participantJid","participant","prepareMessage","MESSAGES_SET","importMessages","addHistoryMessages","msg","isIgnorePhoneNumber","type","requestId","settings","received","messageStubParameters","some","param","err","warn","conversation","extendedTextMessage","text","messageId","client","requestPlaceholderResend","fetchMessageHistory","editedMessage","protocolMessage","eventWhatsapp","MESSAGES_EDITED","oldMessage","getMessage","editedMessageTimestamp","floor","status","messageUpdate","keyId","groupsIgnore","existingChat","findFirst","trim","messageRaw","messageType","pollCreationKey","pollUpdateMessage","pollCreationMessageKey","pollMessage","pollMessageSecret","pollOptions","pollCreationMessage","options","pollCreationMessageV3","pollVote","vote","voterJid","wuid","pollEncKey","messageContextInfo","messageSecret","successfulVoterJid","from","Array","toString","encPayload","creatorCandidates","user","lid","participantAlt","voterCandidates","remoteJidAlt","uniqueCreators","Boolean","uniqueVoters","decryptedVote","creator","voter","pollCreatorJid","pollMsgId","Object","assign","selectedOptions","selectedOptionNames","option","hash","optionName","digest","selected","compare","pollUpdates","voters","isMedia","imageMessage","videoMessage","stickerMessage","documentMessage","documentWithCaptionMessage","ptvMessage","audioMessage","isVideo","localSettings","readMessages","readStatus","chatwootSentMessage","MESSAGES_UPSERT","chatwootMessageId","chatwootInboxId","inbox_id","chatwootConversationId","conversation_id","openAiDefaultSettings","openaiSetting","include","OpenaiCreds","openaiCredsId","speechToText","openaiService","NEW_MESSAGE","messageData","timestamp","messageKey","info","updateMessagesReadedByTimestamp","updateChatUnreadMessages","ENABLE","SAVE_VIDEO","hasValidMediaContent","getBase64FromMediaMessage","verbose","mediaType","fileName","mimetype","lookup","fullName","now","uploadFile","fileLength","low","mediaUrl","getObjectUrl","stack","localWebhook","webhookBase64","level","reuploadRequest","updateMediaMessage","base64","sendTelemetry","chatbotController","emit","contactRaw","addressingMode","args","readChatToUpdate","updateKey","cached","secondsSinceEpoch","pollCreation","findMessage","configDatabaseData","protocolMapKey","originalMessageId","searchId","$queryRaw","MESSAGES_DELETE","MESSAGE_UPDATE","MESSAGES_UPDATE","_msg","chatToInsert","keys","groupHandler","groupMetadata","GROUPS_UPSERT","groupMetadataUpdate","GROUPS_UPDATE","group","updateGroupMetadataCache","participantsUpdate","normalizePhoneNumber","String","groupParticipants","findParticipants","groupJid","participants","resolvedParticipants","participantId","participantData","p","imgUrl","enhancedParticipantsUpdate","participantsData","GROUP_PARTICIPANTS_UPDATE","labelHandle","LABELS_EDIT","label","savedLabel","l","labelId","deleted","delete","labelId_instanceId","labelName","replace","color","LABELS","labelData","predefinedId","LABELS_ASSOCIATION","database","association","chatId","addLabel","removeLabel","mapType","mapKeyType","getGroupMetadataCache","cacheConf","REDIS","URI","LOCAL","meta","findGroup","count","mount","onMessageReceive","bind","AuthStateProvider","BAILEYS","connectionStatus","logoutInstance","onDestroy","logout","ws","db","removeCreds","SAVE_INSTANCES","useMultiFileAuthStateRedisDb","INSTANCE","useMultiFileAuthStatePrisma","session","sessionId","getProfileName","profileName","findUnique","creds","reviver","me","getProfileStatus","fetchStatus","qrCode","pairingCode","code","connectionUpdate","qr","connection","lastDisconnect","LIMIT","QRCODE_UPDATED","statusCode","badSession","CONNECTION_UPDATE","statusReason","connectionClosed","optsQrcode","margin","scale","errorCorrectionLevel","light","dark","COLOR","requestPairingCode","toDataURL","generate","small","output","loggedOut","forbidden","connectToWhatsapp","STATUS_INSTANCE","disconnectionAt","disconnectionReasonCode","disconnectionObject","end","profilePic","formattedWuid","padEnd","formattedName","ownerJid","syncChatwootLostMessages","full","webMessageInfo","messageSecretBase64","defineAuthState","createClient","number","authState","browserOptions","browser","CLIENT","NAME","version","fetchLatestWaWebVersion","localProxy","host","proxyUrls","rand","random","proxyUrl","agent","makeProxyAgent","fetchAgent","makeProxyAgentUndici","port","protocol","username","password","socketConfig","printQRInTerminal","auth","generateHighQualityLinkPreview","markOnlineOnConnect","alwaysOnline","retryRequestDelayMs","maxMsgRetryCount","fireInitQueries","connectTimeoutMs","keepAliveIntervalMs","qrTimeout","emitOwnEvents","shouldIgnoreJid","syncFullHistory","isGroupJid","isBroadcast","isNewsletter","shouldSyncHistoryMessage","historySyncNotification","cachedGroupMetadata","transactionOpts","maxCommitRetries","delayBetweenTriesMs","patchMessageBeforeSending","deviceSentMessage","listMessage","listType","Message","ListMessage","ListType","PRODUCT_LIST","SINGLE_SELECT","wavoipToken","useVoiceCallsBaileys","eventHandler","on","packet","payload","event","CALL","loadChatwoot","loadSettings","loadWebhook","loadProxy","InternalServerErrorException","reloadConnection","ev","process","events","then","findSettings","call","rejectCall","msgCall","endsWith","signalRepository","lidMapping","getPNForLID","sendMessage","saveCreds","remotesJidMap","receipt","readTimestamp","PRESENCE_UPDATE","isSyncNotificationFromUsedSyncType","chunkOrder","startImportHistoryMessages","setTimeout","importHistoryMessages","createJid","getStatus","fetchProfile","onWhatsapp","whatsappNumber","numbers","shift","exists","BadRequestException","picture","business","fetchBusinessProfile","numberExists","isBusiness","email","description","website","instanceNames","waMonitor","instanceInfo","os","offerCall","callDuration","sender","mentions","linkPreview","quoted","ephemeralExpiration","contextInfo","toLowerCase","useCachedGroupMetadata","userJid","relayMessage","value","entries","react","forward","jidList","allContacts","not","statusJidList","batchSize","batches","ceil","_","i","msgId","firstMessage","firstBatch","content","backgroundColor","font","allSettled","batch","sendMessageWithTyping","isIntegration","isWA","remainingDelay","presenceSubscribe","sendPresenceUpdate","presence","messageSent","NotFoundException","mentionsEveryOne","mentioned","mention","ephemeralDuration","mentionedJid","groupMentions","ephemeralSettingTimestamp","high","unsigned","disappearingMode","initiator","SEND_MESSAGE","sendPresence","setPresence","textMessage","poll","selectableCount","values","formatStatusMessage","image","url","caption","video","convert","processAudioMp4","audio","ptt","statusMessage","file","mediaData","prepareMediaMessage","mediaMessage","mediatype","mediaInput","imageBuffer","config","responseType","httpsAgent","response","jpeg","toBuffer","prepareMedia","upload","waUploadToServer","arrayMatch","RegExp","exec","headers","mediaBuffer","seconds","gifPlayback","convertToWebP","base64Data","parsedURL","URL","searchParams","isAnimated","animated","webp","quality","isAnimatedWebp","indexOf","lowerCaseImage","mediaSticker","sticker","notConvertSticker","inputStream","audioBuffer","reject","ffmpegProcess","path","outputChunks","stderrData","stdout","stderr","outputBuffer","pipe","stdin","processAudio","audioConverterConfig","API_URL","formData","append","post","getHeaders","apikey","API_KEY","inputAudioStream","isLpcm","test","outputAudioStream","setFfmpegPath","command","inputFormat","inputOptions","outputFormat","noVideo","audioCodec","addOutputOptions","audioBitrate","audioFrequency","audioChannels","outputOptions","audioWhatsapp","encoding","generateRandomId","characters","charAt","toJSONString","button","obj","display_text","displayText","phone_number","reply","copy","copy_code","copyCode","merchant_url","pix","currency","total_amount","reference_id","order","subtotal","order_type","items","amount","quantity","sale_amount","payment_settings","pix_static_code","merchant_name","key_type","keyType","share_payment_status","buttonMessage","buttons","hasReplyButtons","btn","hasPixButton","hasOtherButtons","viewOnceMessage","interactiveMessage","nativeFlowMessage","buttonParamsJson","messageParamsJson","templateId","thumbnailUrl","body","title","footer","header","hasMediaAttachment","locationMessage","degreesLatitude","latitude","degreesLongitude","longitude","address","buttonText","footerText","sections","contactMessage","vcard","organization","displayName","contactsArrayMessage","reactionMessage","reaction","jids","groups","broadcast","users","OnWhatsAppDto","subject","in","numbersToVerify","cachedNumbers","getOnWhatsappCache","cachedJids","flatMap","jidOptions","numbersNotInCache","verify","normalNumbersNotInCache","onWhatsApp","verifiedUsers","numberVerified","startsWith","numberWithDigit","numberWithoutDigit","v","prefix","numberJid","numbersToCache","markMessageAsRead","getLastMessage","orderBy","take","lastMessage","pop","archiveChat","last_message","chatModify","archive","lastMessages","archived","markChatUnread","markRead","markedChatUnread","deleteMessage","del","isLogicalDeleted","DELETE_DATA","LOGICAL_MESSAGE_DELETE","equals","existingKey","source","mapMediaType","getBuffer","convertToMp4","subtype","MessageSubtype","templateMessage","template","hydratedTemplate","hydratedFourRowTemplate","TypeMediaMessage","staticUrl","mediaKey","Uint8Array","directPath","fallbackErr","typeMessage","ext","extension","height","width","fetchPrivacySettings","privacy","readreceipts","profile","online","last","groupadd","updatePrivacySettings","updateReadReceiptsPrivacy","updateProfilePicturePrivacy","updateStatusPrivacy","updateOnlinePrivacy","updateLastSeenPrivacy","updateGroupsAddPrivacy","getBusinessProfile","updateProfileName","updateProfileStatus","updateProfilePicture","pic","removeProfilePicture","blockUser","updateBlockStatus","block","formatUpdateMessage","updateMessage","edit","SEND_MESSAGE_UPDATE","valueOf","fetchLabels","handleLabel","whatsappContact","action","addChatLabel","add","removeChatLabel","remove","createGroup","groupCreate","groupUpdateDescription","promoteParticipants","updateGParticipant","updateGroupPicture","updateGroupSubject","groupUpdateSubject","updateGroupDescription","subjectOwner","subjectTime","pictureUrl","creation","owner","desc","descId","restrict","announce","isCommunity","isCommunityAnnounce","linkedParent","fetchAllGroups","getParticipants","fetch","groupFetchAllParticipating","inviteCode","groupInviteCode","inviteUrl","inviteInfo","groupGetInviteInfo","sendInvite","send","acceptInviteCode","accepted","groupAcceptInvite","revokeInviteCode","revoked","groupRevokeInvite","parsedParticipants","updateParticipants","groupParticipantsUpdate","updateGSetting","updateSetting","groupSettingUpdate","toggleEphemeral","groupToggleEphemeral","expiration","success","leaveGroup","groupLeave","leave","deserializeMessageBuffers","every","isNaN","Number","sort","a","b","item","converted","prototype","hasOwnProperty","contentType","contentMsg","quotedMessage","chatwootConfig","findChatwoot","prepare","syncLostMessages","cronId","cronKey","getCache","hSet","task","schedule","storedId","hGet","stop","start","$executeRaw","$executeRawUnsafe","baileysOnWhatsapp","baileysProfilePictureUrl","timeoutMs","baileysAssertSessions","assertSessions","baileysCreateParticipantNodes","extraAttrs","createParticipantNodes","nodes","node","baileysSendNode","stanza","sendNode","baileysGetUSyncDevices","useCache","ignoreZeroDevices","getUSyncDevices","baileysGenerateMessageTag","generateMessageTag","baileysSignalRepositoryDecryptMessage","ciphertext","ciphertextBuffer","decryptMessage","baileysGetAuthState","account","fetchCatalog","limit","cursor","catalog","getCatalog","nextPageCursor","nextPageCursorJson","atob","pagination","pagination_cursor","fetcherHasMore","fetcher_has_more","productsCatalog","products","countLoops","catalogLength","fetchCollections","collections","getCollections","collectionsLength","fetchMessages","query","keyFilters","timestampFilter","gte","lte","AND","OR","page","formattedMessages","skip","MessageUpdate","total","pages","currentPage","records","_BaileysStartupService","ChannelController","init_channel_controller","__esmMin","init_wa_types","init_exceptions","init_evolution_channel_service","init_whatsapp_business_service","init_whatsapp_baileys_service","prismaRepository","waMonitor","prisma","monitor","init","instanceData","data","token","integration","Integration","WHATSAPP_BUSINESS","BadRequestException","BusinessStartupService","configService","eventEmitter","cache","chatwootCache","baileysCache","providerFiles","EVOLUTION","EvolutionStartupService","WHATSAPP_BAILEYS","BaileysStartupService","_ChannelController","EvolutionController","init_evolution_controller","__esmMin","init_logger_config","init_channel_controller","ChannelController","prismaRepository","waMonitor","logger","Logger","integrationEnabled","receiveWebhook","data","numberId","error","instance","findFirst","where","number","waInstances","name","connectToWhatsapp","status","_EvolutionController","axios","MetaController","init_meta_controller","__esmMin","init_logger_config","init_channel_controller","ChannelController","prismaRepository","waMonitor","logger","Logger","integrationEnabled","receiveWebhook","data","object","entry","changes","field","template","findFirst","where","templateId","value","message_template_id","console","log","webhookUrl","post","headers","forEach","numberId","metadata","phone_number_id","error","status","instance","number","waInstances","name","connectToWhatsapp","_MetaController","BaileysController","init_baileys_controller","__esmMin","waMonitor","onWhatsapp","instanceName","body","waInstances","baileysOnWhatsapp","jid","profilePictureUrl","baileysProfilePictureUrl","type","timeoutMs","assertSessions","baileysAssertSessions","jids","force","createParticipantNodes","baileysCreateParticipantNodes","message","extraAttrs","getUSyncDevices","baileysGetUSyncDevices","useCache","ignoreZeroDevices","generateMessageTag","baileysGenerateMessageTag","sendNode","baileysSendNode","stanza","signalRepositoryDecryptMessage","baileysSignalRepositoryDecryptMessage","ciphertext","getAuthState","baileysGetAuthState","_BaileysController","normalizeString","str","normalize","replace","toLowerCase","advancedOperatorsSearch","data","query","filters","split","reduce","acc","filter","operator","values","value","join","push","normalizedItem","Object","entries","every","some","val","subVal","normalizedSubVal","includes","startsWith","endsWith","init_advancedOperatorsSearch","__esmMin","findBotByTrigger","init_findBotByTrigger","__esmMin","init_advancedOperatorsSearch","__name","botRepository","content","instanceId","findTriggerAllOrNone","findFirst","where","enabled","triggerType","in","findTriggerAdvanced","findMany","advanced","advancedOperatorsSearch","triggerValue","findTriggerEquals","triggerOperator","findRegex","findTriggerRegex","regex","RegExp","test","findStartsWith","findTriggerStartsWith","startsWith","findEndsWith","findTriggerEndsWith","endsWith","findContains","findTriggerContains","contains","includes","ChatbotController","init_chatbot_controller","__esmMin","init_server_module","init_logger_config","init_findBotByTrigger","prismaRepository","waMonitor","logger","Logger","prisma","monitor","emit","instance","remoteJid","msg","pushName","isIntegration","emitData","evolutionBotController","typebotController","openaiController","difyController","n8nController","evoaiController","flowiseController","processDebounce","userMessageDebounce","content","debounceTime","callback","message","log","clearTimeout","timeoutId","setTimeout","myQuestion","checkIgnoreJids","ignoreJids","length","ignoreGroups","ignoreContacts","includes","endsWith","warn","getSession","session","integrationSession","findFirst","where","instanceId","orderBy","createdAt","status","botId","findBotTrigger","botRepository","findBot","id","findBotByTrigger","_ChatbotController","isURL","ChatwootController","init_chatwoot_controller","__esmMin","init_exceptions","chatwootService","configService","createChatwoot","instance","data","get","ENABLED","BadRequestException","enabled","url","require_tld","accountId","token","signMsg","signDelimiter","nameInbox","instanceName","result","create","urlServer","URL","webhook_url","encodeURIComponent","findChatwoot","find","Object","keys","length","receiveWebhook","_ChatwootController","BaseChatbotController","init_base_chatbot_controller","__esmMin","init_wa_types","init_exceptions","init_getConversationMessage","init_chatbot_controller","ChatbotController","prismaRepository","waMonitor","logger","integrationEnabled","botRepository","settingsRepository","sessionRepository","userMessageDebounce","integrationSession","createBot","instance","data","BadRequestException","integrationName","instanceId","findFirst","where","name","instanceName","then","id","expire","keywordFinish","delayMessage","unknownMessage","listeningFromMe","stopBotFromMe","keepOpen","debounceTime","ignoreJids","splitMessages","timePerChar","defaultSettingCheck","undefined","settings","enabled","triggerType","Error","triggerOperator","triggerValue","botData","description","getAdditionalBotData","create","error","findBot","findMany","fetchBot","botId","bot","findUnique","existingSettings","fallbackFieldName","getFallbackFieldName","settingsData","fallbackId","update","Instance","connect","fetchSettings","include","Fallback","fallback","changeStatus","remoteJid","status","session","getSession","typebotData","waInstances","sendDataWebhook","Events","TYPEBOT_CHANGE_STATUS","deleteMany","not","updateMany","fetchSessions","integrationType","getIntegrationType","type","ignoreJid","action","includes","push","filter","jid","updateBot","validateNoDuplicatesOnUpdate","updateData","getAdditionalUpdateFields","deleteBot","delete","emit","msg","checkIgnoreJids","content","getConversationMessage","findBotTrigger","getFallbackBotId","key","fromMe","mergedSettings","processDebounce","debouncedContent","processBot","pushName","_BaseChatbotController","DifyController","init_dify_controller","__esmMin","init_env_config","init_logger_config","init_exceptions","init_base_chatbot_controller","BaseChatbotController","difyService","prismaRepository","waMonitor","logger","Logger","integrationName","integrationEnabled","configService","get","ENABLED","botRepository","settingsRepository","sessionRepository","userMessageDebounce","dify","difySetting","integrationSession","getFallbackBotId","settings","fallbackId","getFallbackFieldName","getIntegrationType","getAdditionalBotData","data","botType","apiUrl","apiKey","getAdditionalUpdateFields","validateNoDuplicatesOnUpdate","botId","instanceId","findFirst","where","id","not","Error","createBot","instance","BadRequestException","name","instanceName","then","processBot","remoteJid","bot","session","content","pushName","msg","process","_DifyController","EvoaiController","init_evoai_controller","__esmMin","init_env_config","init_logger_config","init_exceptions","init_base_chatbot_controller","BaseChatbotController","evoaiService","prismaRepository","waMonitor","logger","Logger","integrationName","integrationEnabled","configService","get","ENABLED","botRepository","settingsRepository","sessionRepository","userMessageDebounce","evoai","evoaiSetting","integrationSession","getFallbackBotId","settings","evoaiIdFallback","getFallbackFieldName","getIntegrationType","getAdditionalBotData","data","agentUrl","apiKey","getAdditionalUpdateFields","validateNoDuplicatesOnUpdate","botId","instanceId","findFirst","where","id","not","Error","createBot","instance","BadRequestException","name","instanceName","then","processBot","remoteJid","bot","session","content","pushName","msg","process","_EvoaiController","axios","downloadMediaMessage","isURL","v4","uuidv4","EvoaiService","init_evoai_service","__esmMin","init_wa_types","init_base_chatbot_service","BaseChatbotService","waMonitor","prismaRepository","configService","openaiService","getBotType","sendMessageToBot","instance","session","settings","evoai","remoteJid","pushName","content","msg","logger","debug","processedContent","isAudioMessage","transcription","speechToText","err","error","endpoint","agentUrl","callId","substring","messageId","split","parts","type","text","isImageMessage","media","message","mediaUrl","base64","mediaBase64","result","get","responseType","Buffer","from","data","toString","push","file","name","key","id","mimeType","bytes","mediaBuffer","fileContent","fileName","fileErr","payload","jsonrpc","method","params","contextId","sessionId","role","metadata","messageKey","fromMe","instanceName","serverUrl","URL","apiKey","token","redactedPayload","JSON","parse","stringify","map","part","integration","Integration","WHATSAPP_BAILEYS","client","presenceSubscribe","sendPresenceUpdate","response","post","headers","artifacts","Array","isArray","length","artifact","textPart","find","p","sendMessageWhatsApp","_EvoaiService","EvolutionBotController","init_evolutionBot_controller","__esmMin","init_logger_config","init_base_chatbot_controller","BaseChatbotController","evolutionBotService","prismaRepository","waMonitor","logger","Logger","integrationName","integrationEnabled","botRepository","settingsRepository","sessionRepository","userMessageDebounce","evolutionBot","evolutionBotSetting","integrationSession","getFallbackBotId","settings","botIdFallback","getFallbackFieldName","getIntegrationType","getAdditionalBotData","data","apiUrl","apiKey","getAdditionalUpdateFields","validateNoDuplicatesOnUpdate","botId","instanceId","findFirst","where","id","not","Error","processBot","instance","remoteJid","bot","session","content","pushName","msg","process","_EvolutionBotController","axios","EvolutionBotService","init_evolutionBot_service","__esmMin","init_wa_types","init_sendTelemetry","init_base_chatbot_service","BaseChatbotService","waMonitor","prismaRepository","configService","openaiService","getBotType","sendMessageToBot","instance","session","settings","bot","remoteJid","pushName","content","msg","payload","inputs","sessionId","id","fromMe","key","instanceName","serverUrl","get","URL","apiKey","token","query","conversation_id","undefined","user","isAudioMessage","logger","debug","transcription","speechToText","err","error","isImageMessage","media","split","message","mediaUrl","base64","files","type","url","integration","Integration","WHATSAPP_BAILEYS","client","presenceSubscribe","sendPresenceUpdate","endpoint","apiUrl","headers","Authorization","sanitizedPayload","response","post","data","rawLinkPreview","linkPreview","startsWith","endsWith","innerContent","slice","includes","sendMessageWhatsApp","warn","sendTelemetry","JSON","stringify","_EvolutionBotService","FlowiseController","init_flowise_controller","__esmMin","init_env_config","init_logger_config","init_exceptions","init_base_chatbot_controller","BaseChatbotController","flowiseService","prismaRepository","waMonitor","logger","Logger","integrationName","integrationEnabled","configService","get","ENABLED","botRepository","settingsRepository","sessionRepository","userMessageDebounce","flowise","flowiseSetting","integrationSession","getFallbackBotId","settings","flowiseIdFallback","getFallbackFieldName","getIntegrationType","getAdditionalBotData","data","apiUrl","apiKey","getAdditionalUpdateFields","validateNoDuplicatesOnUpdate","botId","instanceId","findFirst","where","id","not","Error","processBot","instance","remoteJid","bot","session","content","pushName","msg","createBot","BadRequestException","name","instanceName","then","_FlowiseController","axios","FlowiseService","init_flowise_service","__esmMin","init_wa_types","init_base_chatbot_service","BaseChatbotService","waMonitor","prismaRepository","configService","openaiService","getBotType","processBot","instance","remoteJid","bot","session","settings","content","pushName","msg","process","sendMessageToBot","payload","question","overrideConfig","sessionId","vars","messageId","key","id","fromMe","instanceName","serverUrl","get","URL","apiKey","token","isAudioMessage","logger","debug","transcription","speechToText","err","error","isImageMessage","media","split","message","mediaUrl","base64","uploads","data","type","name","mime","integration","Integration","WHATSAPP_BAILEYS","client","presenceSubscribe","sendPresenceUpdate","headers","Authorization","endpoint","apiUrl","response","post","text","sendMessageWhatsApp","_FlowiseService","N8nController","init_n8n_controller","__esmMin","init_env_config","init_logger_config","init_exceptions","init_base_chatbot_controller","BaseChatbotController","n8nService","prismaRepository","waMonitor","logger","Logger","integrationName","integrationEnabled","configService","get","ENABLED","botRepository","settingsRepository","sessionRepository","userMessageDebounce","n8n","n8nSetting","integrationSession","getFallbackBotId","settings","fallbackId","getFallbackFieldName","getIntegrationType","getAdditionalBotData","data","webhookUrl","basicAuthUser","basicAuthPass","getAdditionalUpdateFields","validateNoDuplicatesOnUpdate","botId","instanceId","findFirst","where","id","not","Error","createBot","instance","BadRequestException","name","instanceName","then","processBot","remoteJid","bot","session","content","pushName","msg","process","_N8nController","axios","N8nService","init_n8n_service","__esmMin","init_base_chatbot_service","BaseChatbotService","waMonitor","prismaRepository","configService","openaiService","getBotType","sendMessageToBot","instance","session","settings","n8n","remoteJid","pushName","content","msg","logger","error","endpoint","webhookUrl","payload","chatInput","sessionId","keyId","key","id","fromMe","quotedMessage","contextInfo","instanceName","serverUrl","get","URL","apiKey","token","isAudioMessage","debug","transcription","speechToText","err","headers","basicAuthUser","basicAuthPass","auth","Buffer","from","toString","response","post","message","data","output","answer","sendMessageWhatsApp","integrationSession","update","where","status","awaitUser","_N8nService","OpenAI","OpenaiController","init_openai_controller","__esmMin","init_env_config","init_logger_config","init_exceptions","init_base_chatbot_controller","BaseChatbotController","openaiService","prismaRepository","waMonitor","logger","Logger","integrationName","integrationEnabled","configService","get","ENABLED","botRepository","settingsRepository","sessionRepository","userMessageDebounce","client","credsRepository","openaiBot","openaiSetting","integrationSession","openaiCreds","getFallbackBotId","settings","openaiIdFallback","getFallbackFieldName","getIntegrationType","getAdditionalBotData","data","openaiCredsId","botType","assistantId","functionUrl","model","systemMessages","assistantMessages","userMessages","maxTokens","getAdditionalUpdateFields","validateNoDuplicatesOnUpdate","botId","instanceId","whereDuplication","id","not","Error","findFirst","where","createBot","instance","BadRequestException","name","instanceName","then","existingSettings","update","OpenaiCreds","connect","expire","keywordFinish","delayMessage","unknownMessage","listeningFromMe","undefined","stopBotFromMe","keepOpen","debounceTime","ignoreJids","speechToText","processBot","remoteJid","bot","session","content","pushName","msg","process","createOpenaiCreds","apiKey","create","error","findOpenaiCreds","findMany","include","OpenaiAssistant","deleteCreds","creds","delete","settingsData","splitMessages","timePerChar","fallbackId","Instance","getModels","defaultSettings","models","list","body","_OpenaiController","axios","TypebotController","init_typebot_controller","__esmMin","init_wa_types","init_env_config","init_logger_config","init_exceptions","init_base_chatbot_controller","BaseChatbotController","typebotService","prismaRepository","waMonitor","logger","Logger","integrationName","integrationEnabled","configService","get","ENABLED","botRepository","settingsRepository","sessionRepository","userMessageDebounce","typebot","typebotSetting","integrationSession","getFallbackBotId","settings","typebotIdFallback","getFallbackFieldName","getIntegrationType","getAdditionalBotData","data","url","getAdditionalUpdateFields","validateNoDuplicatesOnUpdate","botId","instanceId","findFirst","where","id","not","Error","processBot","instance","remoteJid","bot","session","content","pushName","msg","processTypebot","expire","keywordFinish","delayMessage","unknownMessage","listeningFromMe","stopBotFromMe","keepOpen","startBot","BadRequestException","instanceData","name","instanceName","startSession","variables","debounceTime","ignoreJids","defaultSettingCheck","checkIgnoreJids","prefilledVariables","length","forEach","variable","value","findBot","create","enabled","deleteMany","waInstances","Math","floor","random","toString","version","API_VERSION","reqData","startParams","publicId","request","post","sendWAMessage","messages","input","clientSideActions","sendDataWebhook","Events","TYPEBOT_START","sessionId","error","_TypebotController","EventController","init_event_controller","__esmMin","prismaRepository","waMonitor","integrationStatus","integrationName","prisma","monitor","status","name","set","instanceName","data","enabled","events","length","upsert","where","instanceId","waInstances","update","create","get","undefined","findUnique","__publicField","_EventController","Kafka","KafkaJS","KafkaController","init_kafka_controller","__esmMin","init_env_config","init_logger_config","init_event_controller","EventController","prismaRepository","waMonitor","configService","get","ENABLED","kafkaClient","producer","consumer","logger","Logger","reconnectAttempts","maxReconnectAttempts","reconnectDelay","isReconnecting","init","status","connect","kafkaConfig","clientConfig","clientId","CLIENT_ID","brokers","BROKERS","connectionTimeout","CONNECTION_TIMEOUT","requestTimeout","REQUEST_TIMEOUT","retry","initialRetryTime","retries","SASL","sasl","mechanism","MECHANISM","username","USERNAME","password","PASSWORD","SSL","ssl","rejectUnauthorized","REJECT_UNAUTHORIZED","ca","CA","undefined","key","KEY","cert","CERT","producerConfig","maxInFlightRequests","idempotent","transactionTimeout","GLOBAL_ENABLED","initGlobalConsumer","info","AUTO_CREATE_TOPICS","createTopics","error","local","message","scheduleReconnect","consumerConfig","groupId","CONSUMER_GROUP_ID","sessionTimeout","heartbeatInterval","events","EVENTS","eventKeys","Object","keys","filter","event","topicName","getTopicName","subscribe","topic","run","eachMessage","__name","data","JSON","parse","value","toString","debug","stringify","admin","topics","push","numPartitions","NUM_PARTITIONS","replicationFactor","REPLICATION_FACTOR","length","waitForLeaders","disconnect","isGlobal","instanceName","prefix","TOPIC_PREFIX","toLowerCase","replace","handleConnectionLoss","cleanup","delay","Math","pow","min","setTimeout","ensureConnection","warn","emit","origin","serverUrl","dateTime","sender","apiKey","integration","extra","includes","instanceKafka","kafkaLocal","kafkaGlobal","kafkaEvents","we","toUpperCase","logEnabled","LEVEL","instance","server_url","date_time","apikey","timestamp","Date","now","messageValue","enabled","Array","isArray","send","messages","headers","logData","log","_KafkaController","connect","StringCodec","NatsController","init_nats_controller","__esmMin","init_env_config","init_logger_config","init_event_controller","EventController","prismaRepository","waMonitor","configService","get","ENABLED","natsClient","logger","Logger","sc","init","status","uri","URI","servers","info","GLOBAL_ENABLED","initGlobalSubscriptions","error","emit","instanceName","origin","event","data","serverUrl","dateTime","sender","apiKey","integration","extra","includes","instanceNats","natsLocal","events","natsGlobal","natsEvents","EVENTS","prefixKey","PREFIX_KEY","we","replace","toUpperCase","logEnabled","LEVEL","message","instance","server_url","date_time","apikey","enabled","Array","isArray","subject","toLowerCase","publish","encode","JSON","stringify","logData","local","log","warn","eventKeys","Object","keys","subscription","subscribe","msg","parse","decode","debug","_NatsController","Pusher","PusherController","init_pusher_controller","__esmMin","init_env_config","init_logger_config","init_event_controller","EventController","prismaRepository","waMonitor","configService","get","ENABLED","logger","Logger","pusherClients","globalPusherClient","pusherConfig","init","status","GLOBAL","APP_ID","KEY","SECRET","CLUSTER","USE_TLS","appId","key","secret","cluster","useTLS","info","instance","findMany","where","isNot","include","forEach","enabled","name","warn","set","instanceName","data","pusher","events","length","prisma","upsert","instanceId","monitor","waInstances","update","create","emit","origin","event","serverUrl","dateTime","sender","apiKey","local","integration","extra","includes","we","replace","toUpperCase","enabledLog","LEVEL","eventName","toLowerCase","pusherData","destination","date_time","server_url","apikey","qrcode","base64","payload","JSON","stringify","payloadSize","Buffer","byteLength","error","message","pusherLocalEvents","Array","isArray","log","trigger","EVENTS","_PusherController","amqp","RabbitmqController","init_rabbitmq_controller","__esmMin","init_env_config","init_logger_config","init_event_controller","EventController","prismaRepository","waMonitor","configService","get","ENABLED","amqpChannel","amqpConnection","logger","Logger","reconnectAttempts","maxReconnectAttempts","reconnectDelay","isReconnecting","init","status","connect","Promise","resolve","reject","uri","URI","frameMax","FRAME_MAX","rabbitmqExchangeName","EXCHANGE_NAME","url","URL","connectionOptions","protocol","slice","hostname","port","username","password","vhost","pathname","heartbeat","error","connection","local","message","on","err","handleConnectionLoss","warn","createChannel","channelError","channel","exchangeName","assertExchange","durable","autoDelete","info","then","GLOBAL_ENABLED","initGlobalQueues","catch","scheduleReconnect","cleanup","delay","Math","pow","min","setTimeout","ensureConnection","emit","instanceName","origin","event","data","serverUrl","dateTime","sender","apiKey","integration","extra","includes","instanceRabbitmq","rabbitmqLocal","events","rabbitmqGlobal","rabbitmqEvents","EVENTS","prefixKey","PREFIX_KEY","we","replace","toUpperCase","logEnabled","LEVEL","instance","server_url","date_time","apikey","enabled","Array","isArray","retry","eventName","toLowerCase","queueName","assertQueue","arguments","bindQueue","publish","Buffer","from","JSON","stringify","logData","log","eventKeys","Object","keys","close","_RabbitmqController","CreateQueueCommand","DeleteQueueCommand","ListQueuesCommand","SQS","SqsController","init_sqs_controller","__esmMin","init_minio_server","init_env_config","init_logger_config","init_event_controller","EventController","prismaRepository","waMonitor","configService","get","ENABLED","sqs","logger","Logger","init","status","awsConfig","credentials","accessKeyId","ACCESS_KEY_ID","secretAccessKey","SECRET_ACCESS_KEY","region","REGION","info","sqsConfig","GLOBAL_ENABLED","sqsEvents","Object","keys","EVENTS","filter","e","saveQueues","GLOBAL_PREFIX_NAME","channel","set","instanceName","data","name","enabled","events","length","payload","where","instanceId","monitor","waInstances","update","create","console","log","prisma","upsert","emit","origin","event","serverUrl","dateTime","sender","apiKey","integration","extra","includes","serverConfig","we","replace","toUpperCase","instanceSqs","Array","isArray","prefixName","eventFormatted","GLOBAL_FORCE_SINGLE_QUEUE","toLowerCase","queueName","sqsUrl","ACCOUNT_ID","message","instance","dataType","server","NAME","server_url","date_time","apikey","jsonStr","JSON","stringify","size","Buffer","byteLength","MAX_PAYLOAD_SIZE","ENABLE","error","buffer","from","fullName","Date","now","uploadFile","fileUrl","getObjectUrl","messageGroupId","isGlobalEnabled","params","MessageBody","MessageGroupId","QueueUrl","MessageDeduplicationId","sendMessage","err","local","hostName","hostname","code","stack","url","LEVEL","logData","enable","eventsFinded","listQueues","normalizedEvent","createCommand","QueueName","Attributes","FifoQueue","ContentBasedDeduplication","send","existingQueues","listCommand","QueueNamePrefix","listData","QueueUrls","map","queueUrl","parts","split","startsWith","endsWith","substring","removeQueuesByInstance","deleteCommand","_SqsController","axios","jwt","WebhookController","init_webhook_controller","__esmMin","init_env_config","init_logger_config","init_event_controller","EventController","prismaRepository","waMonitor","logger","Logger","set","instanceName","data","webhook","enabled","events","length","prisma","upsert","where","instanceId","monitor","waInstances","update","url","headers","webhookBase64","base64","webhookByEvents","byEvents","create","emit","origin","event","serverUrl","dateTime","sender","apiKey","local","integration","extra","includes","instance","get","webhookConfig","configService","webhookLocal","webhookHeaders","jwtKey","jwtToken","generateJwtToken","we","replace","toUpperCase","transformedWe","toLowerCase","enabledLog","LEVEL","regex","webhookData","destination","GLOBAL","URL","date_time","server_url","apikey","Array","isArray","baseURL","logData","log","test","httpService","timeout","REQUEST","TIMEOUT_MS","retryWebhookRequest","error","message","hostName","hostname","syscall","code","errno","stack","name","ENABLED","EVENTS","globalURL","WEBHOOK_BY_EVENTS","maxRetries","delaySeconds","maxRetryAttempts","RETRY","MAX_ATTEMPTS","initialDelay","INITIAL_DELAY_SECONDS","useExponentialBackoff","USE_EXPONENTIAL_BACKOFF","maxDelay","MAX_DELAY_SECONDS","jitterFactor","JITTER_FACTOR","nonRetryableStatusCodes","NON_RETRYABLE_STATUS_CODES","attempts","post","isTimeout","response","status","statusCode","nextDelay","Math","min","pow","jitter","random","max","toFixed","Promise","resolve","setTimeout","authToken","payload","iat","floor","Date","now","exp","app","action","sign","algorithm","_WebhookController","Server","SocketIO","WebsocketController","init_websocket_controller","__esmMin","init_env_config","init_logger_config","init_event_controller","EventController","prismaRepository","waMonitor","configService","get","ENABLED","io","corsConfig","logger","Logger","cors","ORIGIN","init","httpServer","status","socket","origin","allowRequest","__name","req","callback","url","URL","params","URLSearchParams","search","remoteAddress","allowedHosts","ALLOWED_HOSTS","isAllowedHost","trim","split","map","h","includes","has","apiKey","headers","apikey","error","instance","findFirst","where","token","globalToken","API_KEY","KEY","on","info","data","waInstances","instanceId","baileysSendNode","stanza","emit","instanceName","event","serverUrl","dateTime","sender","integration","extra","configEv","replace","toUpperCase","logEnabled","LEVEL","message","server_url","date_time","GLOBAL_EVENTS","log","local","enabled","Array","isArray","events","of","err","_WebsocketController","EventManager","init_event_manager","__esmMin","init_kafka_controller","init_nats_controller","init_pusher_controller","init_rabbitmq_controller","init_sqs_controller","init_webhook_controller","init_websocket_controller","prismaRepository","waMonitor","websocketController","webhookController","rabbitmqController","natsController","sqsController","pusherController","kafkaController","prisma","monitor","websocket","WebsocketController","webhook","WebhookController","rabbitmq","RabbitmqController","nats","NatsController","sqs","SqsController","pusher","PusherController","kafka","KafkaController","init","httpServer","emit","eventData","setInstance","instanceName","data","set","enabled","events","url","headers","base64","byEvents","appId","key","secret","cluster","useTLS","_EventManager","S3Controller","init_s3_controller","__esmMin","s3Service","getMedia","instance","data","getMediaUrl","_S3Controller","S3Service","init_s3_service","__esmMin","init_minio_server","init_logger_config","init_exceptions","prismaRepository","logger","Logger","getMedia","instance","query","where","instanceId","media","findMany","select","id","fileName","type","mimetype","createdAt","Message","length","error","BadRequestException","getMediaUrl","data","mediaUrl","getObjectUrl","expiry","_S3Service","execFileSync","rmSync","join","WAMonitoringService","init_monitor_service","__esmMin","init_server_module","init_wa_types","init_logger_config","init_path_config","init_exceptions","eventEmitter","configService","prismaRepository","providerFiles","cache","chatwootCache","baileysCache","db","redis","logger","Logger","waInstances","delInstanceTimeouts","providerSession","removeInstance","noConnection","Object","assign","get","freeze","delInstanceTime","instance","time","clearTimeout","setTimeout","connectionStatus","state","integration","Integration","WHATSAPP_BAILEYS","client","logout","ws","close","end","undefined","emit","clearDelInstanceTime","instanceInfo","instanceNames","length","inexistentInstances","filter","NotFoundException","clientName","CONNECTION","CLIENT_NAME","where","name","in","findMany","include","Chatwoot","Proxy","Rabbitmq","Nats","Sqs","Websocket","Setting","_count","select","Message","Contact","Chat","instanceInfoById","instanceId","number","instanceName","findFirst","id","then","r","cleaningUp","instanceDbId","SAVE_DATA","INSTANCE","update","data","INSTANCE_DIR","recursive","force","session","deleteMany","sessionId","REDIS","ENABLED","SAVE_INSTANCES","delete","removeSession","cleaningStoreData","instancePath","STORE_DIR","chat","contact","messageUpdate","message","webhook","chatwoot","proxy","rabbitmq","nats","sqs","integrationSession","typebot","websocket","setting","label","loadInstance","loadInstancesFromProvider","loadInstancesFromDatabasePostgres","loadInstancesFromRedis","error","saveInstance","create","ownerJid","profileName","profilePicUrl","status","token","hash","businessId","deleteInstance","setInstance","instanceData","channelController","init","info","connectToWhatsapp","keys","Promise","all","map","k","findUnique","split","instances","allInstances","on","sendDataWebhook","Events","REMOVE_INSTANCE","warn","LOGOUT_INSTANCE","clearCacheChatwoot","qrcode","count","stateConnection","localError","_WAMonitoringService","ProxyService","init_proxy_service","__esmMin","init_logger_config","waMonitor","logger","Logger","create","instance","data","waInstances","instanceName","setProxy","proxy","find","result","findProxy","Object","keys","length","Error","_ProxyService","SettingsService","init_settings_service","__esmMin","init_logger_config","waMonitor","logger","Logger","create","instance","data","waInstances","instanceName","setSettings","settings","find","result","findSettings","Object","keys","length","Error","_SettingsService","axios","TemplateService","init_template_service","__esmMin","init_logger_config","waMonitor","prismaRepository","configService","logger","Logger","businessId","token","find","instance","getInstance","waInstances","instanceName","Error","response","requestTemplate","data","create","postData","name","category","allow_category_change","allowCategoryChange","language","components","error","metaError","message","template","templateId","id","webhookUrl","instanceId","edit","payload","ttl","time_to_live","requestEditTemplate","delete","requestDeleteTemplate","hsm_id","hsmId","deleteMany","where","OR","undefined","filter","Boolean","err","warn","String","method","urlServer","get","URL","version","VERSION","headers","Authorization","post","e","JSON","stringify","params","_TemplateService","logger","chatwootCache","cache","baileysCache","providerFiles","prismaRepository","waMonitor","s3Service","s3Controller","templateService","templateController","proxyService","proxyController","chatwootService","chatwootController","settingsService","settingsController","instanceController","sendMessageController","callController","chatController","businessController","groupController","labelController","eventManager","chatbotController","channelController","evolutionController","metaController","baileysController","openaiService","openaiController","typebotService","typebotController","difyService","difyController","evolutionBotService","evolutionBotController","flowiseService","flowiseController","n8nService","n8nController","evoaiService","evoaiController","init_server_module","__esmMin","init_cacheengine","init_env_config","init_event_config","init_logger_config","init_business_controller","init_call_controller","init_chat_controller","init_group_controller","init_instance_controller","init_label_controller","init_proxy_controller","init_sendMessage_controller","init_settings_controller","init_template_controller","init_channel_controller","init_evolution_controller","init_meta_controller","init_baileys_controller","init_chatbot_controller","init_chatwoot_controller","init_chatwoot_service","init_dify_controller","init_dify_service","init_evoai_controller","init_evoai_service","init_evolutionBot_controller","init_evolutionBot_service","init_flowise_controller","init_flowise_service","init_n8n_controller","init_n8n_service","init_openai_controller","init_openai_service","init_typebot_controller","init_typebot_service","init_event_manager","init_s3_controller","init_s3_service","init_sessions","init_repository_service","init_cache_service","init_monitor_service","init_proxy_service","init_settings_service","init_template_service","Logger","configService","get","ENABLED","CacheService","CacheEngine","ChatwootService","name","getEngine","ProviderFiles","PrismaRepository","WAMonitoringService","eventEmitter","S3Service","S3Controller","TemplateService","TemplateController","ProxyService","ProxyController","ChatwootController","SettingsService","SettingsController","InstanceController","SendMessageController","CallController","ChatController","BusinessController","GroupController","LabelController","EventManager","ChatbotController","ChannelController","EvolutionController","MetaController","BaileysController","OpenaiService","OpenaiController","TypebotService","TypebotController","DifyService","DifyController","EvolutionBotService","EvolutionBotController","FlowiseService","FlowiseController","N8nService","N8nController","EvoaiService","EvoaiController","info","apikey","req","_","next","env","configService","get","API_KEY","key","db","UnauthorizedException","KEY","originalUrl","includes","ForbiddenException","param","params","instanceName","prismaRepository","instance","findUnique","where","name","token","SAVE_DATA","INSTANCE","findFirst","error","logger","authGuard","init_auth_guard","__esmMin","init_server_module","init_env_config","init_logger_config","init_exceptions","Logger","getInstance","instanceName","cacheConf","configService","get","exists","waMonitor","waInstances","REDIS","ENABLED","SAVE_INSTANCES","keyExists","cache","has","prismaRepository","instance","findMany","where","name","length","error","InternalServerErrorException","toString","instanceExistsGuard","req","_","next","originalUrl","includes","param","params","BadRequestException","NotFoundException","instanceLoggedGuard","body","ForbiddenException","init_instance_guard","__esmMin","init_server_module","init_env_config","init_exceptions","_a","Telemetry","telemetry_guard_default","init_telemetry_guard","__esmMin","init_sendTelemetry","collectTelemetry","req","res","next","sendTelemetry","path","validate","logger","RouterBroker","init_abstract_router","__esmMin","init_logger_config","init_exceptions","Logger","routerPath","path","param","route","dataValidate","args","request","schema","ClassRef","execute","ref","body","instance","params","query","Object","keys","length","assign","originalUrl","includes","v","valid","errors","message","map","stack","replace","error","BadRequestException","groupNoValidate","property","groupValidate","groupJid","endsWith","inviteCodeValidate","inviteCode","getParticipantsValidate","getParticipants","_RouterBroker","Router","EvolutionRouter","init_evolution_router","__esmMin","init_abstract_router","init_server_module","RouterBroker","configService","router","post","routerPath","req","res","body","response","evolutionController","receiveWebhook","status","json","_EvolutionRouter","Router","MetaRouter","init_meta_router","__esmMin","init_abstract_router","init_server_module","RouterBroker","configService","router","get","routerPath","req","res","query","TOKEN_WEBHOOK","send","post","body","response","metaController","receiveWebhook","status","json","_MetaRouter","ChatwootInstanceMixin","Base","chatwootAccountId","chatwootToken","chatwootUrl","chatwootSignMsg","chatwootReopenConversation","chatwootConversationPending","chatwootMergeBrazilContacts","chatwootImportContacts","chatwootImportMessages","chatwootDaysLimitImportMessages","chatwootNameInbox","chatwootOrganization","chatwootLogo","chatwootAutoCreate","ChatwootDto","init_chatwoot_dto","__esmMin","enabled","accountId","token","url","nameInbox","signMsg","signDelimiter","number","reopenConversation","conversationPending","mergeBrazilContacts","importContacts","importMessages","daysLimitImportMessages","autoCreate","organization","logo","ignoreJids","_ChatwootDto","EventInstanceMixin","Base","webhook","websocket","sqs","rabbitmq","nats","pusher","kafka","EventDto","init_event_dto","__esmMin","_EventDto","IntegrationDto","init_integration_dto","__esmMin","init_chatwoot_dto","init_event_dto","EventInstanceMixin","ChatwootInstanceMixin","__name","_IntegrationDto","InstanceDto","SetPresenceDto","init_instance_dto","__esmMin","init_integration_dto","IntegrationDto","instanceName","instanceId","qrcode","businessId","number","integration","token","status","ownerJid","connectionStatus","profileName","profilePicUrl","rejectCall","msgCall","groupsIgnore","alwaysOnline","readMessages","readStatus","syncFullHistory","wavoipToken","proxyHost","proxyPort","proxyProtocol","proxyUsername","proxyPassword","webhook","chatwootAccountId","chatwootConversationPending","chatwootAutoCreate","chatwootDaysLimitImportMessages","chatwootImportContacts","chatwootImportMessages","chatwootLogo","chatwootMergeBrazilContacts","chatwootNameInbox","chatwootOrganization","chatwootReopenConversation","chatwootSignMsg","chatwootToken","chatwootUrl","_InstanceDto","presence","_SetPresenceDto","v4","isNotEmpty","instanceSchema","presenceOnlySchema","init_instance_schema","__esmMin","init_wa_types","__name","propertyNames","properties","forEach","property","minLength","description","if","enum","then","$id","type","instanceName","token","number","pattern","businessId","qrcode","Integration","Object","values","rejectCall","msgCall","groupsIgnore","alwaysOnline","readMessages","readStatus","syncFullHistory","wavoipToken","proxyHost","proxyPort","proxyProtocol","proxyUsername","proxyPassword","webhookUrl","webhookByEvents","webhookBase64","webhookEvents","minItems","items","rabbitmqEnabled","rabbitmqEvents","natsEnabled","natsEvents","sqsEnabled","sqsEvents","chatwootAccountId","chatwootToken","chatwootUrl","chatwootSignMsg","chatwootReopenConversation","chatwootConversationPending","chatwootImportContacts","chatwootNameInbox","chatwootMergeBrazilContacts","chatwootImportMessages","chatwootDaysLimitImportMessages","presence","required","Router","BaileysRouter","init_baileys_router","__esmMin","init_abstract_router","init_instance_dto","init_index_router","init_server_module","init_instance_schema","RouterBroker","guards","router","post","routerPath","req","res","response","dataValidate","request","schema","instanceSchema","ClassRef","InstanceDto","execute","__name","instance","baileysController","onWhatsapp","body","status","HttpStatus","OK","json","profilePictureUrl","assertSessions","createParticipantNodes","getUSyncDevices","generateMessageTag","sendNode","signalRepositoryDecryptMessage","getAuthState","_BaileysRouter","Router","ChannelRouter","init_channel_router","__esmMin","init_evolution_router","init_meta_router","init_baileys_router","configService","guards","router","use","EvolutionRouter","MetaRouter","BaileysRouter","_ChannelRouter","catalogSchema","collectionsSchema","init_business_schema","__esmMin","type","properties","number","limit","v4","isNotEmpty","numberDefinition","whatsappNumberSchema","readMessageSchema","archiveChatSchema","markChatUnreadSchema","deleteMessageSchema","profilePictureSchema","updateMessageSchema","presenceSchema","blockUserSchema","contactValidateSchema","messageValidateSchema","messageUpSchema","privacySettingsSchema","profileNameSchema","profileStatusSchema","profileSchema","init_chat_schema","__esmMin","__name","propertyNames","properties","forEach","property","minLength","description","if","enum","then","type","$id","numbers","minItems","uniqueItems","items","readMessages","id","fromMe","remoteJid","required","chat","lastMessage","key","messageTimestamp","archive","participant","number","picture","text","delay","presence","status","where","_id","pushName","message","limit","readreceipts","profile","online","last","groupadd","name","wuid","isBusiness","v4","isNotEmpty","createGroupSchema","groupJidSchema","getParticipantsSchema","groupSendInviteSchema","groupInviteSchema","AcceptGroupInviteSchema","updateParticipantsSchema","updateSettingsSchema","toggleEphemeralSchema","updateGroupPictureSchema","updateGroupSubjectSchema","updateGroupDescriptionSchema","init_group_schema","__esmMin","__name","propertyNames","properties","forEach","property","minLength","description","if","enum","then","$id","type","subject","profilePicture","promoteParticipants","participants","minItems","uniqueItems","items","pattern","required","groupJid","getParticipants","numbers","inviteCode","action","expiration","image","v4","isNotEmpty","numberDefinition","handleLabelSchema","init_label_schema","__esmMin","__name","propertyNames","properties","forEach","property","minLength","description","if","enum","then","type","$id","number","labelId","action","required","v4","isNotEmpty","numberDefinition","templateMessageSchema","quotedOptionsSchema","offerCallSchema","textMessageSchema","mediaMessageSchema","ptvMessageSchema","audioMessageSchema","statusMessageSchema","stickerMessageSchema","locationMessageSchema","contactMessageSchema","reactionMessageSchema","pollMessageSchema","listMessageSchema","buttonsMessageSchema","init_message_schema","__esmMin","__name","propertyNames","properties","forEach","property","minLength","description","if","enum","then","type","$id","number","name","language","components","webhookUrl","required","key","id","remoteJid","fromMe","message","isVideo","callDuration","minimum","maximum","text","linkPreview","delay","quoted","everyOne","mentioned","minItems","uniqueItems","items","pattern","mediatype","mimetype","media","fileName","caption","video","audio","content","backgroundColor","font","statusJidList","allContacts","sticker","latitude","longitude","address","contact","fullName","wuid","phoneNumber","organization","email","url","reaction","selectableCount","values","maxItems","title","footerText","buttonText","sections","rows","rowId","thumbnailUrl","footer","buttons","displayText","currency","keyType","v4","isNotEmpty","proxySchema","init_proxy_schema","__esmMin","__name","propertyNames","properties","forEach","property","minLength","description","if","enum","then","$id","type","enabled","host","port","protocol","username","password","required","v4","isNotEmpty","settingsSchema","init_settings_schema","__esmMin","__name","propertyNames","properties","forEach","property","minLength","description","if","enum","then","$id","type","rejectCall","msgCall","groupsIgnore","alwaysOnline","readMessages","readStatus","syncFullHistory","wavoipToken","required","v4","isNotEmpty","templateSchema","init_template_schema","__esmMin","__name","propertyNames","properties","forEach","property","minLength","description","if","enum","then","$id","type","name","category","allowCategoryChange","language","components","webhookUrl","required","v4","isNotEmpty","templateDeleteSchema","init_templateDelete_schema","__esmMin","__name","propertyNames","properties","forEach","property","minLength","description","if","enum","then","$id","type","name","hsmId","required","v4","isNotEmpty","templateEditSchema","init_templateEdit_schema","__esmMin","__name","propertyNames","properties","forEach","property","minLength","description","if","enum","then","$id","type","templateId","category","allowCategoryChange","ttl","components","required","v4","isNotEmpty","chatwootSchema","init_chatwoot_schema","__esmMin","__name","propertyNames","properties","forEach","property","minLength","description","if","enum","then","$id","type","enabled","accountId","token","url","signMsg","signDelimiter","nameInbox","reopenConversation","conversationPending","autoCreate","importContacts","mergeBrazilContacts","importMessages","daysLimitImportMessages","ignoreJids","items","required","v4","isNotEmpty","difySchema","difyStatusSchema","difySettingSchema","difyIgnoreJidSchema","init_dify_schema","__esmMin","__name","propertyNames","properties","forEach","property","minLength","description","if","enum","then","$id","type","enabled","botType","apiUrl","apiKey","triggerType","triggerOperator","triggerValue","expire","keywordFinish","delayMessage","unknownMessage","listeningFromMe","stopBotFromMe","keepOpen","debounceTime","ignoreJids","items","splitMessages","timePerChar","required","remoteJid","status","difyIdFallback","action","v4","isNotEmpty","evoaiSchema","evoaiStatusSchema","evoaiSettingSchema","evoaiIgnoreJidSchema","init_evoai_schema","__esmMin","__name","propertyNames","properties","forEach","property","minLength","description","if","enum","then","$id","type","enabled","agentUrl","apiKey","triggerType","triggerOperator","triggerValue","expire","keywordFinish","delayMessage","unknownMessage","listeningFromMe","stopBotFromMe","keepOpen","debounceTime","ignoreJids","items","splitMessages","timePerChar","required","remoteJid","status","botIdFallback","action","v4","isNotEmpty","evolutionBotSchema","evolutionBotStatusSchema","evolutionBotSettingSchema","evolutionBotIgnoreJidSchema","init_evolutionBot_schema","__esmMin","__name","propertyNames","properties","forEach","property","minLength","description","if","enum","then","$id","type","enabled","apiUrl","apiKey","triggerType","triggerOperator","triggerValue","expire","keywordFinish","delayMessage","unknownMessage","listeningFromMe","stopBotFromMe","keepOpen","debounceTime","ignoreJids","items","splitMessages","timePerChar","required","remoteJid","status","botIdFallback","action","v4","isNotEmpty","flowiseSchema","flowiseStatusSchema","flowiseSettingSchema","flowiseIgnoreJidSchema","init_flowise_schema","__esmMin","__name","propertyNames","properties","forEach","property","minLength","description","if","enum","then","$id","type","enabled","apiUrl","apiKey","triggerType","triggerOperator","triggerValue","expire","keywordFinish","delayMessage","unknownMessage","listeningFromMe","stopBotFromMe","keepOpen","debounceTime","ignoreJids","items","splitMessages","timePerChar","required","remoteJid","status","flowiseIdFallback","action","v4","isNotEmpty","n8nSchema","n8nStatusSchema","n8nSettingSchema","n8nIgnoreJidSchema","init_n8n_schema","__esmMin","__name","propertyNames","properties","forEach","property","minLength","description","if","enum","then","$id","type","enabled","webhookUrl","basicAuthUser","basicAuthPassword","triggerType","triggerOperator","triggerValue","expire","keywordFinish","delayMessage","unknownMessage","listeningFromMe","stopBotFromMe","keepOpen","debounceTime","ignoreJids","items","splitMessages","timePerChar","required","remoteJid","status","botIdFallback","action","v4","isNotEmpty","openaiSchema","openaiCredsSchema","openaiStatusSchema","openaiSettingSchema","openaiIgnoreJidSchema","init_openai_schema","__esmMin","__name","propertyNames","properties","forEach","property","minLength","description","if","enum","then","$id","type","enabled","openaiCredsId","botType","assistantId","functionUrl","model","systemMessages","items","assistantMessages","userMessages","maxTokens","triggerType","triggerOperator","triggerValue","expire","keywordFinish","delayMessage","unknownMessage","listeningFromMe","stopBotFromMe","keepOpen","debounceTime","ignoreJids","required","name","apiKey","remoteJid","status","speechToText","openaiIdFallback","action","v4","isNotEmpty","typebotSchema","typebotStatusSchema","typebotStartSchema","typebotSettingSchema","typebotIgnoreJidSchema","init_typebot_schema","__esmMin","__name","propertyNames","properties","forEach","property","minLength","description","if","enum","then","$id","type","enabled","url","typebot","triggerType","triggerOperator","triggerValue","expire","keywordFinish","delayMessage","unknownMessage","listeningFromMe","stopBotFromMe","ignoreJids","items","required","remoteJid","status","keepOpen","debounceTime","typebotIdFallback","action","init_chatbot_schema","__esmMin","init_chatwoot_schema","init_dify_schema","init_evoai_schema","init_evolutionBot_schema","init_flowise_schema","init_n8n_schema","init_openai_schema","init_typebot_schema","v4","isNotEmpty","pusherSchema","init_pusher_schema","__esmMin","init_event_controller","__name","propertyNames","properties","forEach","property","minLength","description","if","enum","then","$id","type","pusher","enabled","appId","key","secret","cluster","useTLS","events","minItems","items","EventController","required","v4","isNotEmpty","webhookSchema","init_webhook_schema","__esmMin","init_event_controller","__name","propertyNames","properties","forEach","property","minLength","description","if","enum","then","$id","type","webhook","enabled","url","headers","byEvents","base64","events","minItems","items","EventController","required","v4","eventSchema","init_event_schema","__esmMin","init_event_controller","init_pusher_schema","init_webhook_schema","$id","type","properties","websocket","$ref","rabbitmq","nats","sqs","kafka","$defs","event","enabled","enum","events","minItems","items","EventController","required","init_validate_schema","__esmMin","init_business_schema","init_chat_schema","init_group_schema","init_instance_schema","init_label_schema","init_message_schema","init_proxy_schema","init_settings_schema","init_template_schema","init_templateDelete_schema","init_templateEdit_schema","init_chatbot_schema","init_event_schema","Router","ChatwootRouter","init_chatwoot_router","__esmMin","init_abstract_router","init_instance_dto","init_chatwoot_dto","init_index_router","init_server_module","init_validate_schema","RouterBroker","guards","router","post","routerPath","req","res","response","dataValidate","request","schema","chatwootSchema","ClassRef","ChatwootDto","execute","__name","instance","data","chatwootController","createChatwoot","status","HttpStatus","CREATED","json","get","instanceSchema","InstanceDto","findChatwoot","OK","receiveWebhook","_ChatwootRouter","IgnoreJidDto","init_chatbot_dto","__esmMin","remoteJid","action","_IgnoreJidDto","BaseChatbotDto","BaseChatbotSettingDto","init_base_chatbot_dto","__esmMin","enabled","description","expire","keywordFinish","delayMessage","unknownMessage","listeningFromMe","stopBotFromMe","keepOpen","debounceTime","triggerType","triggerOperator","triggerValue","ignoreJids","splitMessages","timePerChar","_BaseChatbotDto","fallbackId","_BaseChatbotSettingDto","DifyDto","DifySettingDto","init_dify_dto","__esmMin","init_base_chatbot_dto","BaseChatbotDto","botType","apiUrl","apiKey","_DifyDto","BaseChatbotSettingDto","difyIdFallback","_DifySettingDto","Router","DifyRouter","init_dify_router","__esmMin","init_abstract_router","init_chatbot_dto","init_instance_dto","init_dify_dto","init_index_router","init_server_module","init_validate_schema","RouterBroker","guards","router","post","routerPath","req","res","response","dataValidate","request","schema","difySchema","ClassRef","DifyDto","execute","__name","instance","data","difyController","createBot","status","HttpStatus","CREATED","json","get","instanceSchema","InstanceDto","findBot","OK","fetchBot","params","difyId","put","updateBot","delete","deleteBot","difySettingSchema","DifySettingDto","settings","fetchSettings","difyStatusSchema","changeStatus","fetchSessions","difyIgnoreJidSchema","IgnoreJidDto","ignoreJid","_DifyRouter","OpenaiCredsDto","OpenaiDto","OpenaiSettingDto","init_openai_dto","__esmMin","init_base_chatbot_dto","name","apiKey","_OpenaiCredsDto","BaseChatbotDto","openaiCredsId","botType","assistantId","functionUrl","model","systemMessages","assistantMessages","userMessages","maxTokens","_OpenaiDto","BaseChatbotSettingDto","openaiIdFallback","speechToText","_OpenaiSettingDto","Router","OpenaiRouter","init_openai_router","__esmMin","init_abstract_router","init_chatbot_dto","init_instance_dto","init_openai_dto","init_index_router","init_server_module","init_validate_schema","RouterBroker","guards","router","post","routerPath","req","res","response","dataValidate","request","schema","openaiCredsSchema","ClassRef","OpenaiCredsDto","execute","__name","instance","data","openaiController","createOpenaiCreds","status","HttpStatus","CREATED","json","get","instanceSchema","InstanceDto","findOpenaiCreds","OK","delete","deleteCreds","params","openaiCredsId","openaiSchema","OpenaiDto","createBot","findBot","fetchBot","openaiBotId","put","updateBot","deleteBot","openaiSettingSchema","OpenaiSettingDto","settings","fetchSettings","openaiStatusSchema","changeStatus","fetchSessions","openaiIgnoreJidSchema","IgnoreJidDto","ignoreJid","getModels","query","_OpenaiRouter","TypebotDto","TypebotSettingDto","init_typebot_dto","__esmMin","init_base_chatbot_dto","BaseChatbotDto","url","typebot","_TypebotDto","BaseChatbotSettingDto","typebotIdFallback","_TypebotSettingDto","Router","TypebotRouter","init_typebot_router","__esmMin","init_abstract_router","init_chatbot_dto","init_instance_dto","init_typebot_dto","init_index_router","init_server_module","init_validate_schema","RouterBroker","guards","router","post","routerPath","req","res","response","dataValidate","request","schema","typebotSchema","ClassRef","TypebotDto","execute","__name","instance","data","typebotController","createBot","status","HttpStatus","CREATED","json","get","instanceSchema","InstanceDto","findBot","OK","fetchBot","params","typebotId","put","updateBot","delete","deleteBot","typebotSettingSchema","TypebotSettingDto","settings","fetchSettings","typebotStartSchema","startBot","typebotStatusSchema","changeStatus","fetchSessions","typebotIgnoreJidSchema","IgnoreJidDto","ignoreJid","_TypebotRouter","EvoaiDto","EvoaiSettingDto","init_evoai_dto","__esmMin","init_base_chatbot_dto","BaseChatbotDto","agentUrl","apiKey","_EvoaiDto","BaseChatbotSettingDto","evoaiIdFallback","_EvoaiSettingDto","Router","EvoaiRouter","init_evoai_router","__esmMin","init_abstract_router","init_chatbot_dto","init_instance_dto","init_index_router","init_server_module","init_validate_schema","init_evoai_dto","RouterBroker","guards","router","post","routerPath","req","res","response","dataValidate","request","schema","evoaiSchema","ClassRef","EvoaiDto","execute","__name","instance","data","evoaiController","createBot","status","HttpStatus","CREATED","json","get","instanceSchema","InstanceDto","findBot","OK","fetchBot","params","evoaiId","put","updateBot","delete","deleteBot","evoaiSettingSchema","EvoaiSettingDto","settings","fetchSettings","evoaiStatusSchema","changeStatus","fetchSessions","evoaiIgnoreJidSchema","IgnoreJidDto","ignoreJid","_EvoaiRouter","EvolutionBotDto","EvolutionBotSettingDto","init_evolutionBot_dto","__esmMin","init_base_chatbot_dto","BaseChatbotDto","apiUrl","apiKey","_EvolutionBotDto","BaseChatbotSettingDto","botIdFallback","_EvolutionBotSettingDto","Router","EvolutionBotRouter","init_evolutionBot_router","__esmMin","init_abstract_router","init_chatbot_dto","init_instance_dto","init_index_router","init_server_module","init_instance_schema","init_evolutionBot_dto","init_evolutionBot_schema","RouterBroker","guards","router","post","routerPath","req","res","response","dataValidate","request","schema","evolutionBotSchema","ClassRef","EvolutionBotDto","execute","__name","instance","data","evolutionBotController","createBot","status","HttpStatus","CREATED","json","get","instanceSchema","InstanceDto","findBot","OK","fetchBot","params","evolutionBotId","put","updateBot","delete","deleteBot","evolutionBotSettingSchema","EvolutionBotSettingDto","settings","fetchSettings","evolutionBotStatusSchema","changeStatus","fetchSessions","evolutionBotIgnoreJidSchema","IgnoreJidDto","ignoreJid","_EvolutionBotRouter","FlowiseDto","FlowiseSettingDto","init_flowise_dto","__esmMin","init_base_chatbot_dto","BaseChatbotDto","apiUrl","apiKey","_FlowiseDto","BaseChatbotSettingDto","flowiseIdFallback","_FlowiseSettingDto","Router","FlowiseRouter","init_flowise_router","__esmMin","init_abstract_router","init_chatbot_dto","init_instance_dto","init_index_router","init_server_module","init_instance_schema","init_flowise_dto","init_flowise_schema","RouterBroker","guards","router","post","routerPath","req","res","response","dataValidate","request","schema","flowiseSchema","ClassRef","FlowiseDto","execute","__name","instance","data","flowiseController","createBot","status","HttpStatus","CREATED","json","get","instanceSchema","InstanceDto","findBot","OK","fetchBot","params","flowiseId","put","updateBot","delete","deleteBot","flowiseSettingSchema","FlowiseSettingDto","settings","fetchSettings","flowiseStatusSchema","changeStatus","fetchSessions","flowiseIgnoreJidSchema","IgnoreJidDto","ignoreJid","_FlowiseRouter","N8nDto","N8nSettingDto","init_n8n_dto","__esmMin","init_base_chatbot_dto","BaseChatbotDto","webhookUrl","basicAuthUser","basicAuthPass","_N8nDto","BaseChatbotSettingDto","_N8nSettingDto","Router","N8nRouter","init_n8n_router","__esmMin","init_abstract_router","init_chatbot_dto","init_instance_dto","init_index_router","init_server_module","init_validate_schema","init_n8n_dto","RouterBroker","guards","router","post","routerPath","req","res","response","dataValidate","request","schema","n8nSchema","ClassRef","N8nDto","execute","__name","instance","data","n8nController","createBot","status","HttpStatus","CREATED","json","get","instanceSchema","InstanceDto","findBot","OK","fetchBot","params","n8nId","put","updateBot","delete","deleteBot","n8nSettingSchema","N8nSettingDto","settings","fetchSettings","n8nStatusSchema","changeStatus","fetchSessions","n8nIgnoreJidSchema","IgnoreJidDto","ignoreJid","_N8nRouter","Router","ChatbotRouter","init_chatbot_router","__esmMin","init_chatwoot_router","init_dify_router","init_openai_router","init_typebot_router","init_evoai_router","init_evolutionBot_router","init_flowise_router","init_n8n_router","guards","router","use","EvolutionBotRouter","ChatwootRouter","TypebotRouter","OpenaiRouter","DifyRouter","FlowiseRouter","N8nRouter","EvoaiRouter","_ChatbotRouter","Router","KafkaRouter","init_kafka_router","__esmMin","init_abstract_router","init_instance_dto","init_event_dto","init_index_router","init_server_module","init_validate_schema","RouterBroker","guards","router","post","routerPath","req","res","response","dataValidate","request","schema","eventSchema","ClassRef","EventDto","execute","__name","instance","data","eventManager","kafka","set","instanceName","status","HttpStatus","CREATED","json","get","instanceSchema","InstanceDto","OK","_KafkaRouter","Router","NatsRouter","init_nats_router","__esmMin","init_abstract_router","init_instance_dto","init_event_dto","init_index_router","init_server_module","init_validate_schema","RouterBroker","guards","router","post","routerPath","req","res","response","dataValidate","request","schema","eventSchema","ClassRef","EventDto","execute","__name","instance","data","eventManager","nats","set","instanceName","status","HttpStatus","CREATED","json","get","instanceSchema","InstanceDto","OK","_NatsRouter","Router","PusherRouter","init_pusher_router","__esmMin","init_abstract_router","init_instance_dto","init_event_dto","init_index_router","init_server_module","init_validate_schema","RouterBroker","guards","router","post","routerPath","req","res","response","dataValidate","request","schema","pusherSchema","ClassRef","EventDto","execute","__name","instance","data","eventManager","pusher","set","instanceName","status","HttpStatus","CREATED","json","get","instanceSchema","InstanceDto","OK","_PusherRouter","Router","RabbitmqRouter","init_rabbitmq_router","__esmMin","init_abstract_router","init_instance_dto","init_event_dto","init_index_router","init_server_module","init_validate_schema","RouterBroker","guards","router","post","routerPath","req","res","response","dataValidate","request","schema","eventSchema","ClassRef","EventDto","execute","__name","instance","data","eventManager","rabbitmq","set","instanceName","status","HttpStatus","CREATED","json","get","instanceSchema","InstanceDto","OK","_RabbitmqRouter","Router","SqsRouter","init_sqs_router","__esmMin","init_abstract_router","init_instance_dto","init_event_dto","init_index_router","init_server_module","init_validate_schema","RouterBroker","guards","router","post","routerPath","req","res","response","dataValidate","request","schema","eventSchema","ClassRef","EventDto","execute","__name","instance","data","eventManager","sqs","set","instanceName","status","HttpStatus","CREATED","json","get","instanceSchema","InstanceDto","OK","_SqsRouter","Router","WebhookRouter","init_webhook_router","__esmMin","init_abstract_router","init_instance_dto","init_event_dto","init_index_router","init_server_module","init_validate_schema","RouterBroker","configService","guards","router","post","routerPath","req","res","response","dataValidate","request","schema","webhookSchema","ClassRef","EventDto","execute","__name","instance","data","eventManager","webhook","set","instanceName","status","HttpStatus","CREATED","json","get","instanceSchema","InstanceDto","OK","_WebhookRouter","Router","WebsocketRouter","init_websocket_router","__esmMin","init_abstract_router","init_instance_dto","init_event_dto","init_index_router","init_server_module","init_validate_schema","RouterBroker","guards","router","post","routerPath","req","res","response","dataValidate","request","schema","eventSchema","ClassRef","EventDto","execute","__name","instance","data","eventManager","websocket","set","instanceName","status","HttpStatus","CREATED","json","get","instanceSchema","InstanceDto","OK","_WebsocketRouter","Router","EventRouter","init_event_router","__esmMin","init_kafka_router","init_nats_router","init_pusher_router","init_rabbitmq_router","init_sqs_router","init_webhook_router","init_websocket_router","configService","guards","router","use","WebhookRouter","WebsocketRouter","RabbitmqRouter","NatsRouter","PusherRouter","SqsRouter","KafkaRouter","_EventRouter","MediaDto","init_media_dto","__esmMin","id","type","messageId","expiry","_MediaDto","v4","isNotEmpty","s3Schema","s3UrlSchema","init_s3_schema","__esmMin","__name","propertyNames","properties","forEach","property","minLength","description","if","enum","then","$id","type","id","messageId","pattern","expiry","required","Router","S3Router","init_s3_router","__esmMin","init_abstract_router","init_media_dto","init_s3_schema","init_index_router","init_server_module","RouterBroker","guards","router","post","routerPath","req","res","response","dataValidate","request","schema","s3Schema","ClassRef","MediaDto","execute","__name","instance","data","s3Controller","getMedia","status","HttpStatus","CREATED","json","s3UrlSchema","getMediaUrl","OK","_S3Router","Router","StorageRouter","init_storage_router","__esmMin","init_s3_router","guards","router","use","S3Router","_StorageRouter","createMetaErrorResponse","error","context","metaError","template","errorUserTitle","error_user_title","message","errorUserMsg","error_user_msg","status","HttpStatus","BAD_REQUEST","details","whatsapp_error","whatsapp_code","code","error_type","type","error_subcode","fbtrace_id","timestamp","Date","toISOString","init_errorResponse","__esmMin","init_index_router","Router","BusinessRouter","init_business_router","__esmMin","init_abstract_router","init_chat_dto","init_server_module","init_errorResponse","init_validate_schema","init_index_router","RouterBroker","guards","router","post","routerPath","req","res","response","dataValidate","request","schema","catalogSchema","ClassRef","NumberDto","execute","__name","instance","data","businessController","fetchCatalog","status","HttpStatus","OK","json","error","console","errorResponse","createMetaErrorResponse","collectionsSchema","fetchCollections","_BusinessRouter","Metadata","OfferCallDto","init_call_dto","__esmMin","number","_Metadata","isVideo","callDuration","_OfferCallDto","Router","CallRouter","init_call_router","__esmMin","init_abstract_router","init_call_dto","init_server_module","init_validate_schema","init_index_router","RouterBroker","guards","router","post","routerPath","req","res","response","dataValidate","request","schema","offerCallSchema","ClassRef","OfferCallDto","execute","__name","instance","data","callController","offerCall","status","HttpStatus","CREATED","json","_CallRouter","Router","ChatRouter","init_chat_router","__esmMin","init_abstract_router","init_chat_dto","init_instance_dto","init_repository_service","init_server_module","init_validate_schema","init_index_router","RouterBroker","guards","router","post","routerPath","req","res","response","dataValidate","request","schema","whatsappNumberSchema","ClassRef","WhatsAppNumberDto","execute","__name","instance","data","chatController","whatsappNumber","status","HttpStatus","OK","json","error","console","log","BAD_REQUEST","readMessageSchema","ReadMessageDto","readMessage","CREATED","archiveChatSchema","ArchiveChatDto","archiveChat","markChatUnreadSchema","MarkChatUnreadDto","markChatUnread","delete","deleteMessageSchema","DeleteMessage","deleteMessage","profilePictureSchema","NumberDto","fetchProfilePicture","getBase64FromMediaMessageDto","getBase64FromMediaMessage","updateMessageSchema","UpdateMessageDto","updateMessage","presenceSchema","SendPresenceDto","sendPresence","blockUserSchema","BlockUserDto","blockUser","contactValidateSchema","Query","fetchContacts","messageValidateSchema","fetchMessages","messageUpSchema","fetchStatusMessage","fetchChats","get","params","remoteJid","query","findChatByRemoteJid","ProfilePictureDto","fetchBusinessProfile","profileSchema","fetchProfile","profileNameSchema","ProfileNameDto","updateProfileName","profileStatusSchema","ProfileStatusDto","updateProfileStatus","updateProfilePicture","removeProfilePicture","InstanceDto","fetchPrivacySettings","privacySettingsSchema","PrivacySettingDto","updatePrivacySettings","_ChatRouter","CreateGroupDto","GroupPictureDto","GroupSubjectDto","GroupDescriptionDto","GroupJid","GetParticipant","GroupInvite","AcceptGroupInvite","GroupSendInvite","GroupUpdateParticipantDto","GroupUpdateSettingDto","GroupToggleEphemeralDto","init_group_dto","__esmMin","subject","participants","description","promoteParticipants","_CreateGroupDto","groupJid","image","_GroupPictureDto","_GroupSubjectDto","_GroupDescriptionDto","_GroupJid","getParticipants","_GetParticipant","inviteCode","_GroupInvite","_AcceptGroupInvite","numbers","_GroupSendInvite","action","_GroupUpdateParticipantDto","_GroupUpdateSettingDto","expiration","_GroupToggleEphemeralDto","Router","GroupRouter","init_group_router","__esmMin","init_abstract_router","init_group_dto","init_server_module","init_validate_schema","init_index_router","RouterBroker","guards","router","post","routerPath","req","res","response","dataValidate","request","schema","createGroupSchema","ClassRef","CreateGroupDto","execute","__name","instance","data","groupController","createGroup","status","HttpStatus","CREATED","json","groupValidate","updateGroupSubjectSchema","GroupSubjectDto","updateGroupSubject","updateGroupPictureSchema","GroupPictureDto","updateGroupPicture","updateGroupDescriptionSchema","GroupDescriptionDto","updateGroupDescription","get","groupJidSchema","GroupJid","findGroupInfo","OK","getParticipantsValidate","getParticipantsSchema","GetParticipant","fetchAllGroups","findParticipants","inviteCode","inviteCodeValidate","groupInviteSchema","GroupInvite","inviteInfo","AcceptGroupInviteSchema","AcceptGroupInvite","acceptInviteCode","groupNoValidate","groupSendInviteSchema","GroupSendInvite","sendInvite","revokeInviteCode","updateParticipantsSchema","GroupUpdateParticipantDto","updateGParticipate","updateSettingsSchema","GroupUpdateSettingDto","updateGSetting","toggleEphemeralSchema","GroupToggleEphemeralDto","toggleEphemeral","delete","leaveGroup","_GroupRouter","Router","InstanceRouter","init_instance_router","__esmMin","init_abstract_router","init_instance_dto","init_server_module","init_validate_schema","init_index_router","RouterBroker","configService","guards","router","post","req","res","response","dataValidate","request","schema","instanceSchema","ClassRef","InstanceDto","execute","__name","instance","instanceController","createInstance","status","HttpStatus","CREATED","json","routerPath","restartInstance","OK","get","connectToWhatsapp","connectionState","key","fetchInstances","presenceOnlySchema","SetPresenceDto","data","setPresence","delete","logout","deleteInstance","_InstanceRouter","LabelDto","HandleLabelDto","init_label_dto","__esmMin","id","name","color","predefinedId","_LabelDto","number","labelId","action","_HandleLabelDto","Router","LabelRouter","init_label_router","__esmMin","init_abstract_router","init_label_dto","init_server_module","init_validate_schema","init_index_router","RouterBroker","guards","router","get","routerPath","req","res","response","dataValidate","request","schema","ClassRef","LabelDto","execute","__name","instance","labelController","fetchLabels","status","HttpStatus","OK","json","post","handleLabelSchema","HandleLabelDto","data","handleLabel","_LabelRouter","ProxyDto","init_proxy_dto","__esmMin","enabled","host","port","protocol","username","password","_ProxyDto","Router","ProxyRouter","init_proxy_router","__esmMin","init_abstract_router","init_instance_dto","init_proxy_dto","init_server_module","init_validate_schema","init_index_router","RouterBroker","guards","router","post","routerPath","req","res","response","dataValidate","request","schema","proxySchema","ClassRef","ProxyDto","execute","__name","instance","data","proxyController","createProxy","status","HttpStatus","CREATED","json","get","instanceSchema","InstanceDto","findProxy","OK","_ProxyRouter","Metadata","SendTextDto","SendStatusDto","SendPollDto","SendMediaDto","SendPtvDto","SendStickerDto","SendButtonsDto","SendLocationDto","SendListDto","SendTemplateDto","SendContactDto","SendReactionDto","init_sendMessage_dto","__esmMin","number","delay","quoted","linkPreview","mentionsEveryOne","mentioned","encoding","notConvertSticker","_Metadata","text","_SendTextDto","type","content","statusJidList","allContacts","caption","backgroundColor","font","_SendStatusDto","name","selectableCount","values","messageSecret","_SendPollDto","mediatype","mimetype","fileName","media","_SendMediaDto","video","_SendPtvDto","sticker","_SendStickerDto","thumbnailUrl","title","description","footer","buttons","_SendButtonsDto","latitude","longitude","address","_SendLocationDto","footerText","buttonText","sections","_SendListDto","language","components","webhookUrl","_SendTemplateDto","contact","_SendContactDto","key","reaction","_SendReactionDto","Router","multer","upload","MessageRouter","init_sendMessage_router","__esmMin","init_abstract_router","init_sendMessage_dto","init_server_module","init_validate_schema","init_index_router","storage","memoryStorage","RouterBroker","guards","router","post","routerPath","req","res","response","dataValidate","request","schema","templateMessageSchema","ClassRef","SendTemplateDto","execute","__name","instance","data","sendMessageController","sendTemplate","status","HttpStatus","CREATED","json","textMessageSchema","SendTextDto","sendText","single","bodyData","body","mediaMessageSchema","SendMediaDto","sendMedia","file","ptvMessageSchema","SendPtvDto","sendPtv","audioMessageSchema","sendWhatsAppAudio","statusMessageSchema","SendStatusDto","sendStatus","stickerMessageSchema","SendStickerDto","sendSticker","locationMessageSchema","SendLocationDto","sendLocation","contactMessageSchema","SendContactDto","sendContact","reactionMessageSchema","SendReactionDto","sendReaction","pollMessageSchema","SendPollDto","sendPoll","listMessageSchema","SendListDto","sendList","buttonsMessageSchema","SendButtonsDto","sendButtons","_MessageRouter","SettingsDto","init_settings_dto","__esmMin","rejectCall","msgCall","groupsIgnore","alwaysOnline","readMessages","readStatus","syncFullHistory","wavoipToken","_SettingsDto","Router","SettingsRouter","init_settings_router","__esmMin","init_abstract_router","init_instance_dto","init_settings_dto","init_server_module","init_validate_schema","init_index_router","RouterBroker","guards","router","post","routerPath","req","res","response","dataValidate","request","schema","settingsSchema","ClassRef","SettingsDto","execute","__name","instance","data","settingsController","createSettings","status","HttpStatus","CREATED","json","get","InstanceDto","findSettings","OK","_SettingsRouter","TemplateDto","TemplateEditDto","TemplateDeleteDto","init_template_dto","__esmMin","name","category","allowCategoryChange","language","components","webhookUrl","_TemplateDto","templateId","ttl","_TemplateEditDto","hsmId","_TemplateDeleteDto","Router","TemplateRouter","init_template_router","__esmMin","init_abstract_router","init_instance_dto","init_template_dto","init_server_module","init_errorResponse","init_templateDelete_schema","init_templateEdit_schema","init_validate_schema","init_index_router","RouterBroker","configService","guards","router","post","routerPath","req","res","response","dataValidate","request","schema","templateSchema","ClassRef","TemplateDto","execute","__name","instance","data","templateController","createTemplate","status","HttpStatus","CREATED","json","error","console","errorResponse","createMetaErrorResponse","templateEditSchema","TemplateEditDto","editTemplate","OK","delete","templateDeleteSchema","TemplateDeleteDto","deleteTemplate","get","instanceSchema","InstanceDto","findTemplate","_TemplateRouter","express","Router","path","ViewsRouter","init_view_router","__esmMin","init_abstract_router","RouterBroker","router","basePath","join","process","cwd","indexPath","use","static","get","req","res","sendFile","_ViewsRouter","Router","fs","mimeTypes","path","HttpStatus","router","serverConfig","databaseConfig","guards","telemetry","packageJson","metricsIPWhitelist","metricsBasicAuth","metricsConfig","init_index_router","__esmMin","init_auth_guard","init_instance_guard","init_telemetry_guard","init_channel_router","init_chatbot_router","init_event_router","init_storage_router","init_server_module","init_env_config","init_fetchLatestWaWebVersion","init_business_router","init_call_router","init_chat_router","init_group_router","init_instance_router","init_label_router","init_proxy_router","init_sendMessage_router","init_settings_router","init_template_router","init_view_router","configService","get","instanceExistsGuard","instanceLoggedGuard","authGuard","Telemetry","JSON","parse","readFileSync","__name","req","res","next","allowedIPs","ALLOWED_IPS","split","map","ip","trim","clientIPs","connection","remoteAddress","socket","headers","filter","undefined","includes","status","send","metricsUser","USER","metricsPass","PASSWORD","auth","startsWith","set","credentials","Buffer","from","slice","toString","user","pass","ENABLED","metricsMiddleware","push","AUTH_REQUIRED","escapeLabel","value","String","replace","lines","clientName","CONNECTION","CLIENT_NAME","serverUrl","URL","version","instances","waMonitor","waInstances","instanceEntries","Object","entries","length","name","instance","state","connectionStatus","integration","up","join","DISABLE_MANAGER","use","ViewsRouter","fileName","params","isAbsolute","basePath","process","cwd","assetsPath","filePath","resolvedPath","resolve","resolvedAssetsPath","sep","existsSync","lookup","collectTelemetry","json","message","manager","protocol","documentation","whatsappWebVersion","fetchLatestWaWebVersion","post","facebookConfig","facebookAppId","APP_ID","facebookConfigId","CONFIG_ID","facebookUserToken","USER_TOKEN","InstanceRouter","MessageRouter","CallRouter","ChatRouter","BusinessRouter","GroupRouter","TemplateRouter","SettingsRouter","ProxyRouter","LabelRouter","ChannelRouter","EventRouter","ChatbotRouter","StorageRouter","onUnexpectedError","process","on","error","origin","Logger","stderr","fd","logger","init_error_config","__esmMin","init_logger_config","readFileSync","http","https","_app","ServerUP","init_server_up","__esmMin","init_env_config","app","e","__privateSet","FULLCHAIN","PRIVKEY","configService","get","createServer","cert","key","__privateAdd","_ServerUP","Sentry","axios","compression","cors","express","json","urlencoded","join","require_main","__commonJSMin","import_instrumentSentry","init_sessions","init_repository_service","init_index_router","init_server_module","init_env_config","init_error_config","init_logger_config","init_path_config","init_server_up","initWA","waMonitor","loadInstance","bootstrap","logger","Logger","app","providerFiles","configService","get","ENABLED","ProviderFiles","onModuleInit","info","PrismaRepository","use","origin","requestOrigin","callback","ORIGIN","includes","indexOf","Error","methods","METHODS","credentials","CREDENTIALS","extended","limit","set","ROOT_DIR","static","router","err","req","res","next","webhook","EVENTS","ERRORS_WEBHOOK","ERRORS","tzoffset","Date","getTimezoneOffset","now","toISOString","globalApiKey","API_KEY","KEY","serverUrl","URL","errorData","event","data","error","message","status","response","date_time","api_key","server_url","baseURL","create","post","method","url","HttpStatus","NOT_FOUND","toUpperCase","httpServer","ServerUP","server","TYPE","warn","eventManager","init","DSN","setupExpressErrorHandler","listen","PORT","log","catch","onUnexpectedError"]}