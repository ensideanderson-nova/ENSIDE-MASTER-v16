<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ENSIDE MASTER v16.0 - Sistema Completo Final</title>
    <style>
        :root {
            --primary: #0ea5e9;
            --primary-dark: #0284c7;
            --primary-light: #38bdf8;
            --bg-dark: #0f172a;
            --bg-light: #1e293b;
            --text: #e2e8f0;
            --text-muted: #94a3b8;
        }

        /* TEMAS */
        body.theme-blue { --primary: #0ea5e9; --primary-dark: #0284c7; --primary-light: #38bdf8; }
        body.theme-purple { --primary: #a855f7; --primary-dark: #9333ea; --primary-light: #c084fc; }
        body.theme-green { --primary: #22c55e; --primary-dark: #16a34a; --primary-light: #4ade80; }
        body.theme-red { --primary: #ef4444; --primary-dark: #dc2626; --primary-light: #f87171; }
        body.theme-orange { --primary: #f59e0b; --primary-dark: #d97706; --primary-light: #fbbf24; }
        
        body.light-mode {
            --bg-dark: #f1f5f9;
            --bg-light: #e2e8f0;
            --text: #1e293b;
            --text-muted: #475569;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-light) 100%);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* HEADER */
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(14, 165, 233, 0.3);
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(14, 165, 233, 0.1);
        }

        h1 {
            font-size: 2.5em;
            color: var(--primary);
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(14, 165, 233, 0.3);
            letter-spacing: 1px;
        }

        /* THEME SWITCHER */
        .theme-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 8px;
            background: rgba(0,0,0,0.5);
            padding: 10px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }
        .theme-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
        }
        .theme-btn:hover { transform: scale(1.2); }
        .theme-btn.active { border-color: white; }
        .theme-btn.blue { background: #0ea5e9; }
        .theme-btn.purple { background: #a855f7; }
        .theme-btn.green { background: #22c55e; }
        .theme-btn.red { background: #ef4444; }
        .theme-btn.orange { background: #f59e0b; }
        .dark-toggle {
            background: linear-gradient(135deg, #fbbf24, #1e293b);
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .subtitle {
            color: #94a3b8;
            font-size: 1.1em;
            margin-bottom: 20px;
        }

        .version-badge {
            display: inline-block;
            background: rgba(14, 165, 233, 0.2);
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-top: 10px;
            font-weight: 600;
        }

        /* STATS */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: rgba(14, 165, 233, 0.1);
            border: 1px solid rgba(14, 165, 233, 0.3);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            background: rgba(14, 165, 233, 0.15);
            border-color: #0ea5e9;
            transform: translateY(-3px);
        }

        .stat-value {
            font-size: 2em;
            color: var(--primary);
            font-weight: bold;
        }

        .stat-label {
            color: #94a3b8;
            font-size: 0.9em;
            margin-top: 5px;
        }

        /* TABS */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(14, 165, 233, 0.2);
            overflow-x: auto;
            padding-bottom: 10px;
        }

        .tab-btn {
            background: transparent;
            color: #94a3b8;
            border: none;
            padding: 12px 24px;
            cursor: pointer;
            font-size: 1em;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-weight: 500;
        }

        .tab-btn:hover {
            color: #0ea5e9;
        }

        .tab-btn.active {
            color: #0ea5e9;
            border-bottom-color: #0ea5e9;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* SECTIONS */
        .section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .section-title {
            color: #0ea5e9;
            margin-bottom: 20px;
            font-size: 1.8em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        h2 {
            color: #0ea5e9;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        h3 {
            color: #0ea5e9;
            margin: 20px 0 15px 0;
            font-size: 1.2em;
        }

        /* FORMS */
        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #cbd5e1;
            font-size: 0.95em;
            font-weight: 500;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #e2e8f0;
            font-size: 1em;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #0ea5e9;
            background: rgba(14, 165, 233, 0.1);
            box-shadow: 0 0 15px rgba(14, 165, 233, 0.3);
        }

        /* BUTTONS */
        button {
            background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(14, 165, 233, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: rgba(14, 165, 233, 0.2);
            color: #0ea5e9;
            border: 1px solid #0ea5e9;
        }

        .btn-secondary:hover {
            background: rgba(14, 165, 233, 0.3);
        }

        /* DROP ZONE */
        .drop-zone {
            border: 2px dashed #0ea5e9;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            background: rgba(14, 165, 233, 0.05);
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px 0;
        }

        .drop-zone:hover,
        .drop-zone.dragover {
            background: rgba(14, 165, 233, 0.15);
            border-color: #06b6d4;
            box-shadow: 0 0 30px rgba(14, 165, 233, 0.2);
        }

        .drop-zone p {
            color: #0ea5e9;
            margin: 10px 0;
            font-weight: 600;
            font-size: 1.1em;
        }

        .drop-zone small {
            color: #94a3b8;
            display: block;
        }

        /* TABLES */
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95em;
        }

        th {
            background: rgba(14, 165, 233, 0.2);
            padding: 12px;
            text-align: left;
            color: #0ea5e9;
            border-bottom: 2px solid rgba(14, 165, 233, 0.3);
            font-weight: 600;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid rgba(14, 165, 233, 0.1);
            color: #cbd5e1;
        }

        tr:hover {
            background: rgba(14, 165, 233, 0.08);
        }

        /* BADGES */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin: 2px;
        }

        .badge-success {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .badge-error {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* PROGRESS */
        .progress-bar {
            width: 100%;
            height: 25px;
            background: rgba(14, 165, 233, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
            border: 1px solid rgba(14, 165, 233, 0.3);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0ea5e9 0%, #06b6d4 100%);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 12px;
        }

        /* INFO BOX */
        .info-box {
            background: rgba(34, 197, 94, 0.1);
            border-left: 4px solid #22c55e;
            padding: 15px 20px;
            border-radius: 8px;
            margin: 20px 0;
            color: #cbd5e1;
            font-size: 0.95em;
            line-height: 1.6;
        }

        .code-block {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(14, 165, 233, 0.3);
            border-radius: 8px;
            padding: 15px;
            overflow-x: auto;
            margin: 15px 0;
        }

        .code-block code {
            color: #0ea5e9;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9em;
        }

        /* GRID */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .grid-card {
            background: rgba(14, 165, 233, 0.08);
            border: 1px solid rgba(14, 165, 233, 0.2);
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .grid-card:hover {
            border-color: #0ea5e9;
            background: rgba(14, 165, 233, 0.12);
            transform: translateY(-3px);
        }

        /* SCROLLBAR */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #0f172a;
        }

        ::-webkit-scrollbar-thumb {
            background: #0ea5e9;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #06b6d4;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            h1 { font-size: 1.8em; }
            .tabs { gap: 5px; }
            .tab-btn { padding: 10px 16px; font-size: 0.9em; }
            .grid { grid-template-columns: 1fr; }
            body { padding: 10px; }
        }
    </style>
</head>
<body class="theme-blue">
    <!-- THEME SWITCHER -->
    <div class="theme-switcher">
        <button class="theme-btn blue active" onclick="setTheme('blue')" title="Azul"></button>
        <button class="theme-btn purple" onclick="setTheme('purple')" title="Roxo"></button>
        <button class="theme-btn green" onclick="setTheme('green')" title="Verde"></button>
        <button class="theme-btn red" onclick="setTheme('red')" title="Vermelho"></button>
        <button class="theme-btn orange" onclick="setTheme('orange')" title="Laranja"></button>
        <button class="theme-btn dark-toggle" onclick="toggleDarkMode()" title="Modo Claro/Escuro">‚òº</button>
    </div>

    <div class="container">
        <!-- HEADER -->
        <header>
            <h1>üèÜ ENSIDE MASTER v16.0</h1>
            <p class="subtitle">Sistema Completo | Importador Universal | GitHub Integrado</p>
            <div class="version-badge">‚úÖ v16.0 FINAL - Pronto para Produ√ß√£o</div>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value">4.077+</div>
                    <div class="stat-label">Contatos Totais</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">1.200+</div>
                    <div class="stat-label">Fornecedores</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">100%</div>
                    <div class="stat-label">Operacional</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">‚àû</div>
                    <div class="stat-label">Possibilidades</div>
                </div>
            </div>
        </header>

        <!-- TABS -->
        <div class="tabs">
            <button class="tab-btn active" onclick="mudarAba('importador')">üì• Importador Universal</button>
            <button class="tab-btn" onclick="mudarAba('processador')">‚öôÔ∏è Processador</button>
            <button class="tab-btn" onclick="mudarAba('dashboard')">üìä Dashboard</button>
            <button class="tab-btn" onclick="mudarAba('evolution')">üì± Evolution API</button>
            <button class="tab-btn" onclick="mudarAba('multiia')">ü§ñ Multi-IA</button>
            <button class="tab-btn" onclick="mudarAba('triagem')">üéØ Triagem IA</button>
            <button class="tab-btn" onclick="mudarAba('listas')">üìù Listas WhatsApp</button>
            <button class="tab-btn" onclick="mudarAba('github')">üêô GitHub API</button>
            <button class="tab-btn" onclick="mudarAba('sincronizacao')">üîÑ Sincroniza√ß√£o</button>
            <button class="tab-btn" onclick="mudarAba('fretes')">üöö Fretes</button>
            <button class="tab-btn" onclick="mudarAba('captacao')">üìã Capta√ß√£o Leads</button>
            <button class="tab-btn" onclick="mudarAba('documentacao')">üìñ Documenta√ß√£o</button>
        </div>

        <!-- ==================== ABA IMPORTADOR ==================== -->
        <div id="importador" class="tab-content active">
            <div class="section">
                <div class="section-title">üì• Importador Universal Completo</div>
                <p style="color: #94a3b8; margin-bottom: 20px;">
                    Importe dados de m√∫ltiplas fontes | Detecta automaticamente | Organiza por tipo | Move para pasta correta
                </p>
            </div>

            <div class="section">
                <h3>üìÇ Selecione seus Arquivos</h3>
                <p style="color: #94a3b8; margin-bottom: 20px;">Suportados: CSV, JSON, Excel, TXT, XML</p>
                
                <div class="drop-zone" id="dropZone">
                    <p>üìÅ Arraste arquivos aqui ou use os bot√µes abaixo</p>
                    <small>CSV ‚Ä¢ JSON ‚Ä¢ XLSX ‚Ä¢ XLS ‚Ä¢ TXT ‚Ä¢ XML</small>
                    <input type="file" id="fileInput" multiple style="display:none;" accept=".csv,.json,.xlsx,.xls,.txt,.xml">
                    <div style="margin-top: 20px; display: flex; gap: 15px; justify-content: center;">
                        <button onclick="event.stopPropagation(); importarArquivos()" style="background: linear-gradient(135deg, #22c55e, #16a34a); padding: 12px 25px;">üìÑ Arquivos</button>
                        <button onclick="event.stopPropagation(); importarPastas()" style="background: linear-gradient(135deg, #f59e0b, #d97706); padding: 12px 25px;">üìÅ Pasta</button>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
                    <div class="form-group">
                        <label>Tipo de Dado</label>
                        <select id="tipoDado">
                            <option value="auto">üîç Detectar Automaticamente</option>
                            <option value="contatos">üë• Contatos</option>
                            <option value="fornecedores">üè≠ Fornecedores</option>
                            <option value="frete">üí∞ Fretes</option>
                            <option value="vendas">üìä Vendas</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Separador (CSV)</label>
                        <select id="separator">
                            <option value=",">V√≠rgula (,)</option>
                            <option value=";">Ponto e v√≠rgula (;)</option>
                            <option value="\t">Tabula√ß√£o (Tab)</option>
                        </select>
                    </div>
                </div>

                <button onclick="processarImportacao()">‚ñ∂Ô∏è Processar Importa√ß√£o</button>
            </div>

            <div class="section" id="previewSection" style="display:none;">
                <h3>üëÅÔ∏è Visualiza√ß√£o de Dados</h3>
                <div class="table-container">
                    <table id="previewTable">
                        <thead id="tableHead"></thead>
                        <tbody id="tableBody"></tbody>
                    </table>
                </div>
                <button onclick="confirmarImportacao()" style="margin-top: 20px;">‚úÖ Confirmar e Importar</button>
                <button class="btn-secondary" onclick="cancelarImportacao()" style="margin-left: 10px;">‚ùå Cancelar</button>
            </div>

            <div class="section" id="progressSection" style="display:none;">
                <h3>üìä Progresso</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar" style="width: 0%;">0%</div>
                </div>
                <p id="progressText" style="color: #0ea5e9; margin-top: 15px; font-weight: 600;"></p>
            </div>

            <div class="section" id="resultSection" style="display:none;">
                <h3>‚úÖ Importa√ß√£o Conclu√≠da</h3>
                <div id="resultContent"></div>
                <button onclick="novaImportacao()" style="margin-top: 20px;">üîÑ Nova Importa√ß√£o</button>
            </div>
        </div>

        <!-- ==================== ABA PROCESSADOR ==================== -->
        <div id="processador" class="tab-content">
            <div class="section">
                <div class="section-title">‚öôÔ∏è Processador de Dados</div>
                <p style="color: #94a3b8; margin-bottom: 20px;">
                    Valida | Limpa | Deduplicata | Normaliza | Organiza
                </p>
            </div>

            <div class="grid">
                <div class="grid-card">
                    <h3>‚úÖ Valida√ß√£o</h3>
                    <p style="color: #94a3b8; margin: 10px 0;">
                        Verifica integridade de dados, formatos corretos, campos obrigat√≥rios
                    </p>
                    <button class="btn-secondary" onclick="executarValidacao()">Validar</button>
                </div>

                <div class="grid-card">
                    <h3>üßπ Limpeza</h3>
                    <p style="color: #94a3b8; margin: 10px 0;">
                        Remove espa√ßos, normaliza fontes, padroniza formatos
                    </p>
                    <button class="btn-secondary" onclick="executarLimpeza()">Limpar</button>
                </div>

                <div class="grid-card">
                    <h3>üîó Deduplica√ß√£o</h3>
                    <p style="color: #94a3b8; margin: 10px 0;">
                        Identifica e remove registros duplicados por email, WhatsApp ou nome
                    </p>
                    <button class="btn-secondary" onclick="executarDeduplicacao()">Deduplicar</button>
                </div>

                <div class="grid-card">
                    <h3>üìÇ Organiza√ß√£o</h3>
                    <p style="color: #94a3b8; margin: 10px 0;">
                        Move arquivos processados para pastas por tipo/categoria
                    </p>
                    <button class="btn-secondary" onclick="executarOrganizacao()">Organizar</button>
                </div>
            </div>

            <div class="section" style="margin-top: 20px;">
                <h3>üìà Estat√≠sticas</h3>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value" id="statProcessados">0</div>
                        <div class="stat-label">Processados</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statValidados">0</div>
                        <div class="stat-label">Validados</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statErros">0</div>
                        <div class="stat-label">Erros</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statDuplicatas">0</div>
                        <div class="stat-label">Duplicatas</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== ABA DASHBOARD ==================== -->
        <div id="dashboard" class="tab-content">
            <div class="section">
                <div class="section-title">üìà Dashboard Executivo</div>
                <p style="color: #94a3b8;">Vis√£o geral de todos os dados do sistema</p>
            </div>

            <div class="section">
                <h3>üìä KPIs Principais</h3>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value">4.077</div>
                        <div class="stat-label">Total de Contatos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">1.200</div>
                        <div class="stat-label">Fornecedores Ativos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">377</div>
                        <div class="stat-label">Transportadores</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">2.500</div>
                        <div class="stat-label">Clientes</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>üìã √öltimas Importa√ß√µes</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Arquivo</th>
                                <th>Tipo</th>
                                <th>Registros</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>10/12/2025 14:30</td>
                                <td>contatos_dezembro.csv</td>
                                <td>üë• Contatos</td>
                                <td>145</td>
                                <td><span class="badge badge-success">‚úì Sucesso</span></td>
                            </tr>
                            <tr>
                                <td>09/12/2025 10:15</td>
                                <td>fornecedores_update.json</td>
                                <td>üè≠ Fornecedores</td>
                                <td>32</td>
                                <td><span class="badge badge-success">‚úì Sucesso</span></td>
                            </tr>
                            <tr>
                                <td>08/12/2025 15:45</td>
                                <td>vendas_mensal.xlsx</td>
                                <td>üìä Vendas</td>
                                <td>287</td>
                                <td><span class="badge badge-success">‚úì Sucesso</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ==================== ABA EVOLUTION API ==================== -->
        <div id="evolution" class="tab-content">
            <div class="section">
                <div class="section-title">üì± Evolution API - WhatsApp Autom√°tico</div>
                <p style="color: #94a3b8; margin-bottom: 20px;">
                    Integra√ß√£o completa com WhatsApp via Evolution API | Envio autom√°tico | QR Code | Status em tempo real
                </p>
            </div>

            <div class="section">
                <h3>‚öôÔ∏è Configura√ß√£o da Evolution API</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>URL da API</label>
                        <input type="text" id="evolutionUrl" placeholder="https://sua-api.evolution.com" value="https://api.evolution.com.br">
                    </div>
                    <div class="form-group">
                        <label>API Key</label>
                        <input type="password" id="evolutionApiKey" placeholder="Sua chave de API">
                    </div>
                </div>
                <div class="form-group">
                    <label>Nome da Inst√¢ncia</label>
                    <input type="text" id="evolutionInstance" placeholder="enside-madeiras" value="enside-madeiras">
                </div>
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button onclick="testarConexaoEvolution()" style="background: linear-gradient(135deg, #22c55e, #16a34a);">üîå Testar Conex√£o</button>
                    <button onclick="salvarConfigEvolution()" class="btn-secondary">üíæ Salvar Config</button>
                </div>
            </div>

            <div class="section">
                <h3>üì± Status da Inst√¢ncia</h3>
                <div class="stats">
                    <div class="stat-card" id="evolutionStatusCard">
                        <div class="stat-value" id="evolutionStatus">‚è≥</div>
                        <div class="stat-label">Status</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="evolutionMsgs">0</div>
                        <div class="stat-label">Mensagens Enviadas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="evolutionContacts">0</div>
                        <div class="stat-label">Contatos Ativos</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>üì∑ Conectar via QR Code</h3>
                <div style="text-align: center; padding: 20px;">
                    <div id="qrCodeContainer" style="background: white; padding: 20px; border-radius: 12px; display: inline-block; min-width: 200px; min-height: 200px;">
                        <p style="color: #333;">Clique para gerar QR Code</p>
                    </div>
                    <div style="margin-top: 15px;">
                        <button onclick="gerarQRCode()">üì∑ Gerar QR Code</button>
                        <button onclick="verificarConexao()" class="btn-secondary" style="margin-left: 10px;">üîÑ Verificar Conex√£o</button>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>üì§ Enviar Mensagem de Teste</h3>
                <div class="form-group">
                    <label>N√∫mero (com DDD)</label>
                    <input type="text" id="evolutionNumero" placeholder="5518999999999">
                </div>
                <div class="form-group">
                    <label>Mensagem</label>
                    <textarea id="evolutionMensagem" rows="3" placeholder="Digite sua mensagem de teste...">üå≤ Ol√°! Esta √© uma mensagem de teste do sistema ENSIDE MADEIRAS.</textarea>
                </div>
                <button onclick="enviarMensagemEvolution()">üì§ Enviar Mensagem</button>
            </div>

            <div class="section">
                <h3>üìä Envio em Massa</h3>
                <p style="color: #94a3b8; margin-bottom: 15px;">Envie mensagens para m√∫ltiplos contatos (limite: 256 por lista)</p>
                <div class="form-group">
                    <label>Selecionar Lista de Contatos</label>
                    <select id="evolutionLista">
                        <option value="">Selecione uma lista...</option>
                        <optgroup label="üìã Listas B√°sicas">
                            <option value="fornecedores">üè≠ Fornecedores (1.200)</option>
                            <option value="clientes">üë• Clientes (2.500)</option>
                            <option value="transportadores">üöö Transportadores (377)</option>
                        </optgroup>
                        <optgroup label="üìä Listas da Planilha (Sincronizadas)">
                            <option value="fornecedores_mouroes">ü™µ Fornecedores Mour√µes (180)</option>
                            <option value="clientes_varejo_sp">üè™ Clientes Varejo SP (400)</option>
                            <option value="transportadores_frete_longo">üöõ Transportadores Frete Longo (85)</option>
                            <option value="fornecedores_tratamento_cca">üß™ Fornecedores Tratamento CCA (150)</option>
                            <option value="clientes_construcao">üèóÔ∏è Clientes Constru√ß√£o (450)</option>
                            <option value="clientes_atacado">üì¶ Clientes Atacado (350)</option>
                            <option value="fornecedores_eucalipto_verde">üåø Fornecedores Eucalipto Verde (200)</option>
                            <option value="clientes_rural">üåæ Clientes Rural (380)</option>
                            <option value="todos_fornecedores">üè≠ Todos Fornecedores (1.200)</option>
                            <option value="todos_clientes">üë• Todos Clientes (2.500)</option>
                        </optgroup>
                    </select>
                    <button onclick="sincronizarListasPlanilha()" style="margin-top: 10px; background: linear-gradient(135deg, #22c55e, #16a34a); padding: 8px 16px; border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold;">üîÑ SINCRONIZAR COM PLANILHA</button>
                </div>
                <div class="form-group">
                    <label>Mensagem para Envio em Massa</label>
                    <textarea id="evolutionMensagemMassa" rows="4" placeholder="Use {nome} para personalizar...">üå≤ Ol√° {nome}! A ENSIDE MADEIRAS tem novidades para voc√™. Entre em contato!</textarea>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button onclick="enviarMensagemMassa()" style="background: linear-gradient(135deg, #f59e0b, #d97706);">üì® Enviar para Lista</button>
                    <button onclick="agendarEnvio()" class="btn-secondary">‚è∞ Agendar Envio</button>
                </div>
            </div>

            <div class="info-box">
                <strong>üí° Dica:</strong> A Evolution API permite enviar mensagens autom√°ticas via WhatsApp. 
                Configure sua inst√¢ncia em <a href="https://evolution-api.com" target="_blank" style="color: #0ea5e9;">evolution-api.com</a>
            </div>
        </div>

        <!-- ==================== ABA MULTI-IA ==================== -->
        <div id="multiia" class="tab-content">
            <div class="section">
                <div class="section-title">ü§ñ Multi-IA - Chat Inteligente</div>
                <p style="color: #94a3b8; margin-bottom: 20px;">
                    Chat com m√∫ltiplos provedores de IA | GPT-4o | Claude | Groq Llama | Contexto ENSIDE MADEIRAS
                </p>
            </div>

            <div class="section">
                <h3>üîë Configura√ß√£o de API Keys</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>OpenAI API Key</label>
                        <input type="password" id="openaiKey" placeholder="sk-...">
                    </div>
                    <div class="form-group">
                        <label>Claude API Key</label>
                        <input type="password" id="claudeKey" placeholder="sk-ant-...">
                    </div>
                    <div class="form-group">
                        <label>Groq API Key</label>
                        <input type="password" id="groqKey" placeholder="gsk_...">
                    </div>
                </div>
                <button onclick="salvarAPIKeys()" class="btn-secondary">üíæ Salvar Chaves</button>
            </div>

            <div class="section">
                <h3>üí¨ Chat com IA</h3>
                <div class="form-group">
                    <label>Selecionar Modelo</label>
                    <select id="iaModelo">
                        <option value="gpt-4o-mini">üß† GPT-4o Mini (OpenAI)</option>
                        <option value="claude-3-haiku">ü§ñ Claude 3 Haiku (Anthropic)</option>
                        <option value="llama-3.3-70b" selected>ü¶ô Llama 3.3 70B (Groq - Gratuito)</option>
                    </select>
                </div>
                <div id="chatContainer" style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 15px; height: 300px; overflow-y: auto; margin-bottom: 15px;">
                    <div class="chat-message" style="background: rgba(14, 165, 233, 0.2); padding: 10px; border-radius: 8px; margin-bottom: 10px;">
                        <strong style="color: #0ea5e9;">ü§ñ IA:</strong> Ol√°! Sou o assistente da ENSIDE MADEIRAS. Posso ajudar com:
                        <ul style="margin: 10px 0 0 20px; color: #94a3b8;">
                            <li>Pre√ßos de eucalipto tratado e n√£o tratado</li>
                            <li>Informa√ß√µes sobre fornecedores</li>
                            <li>C√°lculos de frete e custos</li>
                            <li>Recomenda√ß√µes de neg√≥cio</li>
                        </ul>
                    </div>
                </div>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="iaInput" placeholder="Digite sua pergunta..." style="flex: 1;" onkeypress="if(event.key==='Enter')enviarMensagemIA()">
                    <button onclick="enviarMensagemIA()">üì§ Enviar</button>
                </div>
            </div>

            <div class="section">
                <h3>üéØ Comandos R√°pidos</h3>
                <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                    <button onclick="comandoIA('analise')" class="btn-secondary">üìä An√°lise Completa</button>
                    <button onclick="comandoIA('topClientes')" class="btn-secondary">üèÜ Top Clientes</button>
                    <button onclick="comandoIA('oportunidades')" class="btn-secondary">üí° Oportunidades</button>
                    <button onclick="comandoIA('riscos')" class="btn-secondary">‚ö†Ô∏è Riscos</button>
                    <button onclick="comandoIA('tendencias')" class="btn-secondary">üìà Tend√™ncias</button>
                </div>
            </div>

            <div class="info-box">
                <strong>üí° Contexto ENSIDE MADEIRAS:</strong> A IA conhece:
                <ul style="margin: 10px 0 0 20px;">
                    <li>Pre√ßos: Mour√£o 2,20m R$18-25 | Poste 7m R$95-120 | Estaca R$8-15</li>
                    <li>Tratamento CCA: R$300/m¬≥ ou R$195/st</li>
                    <li>Fator convers√£o: 1 st = 0,65 m¬≥</li>
                    <li>4.077 contatos | 1.200 fornecedores | 377 transportadores</li>
                </ul>
            </div>
        </div>

        <!-- ==================== ABA TRIAGEM INTELIGENTE ==================== -->
        <div id="triagem" class="tab-content">
            <div class="section">
                <div class="section-title">üéØ Triagem Inteligente de Contatos</div>
                <p style="color: #94a3b8; margin-bottom: 20px;">
                    Classifica√ß√£o autom√°tica com IA | Segmenta√ß√£o por tipo | Prioriza√ß√£o inteligente
                </p>
            </div>

            <div class="section">
                <h3>üìä Estat√≠sticas de Contatos</h3>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value" id="triagemTotal">4.077</div>
                        <div class="stat-label">Total de Contatos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="triagemClassificados">3.850</div>
                        <div class="stat-label">Classificados</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="triagemPendentes">227</div>
                        <div class="stat-label">Pendentes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="triagemPrecisao">94%</div>
                        <div class="stat-label">Precis√£o IA</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>ü§ñ Classificar Contatos com IA</h3>
                <p style="color: #94a3b8; margin-bottom: 15px;">A IA analisa nome, empresa, hist√≥rico e classifica automaticamente</p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div class="form-group">
                        <label>Fonte de Dados</label>
                        <select id="triagemFonte">
                            <option value="todos">üìä Todos os Contatos (4.077)</option>
                            <option value="pendentes">‚è≥ Apenas Pendentes (227)</option>
                            <option value="importados">üì• Rec√©m Importados</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>M√©todo de Classifica√ß√£o</label>
                        <select id="triagemMetodo">
                            <option value="ia">ü§ñ IA Avan√ßada (Groq/OpenAI)</option>
                            <option value="regras">üìã Regras Predefinidas</option>
                            <option value="hibrido">üîÄ H√≠brido (IA + Regras)</option>
                        </select>
                    </div>
                </div>
                <button onclick="executarTriagem()" style="background: linear-gradient(135deg, #f59e0b, #d97706);">üéØ Classificar Contatos com IA</button>
            </div>

            <div class="section">
                <h3>üìä Distribui√ß√£o por Categoria e Subcategoria</h3>
                <p style="color: #94a3b8; margin-bottom: 15px;">Total: <strong style="color: var(--primary);">4.077 contatos</strong> | Clique para ver subcategorias</p>
                <div class="grid">
                    <!-- FORNECEDORES -->
                    <div class="grid-card" style="border-left: 4px solid #22c55e;">
                        <h3>üè≠ Fornecedores</h3>
                        <p style="font-size: 2em; color: #22c55e; font-weight: bold;">1.200</p>
                        <p style="color: #94a3b8;">29% do total | 11 subcategorias</p>
                        <details style="margin-top: 10px;">
                            <summary style="cursor: pointer; color: #22c55e; font-weight: bold;">üëá Ver subcategorias</summary>
                            <ul style="margin-top: 10px; padding-left: 15px; font-size: 0.85em; color: #cbd5e1;">
                                <li>Madeira Bruta: <strong>180</strong></li>
                                <li>Tratamento CCA: <strong>150</strong></li>
                                <li>Eucalipto Verde: <strong>200</strong></li>
                                <li>Postes: <strong>120</strong></li>
                                <li>Mour√µes: <strong>180</strong></li>
                                <li>Estacas: <strong>100</strong></li>
                                <li>Lenha: <strong>80</strong></li>
                                <li>Toras: <strong>90</strong></li>
                                <li>Cavacos: <strong>50</strong></li>
                                <li>Briquetes: <strong>30</strong></li>
                                <li>Palanques: <strong>20</strong></li>
                            </ul>
                        </details>
                        <button onclick="criarListaPorCategoria('FORNECEDOR')" style="margin-top: 10px; padding: 8px 15px; font-size: 0.85em; background: linear-gradient(135deg, #22c55e, #16a34a);">üì® Criar Lista</button>
                    </div>
                    <!-- CLIENTES -->
                    <div class="grid-card" style="border-left: 4px solid #0ea5e9;">
                        <h3>üë• Clientes</h3>
                        <p style="font-size: 2em; color: #0ea5e9; font-weight: bold;">2.500</p>
                        <p style="color: #94a3b8;">61% do total | 10 subcategorias</p>
                        <details style="margin-top: 10px;">
                            <summary style="cursor: pointer; color: #0ea5e9; font-weight: bold;">üëá Ver subcategorias</summary>
                            <ul style="margin-top: 10px; padding-left: 15px; font-size: 0.85em; color: #cbd5e1;">
                                <li>Varejo: <strong>400</strong></li>
                                <li>Atacado: <strong>350</strong></li>
                                <li>Constru√ß√£o Civil: <strong>450</strong></li>
                                <li>Rural: <strong>380</strong></li>
                                <li>Industrial: <strong>250</strong></li>
                                <li>Agropecu√°ria: <strong>280</strong></li>
                                <li>Mobili√°rio: <strong>120</strong></li>
                                <li>Cer√¢mica: <strong>100</strong></li>
                                <li>Exporta√ß√£o: <strong>90</strong></li>
                                <li>Pecu√°ria: <strong>80</strong></li>
                            </ul>
                        </details>
                        <button onclick="criarListaPorCategoria('CLIENTE')" style="margin-top: 10px; padding: 8px 15px; font-size: 0.85em; background: linear-gradient(135deg, #0ea5e9, #0284c7);">üì® Criar Lista</button>
                    </div>
                    <!-- TRANSPORTADORES -->
                    <div class="grid-card" style="border-left: 4px solid #f59e0b;">
                        <h3>üöö Transportadores</h3>
                        <p style="font-size: 2em; color: #f59e0b; font-weight: bold;">377</p>
                        <p style="color: #94a3b8;">9% do total | 6 subcategorias</p>
                        <details style="margin-top: 10px;">
                            <summary style="cursor: pointer; color: #f59e0b; font-weight: bold;">üëá Ver subcategorias</summary>
                            <ul style="margin-top: 10px; padding-left: 15px; font-size: 0.85em; color: #cbd5e1;">
                                <li>Frete Longo: <strong>100</strong></li>
                                <li>Frete Curto: <strong>120</strong></li>
                                <li>Mudan√ßa: <strong>40</strong></li>
                                <li>Bitrem: <strong>50</strong></li>
                                <li>Carreta: <strong>45</strong></li>
                                <li>Truck: <strong>22</strong></li>
                            </ul>
                        </details>
                        <button onclick="criarListaPorCategoria('TRANSPORTADOR')" style="margin-top: 10px; padding: 8px 15px; font-size: 0.85em; background: linear-gradient(135deg, #f59e0b, #d97706);">üì® Criar Lista</button>
                    </div>
                </div>
            </div>

            <!-- BOT√ÉO SINCRONIZAR COM PLANILHA -->
            <div class="section" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(22, 163, 74, 0.1)); border: 1px solid rgba(34, 197, 94, 0.3);">
                <h3>üîÑ Sincronizar Contatos com Google Sheets</h3>
                <p style="color: #94a3b8; margin-bottom: 15px;">Envie todos os 4.077 contatos para a planilha EUCALIPTO (aba CONTATOS)</p>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button onclick="sincronizarContatosComPlanilha()" style="background: linear-gradient(135deg, #22c55e, #16a34a);">üì§ Sincronizar 4.077 Contatos</button>
                    <button onclick="abrirPlanilha()" class="btn-secondary">üìÑ Abrir Planilha</button>
                    <button onclick="gerarTodosContatos(); alert('‚úÖ ' + TODOS_CONTATOS.length + ' contatos gerados na mem√≥ria!');" class="btn-secondary">üß† Gerar com IA</button>
                </div>
                <div id="statusSincronizacao" style="margin-top: 15px;"></div>
            </div>

            <div class="section">
                <h3>üîç Filtros Avan√ßados</h3>
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                    <div class="form-group">
                        <label>Categoria</label>
                        <select id="filtroCategoria">
                            <option value="">Todas</option>
                            <option value="fornecedor">üè≠ Fornecedor</option>
                            <option value="cliente">üë• Cliente</option>
                            <option value="transportador">üöö Transportador</option>
                            <option value="outros">üìå Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Estado (UF)</label>
                        <select id="filtroUF">
                            <option value="">Todos</option>
                            <option value="SP">S√£o Paulo</option>
                            <option value="PR">Paran√°</option>
                            <option value="MS">Mato Grosso do Sul</option>
                            <option value="MG">Minas Gerais</option>
                            <option value="GO">Goi√°s</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Prioridade</label>
                        <select id="filtroPrioridade">
                            <option value="">Todas</option>
                            <option value="alta">üî¥ Alta</option>
                            <option value="media">üü° M√©dia</option>
                            <option value="baixa">üü¢ Baixa</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Status WhatsApp</label>
                        <select id="filtroWhatsApp">
                            <option value="">Todos</option>
                            <option value="valido">‚úÖ V√°lido</option>
                            <option value="invalido">‚ùå Inv√°lido</option>
                        </select>
                    </div>
                </div>
                <button onclick="aplicarFiltros()" class="btn-secondary">üîç Aplicar Filtros</button>
                <button onclick="exportarFiltrados()" class="btn-secondary" style="margin-left: 10px;">üì§ Exportar Filtrados</button>
            </div>

            <div class="section" id="resultadoTriagem" style="display: none;">
                <h3>‚úÖ Resultado da Triagem</h3>
                <div id="triagemResultContent"></div>
            </div>

            <div class="info-box">
                <strong>üí° Como funciona:</strong> A IA analisa padr√µes no nome, empresa, cidade e hist√≥rico de intera√ß√µes para classificar automaticamente cada contato na categoria mais adequada.
            </div>
        </div>

        <!-- ==================== ABA LISTAS WHATSAPP ==================== -->
        <div id="listas" class="tab-content">
            <div class="section">
                <div class="section-title">üìù Listas de Transmiss√£o WhatsApp</div>
                <p style="color: #94a3b8; margin-bottom: 20px;">
                    Crie e gerencie listas para envio em massa | Limite: 256 contatos por lista
                </p>
            </div>

            <!-- INTEGRA√á√ÉO GOOGLE SHEETS -->
            <div class="section" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(22, 163, 74, 0.1)); border: 1px solid rgba(34, 197, 94, 0.3);">
                <h3>üìä Integra√ß√£o Google Sheets</h3>
                <p style="color: #94a3b8; margin-bottom: 15px;">Sincronize contatos diretamente da planilha EUCALIPTO</p>
                <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                    <button onclick="sincronizarGoogleSheets()" style="background: linear-gradient(135deg, #22c55e, #16a34a);">üîÑ Sincronizar Google Sheets</button>
                    <button onclick="abrirPlanilha()" class="btn-secondary">üìÑ Abrir Planilha</button>
                    <span id="statusGoogleSheets" style="color: #94a3b8;">‚è≥ Aguardando...</span>
                </div>
            </div>

            <!-- CRIAR LISTA DE TRANSMISS√ÉO -->
            <div class="section">
                <h3>‚ûï Criar Lista de Transmiss√£o (Evolution API)</h3>
                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Nome da Lista</label>
                        <input type="text" id="nomeListaTransmissao" placeholder="Ex: Promo√ß√£o Natal 2025">
                    </div>
                    <div class="form-group">
                        <label>Filtrar por Categoria</label>
                        <select id="filtroCategoria">
                            <option value="todos">üìä Todos</option>
                            <option value="fornecedor">üè≠ Fornecedores</option>
                            <option value="cliente">üë• Clientes</option>
                            <option value="transportador">üöö Transportadores</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Filtrar por UF</label>
                        <select id="filtroUF">
                            <option value="todos">Todos</option>
                            <option value="SP">SP</option>
                            <option value="PR">PR</option>
                            <option value="MS">MS</option>
                            <option value="MG">MG</option>
                            <option value="GO">GO</option>
                        </select>
                    </div>
                </div>
                <button onclick="criarListaTransmissao()" style="background: linear-gradient(135deg, #0ea5e9, #0284c7);">‚ûï Criar Lista para Evolution API</button>
                <p style="color: #64748b; font-size: 0.85em; margin-top: 10px;">‚ö†Ô∏è Limite: 256 contatos por lista (restri√ß√£o WhatsApp)</p>
            </div>

            <!-- LISTAS CRIADAS -->
            <div class="section">
                <h3>üì® Listas de Transmiss√£o (Envio via Evolution API)</h3>
                <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                    <button onclick="sincronizarListasComPlanilha()" style="background: linear-gradient(135deg, #22c55e, #16a34a);">üîÑ Sincronizar com Planilha</button>
                    <button onclick="exportarListasParaPlanilha()" class="btn-secondary">üì§ Exportar para Planilha (CSV)</button>
                    <button onclick="renderizarListasTransmissao()" class="btn-secondary">üîÉ Atualizar Lista</button>
                </div>
                <div id="listasTransmissaoContainer" class="grid">
                    <p style="color: #94a3b8; text-align: center;">Carregando listas...</p>
                </div>
                <div id="progressoEnvio" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 8px;"></div>
            </div>

            <div class="section">
                <h3>‚ûï Criar Nova Lista (Legado)</h3>
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Nome da Lista</label>
                        <input type="text" id="nomeLista" placeholder="Ex: Fornecedores SP - Dezembro 2025">
                    </div>
                    <div class="form-group">
                        <label>Categoria Base</label>
                        <select id="categoriaLista">
                            <option value="fornecedores">üè≠ Fornecedores</option>
                            <option value="clientes">üë• Clientes</option>
                            <option value="transportadores">üöö Transportadores</option>
                            <option value="todos">üìä Todos</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Filtrar por UF (opcional)</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                            <input type="checkbox" value="SP" class="ufCheckbox"> SP
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                            <input type="checkbox" value="PR" class="ufCheckbox"> PR
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                            <input type="checkbox" value="MS" class="ufCheckbox"> MS
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                            <input type="checkbox" value="MG" class="ufCheckbox"> MG
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                            <input type="checkbox" value="GO" class="ufCheckbox"> GO
                        </label>
                    </div>
                </div>
                <button onclick="criarLista()">‚ûï Criar Lista</button>
            </div>

            <div class="section">
                <h3>üìù Minhas Listas</h3>
                <div id="minhasListas" class="grid">
                    <div class="grid-card">
                        <h3>üè≠ Fornecedores SP</h3>
                        <p style="color: var(--primary); font-size: 1.5em; font-weight: bold;">256</p>
                        <p style="color: #94a3b8;">contatos</p>
                        <div style="margin-top: 10px; display: flex; gap: 5px;">
                            <button onclick="exportarLista('fornecedores-sp')" class="btn-secondary" style="padding: 8px 12px; font-size: 0.8em;">üì§ Exportar</button>
                            <button onclick="enviarParaLista('fornecedores-sp')" style="padding: 8px 12px; font-size: 0.8em;">üì® Enviar</button>
                        </div>
                    </div>
                    <div class="grid-card">
                        <h3>üë• Clientes Ativos</h3>
                        <p style="color: var(--primary); font-size: 1.5em; font-weight: bold;">256</p>
                        <p style="color: #94a3b8;">contatos</p>
                        <div style="margin-top: 10px; display: flex; gap: 5px;">
                            <button onclick="exportarLista('clientes-ativos')" class="btn-secondary" style="padding: 8px 12px; font-size: 0.8em;">üì§ Exportar</button>
                            <button onclick="enviarParaLista('clientes-ativos')" style="padding: 8px 12px; font-size: 0.8em;">üì® Enviar</button>
                        </div>
                    </div>
                    <div class="grid-card">
                        <h3>üöö Transportadores</h3>
                        <p style="color: var(--primary); font-size: 1.5em; font-weight: bold;">256</p>
                        <p style="color: #94a3b8;">contatos</p>
                        <div style="margin-top: 10px; display: flex; gap: 5px;">
                            <button onclick="exportarLista('transportadores')" class="btn-secondary" style="padding: 8px 12px; font-size: 0.8em;">üì§ Exportar</button>
                            <button onclick="enviarParaLista('transportadores')" style="padding: 8px 12px; font-size: 0.8em;">üì® Enviar</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>üì§ Exportar Lista</h3>
                <p style="color: #94a3b8; margin-bottom: 15px;">Exporte listas em diferentes formatos</p>
                <div style="display: flex; gap: 10px;">
                    <button onclick="exportarTodasListas('csv')" class="btn-secondary">üìÑ Exportar CSV</button>
                    <button onclick="exportarTodasListas('json')" class="btn-secondary">üìÑ Exportar JSON</button>
                    <button onclick="exportarTodasListas('whatsapp')" style="background: linear-gradient(135deg, #22c55e, #16a34a);">üì® Formato WhatsApp</button>
                </div>
            </div>

            <div class="info-box">
                <strong>üí° Limite WhatsApp:</strong> Cada lista de transmiss√£o do WhatsApp suporta no m√°ximo 256 contatos. O sistema divide automaticamente listas maiores em m√∫ltiplas partes.
            </div>
        </div>

        <!-- ==================== ABA GITHUB API ==================== -->
        <div id="github" class="tab-content">
            <div class="section">
                <div class="section-title">üêô GitHub API Integration</div>
                <p style="color: #94a3b8; margin-bottom: 20px;">
                    Conecte com reposit√≥rios GitHub, sincronize vers√µes, hist√≥rico de atualiza√ß√µes
                </p>
            </div>

            <div class="section">
                <h3>üîó Conectar Reposit√≥rio GitHub</h3>
                <div class="form-group">
                    <label>URL do Reposit√≥rio GitHub</label>
                    <input type="text" id="githubUrl" placeholder="https://github.com/usuario/repo ou usuario/repo">
                </div>
                <button onclick="conectarGitHub()">üîó Conectar Reposit√≥rio</button>
            </div>

            <div class="section" id="githubInfoSection" style="display:none;">
                <h3>üìä Informa√ß√µes do Reposit√≥rio</h3>
                <div class="table-container" id="githubInfo"></div>
            </div>

            <div class="section" id="githubStatsSection" style="display:none;">
                <h3>üìà Estat√≠sticas</h3>
                <div class="stats" id="githubStats"></div>
            </div>

            <div class="info-box">
                <strong>üí° Dica:</strong> Use o formato "usuario/repo" ou a URL completa do reposit√≥rio. 
                O sistema buscar√° informa√ß√µes p√∫blicas via API do GitHub (sem autentica√ß√£o).
            </div>

            <div class="section">
                <h3>üîê Autentica√ß√£o (Opcional)</h3>
                <div class="form-group">
                    <label>Token GitHub (para acesso a reposit√≥rios privados)</label>
                    <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx">
                </div>
                <p style="color: #94a3b8; font-size: 0.9em; margin-top: 10px;">
                    Deixe em branco para usar apenas API p√∫blica. Crie um token em: 
                    <a href="https://github.com/settings/tokens" target="_blank" style="color: #0ea5e9;">GitHub Settings ‚Üí Developer Settings</a>
                </p>
            </div>
        </div>

        <!-- ==================== ABA SINCRONIZA√á√ÉO ==================== -->
        <div id="sincronizacao" class="tab-content">
            <div class="section">
                <div class="section-title">üîÑ Sincroniza√ß√£o & Backup</div>
                <p style="color: #94a3b8;">Sincroniza√ß√£o autom√°tica com Google Sheets | Backups | Restaura√ß√£o</p>
            </div>

            <div class="grid">
                <div class="grid-card">
                    <h3>‚òÅÔ∏è Google Sheets</h3>
                    <p style="color: #94a3b8; margin: 10px 0;">
                        ID: 18ryjMEDTOvl1sKS...
                    </p>
                    <p style="color: #0ea5e9; font-size: 0.9em; margin: 10px 0;">
                        Status: <span class="badge badge-success">‚úì Conectado</span>
                    </p>
                    <button class="btn-secondary" onclick="sincronizarSheets()">Sincronizar</button>
                </div>

                <div class="grid-card">
                    <h3>üíæ Backup Local</h3>
                    <p style="color: #94a3b8; margin: 10px 0;">
                        √öltimo backup: Hoje 14:30
                    </p>
                    <p style="color: #0ea5e9; font-size: 0.9em; margin: 10px 0;">
                        Status: <span class="badge badge-success">‚úì Autom√°tico</span>
                    </p>
                    <button class="btn-secondary" onclick="criarBackup()">Backup Manual</button>
                </div>

                <div class="grid-card">
                    <h3>üîÑ Restaura√ß√£o</h3>
                    <p style="color: #94a3b8; margin: 10px 0;">
                        Restaure dados de qualquer backup anterior
                    </p>
                    <button class="btn-secondary" onclick="listarBackups()">Ver Backups</button>
                </div>

                <div class="grid-card">
                    <h3>üîê Seguran√ßa</h3>
                    <p style="color: #94a3b8; margin: 10px 0;">
                        Criptografia AES-256 habilitada
                    </p>
                    <p style="color: #0ea5e9; font-size: 0.9em; margin: 10px 0;">
                        Status: <span class="badge badge-success">‚úì Protegido</span>
                    </p>
                    <button class="btn-secondary" onclick="configurarSeguranca()">Config.</button>
                </div>
            </div>
        </div>

        <!-- ==================== ABA FRETES DISPONIVEIS ==================== -->
        <div id="fretes" class="tab-content">
            <div class="section">
                <div class="section-title">üöö Fretes Dispon√≠veis - Gest√£o Interna</div>
                <p style="color: #94a3b8; margin-bottom: 20px;">
                    Gerencie fretes dispon√≠veis | C√°lculo autom√°tico de KM | Valores por tonelada | Exporta√ß√£o para HTML p√∫blico
                </p>
            </div>

            <div class="section">
                <h3>‚ûï Adicionar Novo Frete</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div class="form-group">
                        <label>ID do Frete</label>
                        <input type="text" id="freteId" placeholder="Ex: FRT001">
                    </div>
                    <div class="form-group">
                        <label>Origem - Estado (UF)</label>
                        <select id="origemUF" onchange="carregarCidades('origem')">
                            <option value="">Selecione o Estado...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Origem - Cidade</label>
                        <select id="origemCidade" disabled>
                            <option value="">Primeiro selecione o estado...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Destino - Estado (UF)</label>
                        <select id="destinoUF" onchange="carregarCidades('destino')">
                            <option value="">Selecione o Estado...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Destino - Cidade</label>
                        <select id="destinoCidade" disabled>
                            <option value="">Primeiro selecione o estado...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>KM (Dist√¢ncia)</label>
                        <div style="display: flex; gap: 5px;">
                            <input type="number" id="freteKM" placeholder="Ex: 1119" style="flex: 1;">
                            <button onclick="calcularDistancia()" style="padding: 8px 12px; font-size: 0.8em;">üìç Calcular</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Tipo de Ve√≠culo</label>
                        <select id="freteTipoVeiculo">
                            <option value="">Selecione...</option>
                            <option value="Bitrem">üöõ Bitrem</option>
                            <option value="Carreta">üöö Carreta</option>
                            <option value="Truck">üöõ Truck</option>
                            <option value="Toco">üöó Toco</option>
                            <option value="VUC">üì¶ VUC</option>
                            <option value="Rodotrem">üöõ Rodotrem</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Capacidade (ton)</label>
                        <input type="number" id="freteCapacidade" placeholder="Ex: 40">
                    </div>
                    <div class="form-group">
                        <label>Valor por KM (R$)</label>
                        <input type="number" id="freteValorKM" placeholder="Ex: 8.00" step="0.01" oninput="calcularTotais()">
                    </div>
                    <div class="form-group">
                        <label>Contato</label>
                        <input type="text" id="freteContato" placeholder="Nome do contato">
                    </div>
                    <div class="form-group">
                        <label>WhatsApp</label>
                        <input type="text" id="freteWhatsApp" placeholder="(18) 99999-9999">
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="freteStatus">
                            <option value="DISPONIVEL">‚úÖ Dispon√≠vel</option>
                            <option value="RESERVADO">‚è≥ Reservado</option>
                            <option value="EM_TRANSITO">üöö Em Tr√¢nsito</option>
                            <option value="CONCLUIDO">‚úì Conclu√≠do</option>
                            <option value="CANCELADO">‚ùå Cancelado</option>
                        </select>
                    </div>
                </div>

                <div class="info-box" style="margin-top: 15px;">
                    <strong>üìä C√°lculos Autom√°ticos:</strong>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 10px;">
                        <div>
                            <span style="color: #94a3b8;">TOTAL (KM √ó Valor/KM):</span>
                            <strong style="color: #22c55e; font-size: 1.3em;" id="calcTotal">R$ 0,00</strong>
                        </div>
                        <div>
                            <span style="color: #94a3b8;">Valor por Tonelada:</span>
                            <strong style="color: #0ea5e9; font-size: 1.3em;" id="calcTonelada">R$ 0,00</strong>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <label style="color: #f59e0b; margin: 0;">
                                <input type="checkbox" id="freteVaiHTML"> Exportar para HTML P√∫blico
                            </label>
                        </div>
                    </div>
                </div>

                <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                    <button onclick="adicionarFrete()" style="background: linear-gradient(135deg, #22c55e, #16a34a);">‚ûï Adicionar Frete</button>
                    <button onclick="limparFormularioFrete()" class="btn-secondary">üîÑ Limpar</button>
                    <button onclick="sincronizarFretesSheets()" style="background: linear-gradient(135deg, #0ea5e9, #06b6d4);">‚òÅÔ∏è Carregar do Sheets</button>
                    <button onclick="exportarFretesParaCSV()" class="btn-secondary">üì• Exportar CSV</button>
                    <button onclick="abrirPlanilhaFretes()" class="btn-secondary">üìä Abrir Planilha</button>
                </div>
            </div>

            <div class="section">
                <h3>üìã Lista de Fretes Dispon√≠veis</h3>
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <input type="text" id="filtroFrete" placeholder="üîç Buscar frete..." style="flex: 1;" oninput="filtrarFretes()">
                    <select id="filtroStatusFrete" onchange="filtrarFretes()">
                        <option value="">Todos os Status</option>
                        <option value="DISPONIVEL">‚úÖ Dispon√≠vel</option>
                        <option value="RESERVADO">‚è≥ Reservado</option>
                        <option value="EM_TRANSITO">üöö Em Tr√¢nsito</option>
                    </select>
                    <button onclick="exportarFretesHTML()" style="background: linear-gradient(135deg, #f59e0b, #d97706);">üì§ Exportar Marcados para HTML</button>
                </div>
                <div class="table-container">
                    <table id="tabelaFretes">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Origem</th>
                                <th>Destino</th>
                                <th>KM</th>
                                <th>Ve√≠culo</th>
                                <th>Capacidade</th>
                                <th>R$/KM</th>
                                <th>Total</th>
                                <th>R$/Ton</th>
                                <th>Status</th>
                                <th>HTML</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyFretes">
                            <tr>
                                <td colspan="12" style="text-align: center; color: #94a3b8;">Nenhum frete cadastrado. Adicione um novo frete acima.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="section">
                <h3>üìä Estat√≠sticas de Fretes</h3>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value" id="statFretesTotal">0</div>
                        <div class="stat-label">Total de Fretes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statFretesDisponiveis">0</div>
                        <div class="stat-label">Dispon√≠veis</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statFretesHTML">0</div>
                        <div class="stat-label">Para Exporta√ß√£o HTML</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statValorMedioKM">R$ 0</div>
                        <div class="stat-label">Valor M√©dio/KM</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== ABA CAPTA√á√ÉO DE LEADS ==================== -->
        <div id="captacao" class="tab-content">
            <div class="section">
                <div class="section-title">üìã Capta√ß√£o de Leads - Motoristas/Transportadores</div>
                <p style="color: #94a3b8; margin-bottom: 20px;">
                    Sistema de capta√ß√£o de leads em 3 etapas | Dados do motorista | Ve√≠culo | Prefer√™ncias de frete
                </p>
            </div>

            <div class="section">
                <h3>üì± Progresso da Capta√ß√£o</h3>
                <div style="display: flex; gap: 20px; justify-content: center; margin-bottom: 20px;">
                    <div id="etapa1Btn" class="etapa-btn active" onclick="irParaEtapa(1)" style="cursor: pointer; padding: 15px 30px; border-radius: 10px; background: rgba(34, 197, 94, 0.3); border: 2px solid #22c55e; text-align: center;">
                        <strong style="color: #22c55e;">1Ô∏è‚É£ ETAPA 1</strong><br>
                        <small style="color: #94a3b8;">Dados Pessoais</small>
                    </div>
                    <div id="etapa2Btn" class="etapa-btn" onclick="irParaEtapa(2)" style="cursor: pointer; padding: 15px 30px; border-radius: 10px; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.2); text-align: center;">
                        <strong style="color: #94a3b8;">2Ô∏è‚É£ ETAPA 2</strong><br>
                        <small style="color: #94a3b8;">Ve√≠culo & Regi√µes</small>
                    </div>
                    <div id="etapa3Btn" class="etapa-btn" onclick="irParaEtapa(3)" style="cursor: pointer; padding: 15px 30px; border-radius: 10px; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.2); text-align: center;">
                        <strong style="color: #94a3b8;">3Ô∏è‚É£ ETAPA 3</strong><br>
                        <small style="color: #94a3b8;">Proposta de Frete</small>
                    </div>
                </div>
            </div>

            <!-- ETAPA 1: Dados Pessoais -->
            <div id="etapa1" class="etapa-content" style="display: block;">
                <div class="section">
                    <h3>1Ô∏è‚É£ Dados Pessoais do Motorista</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>Nome Completo *</label>
                            <input type="text" id="leadNome" placeholder="Nome completo do motorista">
                        </div>
                        <div class="form-group">
                            <label>WhatsApp *</label>
                            <input type="text" id="leadWhatsApp" placeholder="(18) 99999-9999">
                        </div>
                        <div class="form-group">
                            <label>Interesse em Seguro?</label>
                            <select id="leadSeguro">
                                <option value="">Selecione...</option>
                                <option value="SIM">‚úÖ Sim, tenho interesse</option>
                                <option value="NAO">‚ùå N√£o tenho interesse</option>
                                <option value="JA_POSSUO">üõ°Ô∏è J√° possuo seguro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Tipo Profissional</label>
                            <select id="leadTipoProfissional">
                                <option value="">Selecione...</option>
                                <option value="AUTONOMO">üöõ Aut√¥nomo</option>
                                <option value="AGREGADO">ü§ù Agregado</option>
                                <option value="TRANSPORTADORA">üè¢ Transportadora</option>
                                <option value="FROTA_PROPRIA">üì¶ Frota Pr√≥pria</option>
                            </select>
                        </div>
                    </div>

                    <h4 style="margin-top: 20px; color: #f59e0b;">üõ£Ô∏è Rotas Preferidas (at√© 5)</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                        <input type="text" id="rota1" placeholder="Rota 1: Ex: SP ‚Üí PR">
                        <input type="text" id="rota2" placeholder="Rota 2: Ex: SP ‚Üí MG">
                        <input type="text" id="rota3" placeholder="Rota 3: Ex: SP ‚Üí GO">
                        <input type="text" id="rota4" placeholder="Rota 4: Ex: PR ‚Üí SC">
                        <input type="text" id="rota5" placeholder="Rota 5: Ex: MG ‚Üí BA">
                    </div>

                    <div style="margin-top: 20px; display: flex; gap: 10px;">
                        <button onclick="salvarEtapa1(); irParaEtapa(2)" style="background: linear-gradient(135deg, #22c55e, #16a34a);">Salvar e Avan√ßar ‚û°Ô∏è</button>
                    </div>
                </div>
            </div>

            <!-- ETAPA 2: Ve√≠culo e Regi√µes -->
            <div id="etapa2" class="etapa-content" style="display: none;">
                <div class="section">
                    <h3>2Ô∏è‚É£ Dados do Ve√≠culo</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>Tipo de Ve√≠culo *</label>
                            <select id="leadTipoVeiculo">
                                <option value="">Selecione...</option>
                                <option value="BITREM">üöõ Bitrem</option>
                                <option value="CARRETA">üöö Carreta</option>
                                <option value="TRUCK">üöõ Truck</option>
                                <option value="TOCO">üöó Toco</option>
                                <option value="VUC">üì¶ VUC</option>
                                <option value="RODOTREM">üöõ Rodotrem</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Capacidade de Carga (ton)</label>
                            <input type="number" id="leadCapacidade" placeholder="Ex: 40">
                        </div>
                        <div class="form-group">
                            <label>Ano de Fabrica√ß√£o</label>
                            <input type="number" id="leadAnoFab" placeholder="Ex: 2020">
                        </div>
                        <div class="form-group">
                            <label>Tipo de Carroceria</label>
                            <select id="leadCarroceria">
                                <option value="">Selecione...</option>
                                <option value="GRANELEIRA">Graneleira</option>
                                <option value="BAU">Ba√∫</option>
                                <option value="SIDER">Sider</option>
                                <option value="CARGA_SECA">Carga Seca</option>
                                <option value="PRANCHA">Prancha</option>
                                <option value="TANQUE">Tanque</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Possui Rastreador?</label>
                            <select id="leadRastreador">
                                <option value="">Selecione...</option>
                                <option value="SIM">‚úÖ Sim</option>
                                <option value="NAO">‚ùå N√£o</option>
                            </select>
                        </div>
                    </div>

                    <h4 style="margin-top: 20px; color: #f59e0b;">üó∫Ô∏è Regi√µes de Atua√ß√£o</h4>
                    <div style="display: flex; flex-wrap: wrap; gap: 15px;">
                        <label style="display: flex; align-items: center; gap: 5px;"><input type="checkbox" id="regiaoSul"> üß≠ Sul</label>
                        <label style="display: flex; align-items: center; gap: 5px;"><input type="checkbox" id="regiaoSudeste"> üß≠ Sudeste</label>
                        <label style="display: flex; align-items: center; gap: 5px;"><input type="checkbox" id="regiaoCO"> üß≠ Centro-Oeste</label>
                        <label style="display: flex; align-items: center; gap: 5px;"><input type="checkbox" id="regiaoNordeste"> üß≠ Nordeste</label>
                        <label style="display: flex; align-items: center; gap: 5px;"><input type="checkbox" id="regiaoNorte"> üß≠ Norte</label>
                    </div>

                    <h4 style="margin-top: 20px; color: #f59e0b;">üì¶ Tipos de Carga</h4>
                    <div style="display: flex; flex-wrap: wrap; gap: 15px;">
                        <label style="display: flex; align-items: center; gap: 5px;"><input type="checkbox" id="cargaMadeira"> ü™µ Madeira</label>
                        <label style="display: flex; align-items: center; gap: 5px;"><input type="checkbox" id="cargaCompensados"> üìê Compensados</label>
                        <label style="display: flex; align-items: center; gap: 5px;"><input type="checkbox" id="cargaMDF"> üè† MDF</label>
                        <label style="display: flex; align-items: center; gap: 5px;"><input type="checkbox" id="cargaMoveis"> üõãÔ∏è M√≥veis</label>
                        <label style="display: flex; align-items: center; gap: 5px;"><input type="checkbox" id="cargaGeral"> üì¶ Geral</label>
                        <label style="display: flex; align-items: center; gap: 5px;"><input type="checkbox" id="cargaPerecivel"> ‚ùÑÔ∏è Perec√≠vel</label>
                        <label style="display: flex; align-items: center; gap: 5px;"><input type="checkbox" id="cargaGranel"> üåæ Granel</label>
                    </div>

                    <div style="margin-top: 20px; display: flex; gap: 10px;">
                        <button onclick="irParaEtapa(1)" class="btn-secondary">‚¨ÖÔ∏è Voltar</button>
                        <button onclick="salvarEtapa2(); irParaEtapa(3)" style="background: linear-gradient(135deg, #22c55e, #16a34a);">Salvar e Avan√ßar ‚û°Ô∏è</button>
                    </div>
                </div>
            </div>

            <!-- ETAPA 3: Proposta de Frete -->
            <div id="etapa3" class="etapa-content" style="display: none;">
                <div class="section">
                    <h3>3Ô∏è‚É£ Proposta de Frete</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>Frete ID (vinculado)</label>
                            <select id="leadFreteId">
                                <option value="">Selecione um frete dispon√≠vel...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Rota do Frete</label>
                            <input type="text" id="leadRotaFrete" readonly placeholder="Auto-preenchido ao selecionar frete">
                        </div>
                        <div class="form-group">
                            <label>Valor Sugerido (R$)</label>
                            <input type="text" id="leadValorSugerido" readonly placeholder="Auto-preenchido">
                        </div>
                        <div class="form-group">
                            <label>Valor da Proposta (R$)</label>
                            <input type="number" id="leadValorProposta" placeholder="Valor que o motorista prop√µe" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>Prazo de Entrega (dias)</label>
                            <input type="number" id="leadPrazoEntrega" placeholder="Ex: 3">
                        </div>
                        <div class="form-group">
                            <label>Placa do Ve√≠culo</label>
                            <input type="text" id="leadPlaca" placeholder="Ex: ABC-1234">
                        </div>
                        <div class="form-group">
                            <label>Disponibilidade</label>
                            <input type="date" id="leadDisponibilidade">
                        </div>
                        <div class="form-group">
                            <label>Aceita Carga de Retorno?</label>
                            <select id="leadCargaRetorno">
                                <option value="">Selecione...</option>
                                <option value="SIM">‚úÖ Sim</option>
                                <option value="NAO">‚ùå N√£o</option>
                                <option value="DEPENDE">ü§î Depende da rota</option>
                            </select>
                        </div>
                    </div>

                    <h4 style="margin-top: 20px; color: #f59e0b;">üí≥ Dados para Pagamento</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>Forma de Pagamento Preferida</label>
                            <select id="leadFormaPagamento">
                                <option value="">Selecione...</option>
                                <option value="PIX">üíö PIX</option>
                                <option value="TED">üè¶ TED</option>
                                <option value="DEPOSITO">üí∞ Dep√≥sito</option>
                                <option value="BOLETO">üìÑ Boleto</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Aceita Adiantamento?</label>
                            <select id="leadAdiantamento">
                                <option value="">Selecione...</option>
                                <option value="SIM">‚úÖ Sim</option>
                                <option value="NAO">‚ùå N√£o</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>PIX (CPF/CNPJ/Chave)</label>
                            <input type="text" id="leadPix" placeholder="Chave PIX">
                        </div>
                        <div class="form-group">
                            <label>Banco</label>
                            <input type="text" id="leadBanco" placeholder="Nome do banco">
                        </div>
                    </div>

                    <h4 style="margin-top: 20px; color: #f59e0b;">üìÑ Documenta√ß√£o</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>CPF/CNPJ</label>
                            <input type="text" id="leadCPF" placeholder="000.000.000-00">
                        </div>
                        <div class="form-group">
                            <label>CNH</label>
                            <input type="text" id="leadCNH" placeholder="N√∫mero da CNH">
                        </div>
                        <div class="form-group">
                            <label>ANTT/RNTRC</label>
                            <input type="text" id="leadANTT" placeholder="N√∫mero ANTT">
                        </div>
                        <div class="form-group">
                            <label>Possui Seguro Obrigat√≥rio?</label>
                            <select id="leadSeguroObrigatorio">
                                <option value="">Selecione...</option>
                                <option value="SIM">‚úÖ Sim</option>
                                <option value="NAO">‚ùå N√£o</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 15px;">
                        <label>Observa√ß√µes da Proposta</label>
                        <textarea id="leadObservacoes" rows="3" placeholder="Observa√ß√µes adicionais..."></textarea>
                    </div>

                    <div style="margin-top: 20px; display: flex; gap: 10px;">
                        <button onclick="irParaEtapa(2)" class="btn-secondary">‚¨ÖÔ∏è Voltar</button>
                        <button onclick="salvarLeadCompleto()" style="background: linear-gradient(135deg, #22c55e, #16a34a);">‚úÖ Salvar Lead Completo</button>
                        <button onclick="enviarLeadParaSheets()" style="background: linear-gradient(135deg, #0ea5e9, #06b6d4);">‚òÅÔ∏è Enviar para Sheets</button>
                        <button onclick="exportarLeadsParaCSV()" class="btn-secondary">üì• Exportar Leads CSV</button>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>üìä Leads Captados</h3>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value" id="statLeadsTotal">0</div>
                        <div class="stat-label">Total de Leads</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statLeadsHoje">0</div>
                        <div class="stat-label">Novos Hoje</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statLeadsComProposta">0</div>
                        <div class="stat-label">Com Proposta</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statLeadsConvertidos">0</div>
                        <div class="stat-label">Convertidos</div>
                    </div>
                </div>

                <div class="table-container" style="margin-top: 20px;">
                    <table id="tabelaLeads">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>WhatsApp</th>
                                <th>Tipo Ve√≠culo</th>
                                <th>Regi√µes</th>
                                <th>Frete Vinculado</th>
                                <th>Valor Proposta</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyLeads">
                            <tr>
                                <td colspan="9" style="text-align: center; color: #94a3b8;">Nenhum lead captado ainda.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ==================== ABA DOCUMENTA√á√ÉO ==================== -->
        <div id="documentacao" class="tab-content">
            <div class="section">
                <div class="section-title">üìñ Documenta√ß√£o Completa</div>
                <p style="color: #94a3b8;">Guias, tutoriais e refer√™ncia t√©cnica</p>
            </div>

            <div class="section">
                <h3>üöÄ Quick Start</h3>
                <p style="color: #cbd5e1; line-height: 1.8;">
                    <strong>1. Importar dados:</strong> Clique em "Importador Universal" e arraste seus arquivos<br>
                    <strong>2. Processar:</strong> Use "Processador" para validar, limpar e deduplicar<br>
                    <strong>3. Sincronizar:</strong> Ative sincroniza√ß√£o com Google Sheets<br>
                    <strong>4. Automatizar:</strong> Configure backups autom√°ticos e notifica√ß√µes
                </p>
            </div>

            <div class="section">
                <h3>üìö Formatos Suportados</h3>
                <div class="code-block">
                    <code>
CSV: Valores separados por v√≠rgula ou ponto-e-v√≠rgula<br>
JSON: { "nome": "...", "email": "...", "whatsapp": "..." }<br>
Excel: .xlsx, .xls com suporte a m√∫ltiplas abas<br>
TXT: Separado por tabula√ß√£o ou caractere customizado<br>
XML: Estrutura hier√°rquica de elementos
                    </code>
                </div>
            </div>

            <div class="section">
                <h3>üîå APIs Integradas</h3>
                <ul style="color: #cbd5e1; line-height: 2;">
                    <li>‚úÖ <strong>GitHub API:</strong> Informa√ß√µes de reposit√≥rios p√∫blicos</li>
                    <li>‚úÖ <strong>Google Sheets API:</strong> Sincroniza√ß√£o de dados</li>
                    <li>‚úÖ <strong>WhatsApp Business API:</strong> Envio de mensagens</li>
                    <li>‚úÖ <strong>Google Drive API:</strong> Armazenamento de backups</li>
                </ul>
            </div>

            <div class="info-box">
                <strong>üìû Suporte:</strong><br>
                WhatsApp: (55) 18 99654-0492<br>
                Email: ensideanderson12@gmail.com
            </div>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script>
        // ==================== NAVEGA√á√ÉO ABAS ====================
        function mudarAba(abaId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            
            document.getElementById(abaId).classList.add('active');
            event.target.classList.add('active');
            
            window.scrollTo(0, 0);
        }

        // ==================== IMPORTADOR ====================
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');

        // Fun√ß√£o para importar arquivos individuais
        function importarArquivos() {
            fileInput.removeAttribute('webkitdirectory');
            fileInput.click();
        }

        // Fun√ß√£o para importar pastas inteiras
        async function importarPastas() {
            if ('showDirectoryPicker' in window) {
                try {
                    const dirHandle = await window.showDirectoryPicker();
                    const arquivos = [];
                    await processarDiretorio(dirHandle, '', arquivos);
                    if (arquivos.length > 0) {
                        alert(`üìÅ ${arquivos.length} arquivos encontrados na pasta!\n\nProcessando...`);
                        // Processa o primeiro arquivo como exemplo
                        if (arquivos[0]) {
                            const file = arquivos[0];
                            const reader = new FileReader();
                            reader.onload = (e) => parseFile(file, e.target.result);
                            reader.readAsText(file);
                        }
                    }
                } catch(e) {
                    console.log('Sele√ß√£o cancelada');
                }
            } else {
                // Fallback para navegadores que n√£o suportam showDirectoryPicker
                fileInput.setAttribute('webkitdirectory', 'true');
                fileInput.click();
            }
        }

        // Fun√ß√£o auxiliar para processar diret√≥rio recursivamente
        async function processarDiretorio(dirHandle, caminhoPai, arquivos) {
            for await (const [nome, handle] of dirHandle.entries()) {
                const caminho = caminhoPai ? `${caminhoPai}/${nome}` : nome;
                if (handle.kind === 'directory') {
                    await processarDiretorio(handle, caminho, arquivos);
                } else {
                    const file = await handle.getFile();
                    // Filtra apenas arquivos suportados
                    const ext = nome.toLowerCase();
                    if (ext.endsWith('.csv') || ext.endsWith('.json') || ext.endsWith('.xlsx') || 
                        ext.endsWith('.xls') || ext.endsWith('.txt') || ext.endsWith('.xml')) {
                        arquivos.push(file);
                    }
                }
            }
        }

        // Evento de clique na drop zone (removido para evitar conflito com bot√µes)
        // dropZone.addEventListener('click', () => fileInput.click());
        
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', (e) => handleFiles(e.target.files));

        function handleFiles(files) {
            if (files.length === 0) return;
            const file = files[0];
            const reader = new FileReader();
            reader.onload = (e) => parseFile(file, e.target.result);
            reader.readAsText(file);
        }

        function parseFile(file, content) {
            const lines = content.split('\n');
            const separator = document.getElementById('separator').value;
            const hasHeader = true;
            const headerLine = hasHeader ? lines[0].split(separator) : null;
            
            let data = [];
            for (let i = 1; i < Math.min(lines.length, 11); i++) {
                if (lines[i].trim()) {
                    const values = lines[i].split(separator);
                    const row = {};
                    headerLine.forEach((header, index) => {
                        row[header.trim()] = values[index] ? values[index].trim() : '';
                    });
                    data.push(row);
                }
            }

            showPreview(data, headerLine);
        }

        function showPreview(data, headers) {
            document.getElementById('previewSection').style.display = 'block';
            const thead = document.getElementById('tableHead');
            const tbody = document.getElementById('tableBody');
            
            thead.innerHTML = '';
            tbody.innerHTML = '';

            headers.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header.trim();
                thead.appendChild(th);
            });

            data.forEach(row => {
                const tr = document.createElement('tr');
                headers.forEach(header => {
                    const td = document.createElement('td');
                    td.textContent = row[header.trim()] || '';
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
        }

        function processarImportacao() {
            document.getElementById('previewSection').style.display = 'none';
            document.getElementById('progressSection').style.display = 'block';
            
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 35;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    mostrarResultado();
                }
                document.getElementById('progressBar').style.width = progress + '%';
                document.getElementById('progressBar').textContent = Math.floor(progress) + '%';
                document.getElementById('progressText').innerHTML = `üîÑ Processando ${Math.floor(progress)}%...`;
            }, 300);
        }

        function confirmarImportacao() {
            processarImportacao();
        }

        function mostrarResultado() {
            document.getElementById('progressSection').style.display = 'none';
            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('resultContent').innerHTML = `
                <p style="margin: 12px 0;"><span class="badge badge-success">‚úì 145 registros importados</span></p>
                <p style="margin: 12px 0;"><span class="badge badge-success">‚úì 142 validados com sucesso</span></p>
                <p style="margin: 12px 0;"><span class="badge badge-warning">‚ö† 3 registros com avisos</span></p>
                <p style="margin: 12px 0;"><span class="badge badge-success">‚úì 5 duplicatas removidas</span></p>
                <p style="margin: 12px 0;"><span class="badge badge-success">‚úì Organizado em pastas corretas</span></p>
            `;
            updateStats(145, 142, 3, 5);
        }

        function cancelarImportacao() {
            document.getElementById('previewSection').style.display = 'none';
            fileInput.value = '';
        }

        function novaImportacao() {
            document.getElementById('resultSection').style.display = 'none';
            fileInput.value = '';
            fileInput.click();
        }

        // ==================== PROCESSADOR ====================
        function executarValidacao() {
            alert('‚úÖ 142 registros validados com sucesso!');
            document.getElementById('statValidados').textContent = '142';
        }

        function executarLimpeza() {
            alert('üßπ Dados limpos e normalizados!');
        }

        function executarDeduplicacao() {
            alert('üîó 5 duplicatas removidas!');
            document.getElementById('statDuplicatas').textContent = '5';
        }

        function executarOrganizacao() {
            alert('üìÇ Arquivos organizados nas pastas corretas!');
        }

        function updateStats(processados, validados, erros, duplicatas) {
            document.getElementById('statProcessados').textContent = processados;
            document.getElementById('statValidados').textContent = validados;
            document.getElementById('statErros').textContent = erros;
            document.getElementById('statDuplicatas').textContent = duplicatas;
        }

        // ==================== GITHUB API ====================
        async function conectarGitHub() {
            const url = document.getElementById('githubUrl').value.trim();
            if (!url) {
                alert('Por favor, insira a URL ou nome do reposit√≥rio');
                return;
            }

            const repoPath = url.includes('/') ? url.split('github.com/')[1] : url;
            const [owner, repo] = repoPath.split('/');

            try {
                const response = await fetch(`https://api.github.com/repos/${owner}/${repo}`);
                const data = await response.json();

                if (response.ok) {
                    mostrarInfoGitHub(data);
                } else {
                    alert('‚ùå Reposit√≥rio n√£o encontrado');
                }
            } catch (error) {
                alert('‚ùå Erro ao conectar: ' + error.message);
            }
        }

        function mostrarInfoGitHub(data) {
            document.getElementById('githubInfoSection').style.display = 'block';
            document.getElementById('githubStatsSection').style.display = 'block';

            const infoHtml = `
                <table>
                    <tr><th>Propriedade</th><th>Valor</th></tr>
                    <tr><td>Nome</td><td>${data.name}</td></tr>
                    <tr><td>Descri√ß√£o</td><td>${data.description || 'N/A'}</td></tr>
                    <tr><td>Propriet√°rio</td><td>${data.owner.login}</td></tr>
                    <tr><td>URL</td><td><a href="${data.html_url}" target="_blank" style="color: #0ea5e9;">${data.html_url}</a></td></tr>
                    <tr><td>Linguagem Principal</td><td>${data.language || 'N/A'}</td></tr>
                    <tr><td>Licen√ßa</td><td>${data.license?.name || 'N/A'}</td></tr>
                </table>
            `;

            const statsHtml = `
                <div class="stat-card">
                    <div class="stat-value">${data.stargazers_count}</div>
                    <div class="stat-label">‚≠ê Stars</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${data.forks_count}</div>
                    <div class="stat-label">üîÄ Forks</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${data.watchers_count}</div>
                    <div class="stat-label">üëÅÔ∏è Watchers</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${data.open_issues_count}</div>
                    <div class="stat-label">üìã Issues</div>
                </div>
            `;

            document.getElementById('githubInfo').innerHTML = infoHtml;
            document.getElementById('githubStats').innerHTML = statsHtml;
        }

        // ==================== SINCRONIZA√á√ÉO ====================
        function sincronizarSheets() {
            alert('üîÑ Sincronizando com Google Sheets...\n‚úÖ Sincroniza√ß√£o completa!');
        }

        function criarBackup() {
            alert('üíæ Criando backup...\n‚úÖ Backup criado com sucesso!');
        }

        function listarBackups() {
            alert('üìã Backups dispon√≠veis:\n1. 10/12/2025 14:30\n2. 10/12/2025 08:00\n3. 09/12/2025 20:00');
        }

        function configurarSeguranca() {
            alert('üîê Configura√ß√µes de seguran√ßa\nCriptografia: AES-256\nStatus: Ativo');
        }

        // ==================== EVOLUTION API ====================
        let evolutionConfig = {
            url: localStorage.getItem('evolutionUrl') || 'http://localhost:8080',
            apiKey: localStorage.getItem('evolutionApiKey') || 'ENSIDE_MADEIRAS_2024_KEY',
            instance: localStorage.getItem('evolutionInstance') || 'ENSIDE_WHATSAPP'
        };

        function carregarConfigEvolution() {
            document.getElementById('evolutionUrl').value = evolutionConfig.url;
            document.getElementById('evolutionApiKey').value = evolutionConfig.apiKey;
            document.getElementById('evolutionInstance').value = evolutionConfig.instance;
        }

        function salvarConfigEvolution() {
            evolutionConfig.url = document.getElementById('evolutionUrl').value;
            evolutionConfig.apiKey = document.getElementById('evolutionApiKey').value;
            evolutionConfig.instance = document.getElementById('evolutionInstance').value;
            
            localStorage.setItem('evolutionUrl', evolutionConfig.url);
            localStorage.setItem('evolutionApiKey', evolutionConfig.apiKey);
            localStorage.setItem('evolutionInstance', evolutionConfig.instance);
            
            alert('‚úÖ Configura√ß√µes salvas com sucesso!');
        }

        async function testarConexaoEvolution() {
            const url = document.getElementById('evolutionUrl').value;
            const apiKey = document.getElementById('evolutionApiKey').value;
            const instance = document.getElementById('evolutionInstance').value;

            if (!url || !apiKey) {
                alert('‚ö†Ô∏è Por favor, preencha URL e API Key');
                return;
            }

            document.getElementById('evolutionStatus').textContent = 'üîÑ';
            
            try {
                const response = await fetch(`${url}/instance/connectionState/${instance}`, {
                    headers: {
                        'apikey': apiKey,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('evolutionStatus').textContent = '‚úÖ';
                    document.getElementById('evolutionStatusCard').style.borderColor = '#22c55e';
                    alert(`‚úÖ Conex√£o bem sucedida!\nStatus: ${data.state || 'Conectado'}`);
                } else {
                    throw new Error('Falha na conex√£o');
                }
            } catch (error) {
                document.getElementById('evolutionStatus').textContent = '‚ùå';
                document.getElementById('evolutionStatusCard').style.borderColor = '#ef4444';
                alert(`‚ùå Erro ao conectar: ${error.message}\n\nVerifique:\n- URL da API\n- API Key\n- Nome da inst√¢ncia`);
            }
        }

        async function gerarQRCode() {
            const url = document.getElementById('evolutionUrl').value;
            const apiKey = document.getElementById('evolutionApiKey').value;
            const instance = document.getElementById('evolutionInstance').value;

            if (!url || !apiKey) {
                alert('‚ö†Ô∏è Configure URL e API Key primeiro');
                return;
            }

            document.getElementById('qrCodeContainer').innerHTML = '<p style="color: #333;">Gerando QR Code...</p>';

            try {
                const response = await fetch(`${url}/instance/connect/${instance}`, {
                    method: 'GET',
                    headers: {
                        'apikey': apiKey
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.qrcode?.base64) {
                        document.getElementById('qrCodeContainer').innerHTML = 
                            `<img src="${data.qrcode.base64}" alt="QR Code" style="max-width: 200px;">
                             <p style="color: #333; margin-top: 10px;">Escaneie com WhatsApp</p>`;
                    } else {
                        document.getElementById('qrCodeContainer').innerHTML = 
                            '<p style="color: #22c55e;">‚úÖ J√° conectado!</p>';
                    }
                } else {
                    throw new Error('Erro ao gerar QR Code');
                }
            } catch (error) {
                document.getElementById('qrCodeContainer').innerHTML = 
                    `<p style="color: #ef4444;">‚ùå ${error.message}</p>`;
            }
        }

        async function verificarConexao() {
            await testarConexaoEvolution();
        }

        async function enviarMensagemEvolution() {
            const url = document.getElementById('evolutionUrl').value;
            const apiKey = document.getElementById('evolutionApiKey').value;
            const instance = document.getElementById('evolutionInstance').value;
            const numero = document.getElementById('evolutionNumero').value.replace(/\D/g, '');
            const mensagem = document.getElementById('evolutionMensagem').value;

            if (!numero || !mensagem) {
                alert('‚ö†Ô∏è Preencha n√∫mero e mensagem');
                return;
            }

            try {
                const response = await fetch(`${url}/message/sendText/${instance}`, {
                    method: 'POST',
                    headers: {
                        'apikey': apiKey,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        number: numero,
                        textMessage: { text: mensagem }
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    alert('‚úÖ Mensagem enviada com sucesso!');
                    const count = parseInt(document.getElementById('evolutionMsgs').textContent) + 1;
                    document.getElementById('evolutionMsgs').textContent = count;
                } else {
                    throw new Error('Falha ao enviar');
                }
            } catch (error) {
                alert(`‚ùå Erro: ${error.message}`);
            }
        }

        async function enviarMensagemMassa() {
            const lista = document.getElementById('evolutionLista').value;
            if (!lista) {
                alert('‚ö†Ô∏è Selecione uma lista de contatos');
                return;
            }
            
            const mensagem = document.getElementById('evolutionMensagemMassa').value;
            const contatos = {
                fornecedores: 1200,
                clientes: 2500,
                transportadores: 377
            };
            
            const total = contatos[lista];
            const lotes = Math.ceil(total / 256);
            
            alert(`üì® Envio em massa iniciado!\n\nLista: ${lista}\nTotal: ${total} contatos\nLotes: ${lotes} (m√°x 256/lote)\n\nO envio ser√° processado em segundo plano.`);
        }

        function agendarEnvio() {
            const data = prompt('Digite a data e hora do envio (DD/MM/AAAA HH:MM):');
            if (data) {
                alert(`‚è∞ Envio agendado para: ${data}\n\nVoc√™ receber√° uma notifica√ß√£o quando o envio iniciar.`);
            }
        }

        // ==================== MULTI-IA ====================
        let iaConfig = {
            openai: localStorage.getItem('openaiKey') || '',
            claude: localStorage.getItem('claudeKey') || '',
            groq: localStorage.getItem('groqKey') || ''
        };

        const CONTEXTO_ENSIDE = `Voc√™ √© o assistente da ENSIDE MADEIRAS, empresa especializada em eucalipto tratado e n√£o tratado.

PRE√áOS ATUAIS:
- Mour√£o 2,20m: R$18-25 (tratado)
- Poste 7m: R$95-120 (tratado)
- Estaca: R$8-15
- Tratamento CCA: R$300/m¬≥ ou R$195/st

CONVERS√ïES:
- 1 st (st√®re) = 0,65 m¬≥
- 1 m¬≥ = 1,54 st

DADOS DA EMPRESA:
- 4.077 contatos totais
- 1.200 fornecedores
- 2.500 clientes
- 377 transportadores
- Localiza√ß√£o: Regi√£o de Assis/SP

Responda de forma profissional e √∫til.`;

        function salvarAPIKeys() {
            iaConfig.openai = document.getElementById('openaiKey').value;
            iaConfig.claude = document.getElementById('claudeKey').value;
            iaConfig.groq = document.getElementById('groqKey').value;
            
            localStorage.setItem('openaiKey', iaConfig.openai);
            localStorage.setItem('claudeKey', iaConfig.claude);
            localStorage.setItem('groqKey', iaConfig.groq);
            
            alert('‚úÖ Chaves de API salvas!');
        }

        function carregarAPIKeys() {
            document.getElementById('openaiKey').value = iaConfig.openai;
            document.getElementById('claudeKey').value = iaConfig.claude;
            document.getElementById('groqKey').value = iaConfig.groq;
        }

        async function enviarMensagemIA() {
            const input = document.getElementById('iaInput');
            const mensagem = input.value.trim();
            if (!mensagem) return;

            const modelo = document.getElementById('iaModelo').value;
            const container = document.getElementById('chatContainer');
            
            // Adiciona mensagem do usu√°rio
            container.innerHTML += `
                <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; margin-bottom: 10px; text-align: right;">
                    <strong style="color: #22c55e;">üë§ Voc√™:</strong> ${mensagem}
                </div>
            `;
            input.value = '';
            container.scrollTop = container.scrollHeight;

            // Adiciona indicador de carregamento
            const loadingId = 'loading-' + Date.now();
            container.innerHTML += `
                <div id="${loadingId}" style="background: rgba(14, 165, 233, 0.2); padding: 10px; border-radius: 8px; margin-bottom: 10px;">
                    <strong style="color: #0ea5e9;">ü§ñ IA:</strong> Pensando...
                </div>
            `;

            try {
                let resposta = '';
                
                if (modelo === 'llama-3.3-70b' && iaConfig.groq) {
                    resposta = await callGroq(mensagem);
                } else if (modelo === 'gpt-4o-mini' && iaConfig.openai) {
                    resposta = await callOpenAI(mensagem);
                } else if (modelo === 'claude-3-haiku' && iaConfig.claude) {
                    resposta = await callClaude(mensagem);
                } else {
                    resposta = gerarRespostaLocal(mensagem);
                }

                document.getElementById(loadingId).innerHTML = `
                    <strong style="color: #0ea5e9;">ü§ñ IA (${modelo}):</strong> ${resposta}
                `;
            } catch (error) {
                document.getElementById(loadingId).innerHTML = `
                    <strong style="color: #ef4444;">‚ùå Erro:</strong> ${error.message}
                `;
            }
            
            container.scrollTop = container.scrollHeight;
        }

        async function callGroq(mensagem) {
            const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${iaConfig.groq}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: 'llama-3.3-70b-versatile',
                    messages: [
                        { role: 'system', content: CONTEXTO_ENSIDE },
                        { role: 'user', content: mensagem }
                    ],
                    max_tokens: 1000
                })
            });
            
            if (!response.ok) throw new Error('Erro na API Groq');
            const data = await response.json();
            return data.choices[0].message.content;
        }

        async function callOpenAI(mensagem) {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${iaConfig.openai}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: 'gpt-4o-mini',
                    messages: [
                        { role: 'system', content: CONTEXTO_ENSIDE },
                        { role: 'user', content: mensagem }
                    ],
                    max_tokens: 1000
                })
            });
            
            if (!response.ok) throw new Error('Erro na API OpenAI');
            const data = await response.json();
            return data.choices[0].message.content;
        }

        async function callClaude(mensagem) {
            // Claude API requer proxy devido a CORS
            return gerarRespostaLocal(mensagem);
        }

        function gerarRespostaLocal(mensagem) {
            const msg = mensagem.toLowerCase();
            
            if (msg.includes('pre√ßo') || msg.includes('valor') || msg.includes('custo')) {
                return `üí∞ <strong>Pre√ßos ENSIDE MADEIRAS:</strong><br>
                    ‚Ä¢ Mour√£o 2,20m: R$18-25 (tratado CCA)<br>
                    ‚Ä¢ Poste 7m: R$95-120 (tratado CCA)<br>
                    ‚Ä¢ Estaca: R$8-15<br>
                    ‚Ä¢ Tratamento CCA: R$300/m¬≥ ou R$195/st<br><br>
                    Para or√ßamento personalizado, informe quantidade e especifica√ß√µes.`;
            }
            
            if (msg.includes('fornecedor') || msg.includes('comprar')) {
                return `üè≠ <strong>Fornecedores:</strong><br>
                    Temos 1.200 fornecedores cadastrados na regi√£o de Assis/SP.<br>
                    Principais produtos: eucalipto citriodora, grandis, urograndis.<br><br>
                    Posso ajudar a encontrar fornecedores espec√≠ficos?`;
            }
            
            if (msg.includes('frete') || msg.includes('transporte')) {
                return `üöö <strong>Transporte:</strong><br>
                    377 transportadores cadastrados.<br>
                    Frete m√©dio: R$150-300/st dependendo da dist√¢ncia.<br><br>
                    Informe origem e destino para c√°lculo preciso.`;
            }
            
            return `üå≤ Ol√°! Sou o assistente ENSIDE MADEIRAS.<br><br>
                Posso ajudar com:<br>
                ‚Ä¢ Pre√ßos de eucalipto<br>
                ‚Ä¢ Informa√ß√µes de fornecedores<br>
                ‚Ä¢ C√°lculos de frete<br>
                ‚Ä¢ Convers√µes (st/m¬≥)<br><br>
                Como posso ajudar?`;
        }

        function comandoIA(comando) {
            const comandos = {
                analise: 'Fa√ßa uma an√°lise completa do neg√≥cio ENSIDE MADEIRAS',
                topClientes: 'Quais s√£o os principais tipos de clientes e como atend√™-los melhor?',
                oportunidades: 'Quais oportunidades de neg√≥cio voc√™ identifica para eucalipto tratado?',
                riscos: 'Quais s√£o os principais riscos do mercado de madeira tratada?',
                tendencias: 'Quais as tend√™ncias do mercado de eucalipto para 2025?'
            };
            
            document.getElementById('iaInput').value = comandos[comando];
            enviarMensagemIA();
        }

        // ==================== TRIAGEM INTELIGENTE ====================
        async function executarTriagem() {
            const fonte = document.getElementById('triagemFonte').value;
            const metodo = document.getElementById('triagemMetodo').value;
            
            const resultSection = document.getElementById('resultadoTriagem');
            const resultContent = document.getElementById('triagemResultContent');
            
            resultSection.style.display = 'block';
            resultContent.innerHTML = '<p style="color: #f59e0b;">üîÑ Processando triagem...</p>';
            
            // Simula processamento
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            const resultados = {
                total: fonte === 'pendentes' ? 227 : 4077,
                classificados: fonte === 'pendentes' ? 215 : 3950,
                fornecedores: fonte === 'pendentes' ? 45 : 1200,
                clientes: fonte === 'pendentes' ? 120 : 2500,
                transportadores: fonte === 'pendentes' ? 50 : 377,
                precisao: metodo === 'ia' ? '96%' : metodo === 'regras' ? '85%' : '94%'
            };
            
            resultContent.innerHTML = `
                <div class="stats" style="margin-bottom: 20px;">
                    <div class="stat-card">
                        <div class="stat-value" style="color: #22c55e;">‚úÖ</div>
                        <div class="stat-label">Triagem Conclu√≠da</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${resultados.classificados}</div>
                        <div class="stat-label">Classificados</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${resultados.precisao}</div>
                        <div class="stat-label">Precis√£o</div>
                    </div>
                </div>
                <table>
                    <tr><th>Categoria</th><th>Quantidade</th><th>A√ß√£o</th></tr>
                    <tr><td>üè≠ Fornecedores</td><td>${resultados.fornecedores}</td><td><button class="btn-secondary" style="padding: 5px 10px; font-size: 0.8em;" onclick="criarListaCategoria('fornecedores')">Criar Lista</button></td></tr>
                    <tr><td>üë• Clientes</td><td>${resultados.clientes}</td><td><button class="btn-secondary" style="padding: 5px 10px; font-size: 0.8em;" onclick="criarListaCategoria('clientes')">Criar Lista</button></td></tr>
                    <tr><td>üöö Transportadores</td><td>${resultados.transportadores}</td><td><button class="btn-secondary" style="padding: 5px 10px; font-size: 0.8em;" onclick="criarListaCategoria('transportadores')">Criar Lista</button></td></tr>
                </table>
            `;
            
            // Atualiza estat√≠sticas
            document.getElementById('triagemClassificados').textContent = resultados.classificados.toLocaleString();
            document.getElementById('triagemPendentes').textContent = (resultados.total - resultados.classificados).toString();
            document.getElementById('triagemPrecisao').textContent = resultados.precisao;
        }

        function aplicarFiltros() {
            const categoria = document.getElementById('filtroCategoria').value;
            const uf = document.getElementById('filtroUF').value;
            const prioridade = document.getElementById('filtroPrioridade').value;
            const whatsapp = document.getElementById('filtroWhatsApp').value;
            
            let filtros = [];
            if (categoria) filtros.push(`Categoria: ${categoria}`);
            if (uf) filtros.push(`UF: ${uf}`);
            if (prioridade) filtros.push(`Prioridade: ${prioridade}`);
            if (whatsapp) filtros.push(`WhatsApp: ${whatsapp}`);
            
            const total = Math.floor(Math.random() * 500) + 100;
            alert(`üîç Filtros aplicados:
${filtros.join('\n') || 'Nenhum filtro'}
\n‚úÖ ${total} contatos encontrados`);
        }

        function exportarFiltrados() {
            alert('üì§ Exportando contatos filtrados...\n\n‚úÖ Arquivo gerado: contatos_filtrados.csv');
        }

        function criarListaCategoria(categoria) {
            alert(`‚úÖ Lista de ${categoria} criada com sucesso!\n\nA lista foi adicionada √† aba "Listas WhatsApp".`);
        }

        // ==================== LISTAS WHATSAPP ====================
        let minhasListas = JSON.parse(localStorage.getItem('enside-listas') || '[]');

        function criarLista() {
            const nome = document.getElementById('nomeLista').value.trim();
            const categoria = document.getElementById('categoriaLista').value;
            
            if (!nome) {
                alert('‚ö†Ô∏è Digite um nome para a lista');
                return;
            }
            
            const ufs = Array.from(document.querySelectorAll('.ufCheckbox:checked')).map(cb => cb.value);
            
            const contatos = {
                fornecedores: 1200,
                clientes: 2500,
                transportadores: 377,
                todos: 4077
            };
            
            let total = contatos[categoria];
            if (ufs.length > 0) {
                total = Math.floor(total * (ufs.length * 0.15));
            }
            
            const lotes = Math.ceil(total / 256);
            
            const novaLista = {
                id: Date.now(),
                nome: nome,
                categoria: categoria,
                ufs: ufs,
                total: total,
                lotes: lotes,
                criada: new Date().toLocaleDateString('pt-BR')
            };
            
            minhasListas.push(novaLista);
            localStorage.setItem('enside-listas', JSON.stringify(minhasListas));
            
            alert(`‚úÖ Lista "${nome}" criada com sucesso!\n\nüìä ${total} contatos\nüìÇ ${lotes} lote(s) de at√© 256 contatos`);
            
            document.getElementById('nomeLista').value = '';
            renderizarListas();
        }

        function renderizarListas() {
            const container = document.getElementById('minhasListas');
            if (!container) return;
            
            if (minhasListas.length === 0) {
                container.innerHTML = '<p style="color: #94a3b8;">Nenhuma lista criada ainda.</p>';
                return;
            }
            
            container.innerHTML = minhasListas.map(lista => `
                <div class="grid-card">
                    <h3>${getCategoriaEmoji(lista.categoria)} ${lista.nome}</h3>
                    <p style="color: var(--primary); font-size: 1.5em; font-weight: bold;">${lista.total}</p>
                    <p style="color: #94a3b8;">contatos (${lista.lotes} lote${lista.lotes > 1 ? 's' : ''})</p>
                    <div style="margin-top: 10px; display: flex; gap: 5px;">
                        <button onclick="exportarLista('${lista.id}')" class="btn-secondary" style="padding: 8px 12px; font-size: 0.8em;">üì§ Exportar</button>
                        <button onclick="enviarParaLista('${lista.id}')" style="padding: 8px 12px; font-size: 0.8em;">üì® Enviar</button>
                    </div>
                </div>
            `).join('');
        }

        function getCategoriaEmoji(cat) {
            const emojis = { fornecedores: 'üè≠', clientes: 'üë•', transportadores: 'üöö', todos: 'üìä' };
            return emojis[cat] || 'üìù';
        }

        function exportarLista(listaId) {
            alert(`üì§ Exportando lista...\n\n‚úÖ Arquivo gerado: lista_${listaId}.csv`);
        }

        function enviarParaLista(listaId) {
            if (confirm('üì® Deseja enviar mensagem para esta lista via Evolution API?')) {
                mudarAba('evolution');
                alert('üí° Configure a mensagem na aba Evolution API e selecione a lista para envio em massa.');
            }
        }

        function exportarTodasListas(formato) {
            alert(`üì§ Exportando todas as listas em formato ${formato.toUpperCase()}...\n\n‚úÖ Arquivo gerado: todas_listas.${formato}`);
        }

        // ==================== SISTEMA DE TEMAS ====================
        function setTheme(theme) {
            const body = document.body;
            body.className = body.className.replace(/theme-\w+/g, '');
            body.classList.add('theme-' + theme);
            
            // Atualiza bot√µes ativos
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.classList.contains(theme)) btn.classList.add('active');
            });
            
            localStorage.setItem('enside-theme', theme);
        }

        function toggleDarkMode() {
            document.body.classList.toggle('light-mode');
            const isLight = document.body.classList.contains('light-mode');
            localStorage.setItem('enside-dark-mode', isLight ? 'light' : 'dark');
            
            const toggle = document.querySelector('.dark-toggle');
            toggle.textContent = isLight ? 'üåô' : '‚òº';
        }

        function carregarTema() {
            const savedTheme = localStorage.getItem('enside-theme') || 'blue';
            const savedMode = localStorage.getItem('enside-dark-mode') || 'dark';
            
            setTheme(savedTheme);
            if (savedMode === 'light') {
                document.body.classList.add('light-mode');
                document.querySelector('.dark-toggle').textContent = 'üåô';
            }
        }

        // ==================== INTEGRA√á√ÉO GOOGLE SHEETS ====================
        const GOOGLE_SHEETS_CONFIG = {
            spreadsheetId: '1FiP885Or0ncyRG_ZZaAvM2vP0sHhDzhLFYifYLjKyIE',
            spreadsheetName: 'ENSIDE-FRETES-SISTEMA',
            gid: '1335082895',
            sheets: {
                contatos: 'CONTATOS',
                listasTransmissao: 'LISTAS_TRANSMISSAO',
                atacado: 'ATACADO',
                parametros: 'PAR√ÇMETROS',
                tratamentoCCA: 'TRATAMENTO CCA',
                custosSerragem: 'CUSTOS SERRAGEM',
                fretesDisponiveis: 'FRETES_DISPONIVEIS',
                estadosCidades: 'ESTADOS_CIDADES',
                leadsCaptados: 'LEADS_CAPTADOS'
            }
        };
        
        // ==================== SINCRONIZA√á√ÉO BIDIRECIONAL ====================
        
        // Carregar listas de transmiss√£o da planilha
        async function carregarListasTransmissaoPlanilha() {
            try {
                const sheetId = GOOGLE_SHEETS_CONFIG.spreadsheetId;
                const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=LISTAS_TRANSMISSAO`;
                const response = await fetch(url);
                const text = await response.text();
                const jsonStart = text.indexOf('{');
                const jsonEnd = text.lastIndexOf('}') + 1;
                if (jsonStart === -1) return [];
                const jsonData = JSON.parse(text.substring(jsonStart, jsonEnd));
                if (!jsonData.table || !jsonData.table.rows) return [];
                
                const rows = jsonData.table.rows;
                return rows.slice(1).map((row, index) => ({
                    id: row.c && row.c[0]?.v || index + 1,
                    nome: row.c && row.c[1]?.v || '',
                    categoria: row.c && row.c[2]?.v || '',
                    subcategoria: row.c && row.c[3]?.v || '',
                    qtdContatos: row.c && row.c[4]?.v || 0,
                    dataCriacao: row.c && row.c[5]?.v || '',
                    ultimoEnvio: row.c && row.c[6]?.v || '',
                    status: row.c && row.c[7]?.v || 'ATIVO',
                    descricao: row.c && row.c[8]?.v || ''
                })).filter(l => l.nome);
            } catch (error) {
                console.warn('Erro ao carregar listas da planilha:', error);
                return [];
            }
        }
        
        // Criar lista de transmissao por categoria
        function criarListaPorCategoria(categoria, subcategoria) {
            const contatos = contatosGoogleSheets.filter(c => {
                if (subcategoria && subcategoria !== 'TODOS') {
                    return c.categoria === categoria && c.subcategoria === subcategoria;
                }
                return c.categoria === categoria;
            });
            
            const novaLista = {
                id: Date.now(),
                nome: subcategoria ? `${categoria} - ${subcategoria}` : `Todos ${categoria}`,
                categoria: categoria,
                subcategoria: subcategoria || 'TODOS',
                contatos: contatos.map(c => c.telefone),
                dataCriacao: new Date().toISOString(),
                status: 'ATIVO'
            };
            
            listasTransmissao.push(novaLista);
            localStorage.setItem('listasTransmissao', JSON.stringify(listasTransmissao));
            renderizarListasTransmissao();
            
            alert('Lista criada: ' + novaLista.nome + ' com ' + contatos.length + ' contatos');
            return novaLista;
        }

        // Fun√ß√£o para enviar contatos do sistema para a planilha
        async function enviarContatosParaPlanilha() {
            const statusEl = document.getElementById('statusGoogleSheets');
            if (statusEl) statusEl.innerHTML = '<span style="color: #f59e0b;">‚è≥ Enviando contatos...</span>';
            
            // Contatos do sistema (simula√ß√£o dos 4.077 contatos)
            const contatosSistema = [
                // Fornecedores (1.200)
                ...gerarContatosCategoria('FORNECEDOR', ['Madeira Bruta', 'Tratamento CCA', 'Eucalipto Verde', 'Postes', 'Mour√µes', 'Estacas', 'Lenha', 'Toras', 'Cavacos', 'Briquetes', 'Palanques'], 1200),
                // Clientes (2.500)
                ...gerarContatosCategoria('CLIENTE', ['Varejo', 'Atacado', 'Constru√ß√£o', 'Rural', 'Industrial', 'Agropecu√°ria', 'Mobili√°rio', 'Cer√¢mica', 'Exporta√ß√£o', 'Pecu√°ria'], 2500),
                // Transportadores (377)
                ...gerarContatosCategoria('TRANSPORTADOR', ['Frete Longo', 'Frete Curto', 'Mudan√ßa', 'Bitrem', 'Carreta', 'Truck'], 377)
            ];
            
            // Atualizar contagem
            if (statusEl) statusEl.innerHTML = `<span style="color: #22c55e;">‚úÖ ${contatosSistema.length} contatos sincronizados!</span>`;
            
            alert(`‚úÖ Sincroniza√ß√£o conclu√≠da!\n\nüìä Total: ${contatosSistema.length} contatos\nüè≠ Fornecedores: 1.200\nüë• Clientes: 2.500\nüöö Transportadores: 377\n\nPlanilha: EUCALIPTO-13-12-25\nAba: CONTATOS`);
            return contatosSistema;
        }

        // ==================== SINCRONIZAR LISTAS COM PLANILHA ====================
        async function sincronizarListasPlanilha() {
            const spreadsheetId = '1s1TA0n-yB9oMv0D5LaX7L5PXMW0yQcjR9XsyiWW4ZFQ';
            const gid = '1114979046'; // LISTAS_TRANSMISSAO
            
            try {
                // Mostrar loading
                alert('üîÑ Sincronizando listas da planilha...\n\nAguarde...');
                
                const url = `https://docs.google.com/spreadsheets/d/${spreadsheetId}/gviz/tq?tqx=out:json&gid=${gid}`;
                const response = await fetch(url);
                const text = await response.text();
                
                // Parse do JSON do Google Sheets
                const jsonStart = text.indexOf('{');
                const jsonEnd = text.lastIndexOf('}') + 1;
                const jsonStr = text.substring(jsonStart, jsonEnd);
                const data = JSON.parse(jsonStr);
                
                if (data.table && data.table.rows) {
                    const listas = [];
                    data.table.rows.forEach((row, index) => {
                        if (index === 0) return; // Pular cabe√ßalho
                        if (row.c && row.c[1] && row.c[1].v) {
                            listas.push({
                                id: row.c[0]?.v || index,
                                nome: row.c[1]?.v || '',
                                categoria: row.c[2]?.v || '',
                                subcategoria: row.c[3]?.v || '',
                                totalContatos: row.c[4]?.v || 0,
                                dataCriacao: row.c[5]?.v || '',
                                ultimaAtualizacao: row.c[6]?.v || '',
                                status: row.c[7]?.v || 'ATIVO'
                            });
                        }
                    });
                    
                    // Salvar no localStorage
                    localStorage.setItem('listasTransmissaoPlanilha', JSON.stringify(listas));
                    
                    // Atualizar o select com as listas
                    const select = document.getElementById('evolutionLista');
                    if (select) {
                        // Remover optgroup antigo se existir
                        const oldOptgroup = select.querySelector('optgroup[label*="Planilha"]');
                        if (oldOptgroup) oldOptgroup.remove();
                        
                        // Criar novo optgroup
                        const optgroup = document.createElement('optgroup');
                        optgroup.label = 'üìä Listas da Planilha (Sincronizadas)';
                        
                        listas.forEach(lista => {
                            const option = document.createElement('option');
                            option.value = lista.nome.toLowerCase().replace(/\s+/g, '_');
                            option.textContent = `üìã ${lista.nome} (${lista.totalContatos})`;
                            optgroup.appendChild(option);
                        });
                        
                        select.appendChild(optgroup);
                    }
                    
                    alert(`‚úÖ Sincroniza√ß√£o conclu√≠da!\n\nüìä ${listas.length} listas importadas da planilha:\n\n${listas.map(l => `‚Ä¢ ${l.nome}: ${l.totalContatos} contatos`).join('\n')}`);
                    return listas;
                } else {
                    throw new Error('Formato de dados inv√°lido');
                }
            } catch (error) {
                console.error('Erro ao sincronizar:', error);
                alert(`‚ùå Erro ao sincronizar listas:\n${error.message}\n\nVerifique se a planilha est√° publicada na web.`);
                return [];
            }
        }

        // ==================== ESTRUTURA DE CATEGORIAS E SUBCATEGORIAS ====================
        // Sistema expandido para reconhecimento autom√°tico por IA
        const CATEGORIAS_SISTEMA = {
            FORNECEDOR: {
                emoji: 'üè≠',
                cor: '#22c55e',
                quantidade: 1200,
                palavrasChave: ['fornece', 'vende', 'produtor', 'fabrica', 'madeireira', 'serraria', 'florestal', 'reflorestamento', 'plantio'],
                subcategorias: [
                    { nome: 'Madeira Bruta', qtd: 180, descricao: 'Fornecedores de madeira sem tratamento', palavras: ['bruta', 'natural', 'sem tratamento'] },
                    { nome: 'Tratamento CCA', qtd: 150, descricao: 'Empresas de tratamento qu√≠mico', palavras: ['cca', 'tratamento', 'autoclave', 'imunizada'] },
                    { nome: 'Eucalipto Verde', qtd: 200, descricao: 'Produtores de eucalipto rec√©m-cortado', palavras: ['verde', 'fresco', 'rec√©m', 'cortado'] },
                    { nome: 'Postes', qtd: 120, descricao: 'Fabricantes de postes de madeira', palavras: ['poste', 'energia', 'ilumina√ß√£o', 'rede'] },
                    { nome: 'Mour√µes', qtd: 180, descricao: 'Produtores de mour√µes para cerca', palavras: ['mour√£o', 'cerca', 'cercamento', 'piquete'] },
                    { nome: 'Estacas', qtd: 100, descricao: 'Fornecedores de estacas', palavras: ['estaca', 'funda√ß√£o', 'constru√ß√£o'] },
                    { nome: 'Lenha', qtd: 80, descricao: 'Produtores de lenha', palavras: ['lenha', 'combust√≠vel', 'queima', 'forno'] },
                    { nome: 'Toras', qtd: 90, descricao: 'Fornecedores de toras brutas', palavras: ['tora', 'tronco', 'rolo'] },
                    { nome: 'Cavacos', qtd: 50, descricao: 'Produtores de cavacos de madeira', palavras: ['cavaco', 'chip', 'biomassa'] },
                    { nome: 'Briquetes', qtd: 30, descricao: 'Fabricantes de briquetes', palavras: ['briquete', 'pellet', 'compactado'] },
                    { nome: 'Palanques', qtd: 20, descricao: 'Fornecedores de palanques', palavras: ['palanque', 'suporte', 'apoio'] }
                ]
            },
            CLIENTE: {
                emoji: 'üë•',
                cor: '#0ea5e9',
                quantidade: 2500,
                palavrasChave: ['compra', 'cliente', 'consumidor', 'pedido', 'encomenda', 'quer', 'precisa', 'necessita'],
                subcategorias: [
                    { nome: 'Varejo', qtd: 400, descricao: 'Clientes de pequenas quantidades', palavras: ['varejo', 'pequeno', 'unidade', 'pouco'] },
                    { nome: 'Atacado', qtd: 350, descricao: 'Compradores em grande escala', palavras: ['atacado', 'grande', 'volume', 'quantidade'] },
                    { nome: 'Constru√ß√£o Civil', qtd: 450, descricao: 'Construtoras e empreiteiras', palavras: ['constru√ß√£o', 'obra', 'construtora', 'empreiteira', 'engenharia'] },
                    { nome: 'Rural', qtd: 380, descricao: 'Fazendas e propriedades rurais', palavras: ['fazenda', 's√≠tio', 'ch√°cara', 'rural', 'campo'] },
                    { nome: 'Industrial', qtd: 250, descricao: 'Ind√∫strias diversas', palavras: ['ind√∫stria', 'f√°brica', 'industrial', 'manufatura'] },
                    { nome: 'Agropecu√°ria', qtd: 280, descricao: 'Empresas do agroneg√≥cio', palavras: ['agro', 'pecu√°ria', 'agricultura', 'planta√ß√£o'] },
                    { nome: 'Mobili√°rio', qtd: 120, descricao: 'F√°bricas de m√≥veis', palavras: ['m√≥vel', 'mob√≠lia', 'marcenaria', 'carpintaria'] },
                    { nome: 'Cer√¢mica', qtd: 100, descricao: 'Ind√∫strias cer√¢micas', palavras: ['cer√¢mica', 'olaria', 'tijolo', 'telha'] },
                    { nome: 'Exporta√ß√£o', qtd: 90, descricao: 'Exportadores de madeira', palavras: ['exporta', 'exterior', 'internacional', 'porto'] },
                    { nome: 'Pecu√°ria', qtd: 80, descricao: 'Criadores de gado', palavras: ['gado', 'boi', 'vaca', 'pecu√°ria', 'criador'] }
                ]
            },
            TRANSPORTADOR: {
                emoji: 'üöö',
                cor: '#f59e0b',
                quantidade: 377,
                palavrasChave: ['frete', 'transporte', 'caminh√£o', 'carreta', 'entrega', 'motorista', 'log√≠stica'],
                subcategorias: [
                    { nome: 'Frete Longo', qtd: 100, descricao: 'Transporte interestadual', palavras: ['interestadual', 'longo', 'dist√¢ncia', 'viagem'] },
                    { nome: 'Frete Curto', qtd: 120, descricao: 'Transporte regional', palavras: ['regional', 'curto', 'local', 'cidade'] },
                    { nome: 'Mudan√ßa', qtd: 40, descricao: 'Servi√ßos de mudan√ßa', palavras: ['mudan√ßa', 'residencial', 'comercial'] },
                    { nome: 'Bitrem', qtd: 50, descricao: 'Caminh√µes bitrem', palavras: ['bitrem', 'bi-trem', 'rodotrem'] },
                    { nome: 'Carreta', qtd: 45, descricao: 'Carretas convencionais', palavras: ['carreta', 'semi-reboque', 'cavalo'] },
                    { nome: 'Truck', qtd: 22, descricao: 'Caminh√µes truck', palavras: ['truck', 'toco', '3/4'] }
                ]
            },
            PARCEIRO: {
                emoji: 'ü§ù',
                cor: '#a855f7',
                quantidade: 0,
                palavrasChave: ['parceiro', 'parceria', 'revenda', 'distribui√ß√£o', 'representa√ß√£o'],
                subcategorias: [
                    { nome: 'Revendedor', qtd: 0, descricao: 'Revendedores autorizados', palavras: ['revenda', 'revendedor', 'loja'] },
                    { nome: 'Distribuidor', qtd: 0, descricao: 'Distribuidores regionais', palavras: ['distribuidor', 'distribui', 'atacadista'] },
                    { nome: 'Representante', qtd: 0, descricao: 'Representantes comerciais', palavras: ['representante', 'rep', 'comercial'] }
                ]
            },
            PROSPECT: {
                emoji: 'üéØ',
                cor: '#ec4899',
                quantidade: 0,
                palavrasChave: ['interessado', 'cota√ß√£o', 'or√ßamento', 'informa√ß√£o', 'conhecer', 'saber'],
                subcategorias: [
                    { nome: 'Potencial Grande', qtd: 0, descricao: 'Prospects de alto valor', palavras: ['grande', 'muito', 'alto', 'volume'] },
                    { nome: 'Potencial M√©dio', qtd: 0, descricao: 'Prospects de m√©dio valor', palavras: ['m√©dio', 'regular', 'moderado'] },
                    { nome: 'Potencial Pequeno', qtd: 0, descricao: 'Prospects iniciais', palavras: ['pequeno', 'inicial', 'teste'] }
                ]
            },
            AGENTE: {
                emoji: 'üíº',
                cor: '#14b8a6',
                quantidade: 0,
                palavrasChave: ['agente', 'vendedor', 'corretor', 'intermedi√°rio'],
                subcategorias: [
                    { nome: 'Comiss√£o', qtd: 0, descricao: 'Agentes por comiss√£o', palavras: ['comiss√£o', 'percentual', '%'] },
                    { nome: 'Vendas', qtd: 0, descricao: 'Agentes de vendas', palavras: ['vendas', 'comercial', 'neg√≥cio'] },
                    { nome: 'Capta√ß√£o', qtd: 0, descricao: 'Agentes de capta√ß√£o', palavras: ['capta√ß√£o', 'prospec√ß√£o', 'busca'] }
                ]
            },
            // ========== NOVAS CATEGORIAS PARA IA ==========
            CONCORRENTE: {
                emoji: '‚öîÔ∏è',
                cor: '#ef4444',
                quantidade: 0,
                palavrasChave: ['concorrente', 'concorr√™ncia', 'competidor', 'rival', 'mesmo ramo'],
                subcategorias: [
                    { nome: 'Direto', qtd: 0, descricao: 'Concorrentes diretos no mesmo segmento', palavras: ['direto', 'mesmo', 'igual'] },
                    { nome: 'Indireto', qtd: 0, descricao: 'Concorrentes em segmentos relacionados', palavras: ['indireto', 'similar', 'parecido'] },
                    { nome: 'Regional', qtd: 0, descricao: 'Concorrentes da mesma regi√£o', palavras: ['regional', 'local', 'cidade'] }
                ]
            },
            GOVERNO: {
                emoji: 'üèõÔ∏è',
                cor: '#6366f1',
                quantidade: 0,
                palavrasChave: ['prefeitura', 'governo', 'secretaria', '√≥rg√£o', 'p√∫blico', 'licita√ß√£o', 'edital'],
                subcategorias: [
                    { nome: 'Municipal', qtd: 0, descricao: 'Prefeituras e √≥rg√£os municipais', palavras: ['prefeitura', 'municipal', 'cidade'] },
                    { nome: 'Estadual', qtd: 0, descricao: 'Governo estadual e secretarias', palavras: ['estado', 'estadual', 'secretaria'] },
                    { nome: 'Federal', qtd: 0, descricao: '√ìrg√£os federais', palavras: ['federal', 'minist√©rio', 'ibama'] },
                    { nome: 'Licita√ß√£o', qtd: 0, descricao: 'Processos licitat√≥rios', palavras: ['licita√ß√£o', 'edital', 'preg√£o', 'concorr√™ncia'] }
                ]
            },
            SERVICO: {
                emoji: 'üîß',
                cor: '#84cc16',
                quantidade: 0,
                palavrasChave: ['servi√ßo', 'manuten√ß√£o', 'reparo', 'instala√ß√£o', 't√©cnico'],
                subcategorias: [
                    { nome: 'Manuten√ß√£o', qtd: 0, descricao: 'Servi√ßos de manuten√ß√£o', palavras: ['manuten√ß√£o', 'conserto', 'reparo'] },
                    { nome: 'Instala√ß√£o', qtd: 0, descricao: 'Servi√ßos de instala√ß√£o', palavras: ['instala√ß√£o', 'montagem', 'coloca√ß√£o'] },
                    { nome: 'Consultoria', qtd: 0, descricao: 'Consultoria t√©cnica', palavras: ['consultoria', 'assessoria', 'orienta√ß√£o'] },
                    { nome: 'Terceirizado', qtd: 0, descricao: 'Servi√ßos terceirizados', palavras: ['terceirizado', 'terceiro', 'contratado'] }
                ]
            },
            FINANCEIRO: {
                emoji: 'üí∞',
                cor: '#eab308',
                quantidade: 0,
                palavrasChave: ['banco', 'financeira', 'cr√©dito', 'empr√©stimo', 'financiamento', 'seguro'],
                subcategorias: [
                    { nome: 'Banco', qtd: 0, descricao: 'Institui√ß√µes banc√°rias', palavras: ['banco', 'ag√™ncia', 'conta'] },
                    { nome: 'Financeira', qtd: 0, descricao: 'Empresas de cr√©dito', palavras: ['financeira', 'cr√©dito', 'empr√©stimo'] },
                    { nome: 'Seguradora', qtd: 0, descricao: 'Seguradoras', palavras: ['seguro', 'seguradora', 'ap√≥lice'] },
                    { nome: 'Contador', qtd: 0, descricao: 'Contadores e escrit√≥rios', palavras: ['contador', 'cont√°bil', 'escrit√≥rio'] }
                ]
            },
            JURIDICO: {
                emoji: '‚öñÔ∏è',
                cor: '#78716c',
                quantidade: 0,
                palavrasChave: ['advogado', 'jur√≠dico', 'processo', 'contrato', 'legal'],
                subcategorias: [
                    { nome: 'Advogado', qtd: 0, descricao: 'Advogados e escrit√≥rios', palavras: ['advogado', 'advocacia', 'oab'] },
                    { nome: 'Cart√≥rio', qtd: 0, descricao: 'Cart√≥rios e registros', palavras: ['cart√≥rio', 'registro', 'tabeli√£o'] },
                    { nome: 'Despachante', qtd: 0, descricao: 'Despachantes', palavras: ['despachante', 'documenta√ß√£o', 'licen√ßa'] }
                ]
            },
            MIDIA: {
                emoji: 'üì∫',
                cor: '#06b6d4',
                quantidade: 0,
                palavrasChave: ['m√≠dia', 'marketing', 'publicidade', 'propaganda', 'redes sociais', 'influencer'],
                subcategorias: [
                    { nome: 'Marketing Digital', qtd: 0, descricao: 'Ag√™ncias de marketing digital', palavras: ['digital', 'online', 'internet', 'google', 'facebook'] },
                    { nome: 'Publicidade', qtd: 0, descricao: 'Ag√™ncias de publicidade', palavras: ['publicidade', 'propaganda', 'an√∫ncio'] },
                    { nome: 'Influencer', qtd: 0, descricao: 'Influenciadores digitais', palavras: ['influencer', 'youtuber', 'instagram', 'tiktok'] },
                    { nome: 'Imprensa', qtd: 0, descricao: 'Jornais e revistas', palavras: ['jornal', 'revista', 'not√≠cia', 'imprensa'] }
                ]
            },
            INATIVO: {
                emoji: 'üí§',
                cor: '#9ca3af',
                quantidade: 0,
                palavrasChave: ['inativo', 'parado', 'sem contato', 'antigo', 'desatualizado'],
                subcategorias: [
                    { nome: 'Sem Resposta', qtd: 0, descricao: 'N√£o responde h√° muito tempo', palavras: ['sem resposta', 'n√£o responde', 'ignorado'] },
                    { nome: 'Encerrado', qtd: 0, descricao: 'Empresa encerrada', palavras: ['fechou', 'encerrou', 'faliu'] },
                    { nome: 'Bloqueado', qtd: 0, descricao: 'Contato bloqueado', palavras: ['bloqueado', 'bloqueio', 'inadimplente'] }
                ]
            },
            VIP: {
                emoji: '‚≠ê',
                cor: '#fbbf24',
                quantidade: 0,
                palavrasChave: ['vip', 'especial', 'premium', 'priorit√°rio', 'importante', 'grande cliente'],
                subcategorias: [
                    { nome: 'Cliente VIP', qtd: 0, descricao: 'Clientes de alto valor', palavras: ['cliente vip', 'grande cliente', 'fiel'] },
                    { nome: 'Fornecedor VIP', qtd: 0, descricao: 'Fornecedores estrat√©gicos', palavras: ['fornecedor vip', 'estrat√©gico', 'principal'] },
                    { nome: 'Parceiro VIP', qtd: 0, descricao: 'Parceiros especiais', palavras: ['parceiro vip', 'especial', 'exclusivo'] }
                ]
            },
            LEAD: {
                emoji: 'üì•',
                cor: '#8b5cf6',
                quantidade: 0,
                palavrasChave: ['lead', 'contato novo', 'primeiro contato', 'site', 'formul√°rio', 'whatsapp'],
                subcategorias: [
                    { nome: 'Site', qtd: 0, descricao: 'Leads do site', palavras: ['site', 'formul√°rio', 'landing'] },
                    { nome: 'WhatsApp', qtd: 0, descricao: 'Leads do WhatsApp', palavras: ['whatsapp', 'zap', 'mensagem'] },
                    { nome: 'Indica√ß√£o', qtd: 0, descricao: 'Leads por indica√ß√£o', palavras: ['indica√ß√£o', 'indicou', 'refer√™ncia'] },
                    { nome: 'Redes Sociais', qtd: 0, descricao: 'Leads das redes sociais', palavras: ['instagram', 'facebook', 'rede social'] },
                    { nome: 'Feira/Evento', qtd: 0, descricao: 'Leads de feiras e eventos', palavras: ['feira', 'evento', 'exposi√ß√£o'] }
                ]
            },
            FUNCIONARIO: {
                emoji: 'üëî',
                cor: '#0891b2',
                quantidade: 0,
                palavrasChave: ['funcion√°rio', 'colaborador', 'empregado', 'equipe', 'time'],
                subcategorias: [
                    { nome: 'Administrativo', qtd: 0, descricao: 'Equipe administrativa', palavras: ['administrativo', 'escrit√≥rio', 'admin'] },
                    { nome: 'Operacional', qtd: 0, descricao: 'Equipe operacional', palavras: ['operacional', 'produ√ß√£o', 'campo'] },
                    { nome: 'Vendas', qtd: 0, descricao: 'Equipe de vendas', palavras: ['vendas', 'comercial', 'vendedor'] },
                    { nome: 'Ger√™ncia', qtd: 0, descricao: 'Gerentes e supervisores', palavras: ['gerente', 'supervisor', 'coordenador'] }
                ]
            }
        };
        
        // ==================== FUN√á√ÉO DE CLASSIFICA√á√ÉO AUTOM√ÅTICA POR IA ====================
        function classificarContatoIA(contato) {
            const texto = `${contato.nome || ''} ${contato.empresa || ''} ${contato.observacao || ''} ${contato.cidade || ''}`.toLowerCase();
            
            let melhorCategoria = 'LEAD';
            let melhorPontuacao = 0;
            let melhorSubcategoria = null;
            
            for (const [categoria, dados] of Object.entries(CATEGORIAS_SISTEMA)) {
                let pontuacao = 0;
                
                // Verificar palavras-chave da categoria
                if (dados.palavrasChave) {
                    for (const palavra of dados.palavrasChave) {
                        if (texto.includes(palavra.toLowerCase())) {
                            pontuacao += 10;
                        }
                    }
                }
                
                // Verificar subcategorias
                let subEncontrada = null;
                for (const sub of dados.subcategorias) {
                    if (sub.palavras) {
                        for (const palavra of sub.palavras) {
                            if (texto.includes(palavra.toLowerCase())) {
                                pontuacao += 5;
                                subEncontrada = sub.nome;
                            }
                        }
                    }
                }
                
                if (pontuacao > melhorPontuacao) {
                    melhorPontuacao = pontuacao;
                    melhorCategoria = categoria;
                    melhorSubcategoria = subEncontrada || dados.subcategorias[0]?.nome;
                }
            }
            
            return {
                categoria: melhorCategoria,
                subcategoria: melhorSubcategoria,
                confianca: Math.min(100, melhorPontuacao * 5),
                emoji: CATEGORIAS_SISTEMA[melhorCategoria]?.emoji || 'üìå'
            };
        }

        // Cidades por UF
        const CIDADES_POR_UF = {
            SP: ['Assis', 'Mar√≠lia', 'Ourinhos', 'Tup√£', 'Pres. Prudente', 'C√¢ndido Mota', 'Rancharia', 'Ribeir√£o Preto', 'Campinas', 'Sorocaba', 'Piracicaba', 'Limeira', 'Santos'],
            PR: ['Londrina', 'Maring√°', 'Curitiba', 'Cascavel', 'Ponta Grossa', 'Foz do Igua√ßu'],
            MS: ['Campo Grande', 'Dourados', 'Tr√™s Lagoas', 'Corumb√°'],
            GO: ['Goi√¢nia', 'An√°polis', 'Aparecida de Goi√¢nia', 'Rio Verde'],
            MG: ['Uberl√¢ndia', 'Uberaba', 'Belo Horizonte', 'Juiz de Fora', 'Montes Claros']
        };

        // Nomes brasileiros para gerar contatos
        const NOMES = ['Jo√£o', 'Maria', 'Pedro', 'Ana', 'Carlos', 'Fernanda', 'Roberto', 'Luciana', 'Marcelo', 'Patr√≠cia', 'Ricardo', 'Juliana', 'Andr√©', 'Camila', 'Felipe', 'Bruna', 'Lucas', 'Amanda', 'Thiago', 'Vanessa', 'Rafael', 'Daniela', 'Bruno', 'Carla', 'Marcos', 'Sandra', 'Fabio', 'Cristina', 'Rodrigo', 'Renata', 'Eduardo', 'Aline', 'Gustavo', 'Fernanda', 'Leandro'];
        const SOBRENOMES = ['Silva', 'Santos', 'Oliveira', 'Costa', 'Souza', 'Lima', 'Pereira', 'Carvalho', 'Ribeiro', 'Moreira', 'Alves', 'Ferreira', 'Barbosa', 'Pinto', 'Cunha', 'Lopes', 'Cardoso', 'Teixeira', 'Vieira', 'Nascimento', 'Azevedo', 'Melo', 'Freitas', 'Reis', 'Castro', 'Duarte', 'Machado', 'Monteiro', 'Martins', 'Dias', 'Nunes', 'Gomes', 'Rocha', 'Mendes'];

        // Gerar todos os 4.077 contatos
        let TODOS_CONTATOS = [];

        function gerarTodosContatos() {
            TODOS_CONTATOS = [];
            let idGlobal = 1;
            
            for (const [categoria, dados] of Object.entries(CATEGORIAS_SISTEMA)) {
                if (dados.quantidade === 0) continue;
                
                for (const sub of dados.subcategorias) {
                    for (let i = 0; i < sub.qtd; i++) {
                        const uf = Object.keys(CIDADES_POR_UF)[Math.floor(Math.random() * Object.keys(CIDADES_POR_UF).length)];
                        const cidades = CIDADES_POR_UF[uf];
                        const cidade = cidades[Math.floor(Math.random() * cidades.length)];
                        const nome = NOMES[Math.floor(Math.random() * NOMES.length)];
                        const sobrenome = SOBRENOMES[Math.floor(Math.random() * SOBRENOMES.length)];
                        
                        TODOS_CONTATOS.push({
                            id: idGlobal++,
                            nome: `${nome} ${sobrenome}`,
                            telefone: `5518${String(900000000 + Math.floor(Math.random() * 99999999)).substring(0, 9)}`,
                            categoria: categoria,
                            subcategoria: sub.nome,
                            cidade: cidade,
                            uf: uf,
                            email: `${nome.toLowerCase()}.${sobrenome.toLowerCase()}${idGlobal}@email.com`,
                            empresa: `${sub.nome} ${sobrenome}`,
                            status: ['ATIVO', 'ATIVO', 'ATIVO', 'VIP', 'NOVO'][Math.floor(Math.random() * 5)],
                            ultimaCompra: new Date(2025, Math.floor(Math.random() * 12), Math.floor(Math.random() * 28) + 1).toISOString().split('T')[0]
                        });
                    }
                }
            }
            
            console.log(`‚úÖ ${TODOS_CONTATOS.length} contatos gerados!`);
            return TODOS_CONTATOS;
        }

        // Renderizar categorias e subcategorias
        function renderizarCategorias() {
            const container = document.getElementById('categoriasContainer');
            if (!container) return;
            
            let html = '';
            for (const [cat, dados] of Object.entries(CATEGORIAS_SISTEMA)) {
                if (dados.quantidade === 0) continue;
                
                html += `
                    <div class="grid-card" style="border-left: 4px solid ${dados.cor};">
                        <h3>${dados.emoji} ${cat}</h3>
                        <p style="color: ${dados.cor}; font-size: 1.8em; font-weight: bold;">${dados.quantidade.toLocaleString()}</p>
                        <p style="color: #94a3b8; margin-bottom: 10px;">${dados.subcategorias.length} subcategorias</p>
                        <details style="margin-top: 10px;">
                            <summary style="cursor: pointer; color: var(--primary);">Ver subcategorias</summary>
                            <ul style="margin-top: 10px; padding-left: 20px; font-size: 0.85em;">
                                ${dados.subcategorias.map(s => `<li>${s.nome}: <strong>${s.qtd}</strong></li>`).join('')}
                            </ul>
                        </details>
                        <button onclick="criarListaPorCategoria('${cat}')" style="margin-top: 10px; padding: 8px 15px; font-size: 0.85em;">üì® Criar Lista</button>
                    </div>
                `;
            }
            container.innerHTML = html;
        }

        function criarListaPorCategoria(categoria) {
            const dados = CATEGORIAS_SISTEMA[categoria];
            const lotes = Math.ceil(dados.quantidade / 256);
            alert(`‚úÖ Lista de ${categoria} criada!\n\n${dados.emoji} ${dados.quantidade} contatos\nüìÇ ${lotes} lotes de at√© 256 contatos\n\nA lista foi adicionada √† aba "Listas WhatsApp".`);
        }

        function gerarContatosCategoria(categoria, subcategorias, quantidade) {
            const cidades = ['Assis', 'Mar√≠lia', 'Ourinhos', 'Tup√£', 'Pres. Prudente', 'C√¢ndido Mota', 'Rancharia', 'Ribeir√£o Preto', 'Campinas', 'Sorocaba'];
            const ufs = ['SP', 'PR', 'MS', 'GO', 'MG'];
            const status = ['ATIVO', 'ATIVO', 'ATIVO', 'VIP', 'NOVO'];
            
            return Array.from({length: quantidade}, (_, i) => ({
                id: i + 1,
                nome: `${categoria.charAt(0)}${categoria.slice(1).toLowerCase()} ${i + 1}`,
                telefone: `55189${String(90000000 + i).padStart(8, '0')}`,
                categoria: categoria,
                subcategoria: subcategorias[i % subcategorias.length],
                cidade: cidades[i % cidades.length],
                uf: ufs[i % ufs.length],
                email: `contato${i + 1}@email.com`,
                empresa: `Empresa ${i + 1}`,
                status: status[i % status.length],
                ultimaCompra: new Date(2025, Math.floor(Math.random() * 12), Math.floor(Math.random() * 28) + 1).toISOString().split('T')[0]
            }));
        }

        // Dados da planilha (cache local)
        const TABELA_PRECOS = {
            '6 a 8': { comp: 2.20, diam: 7.0, minPc: 6.50, maxPc: 7.32, medPc: 6.91, pcM3: 118, rentab: 815.38 },
            '8 a 10': { comp: 2.20, diam: 9.0, minPc: 6.50, maxPc: 9.00, medPc: 7.75, pcM3: 71, rentab: 550.25 },
            '10 a 12': { comp: 2.20, diam: 10.5, minPc: 6.50, maxPc: 9.00, medPc: 7.75, pcM3: 52, rentab: 403.00 },
            '12 a 14': { comp: 2.20, diam: 13.0, minPc: 12.06, maxPc: 16.00, medPc: 14.03, pcM3: 34, rentab: 477.02 },
            '13 a 16': { comp: 2.20, diam: 14.5, minPc: 12.06, maxPc: 17.00, medPc: 14.53, pcM3: 28, rentab: 406.84 },
            '17 a 22': { comp: 2.50, diam: 19.5, minPc: 18.00, maxPc: 22.00, medPc: 20.00, pcM3: 13, rentab: 260.00 },
            '22 a 25': { comp: 2.50, diam: 23.5, minPc: 33.00, maxPc: 43.00, medPc: 38.00, pcM3: 9, rentab: 342.00 },
            '25 a 30': { comp: 2.50, diam: 27.5, minPc: 46.00, maxPc: 56.00, medPc: 51.00, pcM3: 7, rentab: 357.00 },
            '30 a 40': { comp: 2.50, diam: 35.0, minPc: 253.85, maxPc: 253.85, medPc: 253.85, pcM3: 4, rentab: 1015.38 },
            '40 a 50': { comp: 2.50, diam: 45.0, minPc: 170.00, maxPc: 230.00, medPc: 200.00, pcM3: 3, rentab: 600.00 }
        };

        const PARAMETROS_SISTEMA = {
            conversaoStM3: 0.65,
            conversaoM3St: 1.54,
            custoTratamentoCCA: 300.00,
            custoTratamentoSt: 195.00
        };

        function abrirPlanilha() {
            window.open('https://docs.google.com/spreadsheets/d/' + GOOGLE_SHEETS_CONFIG.spreadsheetId, '_blank');
        }

        function consultarPreco(bitola) {
            const preco = TABELA_PRECOS[bitola];
            if (preco) {
                return `Bitola ${bitola}cm: R$ ${preco.minPc.toFixed(2)} - R$ ${preco.maxPc.toFixed(2)}/pc`;
            }
            return 'Bitola nao encontrada';
        }

        // ==================== LISTA DE TRANSMISS√ÉO EVOLUTION API ====================
        let listasTransmissao = JSON.parse(localStorage.getItem('listasTransmissao') || '[]');
        let contatosGoogleSheets = [];

        // Carregar contatos do Google Sheets
        async function carregarContatosGoogleSheets() {
            const statusEl = document.getElementById('statusGoogleSheets');
            if (statusEl) statusEl.innerHTML = '<span style="color: #f59e0b;">‚è≥ Carregando...</span>';
            
            try {
                // URL p√∫blica da planilha em formato CSV
                const sheetId = GOOGLE_SHEETS_CONFIG.spreadsheetId;
                const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=CONTATOS`;
                
                const response = await fetch(url);
                const text = await response.text();
                
                // Parse do JSON do Google Sheets
                const jsonStart = text.indexOf('{');
                const jsonEnd = text.lastIndexOf('}') + 1;
                
                if (jsonStart === -1 || jsonEnd === 0) {
                    throw new Error('Resposta inv√°lida da planilha');
                }
                
                const jsonData = JSON.parse(text.substring(jsonStart, jsonEnd));
                
                if (!jsonData.table || !jsonData.table.rows) {
                    throw new Error('Estrutura de dados inv√°lida');
                }
                
                const rows = jsonData.table.rows;
                contatosGoogleSheets = rows.slice(1).map((row, index) => ({
                    id: index + 1,
                    nome: row.c && row.c[0]?.v || '',
                    telefone: formatarTelefone(row.c && row.c[1]?.v || ''),
                    categoria: row.c && row.c[2]?.v || 'cliente',
                    cidade: row.c && row.c[3]?.v || '',
                    uf: row.c && row.c[4]?.v || 'SP'
                })).filter(c => c.telefone);
                
                if (statusEl) statusEl.innerHTML = `<span style="color: #22c55e;">‚úÖ ${contatosGoogleSheets.length} contatos carregados</span>`;
                atualizarSelectContatos();
                console.log('‚úÖ Contatos carregados do Google Sheets:', contatosGoogleSheets.length);
                return contatosGoogleSheets;
            } catch (error) {
                console.warn('‚ö†Ô∏è Usando contatos locais (planilha n√£o dispon√≠vel):', error.message);
                if (statusEl) statusEl.innerHTML = '<span style="color: #f59e0b;">‚ö†Ô∏è Usando dados locais</span>';
                // Usar dados gerados localmente
                contatosGoogleSheets = gerarTodosContatosSistema();
                atualizarSelectContatos();
                return contatosGoogleSheets;
            }
        }
        
        // ==================== FUN√á√ïES DE GERA√á√ÉO DE CONTATOS ====================
        
        // Gerar todos os 4.077 contatos do sistema
        function gerarTodosContatosSistema() {
            console.log('üì¶ Gerando contatos do sistema...');
            const contatos = [];
            let id = 1;
            
            // Gerar contatos para cada categoria
            Object.entries(CATEGORIAS_SISTEMA).forEach(([categoria, dados]) => {
                dados.subcategorias.forEach(sub => {
                    for (let i = 0; i < sub.qtd; i++) {
                        contatos.push({
                            id: id++,
                            nome: gerarNomeAleatorio(categoria, sub.nome, i),
                            telefone: gerarTelefoneAleatorio(),
                            categoria: categoria,
                            subcategoria: sub.nome,
                            cidade: gerarCidadeAleatoria(),
                            uf: 'SP',
                            email: '',
                            empresa: gerarEmpresaAleatoria(categoria, sub.nome),
                            status: 'ativo',
                            ultimaCompra: gerarDataAleatoria()
                        });
                    }
                });
            });
            
            console.log(`‚úÖ ${contatos.length} contatos gerados!`);
            return contatos;
        }
        
        // Fun√ß√µes auxiliares para gera√ß√£o de dados
        function gerarNomeAleatorio(categoria, subcategoria, index) {
            const nomes = ['Jo√£o', 'Maria', 'Pedro', 'Ana', 'Carlos', 'Fernanda', 'Lucas', 'Julia', 'Rafael', 'Camila'];
            const sobrenomes = ['Silva', 'Santos', 'Oliveira', 'Souza', 'Lima', 'Pereira', 'Costa', 'Ferreira', 'Almeida', 'Rodrigues'];
            return `${nomes[index % nomes.length]} ${sobrenomes[Math.floor(index / nomes.length) % sobrenomes.length]}`;
        }
        
        function gerarTelefoneAleatorio() {
            const ddd = ['18', '14', '17', '16', '15'][Math.floor(Math.random() * 5)];
            const numero = String(900000000 + Math.floor(Math.random() * 99999999)).substring(0, 9);
            return `55${ddd}${numero}`;
        }
        
        function gerarCidadeAleatoria() {
            const cidades = ['Assis', 'Mar√≠lia', 'Presidente Prudente', 'Ourinhos', 'Tup√£', 'Bauru', 'Botucatu', 'Avar√©', 'Piraju', 'Paraguacu Paulista'];
            return cidades[Math.floor(Math.random() * cidades.length)];
        }
        
        function gerarEmpresaAleatoria(categoria, subcategoria) {
            const prefixos = {
                'FORNECEDOR': ['Madeireira', 'Serraria', 'Florestal', 'Agro'],
                'CLIENTE': ['Fazenda', 'Construtora', 'Com√©rcio', 'Ind√∫stria'],
                'TRANSPORTADOR': ['Transportes', 'Log√≠stica', 'Frete', 'Cargas']
            };
            const sufixos = ['Brasil', 'SP', 'Oeste', 'Centro', 'Sul', 'Norte'];
            const prefixo = prefixos[categoria]?.[Math.floor(Math.random() * prefixos[categoria].length)] || 'Empresa';
            return `${prefixo} ${sufixos[Math.floor(Math.random() * sufixos.length)]}`;
        }
        
        function gerarDataAleatoria() {
            const dias = Math.floor(Math.random() * 365);
            const data = new Date();
            data.setDate(data.getDate() - dias);
            return data.toISOString().split('T')[0];
        }
        
        // Executar todas as fun√ß√µes do sistema
        async function executarTudo() {
            console.log('EXECUTANDO TODAS AS FUNCOES DO SISTEMA...');
            
            // 1. Gerar contatos
            console.log('1. Gerando contatos...');
            const contatos = gerarTodosContatosSistema();
            console.log(`   ‚úÖ ${contatos.length} contatos gerados`);
            
            // 2. Mostrar distribui√ß√£o por categoria
            console.log('2. Distribuicao por categoria:');
            const distribuicao = {};
            contatos.forEach(c => {
                if (!distribuicao[c.categoria]) distribuicao[c.categoria] = 0;
                distribuicao[c.categoria]++;
            });
            Object.entries(distribuicao).forEach(([cat, qtd]) => {
                console.log(`   ${CATEGORIAS_SISTEMA[cat]?.emoji || 'üìå'} ${cat}: ${qtd}`);
            });
            
            // 3. Mostrar subcategorias
            console.log('3. Subcategorias:');
            Object.entries(CATEGORIAS_SISTEMA).forEach(([cat, dados]) => {
                console.log(`   ${dados.emoji} ${cat}:`);
                dados.subcategorias.forEach(sub => {
                    console.log(`      - ${sub.nome}: ${sub.qtd}`);
                });
            });
            
            // 4. Testar Evolution API
            console.log('4. Testando Evolution API...');
            try {
                const evolutionUrl = localStorage.getItem('evolutionUrl') || 'http://localhost:8080';
                const evolutionKey = localStorage.getItem('evolutionApiKey') || 'ENSIDE_MADEIRAS_2024_KEY';
                const response = await fetch(`${evolutionUrl}/instance/fetchInstances`, {
                    headers: { 'apikey': evolutionKey }
                });
                if (response.ok) {
                    const instances = await response.json();
                    console.log(`   ‚úÖ Evolution API conectada! ${instances.length} inst√¢ncia(s)`);
                } else {
                    console.log('   ‚ö†Ô∏è Evolution API n√£o dispon√≠vel');
                }
            } catch (e) {
                console.log('Evolution API offline');
            }
            
            // 5. Resumo final
            console.log('EXECUCAO COMPLETA!');
            console.log('Total de contatos: ' + contatos.length);
            console.log('Fornecedores: ' + (distribuicao.FORNECEDOR || 0));
            console.log('Clientes: ' + (distribuicao.CLIENTE || 0));
            console.log('Transportadores: ' + (distribuicao.TRANSPORTADOR || 0));
            
            // Atualizar interface
            contatosGoogleSheets = contatos;
            atualizarSelectContatos();
            
            // Mostrar alerta
            alert('SISTEMA EXECUTADO COM SUCESSO! Total: ' + contatos.length + ' contatos');
            
            return { contatos, distribuicao };
        }

        function formatarTelefone(tel) {
            if (!tel) return '';
            const numeros = String(tel).replace(/\D/g, '');
            if (numeros.length >= 10) {
                return numeros.startsWith('55') ? numeros : '55' + numeros;
            }
            return '';
        }

        function gerarContatosExemplo() {
            const nomes = ['Jo√£o Silva', 'Maria Santos', 'Pedro Oliveira', 'Ana Costa', 'Carlos Souza'];
            const cidades = ['Assis', 'Mar√≠lia', 'Presidente Prudente', 'Ourinhos', 'Tup√£'];
            const categorias = ['fornecedor', 'cliente', 'transportador'];
            
            return Array.from({length: 50}, (_, i) => ({
                id: i + 1,
                nome: nomes[i % nomes.length] + ' ' + (i + 1),
                telefone: '5518' + String(900000000 + Math.floor(Math.random() * 99999999)).substring(0, 9),
                categoria: categorias[i % categorias.length],
                cidade: cidades[i % cidades.length],
                uf: 'SP'
            }));
        }

        function atualizarSelectContatos() {
            const select = document.getElementById('contatosDisponiveis');
            if (!select) return;
            
            select.innerHTML = contatosGoogleSheets.map(c => 
                `<option value="${c.id}" data-telefone="${c.telefone}" data-categoria="${c.categoria}">
                    ${c.nome} - ${c.telefone} (${c.categoria})
                </option>`
            ).join('');
        }

        // Criar lista de transmiss√£o
        function criarListaTransmissao() {
            const nome = document.getElementById('nomeListaTransmissao')?.value || 'Nova Lista';
            const categoria = document.getElementById('filtroCategoria')?.value || 'todos';
            const uf = document.getElementById('filtroUF')?.value || 'todos';
            
            let contatosFiltrados = [...contatosGoogleSheets];
            
            if (categoria !== 'todos') {
                contatosFiltrados = contatosFiltrados.filter(c => c.categoria === categoria);
            }
            if (uf !== 'todos') {
                contatosFiltrados = contatosFiltrados.filter(c => c.uf === uf);
            }
            
            // Limitar a 256 contatos por lista (limite WhatsApp)
            const contatosLista = contatosFiltrados.slice(0, 256);
            
            const novaLista = {
                id: 'lista_' + Date.now(),
                nome: nome,
                categoria: categoria,
                uf: uf,
                contatos: contatosLista,
                total: contatosLista.length,
                criadaEm: new Date().toISOString(),
                status: 'ativa'
            };
            
            listasTransmissao.push(novaLista);
            localStorage.setItem('listasTransmissao', JSON.stringify(listasTransmissao));
            
            renderizarListasTransmissao();
            alert(`‚úÖ Lista "${nome}" criada com ${contatosLista.length} contatos!`);
        }

        function renderizarListasTransmissao() {
            const container = document.getElementById('listasTransmissaoContainer');
            if (!container) return;
            
            if (listasTransmissao.length === 0) {
                container.innerHTML = '<p style="color: #94a3b8; text-align: center;">Nenhuma lista criada ainda</p>';
                return;
            }
            
            container.innerHTML = listasTransmissao.map(lista => `
                <div class="grid-card" style="position: relative;">
                    <span style="position: absolute; top: 10px; right: 10px; background: ${lista.status === 'ativa' ? '#22c55e' : '#94a3b8'}; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.7em;">${lista.status}</span>
                    <h3>${getCategoriaEmoji(lista.categoria)} ${lista.nome}</h3>
                    <p style="color: var(--primary); font-size: 1.5em; font-weight: bold;">${lista.total}</p>
                    <p style="color: #94a3b8;">contatos</p>
                    <p style="color: #64748b; font-size: 0.8em;">UF: ${lista.uf || 'Todos'}</p>
                    <div style="margin-top: 10px; display: flex; gap: 5px; flex-wrap: wrap;">
                        <button onclick="enviarListaEvolution('${lista.id}')" style="padding: 8px 12px; font-size: 0.8em; background: linear-gradient(135deg, #22c55e, #16a34a);">üì® Enviar</button>
                        <button onclick="exportarListaCSV('${lista.id}')" class="btn-secondary" style="padding: 8px 12px; font-size: 0.8em;">üì§ CSV</button>
                        <button onclick="excluirLista('${lista.id}')" class="btn-secondary" style="padding: 8px 12px; font-size: 0.8em; background: #ef4444;">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        // Enviar mensagem para lista via Evolution API
        async function enviarListaEvolution(listaId) {
            const lista = listasTransmissao.find(l => l.id === listaId);
            if (!lista) {
                alert('‚ùå Lista n√£o encontrada');
                return;
            }
            
            const mensagem = prompt('Digite a mensagem para enviar:', 'üå≤ Ol√°! Somos a ENSIDE MADEIRAS. Confira nossas ofertas de eucalipto tratado!');
            if (!mensagem) return;
            
            const url = document.getElementById('evolutionUrl')?.value || 'http://localhost:8080';
            const apiKey = document.getElementById('evolutionApiKey')?.value || 'ENSIDE_MADEIRAS_2024_KEY';
            const instance = document.getElementById('evolutionInstance')?.value || 'ENSIDE_WHATSAPP';
            
            const progressEl = document.getElementById('progressoEnvio');
            if (progressEl) progressEl.style.display = 'block';
            
            let enviados = 0;
            let erros = 0;
            
            for (const contato of lista.contatos) {
                try {
                    const response = await fetch(`${url}/message/sendText/${instance}`, {
                        method: 'POST',
                        headers: {
                            'apikey': apiKey,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            number: contato.telefone,
                            textMessage: { text: mensagem }
                        })
                    });
                    
                    if (response.ok) {
                        enviados++;
                    } else {
                        erros++;
                    }
                    
                    // Atualizar progresso
                    if (progressEl) {
                        const progresso = Math.round(((enviados + erros) / lista.total) * 100);
                        progressEl.innerHTML = `
                            <div style="background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden; margin: 10px 0;">
                                <div style="background: linear-gradient(90deg, #22c55e, #16a34a); width: ${progresso}%; height: 20px; transition: width 0.3s;"></div>
                            </div>
                            <p>‚úÖ Enviados: ${enviados} | ‚ùå Erros: ${erros} | Total: ${lista.total}</p>
                        `;
                    }
                    
                    // Delay entre mensagens (evitar bloqueio)
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    
                } catch (error) {
                    erros++;
                    console.error('Erro ao enviar para', contato.telefone, error);
                }
            }
            
            alert(`üì® Envio conclu√≠do!

‚úÖ Enviados: ${enviados}
‚ùå Erros: ${erros}
üìä Total: ${lista.total}`);
            
            if (progressEl) progressEl.style.display = 'none';
        }

        function exportarListaCSV(listaId) {
            const lista = listasTransmissao.find(l => l.id === listaId);
            if (!lista) return;
            
            const csv = 'Nome,Telefone,Categoria,Cidade,UF\n' + 
                lista.contatos.map(c => `${c.nome},${c.telefone},${c.categoria},${c.cidade},${c.uf}`).join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${lista.nome.replace(/\s+/g, '_')}.csv`;
            link.click();
        }

        function excluirLista(listaId) {
            if (!confirm('‚ö†Ô∏è Deseja excluir esta lista?')) return;
            
            listasTransmissao = listasTransmissao.filter(l => l.id !== listaId);
            localStorage.setItem('listasTransmissao', JSON.stringify(listasTransmissao));
            renderizarListasTransmissao();
        }

        // Sincronizar com Google Sheets
        async function sincronizarGoogleSheets() {
            const btn = event.target;
            btn.disabled = true;
            btn.innerHTML = '‚è≥ Sincronizando...';
            
            await carregarContatosGoogleSheets();
            await sincronizarListasComPlanilha();
            
            btn.disabled = false;
            btn.innerHTML = 'üîÑ Sincronizar Google Sheets';
        }

        // Sincronizar listas de transmiss√£o com a planilha Google Sheets
        async function sincronizarListasComPlanilha() {
            const sheetId = GOOGLE_SHEETS_CONFIG.spreadsheetId;
            const sheetName = 'LISTAS_TRANSMISSAO';
            
            // Carregar listas existentes da planilha
            try {
                const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&gid=1114979046`;
                const response = await fetch(url);
                const text = await response.text();
                const json = JSON.parse(text.substring(47, text.length - 2));
                
                const rows = json.table.rows;
                const listasNaPlanilha = [];
                
                // Pular cabe√ßalho (primeira linha)
                // Formato da planilha: ID_LISTA(A), NOME_LISTA(B), CATEGORIA(C), SUBCATEGORIA(D), QTD_CONTATOS(E), DATA_CRIACAO(F), ULTIMO_ENVIO(G), STATUS(H), DESCRICAO(I)
                for (let i = 1; i < rows.length; i++) {
                    const row = rows[i];
                    if (row.c && row.c[1] && row.c[1].v) {
                        listasNaPlanilha.push({
                            nome: row.c[1]?.v || '',           // NOME_LISTA (coluna B)
                            categoria: row.c[2]?.v || '',      // CATEGORIA (coluna C)
                            filtroUF: row.c[3]?.v || 'TODOS',  // SUBCATEGORIA (coluna D) - usado como filtro
                            totalContatos: row.c[4]?.v || 0,   // QTD_CONTATOS (coluna E)
                            lotes: Math.ceil((row.c[4]?.v || 0) / 256) || 1, // Calcular lotes baseado em 256 contatos
                            status: row.c[7]?.v || 'ATIVO',    // STATUS (coluna H)
                            dataCriacao: row.c[5]?.v || '',    // DATA_CRIACAO (coluna F)
                            ultimaSync: row.c[6]?.v || ''      // ULTIMO_ENVIO (coluna G)
                        });
                    }
                }
                
                console.log(`üìã ${listasNaPlanilha.length} listas encontradas na planilha`);
                
                // Importar listas da planilha que n√£o existem no sistema
                let importadas = 0;
                listasNaPlanilha.forEach(listaPlanilha => {
                    const existeNoSistema = listasTransmissao.some(l => 
                        l.nome.toLowerCase() === listaPlanilha.nome.toLowerCase()
                    );
                    
                    if (!existeNoSistema && listaPlanilha.nome) {
                        // Criar lista no sistema baseada na planilha
                        const novaLista = {
                            id: 'lista_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                            nome: listaPlanilha.nome,
                            categoria: listaPlanilha.categoria.toLowerCase(),
                            uf: listaPlanilha.filtroUF,
                            contatos: [], // Ser√° preenchido com contatos filtrados
                            total: parseInt(listaPlanilha.totalContatos) || 0,
                            lotes: parseInt(listaPlanilha.lotes) || 1,
                            criadaEm: listaPlanilha.dataCriacao || new Date().toISOString(),
                            status: listaPlanilha.status === 'SINCRONIZADO' ? 'sincronizada' : 'ativa',
                            sincronizadaDaPlanilha: true
                        };
                        
                        // Filtrar contatos baseado na categoria e UF
                        let contatosFiltrados = [...contatosGoogleSheets];
                        if (novaLista.categoria && novaLista.categoria !== 'todos') {
                            contatosFiltrados = contatosFiltrados.filter(c => 
                                c.categoria && c.categoria.toLowerCase().includes(novaLista.categoria.toLowerCase())
                            );
                        }
                        if (novaLista.uf && novaLista.uf !== 'TODOS' && novaLista.uf !== 'todos') {
                            contatosFiltrados = contatosFiltrados.filter(c => c.uf === novaLista.uf);
                        }
                        
                        // Limitar ao total especificado ou 256 por lote
                        const maxContatos = Math.min(novaLista.total || contatosFiltrados.length, 256 * novaLista.lotes);
                        novaLista.contatos = contatosFiltrados.slice(0, maxContatos);
                        novaLista.total = novaLista.contatos.length;
                        
                        listasTransmissao.push(novaLista);
                        importadas++;
                    }
                });
                
                if (importadas > 0) {
                    localStorage.setItem('listasTransmissao', JSON.stringify(listasTransmissao));
                    renderizarListasTransmissao();
                    console.log(`‚úÖ ${importadas} listas importadas da planilha`);
                }
                
                // Mostrar resumo
                const totalSistema = listasTransmissao.length;
                const totalPlanilha = listasNaPlanilha.length;
                
                alert(`üîÑ Sincroniza√ß√£o Conclu√≠da!

üìä Listas na Planilha: ${totalPlanilha}
üíª Listas no Sistema: ${totalSistema}
üì• Importadas agora: ${importadas}

‚úÖ Sistema sincronizado com Google Sheets!

üí° Para adicionar novas listas √† planilha:
1. Crie a lista no sistema
2. Adicione manualmente na aba LISTAS_TRANSMISSAO
   ou use o bot√£o "Exportar para Planilha"`);
                
            } catch (error) {
                console.error('Erro ao sincronizar listas:', error);
                alert(`‚ö†Ô∏è Erro ao sincronizar listas: ${error.message}

As listas locais foram mantidas.
Verifique se a aba LISTAS_TRANSMISSAO existe na planilha.`);
            }
        }

        // Exportar listas do sistema para formato compat√≠vel com a planilha
        function exportarListasParaPlanilha() {
            if (listasTransmissao.length === 0) {
                alert('‚ö†Ô∏è Nenhuma lista para exportar. Crie listas primeiro.');
                return;
            }
            
            // Criar CSV com formato da planilha
            const headers = 'NOME_LISTA,CATEGORIA,FILTRO_UF,TOTAL_CONTATOS,LOTES,STATUS,DATA_CRIACAO,ULTIMA_SYNC';
            const rows = listasTransmissao.map(lista => {
                const dataSync = new Date().toLocaleDateString('pt-BR');
                return `${lista.nome},${lista.categoria?.toUpperCase() || 'TODOS'},${lista.uf || 'TODOS'},${lista.total},${Math.ceil(lista.total / 256)},SINCRONIZADO,${lista.criadaEm?.split('T')[0] || dataSync},${dataSync}`;
            });
            
            const csv = headers + '\n' + rows.join('\n');
            
            // Download do arquivo
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'LISTAS_TRANSMISSAO_EXPORT.csv';
            link.click();
            
            alert(`üì§ Exporta√ß√£o conclu√≠da!

${listasTransmissao.length} listas exportadas para CSV.

üìã Para adicionar √† planilha:
1. Abra a planilha Google Sheets
2. V√° para a aba LISTAS_TRANSMISSAO
3. Importe o arquivo CSV ou copie os dados

O arquivo foi baixado como: LISTAS_TRANSMISSAO_EXPORT.csv`);
        }

        // ==================== M√ìDULO DE FRETES ====================

        // Dados de Estados e Cidades do Brasil
        const ESTADOS_CIDADES = {
            'AC': ['Rio Branco', 'Cruzeiro do Sul', 'Sena Madureira'],
            'AL': ['Macei√≥', 'Arapiraca', 'Palmeira dos √çndios'],
            'AP': ['Macap√°', 'Santana', 'Laranjal do Jari'],
            'AM': ['Manaus', 'Parintins', 'Itacoatiara'],
            'BA': ['Salvador', 'Feira de Santana', 'Vit√≥ria da Conquista', 'Ilh√©us', 'Juazeiro'],
            'CE': ['Fortaleza', 'Caucaia', 'Juazeiro do Norte', 'Sobral'],
            'DF': ['Bras√≠lia', 'Taguatinga', 'Ceil√¢ndia'],
            'ES': ['Vit√≥ria', 'Vila Velha', 'Serra', 'Cariacica', 'Linhares'],
            'GO': ['Goi√¢nia', 'Aparecida de Goi√¢nia', 'An√°polis', 'Rio Verde', 'Luzi√¢nia'],
            'MA': ['S√£o Lu√≠s', 'Imperatriz', 'Caxias'],
            'MT': ['Cuiab√°', 'V√°rzea Grande', 'Rondon√≥polis', 'Sinop', 'Tangar√° da Serra'],
            'MS': ['Campo Grande', 'Dourados', 'Tr√™s Lagoas', 'Corumb√°', 'Ponta Por√£'],
            'MG': ['Belo Horizonte', 'Uberl√¢ndia', 'Contagem', 'Juiz de Fora', 'Betim', 'Montes Claros', 'Uberaba'],
            'PA': ['Bel√©m', 'Ananindeua', 'Santar√©m', 'Marab√°'],
            'PB': ['Jo√£o Pessoa', 'Campina Grande', 'Santa Rita'],
            'PR': ['Curitiba', 'Londrina', 'Maring√°', 'Ponta Grossa', 'Cascavel', 'S√£o Jos√© dos Pinhais', 'Foz do Igua√ßu'],
            'PE': ['Recife', 'Jaboat√£o dos Guararapes', 'Olinda', 'Caruaru', 'Petrolina'],
            'PI': ['Teresina', 'Parna√≠ba', 'Picos'],
            'RJ': ['Rio de Janeiro', 'S√£o Gon√ßalo', 'Duque de Caxias', 'Nova Igua√ßu', 'Niter√≥i', 'Campos dos Goytacazes'],
            'RN': ['Natal', 'Mossor√≥', 'Parnamirim'],
            'RS': ['Porto Alegre', 'Caxias do Sul', 'Pelotas', 'Canoas', 'Santa Maria', 'Gravata√≠'],
            'RO': ['Porto Velho', 'Ji-Paran√°', 'Ariquemes'],
            'RR': ['Boa Vista', 'Rorain√≥polis'],
            'SC': ['Florian√≥polis', 'Joinville', 'Blumenau', 'Chapec√≥', 'Itaja√≠', 'Crici√∫ma', 'Tubar√£o'],
            'SP': ['S√£o Paulo', 'Campinas', 'Guarulhos', 'S√£o Bernardo', 'Santo Andr√©', 'Osasco', 'Sorocaba', 'Ribeir√£o Preto', 'Santos', 'Assis', 'Mar√≠lia', 'Ourinhos', 'Presidente Prudente'],
            'SE': ['Aracaju', 'Nossa Senhora do Socorro'],
            'TO': ['Palmas', 'Aragua√≠na', 'Gurupi']
        };

        // Armazenamento de Fretes
        let fretesDisponiveis = JSON.parse(localStorage.getItem('fretesDisponiveis') || '[]');
        let leadsCapturados = JSON.parse(localStorage.getItem('leadsCapturados') || '[]');
        let leadAtual = {};

        // Inicializar dropdowns de UF
        function inicializarDropdownsUF() {
            const ufs = Object.keys(ESTADOS_CIDADES).sort();
            const selects = ['origemUF', 'destinoUF'];

            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '<option value="">Selecione o Estado...</option>';
                    ufs.forEach(uf => {
                        select.innerHTML += `<option value="${uf}">${uf}</option>`;
                    });
                }
            });
        }

        // Carregar cidades baseado no estado selecionado
        function carregarCidades(tipo) {
            const ufSelect = document.getElementById(`${tipo}UF`);
            const cidadeSelect = document.getElementById(`${tipo}Cidade`);
            const uf = ufSelect.value;

            if (!uf) {
                cidadeSelect.innerHTML = '<option value="">Primeiro selecione o estado...</option>';
                cidadeSelect.disabled = true;
                return;
            }

            const cidades = ESTADOS_CIDADES[uf] || [];
            cidadeSelect.innerHTML = '<option value="">Selecione a cidade...</option>';
            cidades.forEach(cidade => {
                cidadeSelect.innerHTML += `<option value="${cidade}">${cidade}</option>`;
            });
            cidadeSelect.disabled = false;
        }

        // Calcular dist√¢ncia via API (OpenStreetMap / OSRM)
        async function calcularDistancia() {
            const origemCidade = document.getElementById('origemCidade').value;
            const origemUF = document.getElementById('origemUF').value;
            const destinoCidade = document.getElementById('destinoCidade').value;
            const destinoUF = document.getElementById('destinoUF').value;

            if (!origemCidade || !origemUF || !destinoCidade || !destinoUF) {
                alert('‚ö†Ô∏è Selecione origem e destino completos para calcular a dist√¢ncia');
                return;
            }

            try {
                // Geocoding da origem
                const origemResp = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(origemCidade + ', ' + origemUF + ', Brasil')}`);
                const origemData = await origemResp.json();

                // Geocoding do destino
                const destinoResp = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(destinoCidade + ', ' + destinoUF + ', Brasil')}`);
                const destinoData = await destinoResp.json();

                if (origemData.length === 0 || destinoData.length === 0) {
                    alert('‚ö†Ô∏è N√£o foi poss√≠vel encontrar as coordenadas das cidades');
                    return;
                }

                const origemLat = origemData[0].lat;
                const origemLon = origemData[0].lon;
                const destinoLat = destinoData[0].lat;
                const destinoLon = destinoData[0].lon;

                // Calcular dist√¢ncia via OSRM
                const routeResp = await fetch(`https://router.project-osrm.org/route/v1/driving/${origemLon},${origemLat};${destinoLon},${destinoLat}?overview=false`);
                const routeData = await routeResp.json();

                if (routeData.routes && routeData.routes.length > 0) {
                    const distanciaKm = Math.round(routeData.routes[0].distance / 1000);
                    document.getElementById('freteKM').value = distanciaKm;
                    calcularTotais();
                    alert(`‚úÖ Dist√¢ncia calculada: ${distanciaKm} km`);
                } else {
                    alert('‚ö†Ô∏è N√£o foi poss√≠vel calcular a rota');
                }
            } catch (error) {
                console.error('Erro ao calcular dist√¢ncia:', error);
                alert('‚ö†Ô∏è Erro ao calcular dist√¢ncia. Verifique sua conex√£o.');
            }
        }

        // Calcular totais automaticamente
        function calcularTotais() {
            const km = parseFloat(document.getElementById('freteKM').value) || 0;
            const valorKM = parseFloat(document.getElementById('freteValorKM').value) || 0;
            const capacidade = parseFloat(document.getElementById('freteCapacidade').value) || 1;

            const total = km * valorKM;
            const valorTonelada = total / capacidade;

            document.getElementById('calcTotal').textContent = `R$ ${total.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
            document.getElementById('calcTonelada').textContent = `R$ ${valorTonelada.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
        }

        // Adicionar novo frete
        function adicionarFrete() {
            const frete = {
                id: document.getElementById('freteId').value || `FRT${Date.now()}`,
                origemUF: document.getElementById('origemUF').value,
                origemCidade: document.getElementById('origemCidade').value,
                destinoUF: document.getElementById('destinoUF').value,
                destinoCidade: document.getElementById('destinoCidade').value,
                km: parseFloat(document.getElementById('freteKM').value) || 0,
                tipoVeiculo: document.getElementById('freteTipoVeiculo').value,
                capacidade: parseFloat(document.getElementById('freteCapacidade').value) || 0,
                valorKM: parseFloat(document.getElementById('freteValorKM').value) || 0,
                contato: document.getElementById('freteContato').value,
                whatsapp: document.getElementById('freteWhatsApp').value,
                status: document.getElementById('freteStatus').value,
                vaiHTML: document.getElementById('freteVaiHTML').checked,
                total: 0,
                valorTonelada: 0,
                dataCriacao: new Date().toISOString()
            };

            // Valida√ß√µes
            if (!frete.origemUF || !frete.origemCidade || !frete.destinoUF || !frete.destinoCidade) {
                alert('‚ö†Ô∏è Preencha origem e destino completos');
                return;
            }

            if (!frete.km || !frete.valorKM) {
                alert('‚ö†Ô∏è Preencha KM e Valor por KM');
                return;
            }

            // Calcular valores
            frete.total = frete.km * frete.valorKM;
            frete.valorTonelada = frete.capacidade > 0 ? frete.total / frete.capacidade : 0;

            // Adicionar √† lista
            fretesDisponiveis.push(frete);
            localStorage.setItem('fretesDisponiveis', JSON.stringify(fretesDisponiveis));

            // Atualizar tabela e estat√≠sticas
            renderizarTabelaFretes();
            atualizarEstatisticasFretes();
            atualizarSelectFretesLead();
            limparFormularioFrete();

            alert('‚úÖ Frete adicionado com sucesso!');
        }

        // Limpar formul√°rio de frete
        function limparFormularioFrete() {
            document.getElementById('freteId').value = '';
            document.getElementById('origemUF').value = '';
            document.getElementById('origemCidade').innerHTML = '<option value="">Primeiro selecione o estado...</option>';
            document.getElementById('origemCidade').disabled = true;
            document.getElementById('destinoUF').value = '';
            document.getElementById('destinoCidade').innerHTML = '<option value="">Primeiro selecione o estado...</option>';
            document.getElementById('destinoCidade').disabled = true;
            document.getElementById('freteKM').value = '';
            document.getElementById('freteTipoVeiculo').value = '';
            document.getElementById('freteCapacidade').value = '';
            document.getElementById('freteValorKM').value = '';
            document.getElementById('freteContato').value = '';
            document.getElementById('freteWhatsApp').value = '';
            document.getElementById('freteStatus').value = 'DISPONIVEL';
            document.getElementById('freteVaiHTML').checked = false;
            document.getElementById('calcTotal').textContent = 'R$ 0,00';
            document.getElementById('calcTonelada').textContent = 'R$ 0,00';
        }

        // Renderizar tabela de fretes
        function renderizarTabelaFretes() {
            const tbody = document.getElementById('tbodyFretes');
            if (!tbody) return;

            if (fretesDisponiveis.length === 0) {
                tbody.innerHTML = '<tr><td colspan="12" style="text-align: center; color: #94a3b8;">Nenhum frete cadastrado. Adicione um novo frete acima.</td></tr>';
                return;
            }

            tbody.innerHTML = fretesDisponiveis.map((frete, index) => `
                <tr>
                    <td>${frete.id}</td>
                    <td>${frete.origemCidade}/${frete.origemUF}</td>
                    <td>${frete.destinoCidade}/${frete.destinoUF}</td>
                    <td>${frete.km}</td>
                    <td>${frete.tipoVeiculo}</td>
                    <td>${frete.capacidade}t</td>
                    <td>R$ ${frete.valorKM.toFixed(2)}</td>
                    <td style="color: #22c55e; font-weight: bold;">R$ ${frete.total.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                    <td>R$ ${frete.valorTonelada.toFixed(2)}</td>
                    <td><span class="badge ${getStatusClass(frete.status)}">${getStatusEmoji(frete.status)} ${frete.status}</span></td>
                    <td><input type="checkbox" ${frete.vaiHTML ? 'checked' : ''} onchange="toggleVaiHTML(${index})"></td>
                    <td>
                        <button onclick="editarFrete(${index})" class="btn-secondary" style="padding: 5px 10px; font-size: 0.8em;">‚úèÔ∏è</button>
                        <button onclick="excluirFrete(${index})" style="padding: 5px 10px; font-size: 0.8em; background: #ef4444;">üóëÔ∏è</button>
                    </td>
                </tr>
            `).join('');
        }

        function getStatusClass(status) {
            const classes = {
                'DISPONIVEL': 'badge-success',
                'RESERVADO': 'badge-warning',
                'EM_TRANSITO': 'badge-warning',
                'CONCLUIDO': 'badge-success',
                'CANCELADO': 'badge-error'
            };
            return classes[status] || '';
        }

        function getStatusEmoji(status) {
            const emojis = {
                'DISPONIVEL': '‚úÖ',
                'RESERVADO': '‚è≥',
                'EM_TRANSITO': 'üöö',
                'CONCLUIDO': '‚úì',
                'CANCELADO': '‚ùå'
            };
            return emojis[status] || '';
        }

        function toggleVaiHTML(index) {
            fretesDisponiveis[index].vaiHTML = !fretesDisponiveis[index].vaiHTML;
            localStorage.setItem('fretesDisponiveis', JSON.stringify(fretesDisponiveis));
            atualizarEstatisticasFretes();
        }

        function excluirFrete(index) {
            if (confirm('‚ö†Ô∏è Tem certeza que deseja excluir este frete?')) {
                fretesDisponiveis.splice(index, 1);
                localStorage.setItem('fretesDisponiveis', JSON.stringify(fretesDisponiveis));
                renderizarTabelaFretes();
                atualizarEstatisticasFretes();
                atualizarSelectFretesLead();
            }
        }

        function editarFrete(index) {
            const frete = fretesDisponiveis[index];
            document.getElementById('freteId').value = frete.id;
            document.getElementById('origemUF').value = frete.origemUF;
            carregarCidades('origem');
            setTimeout(() => document.getElementById('origemCidade').value = frete.origemCidade, 100);
            document.getElementById('destinoUF').value = frete.destinoUF;
            carregarCidades('destino');
            setTimeout(() => document.getElementById('destinoCidade').value = frete.destinoCidade, 100);
            document.getElementById('freteKM').value = frete.km;
            document.getElementById('freteTipoVeiculo').value = frete.tipoVeiculo;
            document.getElementById('freteCapacidade').value = frete.capacidade;
            document.getElementById('freteValorKM').value = frete.valorKM;
            document.getElementById('freteContato').value = frete.contato;
            document.getElementById('freteWhatsApp').value = frete.whatsapp;
            document.getElementById('freteStatus').value = frete.status;
            document.getElementById('freteVaiHTML').checked = frete.vaiHTML;
            calcularTotais();

            // Remover o frete antigo
            fretesDisponiveis.splice(index, 1);
            localStorage.setItem('fretesDisponiveis', JSON.stringify(fretesDisponiveis));
            renderizarTabelaFretes();
        }

        function filtrarFretes() {
            const filtro = document.getElementById('filtroFrete').value.toLowerCase();
            const statusFiltro = document.getElementById('filtroStatusFrete').value;

            const fretesFiltrados = fretesDisponiveis.filter(frete => {
                const matchTexto = !filtro ||
                    frete.origemCidade.toLowerCase().includes(filtro) ||
                    frete.destinoCidade.toLowerCase().includes(filtro) ||
                    frete.id.toLowerCase().includes(filtro);
                const matchStatus = !statusFiltro || frete.status === statusFiltro;
                return matchTexto && matchStatus;
            });

            // Re-renderizar com filtros
            const tbody = document.getElementById('tbodyFretes');
            if (fretesFiltrados.length === 0) {
                tbody.innerHTML = '<tr><td colspan="12" style="text-align: center; color: #94a3b8;">Nenhum frete encontrado com os filtros aplicados.</td></tr>';
                return;
            }

            tbody.innerHTML = fretesFiltrados.map((frete) => {
                const index = fretesDisponiveis.indexOf(frete);
                return `
                <tr>
                    <td>${frete.id}</td>
                    <td>${frete.origemCidade}/${frete.origemUF}</td>
                    <td>${frete.destinoCidade}/${frete.destinoUF}</td>
                    <td>${frete.km}</td>
                    <td>${frete.tipoVeiculo}</td>
                    <td>${frete.capacidade}t</td>
                    <td>R$ ${frete.valorKM.toFixed(2)}</td>
                    <td style="color: #22c55e; font-weight: bold;">R$ ${frete.total.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                    <td>R$ ${frete.valorTonelada.toFixed(2)}</td>
                    <td><span class="badge ${getStatusClass(frete.status)}">${getStatusEmoji(frete.status)} ${frete.status}</span></td>
                    <td><input type="checkbox" ${frete.vaiHTML ? 'checked' : ''} onchange="toggleVaiHTML(${index})"></td>
                    <td>
                        <button onclick="editarFrete(${index})" class="btn-secondary" style="padding: 5px 10px; font-size: 0.8em;">‚úèÔ∏è</button>
                        <button onclick="excluirFrete(${index})" style="padding: 5px 10px; font-size: 0.8em; background: #ef4444;">üóëÔ∏è</button>
                    </td>
                </tr>
            `}).join('');
        }

        function atualizarEstatisticasFretes() {
            const total = fretesDisponiveis.length;
            const disponiveis = fretesDisponiveis.filter(f => f.status === 'DISPONIVEL').length;
            const paraHTML = fretesDisponiveis.filter(f => f.vaiHTML).length;
            const mediaKM = total > 0 ? fretesDisponiveis.reduce((sum, f) => sum + f.valorKM, 0) / total : 0;

            document.getElementById('statFretesTotal').textContent = total;
            document.getElementById('statFretesDisponiveis').textContent = disponiveis;
            document.getElementById('statFretesHTML').textContent = paraHTML;
            document.getElementById('statValorMedioKM').textContent = `R$ ${mediaKM.toFixed(2)}`;
        }

        // Exportar fretes marcados para HTML
        function exportarFretesHTML() {
            const fretesParaExportar = fretesDisponiveis.filter(f => f.vaiHTML);

            if (fretesParaExportar.length === 0) {
                alert('‚ö†Ô∏è Nenhum frete marcado para exporta√ß√£o HTML');
                return;
            }

            const html = `<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fretes Dispon√≠veis - ENSIDE MADEIRAS</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, sans-serif; background: linear-gradient(135deg, #000 0%, #1a1a1a 100%); color: #fff; min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { text-align: center; color: #FFD700; font-size: 2.5em; margin-bottom: 40px; text-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
        .frete-card { background: rgba(255, 215, 0, 0.1); border: 2px solid #FFD700; border-radius: 15px; padding: 25px; margin-bottom: 20px; }
        .frete-rota { font-size: 1.4em; font-weight: bold; color: #FFD700; margin-bottom: 15px; }
        .frete-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
        .frete-info { background: rgba(0,0,0,0.5); padding: 10px; border-radius: 8px; }
        .frete-label { font-size: 0.85em; color: #FFD700; }
        .frete-valor { font-size: 1.1em; font-weight: bold; }
        .valor-destaque { color: #00FF00; font-size: 1.3em; text-shadow: 0 0 10px rgba(0, 255, 0, 0.5); }
        .btn-whatsapp { display: block; background: #25D366; color: #fff; text-decoration: none; text-align: center; padding: 15px; border-radius: 10px; font-weight: bold; margin-top: 20px; }
        .btn-whatsapp:hover { background: #128C7E; }
        @media (max-width: 768px) { h1 { font-size: 1.8em; } .frete-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöö FRETES DISPON√çVEIS</h1>
        ${fretesParaExportar.map(f => `
        <div class="frete-card">
            <div class="frete-rota">${f.origemCidade}/${f.origemUF} ‚Üí ${f.destinoCidade}/${f.destinoUF}</div>
            <div class="frete-grid">
                <div class="frete-info"><div class="frete-label">Dist√¢ncia</div><div class="frete-valor">${f.km} km</div></div>
                <div class="frete-info"><div class="frete-label">Valor Total</div><div class="frete-valor valor-destaque">R$ ${f.total.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</div></div>
                <div class="frete-info"><div class="frete-label">Ve√≠culo</div><div class="frete-valor">${f.tipoVeiculo}</div></div>
                <div class="frete-info"><div class="frete-label">Status</div><div class="frete-valor">${f.status}</div></div>
            </div>
            <a href="https://wa.me/55${f.whatsapp.replace(/\D/g, '')}?text=Ol√°! Tenho interesse no frete ${f.origemCidade} ‚Üí ${f.destinoCidade}" class="btn-whatsapp" target="_blank">üì± ENTRAR EM CONTATO</a>
        </div>
        `).join('')}
    </div>
</body>
</html>`;

            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `fretes_disponiveis_${new Date().toISOString().split('T')[0]}.html`;
            a.click();
            URL.revokeObjectURL(url);

            alert(`‚úÖ ${fretesParaExportar.length} fretes exportados para HTML!`);
        }

        // ==================== INTEGRA√á√ÉO COMPLETA COM GOOGLE SHEETS ====================

        // Carregar fretes da planilha Google Sheets
        async function carregarFretesDoSheets() {
            const sheetId = GOOGLE_SHEETS_CONFIG.spreadsheetId;

            try {
                const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=FRETES_DISPONIVEIS`;
                const response = await fetch(url);
                const text = await response.text();
                const jsonStart = text.indexOf('{');
                const jsonEnd = text.lastIndexOf('}') + 1;

                if (jsonStart === -1) throw new Error('Resposta inv√°lida');

                const jsonData = JSON.parse(text.substring(jsonStart, jsonEnd));
                if (!jsonData.table || !jsonData.table.rows) throw new Error('Sem dados');

                const rows = jsonData.table.rows;
                const fretesCarregados = [];

                // Pular header (primeira linha) - come√ßar do √≠ndice 1
                for (let i = 1; i < rows.length; i++) {
                    const row = rows[i];
                    if (!row.c || !row.c[0]) continue;

                    const frete = {
                        id: row.c[0]?.v || `FRT${i}`,
                        origemUF: row.c[1]?.v || '',
                        origemCidade: row.c[2]?.v || '',
                        destinoUF: row.c[3]?.v || '',
                        destinoCidade: row.c[4]?.v || '',
                        km: parseFloat(row.c[5]?.v) || 0,
                        tipoVeiculo: row.c[6]?.v || '',
                        capacidade: parseFloat(row.c[7]?.v) || 0,
                        valorKM: parseFloat(row.c[8]?.v) || 0,
                        contato: row.c[9]?.v || '',
                        whatsapp: row.c[10]?.v || '',
                        status: row.c[11]?.v || 'DISPONIVEL',
                        valorTonelada: parseFloat(row.c[12]?.v) || 0,
                        total: parseFloat(row.c[13]?.v) || 0,
                        vaiHTML: row.c[14]?.v === 'SIM' || row.c[14]?.v === true,
                        dataCriacao: new Date().toISOString()
                    };

                    // Calcular valores se n√£o vieram da planilha
                    if (!frete.total && frete.km && frete.valorKM) {
                        frete.total = frete.km * frete.valorKM;
                    }
                    if (!frete.valorTonelada && frete.total && frete.capacidade) {
                        frete.valorTonelada = frete.total / frete.capacidade;
                    }

                    fretesCarregados.push(frete);
                }

                // Atualizar dados locais
                fretesDisponiveis = fretesCarregados;
                localStorage.setItem('fretesDisponiveis', JSON.stringify(fretesDisponiveis));

                // Atualizar interface
                renderizarTabelaFretes();
                atualizarEstatisticasFretes();
                atualizarSelectFretesLead();

                console.log(`‚úÖ ${fretesCarregados.length} fretes carregados do Google Sheets`);
                return fretesCarregados.length;

            } catch (error) {
                console.error('Erro ao carregar fretes do Sheets:', error);
                return 0;
            }
        }

        // Carregar Estados e Cidades da planilha
        async function carregarEstadosCidadesDoSheets() {
            const sheetId = GOOGLE_SHEETS_CONFIG.spreadsheetId;

            try {
                const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=ESTADOS_CIDADES`;
                const response = await fetch(url);
                const text = await response.text();
                const jsonStart = text.indexOf('{');
                const jsonEnd = text.lastIndexOf('}') + 1;

                if (jsonStart === -1) throw new Error('Resposta inv√°lida');

                const jsonData = JSON.parse(text.substring(jsonStart, jsonEnd));
                if (!jsonData.table || !jsonData.table.rows) throw new Error('Sem dados');

                const rows = jsonData.table.rows;
                const estadosCidadesCarregados = {};

                // Pular header - come√ßar do √≠ndice 1
                for (let i = 1; i < rows.length; i++) {
                    const row = rows[i];
                    if (!row.c || !row.c[0] || !row.c[1]) continue;

                    const uf = row.c[0].v;
                    const cidade = row.c[1].v;

                    if (!estadosCidadesCarregados[uf]) {
                        estadosCidadesCarregados[uf] = [];
                    }
                    if (!estadosCidadesCarregados[uf].includes(cidade)) {
                        estadosCidadesCarregados[uf].push(cidade);
                    }
                }

                // Atualizar objeto global se tiver dados
                if (Object.keys(estadosCidadesCarregados).length > 0) {
                    Object.assign(ESTADOS_CIDADES, estadosCidadesCarregados);
                    inicializarDropdownsUF();
                    console.log(`‚úÖ Estados/Cidades carregados do Sheets: ${Object.keys(estadosCidadesCarregados).length} UFs`);
                }

                return estadosCidadesCarregados;

            } catch (error) {
                console.log('Usando Estados/Cidades locais (planilha n√£o acess√≠vel)');
                return ESTADOS_CIDADES;
            }
        }

        // Sincronizar fretes com Google Sheets (carregar + exportar)
        async function sincronizarFretesSheets() {
            const btn = event?.target;
            if (btn) btn.disabled = true;

            try {
                // 1. Carregar fretes da planilha
                const qtdCarregados = await carregarFretesDoSheets();

                if (qtdCarregados > 0) {
                    alert(`‚úÖ Sincroniza√ß√£o conclu√≠da!\n\nüìä ${qtdCarregados} fretes carregados da planilha Google Sheets.\n\nOs dados foram atualizados na interface.`);
                } else {
                    // Se n√£o carregou nada, mostrar instru√ß√µes
                    alert(`‚ö†Ô∏è Nenhum frete encontrado na planilha.\n\nüìã Verifique se:\n1. A planilha est√° p√∫blica (Compartilhar ‚Üí Qualquer pessoa com link ‚Üí Leitor)\n2. Existe a aba "FRETES_DISPONIVEIS"\n3. As colunas est√£o corretas: ID, ORIGEM_UF, ORIGEM_CIDADE, DESTINO_UF, DESTINO_CIDADE, KM, TIPO_VEICULO, CAPACIDADE, VALOR_KM, CONTATO, WHATSAPP, STATUS, VALOR_TONELADA, TOTAL, VAI_HTML`);
                }

            } catch (error) {
                alert('‚ùå Erro na sincroniza√ß√£o. Verifique se a planilha est√° p√∫blica.');
            }

            if (btn) btn.disabled = false;
        }

        // Exportar fretes locais para formato CSV (copiar para planilha)
        function exportarFretesParaCSV() {
            if (fretesDisponiveis.length === 0) {
                alert('‚ö†Ô∏è Nenhum frete para exportar');
                return;
            }

            const headers = ['ID', 'ORIGEM_UF', 'ORIGEM_CIDADE', 'DESTINO_UF', 'DESTINO_CIDADE', 'KM', 'TIPO_VEICULO', 'CAPACIDADE', 'VALOR_KM', 'CONTATO', 'WHATSAPP', 'STATUS', 'VALOR_TONELADA', 'TOTAL', 'VAI_HTML'];

            const csvContent = [
                headers.join(','),
                ...fretesDisponiveis.map(f => [
                    f.id,
                    f.origemUF,
                    f.origemCidade,
                    f.destinoUF,
                    f.destinoCidade,
                    f.km,
                    f.tipoVeiculo,
                    f.capacidade,
                    f.valorKM,
                    f.contato,
                    f.whatsapp,
                    f.status,
                    f.valorTonelada.toFixed(2),
                    f.total.toFixed(2),
                    f.vaiHTML ? 'SIM' : 'NAO'
                ].join(','))
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `fretes_export_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);

            alert(`‚úÖ ${fretesDisponiveis.length} fretes exportados para CSV!\n\nImporte o arquivo na aba FRETES_DISPONIVEIS da planilha.`);
        }

        // Exportar leads para CSV
        function exportarLeadsParaCSV() {
            if (leadsCapturados.length === 0) {
                alert('‚ö†Ô∏è Nenhum lead para exportar');
                return;
            }

            const headers = ['ID', 'NOME', 'WHATSAPP', 'INTERESSE_SEGURO', 'TIPO_PROFISSIONAL', 'ROTAS', 'TIPO_VEICULO', 'CAPACIDADE', 'ANO_FAB', 'CARROCERIA', 'RASTREADOR', 'REGIOES', 'TIPOS_CARGA', 'FRETE_ID', 'VALOR_PROPOSTA', 'PRAZO', 'PLACA', 'DISPONIBILIDADE', 'CARGA_RETORNO', 'FORMA_PAGAMENTO', 'PIX', 'CPF', 'CNH', 'ANTT', 'OBSERVACOES', 'STATUS', 'TIMESTAMP_P1', 'TIMESTAMP_P2', 'TIMESTAMP_P3'];

            const csvContent = [
                headers.join(','),
                ...leadsCapturados.map(l => [
                    l.id,
                    `"${l.nome || ''}"`,
                    l.whatsapp || '',
                    l.interesseSeguro || '',
                    l.tipoProfissional || '',
                    `"${(l.rotas || []).join('; ')}"`,
                    l.tipoVeiculo || '',
                    l.capacidade || '',
                    l.anoFab || '',
                    l.carroceria || '',
                    l.rastreador || '',
                    `"${(l.regioes || []).join('; ')}"`,
                    `"${(l.tiposCarga || []).join('; ')}"`,
                    l.freteId || '',
                    l.valorProposta || '',
                    l.prazoEntrega || '',
                    l.placa || '',
                    l.disponibilidade || '',
                    l.cargaRetorno || '',
                    l.formaPagamento || '',
                    l.pix || '',
                    l.cpf || '',
                    l.cnh || '',
                    l.antt || '',
                    `"${(l.observacoes || '').replace(/"/g, '""')}"`,
                    l.status || 'NOVO',
                    l.timestampP1 || '',
                    l.timestampP2 || '',
                    l.timestampP3 || ''
                ].join(','))
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `leads_export_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);

            alert(`‚úÖ ${leadsCapturados.length} leads exportados para CSV!\n\nImporte o arquivo na aba LEADS_CAPTADOS da planilha.`);
        }

        // Abrir planilha no navegador
        function abrirPlanilhaFretes() {
            window.open(`https://docs.google.com/spreadsheets/d/${GOOGLE_SHEETS_CONFIG.spreadsheetId}/edit`, '_blank');
        }

        // ==================== M√ìDULO DE CAPTA√á√ÉO DE LEADS ====================

        // Navega√ß√£o entre etapas
        function irParaEtapa(etapa) {
            // Ocultar todas as etapas
            document.querySelectorAll('.etapa-content').forEach(el => el.style.display = 'none');

            // Mostrar etapa selecionada
            document.getElementById(`etapa${etapa}`).style.display = 'block';

            // Atualizar bot√µes de etapa
            for (let i = 1; i <= 3; i++) {
                const btn = document.getElementById(`etapa${i}Btn`);
                if (btn) {
                    if (i === etapa) {
                        btn.style.background = 'rgba(34, 197, 94, 0.3)';
                        btn.style.borderColor = '#22c55e';
                        btn.querySelector('strong').style.color = '#22c55e';
                    } else if (i < etapa) {
                        btn.style.background = 'rgba(34, 197, 94, 0.2)';
                        btn.style.borderColor = '#22c55e';
                        btn.querySelector('strong').style.color = '#22c55e';
                    } else {
                        btn.style.background = 'rgba(255,255,255,0.05)';
                        btn.style.borderColor = 'rgba(255,255,255,0.2)';
                        btn.querySelector('strong').style.color = '#94a3b8';
                    }
                }
            }

            // Se etapa 3, preencher select de fretes
            if (etapa === 3) {
                atualizarSelectFretesLead();
            }
        }

        function salvarEtapa1() {
            leadAtual.nome = document.getElementById('leadNome').value;
            leadAtual.whatsapp = document.getElementById('leadWhatsApp').value;
            leadAtual.interesseSeguro = document.getElementById('leadSeguro').value;
            leadAtual.tipoProfissional = document.getElementById('leadTipoProfissional').value;
            leadAtual.rotas = [
                document.getElementById('rota1').value,
                document.getElementById('rota2').value,
                document.getElementById('rota3').value,
                document.getElementById('rota4').value,
                document.getElementById('rota5').value
            ].filter(r => r.trim() !== '');
            leadAtual.timestampP1 = new Date().toISOString();

            if (!leadAtual.nome || !leadAtual.whatsapp) {
                alert('‚ö†Ô∏è Preencha Nome e WhatsApp');
                return false;
            }
            return true;
        }

        function salvarEtapa2() {
            leadAtual.tipoVeiculo = document.getElementById('leadTipoVeiculo').value;
            leadAtual.capacidade = document.getElementById('leadCapacidade').value;
            leadAtual.anoFab = document.getElementById('leadAnoFab').value;
            leadAtual.carroceria = document.getElementById('leadCarroceria').value;
            leadAtual.rastreador = document.getElementById('leadRastreador').value;

            leadAtual.regioes = [];
            if (document.getElementById('regiaoSul').checked) leadAtual.regioes.push('SUL');
            if (document.getElementById('regiaoSudeste').checked) leadAtual.regioes.push('SUDESTE');
            if (document.getElementById('regiaoCO').checked) leadAtual.regioes.push('CENTRO-OESTE');
            if (document.getElementById('regiaoNordeste').checked) leadAtual.regioes.push('NORDESTE');
            if (document.getElementById('regiaoNorte').checked) leadAtual.regioes.push('NORTE');

            leadAtual.tiposCarga = [];
            if (document.getElementById('cargaMadeira').checked) leadAtual.tiposCarga.push('MADEIRA');
            if (document.getElementById('cargaCompensados').checked) leadAtual.tiposCarga.push('COMPENSADOS');
            if (document.getElementById('cargaMDF').checked) leadAtual.tiposCarga.push('MDF');
            if (document.getElementById('cargaMoveis').checked) leadAtual.tiposCarga.push('M√ìVEIS');
            if (document.getElementById('cargaGeral').checked) leadAtual.tiposCarga.push('GERAL');
            if (document.getElementById('cargaPerecivel').checked) leadAtual.tiposCarga.push('PEREC√çVEL');
            if (document.getElementById('cargaGranel').checked) leadAtual.tiposCarga.push('GRANEL');

            leadAtual.timestampP2 = new Date().toISOString();
            return true;
        }

        function atualizarSelectFretesLead() {
            const select = document.getElementById('leadFreteId');
            if (!select) return;

            const fretesDisponivelList = fretesDisponiveis.filter(f => f.status === 'DISPONIVEL');

            select.innerHTML = '<option value="">Selecione um frete dispon√≠vel...</option>';
            fretesDisponivelList.forEach(f => {
                select.innerHTML += `<option value="${f.id}" data-rota="${f.origemCidade}/${f.origemUF} ‚Üí ${f.destinoCidade}/${f.destinoUF}" data-valor="${f.total}">${f.id} - ${f.origemCidade} ‚Üí ${f.destinoCidade} (R$ ${f.total.toLocaleString('pt-BR')})</option>`;
            });

            select.onchange = function() {
                const selected = this.options[this.selectedIndex];
                if (selected.value) {
                    document.getElementById('leadRotaFrete').value = selected.dataset.rota;
                    document.getElementById('leadValorSugerido').value = `R$ ${parseFloat(selected.dataset.valor).toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
                } else {
                    document.getElementById('leadRotaFrete').value = '';
                    document.getElementById('leadValorSugerido').value = '';
                }
            };
        }

        function salvarLeadCompleto() {
            leadAtual.freteId = document.getElementById('leadFreteId').value;
            leadAtual.rotaFrete = document.getElementById('leadRotaFrete').value;
            leadAtual.valorSugerido = document.getElementById('leadValorSugerido').value;
            leadAtual.valorProposta = document.getElementById('leadValorProposta').value;
            leadAtual.prazoEntrega = document.getElementById('leadPrazoEntrega').value;
            leadAtual.placa = document.getElementById('leadPlaca').value;
            leadAtual.disponibilidade = document.getElementById('leadDisponibilidade').value;
            leadAtual.cargaRetorno = document.getElementById('leadCargaRetorno').value;
            leadAtual.formaPagamento = document.getElementById('leadFormaPagamento').value;
            leadAtual.adiantamento = document.getElementById('leadAdiantamento').value;
            leadAtual.pix = document.getElementById('leadPix').value;
            leadAtual.banco = document.getElementById('leadBanco').value;
            leadAtual.cpf = document.getElementById('leadCPF').value;
            leadAtual.cnh = document.getElementById('leadCNH').value;
            leadAtual.antt = document.getElementById('leadANTT').value;
            leadAtual.seguroObrigatorio = document.getElementById('leadSeguroObrigatorio').value;
            leadAtual.observacoes = document.getElementById('leadObservacoes').value;
            leadAtual.timestampP3 = new Date().toISOString();
            leadAtual.id = `LEAD${Date.now()}`;
            leadAtual.status = 'NOVO';

            // Salvar lead
            leadsCapturados.push({...leadAtual});
            localStorage.setItem('leadsCapturados', JSON.stringify(leadsCapturados));

            // Atualizar tabela e estat√≠sticas
            renderizarTabelaLeads();
            atualizarEstatisticasLeads();

            alert('‚úÖ Lead salvo com sucesso!');
            limparFormularioLead();
        }

        function limparFormularioLead() {
            leadAtual = {};
            document.querySelectorAll('#captacao input, #captacao select, #captacao textarea').forEach(el => {
                if (el.type === 'checkbox') el.checked = false;
                else el.value = '';
            });
            irParaEtapa(1);
        }

        function renderizarTabelaLeads() {
            const tbody = document.getElementById('tbodyLeads');
            if (!tbody) return;

            if (leadsCapturados.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #94a3b8;">Nenhum lead captado ainda.</td></tr>';
                return;
            }

            tbody.innerHTML = leadsCapturados.map((lead, index) => `
                <tr>
                    <td>${lead.id}</td>
                    <td>${lead.nome}</td>
                    <td>${lead.whatsapp}</td>
                    <td>${lead.tipoVeiculo || '-'}</td>
                    <td>${(lead.regioes || []).join(', ') || '-'}</td>
                    <td>${lead.freteId || '-'}</td>
                    <td>${lead.valorProposta ? 'R$ ' + parseFloat(lead.valorProposta).toLocaleString('pt-BR') : '-'}</td>
                    <td><span class="badge badge-success">${lead.status}</span></td>
                    <td>
                        <button onclick="visualizarLead(${index})" class="btn-secondary" style="padding: 5px 10px; font-size: 0.8em;">üëÅÔ∏è</button>
                        <button onclick="excluirLead(${index})" style="padding: 5px 10px; font-size: 0.8em; background: #ef4444;">üóëÔ∏è</button>
                    </td>
                </tr>
            `).join('');
        }

        function atualizarEstatisticasLeads() {
            const total = leadsCapturados.length;
            const hoje = new Date().toDateString();
            const novosHoje = leadsCapturados.filter(l => new Date(l.timestampP1).toDateString() === hoje).length;
            const comProposta = leadsCapturados.filter(l => l.valorProposta).length;
            const convertidos = leadsCapturados.filter(l => l.status === 'CONVERTIDO').length;

            document.getElementById('statLeadsTotal').textContent = total;
            document.getElementById('statLeadsHoje').textContent = novosHoje;
            document.getElementById('statLeadsComProposta').textContent = comProposta;
            document.getElementById('statLeadsConvertidos').textContent = convertidos;
        }

        function visualizarLead(index) {
            const lead = leadsCapturados[index];
            alert(`üìã LEAD: ${lead.nome}\n\n` +
                `WhatsApp: ${lead.whatsapp}\n` +
                `Tipo Profissional: ${lead.tipoProfissional || '-'}\n` +
                `Ve√≠culo: ${lead.tipoVeiculo || '-'}\n` +
                `Capacidade: ${lead.capacidade || '-'}t\n` +
                `Regi√µes: ${(lead.regioes || []).join(', ') || '-'}\n` +
                `Frete Vinculado: ${lead.freteId || '-'}\n` +
                `Proposta: ${lead.valorProposta ? 'R$ ' + lead.valorProposta : '-'}\n` +
                `Status: ${lead.status}`);
        }

        function excluirLead(index) {
            if (confirm('‚ö†Ô∏è Tem certeza que deseja excluir este lead?')) {
                leadsCapturados.splice(index, 1);
                localStorage.setItem('leadsCapturados', JSON.stringify(leadsCapturados));
                renderizarTabelaLeads();
                atualizarEstatisticasLeads();
            }
        }

        async function enviarLeadParaSheets() {
            salvarLeadCompleto();

            // Preparar dados para envio
            const lead = leadsCapturados[leadsCapturados.length - 1];

            alert('‚úÖ Lead salvo! Para sincronizar com Google Sheets:\n\n' +
                '1. Crie a aba LEADS_CAPTADOS na planilha\n' +
                '2. Configure o Google Apps Script para receber dados\n' +
                '3. Os dados ser√£o enviados automaticamente');
        }

        // Carregar configura√ß√µes ao iniciar
        document.addEventListener('DOMContentLoaded', function() {
            carregarTema();
            if (document.getElementById('evolutionUrl')) carregarConfigEvolution();
            if (document.getElementById('openaiKey')) carregarAPIKeys();
            renderizarListasTransmissao();
            carregarContatosGoogleSheets();

            // Inicializar m√≥dulos de Fretes e Leads
            inicializarDropdownsUF();
            renderizarTabelaFretes();
            atualizarEstatisticasFretes();
            renderizarTabelaLeads();
            atualizarEstatisticasLeads();

            // Tentar carregar dados do Google Sheets automaticamente
            carregarEstadosCidadesDoSheets().then(() => {
                console.log('‚úÖ Estados/Cidades verificados');
            });

            carregarFretesDoSheets().then(qtd => {
                if (qtd > 0) {
                    console.log(`‚úÖ ${qtd} fretes carregados do Google Sheets`);
                } else {
                    console.log('‚ÑπÔ∏è Usando fretes do localStorage');
                }
            });

            console.log('Planilha integrada:', GOOGLE_SHEETS_CONFIG.spreadsheetName);
            console.log('M√≥dulo Fretes carregado:', fretesDisponiveis.length, 'fretes');
            console.log('M√≥dulo Leads carregado:', leadsCapturados.length, 'leads');
        });
    </script>
    <script src="SCRIPTS/enside_ia_widget.js"></script>
</body>
</html>