<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Fretes - Admin</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        .header {
            background: linear-gradient(135deg, rgba(0,0,0,0.8) 0%, rgba(26,26,46,0.8) 100%);
            padding: 30px;
            border-radius: 15px;
            border: 3px solid #FFD700;
            margin-bottom: 30px;
            text-align: center;
        }
        .header h1 { color: #FFD700; font-size: 2.5em; text-shadow: 0 0 20px rgba(255,215,0,0.5); }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        .stat-card {
            background: linear-gradient(135deg, rgba(255,215,0,0.1) 0%, rgba(255,215,0,0.05) 100%);
            border: 2px solid #FFD700;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
        }
        .stat-number { font-size: 3em; font-weight: 900; color: #FFD700; }
        .stat-label { color: #94a3b8; margin-top: 10px; font-size: 1.1em; }
        .form-section {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,215,0,0.3);
            border-radius: 15px;
            padding: 40px;
            margin-bottom: 40px;
        }
        .form-title { font-size: 2em; color: #FFD700; margin-bottom: 30px; text-align: center; }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .form-group { margin-bottom: 20px; }
        .form-group.full { grid-column: 1 / -1; }
        .form-label {
            display: block;
            color: #FFD700;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,215,0,0.3);
            border-radius: 8px;
            color: #fff;
            font-size: 1em;
        }
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #FFD700;
            box-shadow: 0 0 15px rgba(255,215,0,0.2);
        }
        .form-textarea { min-height: 100px; resize: vertical; font-family: inherit; }
        .form-select option { background: #1a1a2e; }
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 0;
        }
        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        .btn {
            padding: 18px 40px;
            border: none;
            border-radius: 10px;
            font-weight: 900;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }
        .btn-primary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            box-shadow: 0 5px 20px rgba(16,185,129,0.3);
        }
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(16,185,129,0.5);
        }
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            margin-left: 15px;
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .freights-list {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,215,0,0.3);
            border-radius: 15px;
            padding: 30px;
        }
        .freight-item {
            background: rgba(255,255,255,0.03);
            border: 2px solid rgba(255,215,0,0.2);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        .freight-item:hover {
            border-color: #FFD700;
            transform: translateX(5px);
        }
        .freight-item.urgent { border-color: #dc2626; background: rgba(220,38,38,0.1); }
        .freight-route { font-size: 1.5em; font-weight: 700; color: #FFD700; margin-bottom: 10px; }
        .freight-value { font-size: 1.8em; font-weight: 900; color: #10b981; }
        .success-message {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            display: none;
            font-size: 1.1em;
            font-weight: 600;
        }
        @media (max-width: 768px) {
            .form-grid { grid-template-columns: 1fr; }
            .btn-secondary { margin-left: 0; margin-top: 10px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöõ Cadastro de Fretes - Painel Admin</h1>
            <p style="color: #94a3b8; margin-top: 10px;">Anderson Enside Log√≠stica</p>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="statFretes">0</div>
                <div class="stat-label">Fretes Cadastrados</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="statPropostas">0</div>
                <div class="stat-label">Propostas Recebidas</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="statMotoristas">0</div>
                <div class="stat-label">Motoristas Ativos</div>
            </div>
        </div>

        <div class="form-section">
            <h2 class="form-title">üìù Cadastrar Novo Frete</h2>
            
            <div class="success-message" id="successMessage">
                ‚úÖ Frete cadastrado com sucesso!
            </div>

            <form id="freteForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Estado Origem *</label>
                        <select id="origemUF" class="form-select" required></select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Cidade Origem *</label>
                        <input type="text" id="origemCidade" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Estado Destino *</label>
                        <select id="destinoUF" class="form-select" required></select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Cidade Destino *</label>
                        <input type="text" id="destinoCidade" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Dist√¢ncia (km) *</label>
                        <input type="number" id="distanciaKm" class="form-input" min="1" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Valor Sugerido (R$) *</label>
                        <input type="number" id="valorSugerido" class="form-input" step="0.01" min="100" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tipo de Ve√≠culo *</label>
                        <select id="tipoVeiculo" class="form-select" required></select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tipo de Carga *</label>
                        <select id="tipoCarga" class="form-select" required></select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Peso (toneladas) *</label>
                        <input type="number" id="pesoTon" class="form-input" step="0.1" min="0.1" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data Embarque *</label>
                        <input type="date" id="dataEmbarque" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">N√∫mero de Vagas</label>
                        <input type="number" id="vagas" class="form-input" value="1" min="1">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select id="status" class="form-select">
                            <option value="ATIVO">ATIVO</option>
                            <option value="INATIVO">INATIVO</option>
                        </select>
                    </div>
                    <div class="form-group full">
                        <div class="checkbox-group">
                            <input type="checkbox" id="urgente">
                            <label class="form-label" for="urgente" style="margin-bottom: 0;">üî• Marcar como URGENTE</label>
                        </div>
                    </div>
                    <div class="form-group full">
                        <label class="form-label">Observa√ß√µes</label>
                        <textarea id="observacoes" class="form-textarea" placeholder="Informa√ß√µes adicionais sobre o frete..."></textarea>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button type="submit" class="btn btn-primary" id="btnSalvar">üíæ Cadastrar Frete</button>
                    <button type="button" class="btn btn-secondary" onclick="document.getElementById('freteForm').reset();">üîÑ Limpar Formul√°rio</button>
                </div>
            </form>
        </div>

        <div class="freights-list">
            <h2 class="form-title">üìã Fretes Cadastrados</h2>
            <div id="fretesLista">
                <p style="text-align: center; color: #94a3b8;">Carregando...</p>
            </div>
        </div>
    </div>

    <script src="../config.js"></script>
    <script src="../api-integration.js"></script>
    <script>
        async function init() {
            preencherSelects();
            await carregarEstatisticas();
            await carregarFretes();
        }

        function preencherSelects() {
            const config = window.CAPTACAO_CONFIG;
            
            const origemUF = document.getElementById('origemUF');
            const destinoUF = document.getElementById('destinoUF');
            for (const [uf, nome] of Object.entries(config.estados)) {
                origemUF.innerHTML += `<option value="${uf}">${uf} - ${nome}</option>`;
                destinoUF.innerHTML += `<option value="${uf}">${uf} - ${nome}</option>`;
            }
            
            const tipoVeiculo = document.getElementById('tipoVeiculo');
            config.tiposVeiculo.forEach(tipo => {
                tipoVeiculo.innerHTML += `<option value="${tipo}">${tipo}</option>`;
            });
            
            const tipoCarga = document.getElementById('tipoCarga');
            config.tiposCarga.forEach(tipo => {
                tipoCarga.innerHTML += `<option value="${tipo}">${tipo}</option>`;
            });
        }

        async function carregarEstatisticas() {
            try {
                const fretes = await window.captacaoAPI.buscarDoSheets('FRETES_DISPONIVEIS');
                const propostas = await window.captacaoAPI.buscarDoSheets('PROPOSTAS_FRETES');
                const motoristas = await window.captacaoAPI.buscarDoSheets('CAPTACAO_FRETES');
                
                document.getElementById('statFretes').textContent = fretes.length || 0;
                document.getElementById('statPropostas').textContent = propostas.length || 0;
                document.getElementById('statMotoristas').textContent = motoristas.length || 0;
            } catch (erro) {
                console.log('Usando dados est√°ticos');
            }
        }

        async function carregarFretes() {
            try {
                const fretes = await window.captacaoAPI.buscarFretesDisponiveis();
                const lista = document.getElementById('fretesLista');
                
                if (fretes.length === 0) {
                    lista.innerHTML = '<p style="text-align: center; color: #94a3b8;">Nenhum frete cadastrado ainda.</p>';
                    return;
                }
                
                lista.innerHTML = fretes.map(f => `
                    <div class="freight-item ${f.URGENTE === 'SIM' ? 'urgent' : ''}">
                        ${f.URGENTE === 'SIM' ? '<div style="color: #dc2626; font-weight: 700; margin-bottom: 10px;">üî• URGENTE</div>' : ''}
                        <div class="freight-route">${f.ORIGEM_CIDADE}-${f.ORIGEM_UF} ‚Üí ${f.DESTINO_CIDADE}-${f.DESTINO_UF}</div>
                        <div class="freight-value">${window.CAPTACAO_CONFIG.utils.formatarMoeda(f.VALOR_SUGERIDO)}</div>
                        <div style="color: #94a3b8; margin-top: 10px;">
                            ${f.DISTANCIA_KM} km | ${f.TIPO_VEICULO} | ${f.TIPO_CARGA} | ${f.PESO_TON}t
                        </div>
                        <div style="color: #94a3b8; margin-top: 5px;">
                            Status: ${f.STATUS} | Data: ${f.DATA_EMBARQUE}
                        </div>
                    </div>
                `).join('');
            } catch (erro) {
                console.error('Erro ao carregar fretes:', erro);
            }
        }

        document.getElementById('freteForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const btn = document.getElementById('btnSalvar');
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '‚è≥ Salvando...';
            
            try {
                const dados = {
                    origemUF: document.getElementById('origemUF').value,
                    origemCidade: document.getElementById('origemCidade').value,
                    destinoUF: document.getElementById('destinoUF').value,
                    destinoCidade: document.getElementById('destinoCidade').value,
                    distanciaKm: document.getElementById('distanciaKm').value,
                    valorSugerido: document.getElementById('valorSugerido').value,
                    tipoVeiculo: document.getElementById('tipoVeiculo').value,
                    tipoCarga: document.getElementById('tipoCarga').value,
                    pesoTon: document.getElementById('pesoTon').value,
                    dataEmbarque: document.getElementById('dataEmbarque').value,
                    vagas: document.getElementById('vagas').value,
                    status: document.getElementById('status').value,
                    urgente: document.getElementById('urgente').checked,
                    observacoes: document.getElementById('observacoes').value
                };
                
                await window.captacaoAPI.salvarFrete(dados);
                
                document.getElementById('successMessage').style.display = 'block';
                document.getElementById('freteForm').reset();
                
                setTimeout(() => {
                    document.getElementById('successMessage').style.display = 'none';
                }, 3000);
                
                await carregarEstatisticas();
                await carregarFretes();
                
            } catch (erro) {
                console.error('Erro ao salvar frete:', erro);
                alert('Erro ao salvar frete. Tente novamente.');
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        });

        window.addEventListener('load', init);
    </script>
</body>
</html>
