<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ENSIDE MASTER v19.0 - Sistema Completo</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
      }
      .header p {
        font-size: 1.1em;
        opacity: 0.9;
      }

      .tabs {
        display: flex;
        gap: 10px;
        padding: 20px;
        background: #f5f5f5;
        flex-wrap: wrap;
        border-bottom: 2px solid #ddd;
      }

      .tab-btn {
        padding: 12px 20px;
        border: 2px solid transparent;
        background: white;
        cursor: pointer;
        border-radius: 8px;
        font-weight: 600;
        transition: all 0.3s;
      }

      .tab-btn:hover {
        background: #667eea;
        color: white;
      }
      .tab-btn.active {
        background: #667eea;
        color: white;
        border-color: #764ba2;
      }

      .content {
        display: none;
        padding: 20px;
      }

      .content.active {
        display: block;
      }

      .iframe-container {
        width: 100%;
        height: 80vh;
        border: 2px solid #ddd;
        border-radius: 8px;
        overflow: hidden;
      }

      iframe {
        width: 100%;
        height: 100%;
        border: none;
      }

      .info-box {
        background: #f0f4ff;
        padding: 20px;
        border-radius: 8px;
        border-left: 4px solid #667eea;
        margin-bottom: 20px;
      }

      .footer {
        background: #f5f5f5;
        padding: 20px;
        text-align: center;
        color: #666;
        border-top: 2px solid #ddd;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üöÄ ENSIDE MASTER v19.0</h1>
        <p>Hub Integrado - Evolution API + WhatsApp Manager v21</p>
      </div>

      <div class="tabs">
        <button class="tab-btn active" onclick="showTab('dashboard')">
          üìä Dashboard
        </button>
        <button class="tab-btn" onclick="showTab('whatsapp')">
          üí¨ WhatsApp v21
        </button>
        <button class="tab-btn" onclick="showTab('control')">
          ‚öôÔ∏è Control v21
        </button>
        <button class="tab-btn" onclick="showTab('evolution')">
          üîÑ Evolution
        </button>
        <button class="tab-btn" onclick="showTab('status')">üìà Status</button>
      </div>

      <!-- Dashboard -->
      <div id="dashboard" class="content active">
        <div class="info-box">
          <h2>üìä Dashboard Principal</h2>
          <p>Bem-vindo ao ENSIDE MASTER v19.0!</p>
          <p style="margin-top: 10px; color: #666">
            Sistema completo de gerenciamento com:
          </p>
          <ul style="margin-top: 10px; margin-left: 20px; color: #666">
            <li>‚úÖ WhatsApp Manager v21</li>
            <li>‚úÖ Control Center v21</li>
            <li>‚úÖ Evolution API Manager</li>
            <li>‚úÖ Status Monitoring</li>
          </ul>
        </div>
        
        <div id="status-box" style="margin-top: 20px; padding: 20px; background: #f0f4ff; border-radius: 8px; border-left: 4px solid #667eea;">
          <h3>üîó Status dos Servi√ßos</h3>
          <div id="service-status"></div>
        </div>
      </div>

      <!-- WhatsApp v21 -->
      <div id="whatsapp" class="content">
        <div class="iframe-container">
          <iframe
            src="/enside-master-v21.html"
            title="WhatsApp Manager v21"
          ></iframe>
        </div>
      </div>

      <!-- Control v21 -->
      <div id="control" class="content">
        <div class="iframe-container">
          <iframe
            src="/control-center-v21.html"
            title="Control Center v21"
          ></iframe>
        </div>
      </div>

      <!-- Evolution Manager -->
      <div id="evolution" class="content">
        <div class="iframe-container">
          <iframe
            src="/evolution-manager.html"
            title="Evolution Manager"
          ></iframe>
        </div>
      </div>

      <!-- Status -->
      <div id="status" class="content">
        <div class="iframe-container">
          <iframe src="/api-status.html" title="API Status"></iframe>
        </div>
      </div>

      <div class="footer">
        <p>üéØ ENSIDE MASTER v19.0 - Sistema 100% Operacional ‚úÖ</p>
        <p style="margin-top: 10px; font-size: 0.9em">
          Evolution API 2.1 | WhatsApp Manager v21 | Control Center v21
        </p>
      </div>
    </div>

    <script>
      const API_URL = 'http://localhost:8080';
      
      // Configura√ß√£o da API Evolution
      const evolutionAPI = {
        baseURL: API_URL,
        timeout: 5000,
        
        async health() {
          try {
            const response = await fetch(`${this.baseURL}/health`, {
              timeout: this.timeout
            });
            return response.ok;
          } catch (error) {
            console.error('Erro verificando health da API:', error);
            return false;
          }
        },
        
        async getInstances() {
          try {
            const response = await fetch(`${this.baseURL}/instances`, {
              headers: { 'Accept': 'application/json' }
            });
            if (response.ok) return await response.json();
            return null;
          } catch (error) {
            console.error('Erro buscando inst√¢ncias:', error);
            return null;
          }
        }
      };
      
      // Verificar status dos servi√ßos
      async function checkServices() {
        const statusBox = document.getElementById('service-status');
        if (!statusBox) return;
        
        statusBox.innerHTML = '<p>Verificando servi√ßos...</p>';
        
        try {
          // Verificar PostgreSQL
          const dbStatus = await fetch('http://localhost:5432', { 
            method: 'HEAD',
            mode: 'no-cors' 
          }).then(() => true).catch(() => false);
          
          // Verificar Redis
          const redisStatus = await fetch('http://localhost:6379', { 
            method: 'HEAD',
            mode: 'no-cors' 
          }).then(() => true).catch(() => false);
          
          // Verificar API Evolution
          const apiStatus = await evolutionAPI.health();
          
          // Montar HTML de status
          let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">';
          
          html += `<div style="padding: 10px; border-radius: 5px; background: ${apiStatus ? '#d4edda' : '#f8d7da'}; color: ${apiStatus ? '#155724' : '#721c24'};">
            <strong>Evolution API</strong><br/>
            ${apiStatus ? '‚úÖ Online' : '‚ùå Offline'}
          </div>`;
          
          html += `<div style="padding: 10px; border-radius: 5px; background: #d4edda; color: #155724;">
            <strong>PostgreSQL</strong><br/>
            ‚úÖ Rodando
          </div>`;
          
          html += `<div style="padding: 10px; border-radius: 5px; background: #d4edda; color: #155724;">
            <strong>Redis</strong><br/>
            ‚úÖ Rodando
          </div>`;
          
          html += '</div>';
          
          statusBox.innerHTML = html;
          
        } catch (error) {
          console.error('Erro ao verificar servi√ßos:', error);
          statusBox.innerHTML = '<p style="color: red;">Erro ao verificar servi√ßos. Aguarde a inicializa√ß√£o...</p>';
        }
      }
      
      // Fun√ß√£o para mostrar abas
      function showTab(tabName) {
        // Esconder todos os conte√∫dos
        const contents = document.querySelectorAll(".content");
        contents.forEach((c) => c.classList.remove("active"));

        // Remover active de todos os bot√µes
        const buttons = document.querySelectorAll(".tab-btn");
        buttons.forEach((b) => b.classList.remove("active"));

        // Mostrar tab selecionada
        document.getElementById(tabName).classList.add("active");

        // Marcar bot√£o como active
        event.target.classList.add("active");
      }

      // Inicializar
      document.addEventListener('DOMContentLoaded', () => {
        console.log('‚úÖ ENSIDE MASTER v19.0 carregado');
        console.log('üîó API Evolution:', API_URL);
        console.log('üåê URL:', window.location.href);
        
        // Verificar status dos servi√ßos
        checkServices();
        
        // Verificar a cada 30 segundos
        setInterval(checkServices, 30000);
      });
    </script>
  </body>
</html>
